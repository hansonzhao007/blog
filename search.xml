<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Ethereum Project Infrastructure</title>
    <url>/blog/Ethereum-Project-Infrastructure/</url>
    <content><![CDATA[<h1 id="Prepare"><a href="#Prepare" class="headerlink" title="Prepare"></a>Prepare</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir kickstart</span><br><span class="line"><span class="built_in">cd</span> kickstart</span><br><span class="line">npm init <span class="comment"># create package.json file</span></span><br><span class="line">npm install --save ganache-cli mocha solc fs-extra web3@1.0.0-beta.26</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><p>Create a blockchain kickstart website.</p>
<h2 id="Contract"><a href="#Contract" class="headerlink" title="Contract"></a>Contract</h2><p><img src="contract.png" alt="contract"></p>
<h2 id="Structure"><a href="#Structure" class="headerlink" title="Structure"></a>Structure</h2><p><img src="structure.png" alt="structure"><br><img src="overview.png" alt="overview"><br><img src="interact.png" alt="interact"></p>
<ol>
<li>create a factory contract. It has a function to deploy a new instance of <code>Campaign</code></li>
<li>User clicks <code>Create Campaign</code></li>
<li>We instruct web3/metamask to show user a transaction that invokes <code>Campaign Factory</code></li>
<li>User pays deployment costs. Factory deploy a new copy of <code>Campaign</code></li>
<li>We tell <code>Campaign Factory</code> to give us a list of all deployed campaigns.</li>
</ol>
<h1 id=""><a href="#" class="headerlink" title=""></a></h1>]]></content>
      <categories>
        <category>blockchain</category>
      </categories>
      <tags>
        <tag>ethereum</tag>
        <tag>web3</tag>
      </tags>
  </entry>
  <entry>
    <title>Dapp: Lottery Contract</title>
    <url>/blog/Dapp-Lottery-Contract/</url>
    <content><![CDATA[<h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Lottery Contract</span><br><span class="line"></span><br><span class="line"><span class="comment"># Variables</span></span><br><span class="line">Name            Purpose</span><br><span class="line">manager:    Address of person who created the contract</span><br><span class="line">players:    Array of addresses of people who entered</span><br><span class="line"></span><br><span class="line"><span class="comment"># Function</span></span><br><span class="line">Name            Purpose</span><br><span class="line">enter:      Enters a player into lottery</span><br><span class="line">pickWinner: Randomly picks a winner and sends them the prize pool</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h1 id="Solidity-Variable"><a href="#Solidity-Variable" class="headerlink" title="Solidity Variable"></a>Solidity Variable</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Name                Notes                                    Examples</span><br><span class="line">string          Sequence of characthers                     <span class="string">"hi there"</span></span><br><span class="line">bool            Boolen value                                <span class="literal">true</span>, <span class="literal">false</span></span><br><span class="line">int             Integer, positive or negative.              0, -300000</span><br><span class="line">uint            unsigned <span class="built_in">integer</span>                            0, 3000000</span><br><span class="line">fixed/ufixed    <span class="string">'Fixes'</span> point number                        20.0001, -43.0002</span><br><span class="line">address         Has methods tied to it <span class="keyword">for</span> sending money    0x01C65bfDeD8c69ef3C28d4EF58F1dA</span><br></pre></td></tr></table></figure>

<h1 id="Reference-type"><a href="#Reference-type" class="headerlink" title="Reference type"></a>Reference type</h1><ul>
<li><code>fixed array</code>:  Array the contains a single type of element. length is fixed. int[3] ‚Äì&gt; [1,2,3]</li>
<li><code>dynamic array</code>: Array the contains a single type of element. length can change over time. int[] ‚Äì&gt;[1,2,3]</li>
<li><code>mapping</code>: Collection of key value pairs.  mapping(string =&gt; int)</li>
<li><code>struct</code>: Collection of key value pairs that can have different types</li>
</ul>
<h1 id="msg-global-variable"><a href="#msg-global-variable" class="headerlink" title="msg global variable"></a>msg global variable</h1><ul>
<li><code>msg.data</code>: ‚ÄòData‚Äô field from the call or transaction that invoked the current function</li>
<li><code>msg.gas</code> : Amount of gas the current function invocation has available</li>
<li><code>msg.sender</code>: Address of account that started the current function invocation</li>
<li><code>msg.value</code>: Amount of ether (in wei) that was sent along with the function invocation</li>
</ul>
<h1 id="Lottery-logic"><a href="#Lottery-logic" class="headerlink" title="Lottery logic"></a>Lottery logic</h1><p><img src="logic.png" alt="logic"></p>
<p><img src="logic2.png" alt="logic2"></p>
<figure class="highlight js"><figcaption><span>:contracts/Lottery.sol</span></figcaption><table><tr><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.17</span>;</span><br><span class="line"></span><br><span class="line">contract Lottery &#123;</span><br><span class="line">    address public manager;</span><br><span class="line">    address[] public players;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">constructor</span> () public &#123;</span><br><span class="line">        manager = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">enter</span>(<span class="params"></span>)  <span class="title">public</span> <span class="title">payable</span></span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.value &gt;= <span class="number">.01</span> ether, <span class="string">"send at least 0.01 ether"</span>);</span><br><span class="line">        players.push(msg.sender);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">random</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> uint(sha3(block.difficulty, now, players));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// function modifier, reduce code we need to write</span></span><br><span class="line">    modifier onlyManagerCanCall() &#123;</span><br><span class="line">        <span class="comment">// only manage can pick winner</span></span><br><span class="line">        <span class="built_in">require</span>(msg.sender == manager, <span class="string">"you don't have authority"</span>);</span><br><span class="line">        _; <span class="comment">// all code in your function will replace the "_"</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">pickWinner</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">onlyManagerCanCall</span></span>&#123;</span><br><span class="line">        uint index = random() % players.length;</span><br><span class="line">        <span class="comment">// this.balance has all the ether in current smart contract</span></span><br><span class="line">        players[index].transfer(address(<span class="keyword">this</span>).balance); </span><br><span class="line">        <span class="comment">// inital dynamic array whose length is 0;</span></span><br><span class="line">        players = <span class="keyword">new</span> address[](<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getPlayers</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">address[]</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> players;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can test this on remix.</p>
<h1 id="Create-a-test-case"><a href="#Create-a-test-case" class="headerlink" title="Create a test case"></a>Create a test case</h1><figure class="highlight js"><figcaption><span>:test/Lottery.test.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> assert = <span class="built_in">require</span>(<span class="string">'assert'</span>);</span><br><span class="line"><span class="keyword">const</span> ganache = <span class="built_in">require</span>(<span class="string">'ganache-cli'</span>);</span><br><span class="line"><span class="keyword">const</span> Web3 = <span class="built_in">require</span>(<span class="string">'web3'</span>)</span><br><span class="line"><span class="keyword">const</span> web3 = <span class="keyword">new</span> Web3(ganache.provider());</span><br><span class="line"><span class="keyword">const</span> &#123;interface, bytecode&#125; = <span class="built_in">require</span>(<span class="string">'../compile'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> lottery;</span><br><span class="line"><span class="keyword">let</span> accounts;</span><br><span class="line"></span><br><span class="line">beforeEach(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// Get a list of all accounts</span></span><br><span class="line">    accounts = <span class="keyword">await</span> web3.eth.getAccounts();</span><br><span class="line">    </span><br><span class="line">    lottery = <span class="keyword">await</span> <span class="keyword">new</span> web3.eth.Contract(<span class="built_in">JSON</span>.parse(interface))</span><br><span class="line">    .deploy(&#123;<span class="attr">data</span>: bytecode&#125;)</span><br><span class="line">    .send(&#123;<span class="attr">from</span>: accounts[<span class="number">0</span>], <span class="attr">gas</span>: <span class="string">'1000000'</span>&#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'Lottery Contract'</span>, () =&gt; &#123;</span><br><span class="line">    it(<span class="string">'deploys a contract'</span>, () =&gt; &#123;</span><br><span class="line">        assert.ok(lottery.options.address);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'allow one account to enter'</span>, <span class="keyword">async</span>() =&gt; &#123;</span><br><span class="line">        <span class="keyword">await</span> lottery.methods.enter().send(&#123;<span class="attr">from</span>: accounts[<span class="number">0</span>], <span class="attr">value</span>: web3.utils.toWei(<span class="string">'0.02'</span>, <span class="string">'ether'</span>)&#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> players = <span class="keyword">await</span> lottery.methods.getPlayers().call(&#123;</span><br><span class="line">            <span class="keyword">from</span>: accounts[<span class="number">0</span>]</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        assert.equal(accounts[<span class="number">0</span>], players[<span class="number">0</span>]);</span><br><span class="line">        assert.equal(<span class="number">1</span>, players.length);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'allow multi account to enter'</span>, <span class="keyword">async</span>() =&gt; &#123;</span><br><span class="line">        <span class="keyword">await</span> lottery.methods.enter().send(&#123;<span class="attr">from</span>: accounts[<span class="number">0</span>], <span class="attr">value</span>: web3.utils.toWei(<span class="string">'0.02'</span>, <span class="string">'ether'</span>)&#125;);</span><br><span class="line">        <span class="keyword">await</span> lottery.methods.enter().send(&#123;<span class="attr">from</span>: accounts[<span class="number">1</span>], <span class="attr">value</span>: web3.utils.toWei(<span class="string">'0.02'</span>, <span class="string">'ether'</span>)&#125;);</span><br><span class="line">        <span class="keyword">await</span> lottery.methods.enter().send(&#123;<span class="attr">from</span>: accounts[<span class="number">2</span>], <span class="attr">value</span>: web3.utils.toWei(<span class="string">'0.02'</span>, <span class="string">'ether'</span>)&#125;);</span><br><span class="line">        <span class="keyword">const</span> players = <span class="keyword">await</span> lottery.methods.getPlayers().call(&#123;</span><br><span class="line">            <span class="keyword">from</span>: accounts[<span class="number">0</span>]</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        assert.equal(accounts[<span class="number">0</span>], players[<span class="number">0</span>]);</span><br><span class="line">        assert.equal(accounts[<span class="number">1</span>], players[<span class="number">1</span>]);</span><br><span class="line">        assert.equal(accounts[<span class="number">2</span>], players[<span class="number">2</span>]);</span><br><span class="line">        assert.equal(<span class="number">3</span>, players.length);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'requires a minimum amount of ether to enter'</span>, <span class="keyword">async</span>() =&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">await</span> lottery.methods.enter().send(&#123;</span><br><span class="line">                <span class="keyword">from</span>: accounts[<span class="number">0</span>],</span><br><span class="line">                value: <span class="number">0</span></span><br><span class="line">            &#125;);</span><br><span class="line">            assert(<span class="literal">false</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            assert(err);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'only manage can call pickWinner'</span>, <span class="keyword">async</span>() =&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">await</span> lottery.methods.pickWinner().send(&#123;</span><br><span class="line">                <span class="keyword">from</span>: accounts[<span class="number">1</span>],</span><br><span class="line">            &#125;);</span><br><span class="line">            assert(<span class="literal">false</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            assert(err);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'sends money to the winner and resets the players'</span>, <span class="keyword">async</span>() =&gt; &#123;</span><br><span class="line">        <span class="keyword">await</span> lottery.methods.enter().send(&#123;</span><br><span class="line">            <span class="keyword">from</span>: accounts[<span class="number">0</span>],</span><br><span class="line">            value: web3.utils.toWei(<span class="string">'2'</span>, <span class="string">'ether'</span>)</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> initialBalance = <span class="keyword">await</span> web3.eth.getBalance(accounts[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">await</span> lottery.methods.pickWinner().send(&#123;<span class="attr">from</span>: accounts[<span class="number">0</span>]&#125;);</span><br><span class="line">        <span class="keyword">const</span> finalBalance = <span class="keyword">await</span> web3.eth.getBalance(accounts[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">const</span> difference = finalBalance - initialBalance;</span><br><span class="line">        <span class="comment">// console.log(difference);</span></span><br><span class="line">        assert(difference &gt; web3.utils.toWei(<span class="string">'1.8'</span>, <span class="string">'ether'</span>));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><figcaption><span>:./compile.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> solc = <span class="built_in">require</span>(<span class="string">'solc'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Path = path.resolve(__dirname, <span class="string">'contracts'</span>, <span class="string">'Lottery.sol'</span>);</span><br><span class="line"><span class="keyword">const</span> source = fs.readFileSync(Path, <span class="string">'utf8'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = solc.compile(source, <span class="number">1</span>).contracts[<span class="string">':Lottery'</span>];</span><br><span class="line"><span class="comment">// console.log(solc.compile(source, 1))</span></span><br></pre></td></tr></table></figure>

<p>then rum <code>npm run test</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mac@HansonMac ÓÇ∞ ~/Code/blockchain ÓÇ∞ npm run <span class="built_in">test</span></span><br><span class="line">&gt; inbox@ <span class="built_in">test</span> /Users/mac/Code/blockchain</span><br><span class="line">&gt; mocha</span><br><span class="line">Lottery Contract</span><br><span class="line">(node:32122) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 data listeners added. Use emitter.setMaxListeners() to increase <span class="built_in">limit</span></span><br><span class="line">    ‚úì deploys a contract</span><br><span class="line">    ‚úì allow one account to enter (56ms)</span><br><span class="line">    ‚úì allow multi account to enter (103ms)</span><br><span class="line">    ‚úì requires a minimum amount of ether to enter</span><br><span class="line">    ‚úì only manage can call pickWinner</span><br><span class="line">    ‚úì sends money to the winner and resets the players (74ms)</span><br></pre></td></tr></table></figure>

<h1 id="Web-of-ethereum-architecture"><a href="#Web-of-ethereum-architecture" class="headerlink" title="Web of ethereum architecture"></a>Web of ethereum architecture</h1><p><img src="arch.png" alt=""></p>
<p><img src="metamask.png" alt=""></p>
<p>Metamask running in Chrome will inject web3 v2.0 automatically.</p>
<p>Our app will use web3 v1.0, and we want to hijack our provider into Metamask one.</p>
<h2 id="install-react-create-new-project-and-install-web3"><a href="#install-react-create-new-project-and-install-web3" class="headerlink" title="install react, create new project and install web3"></a>install react, create new project and install web3</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mac@HansonMac ÓÇ∞ ~/Code: sudo npm install -g create-react-app</span><br><span class="line">mac@HansonMac ÓÇ∞ ~/Code: create-react-app lottery-react</span><br><span class="line"></span><br><span class="line">Creating a new React app <span class="keyword">in</span> /Users/mac/Code/lottery-react.</span><br><span class="line"></span><br><span class="line">Installing packages. This might take a couple of minutes.</span><br><span class="line">Installing react, react-dom, and react-scripts...</span><br><span class="line"></span><br><span class="line">yarn add v1.10.1</span><br><span class="line">[1/4] üîç  Resolving packages...</span><br><span class="line">[2/4] üöö  Fetching packages...</span><br><span class="line">[3/4] üîó  Linking dependencies...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">mac@HansonMac ÓÇ∞ ~/Code: yarn add web3@1.0.0-beta.26</span><br><span class="line">mac@HansonMac ÓÇ∞ ~/Code: npm run start</span><br></pre></td></tr></table></figure>


<h2 id="Hijack-Metamask-web3-to-our-version"><a href="#Hijack-Metamask-web3-to-our-version" class="headerlink" title="Hijack Metamask web3 to our version"></a>Hijack Metamask web3 to our version</h2><figure class="highlight js"><figcaption><span>:src/web3.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Web3 <span class="keyword">from</span> <span class="string">'web3'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// inject our web3 v1.0</span></span><br><span class="line"><span class="keyword">const</span> web3 = <span class="keyword">new</span> Web3(<span class="built_in">window</span>.web3.currentProvider);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> web3;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><figcaption><span>:src/App.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">// add this to App.js</span></span><br><span class="line"><span class="keyword">import</span> web3 <span class="keyword">from</span> <span class="string">'./web3'</span></span><br></pre></td></tr></table></figure>

<h2 id="Deploy-Lottery-contract-to-Rinkeby"><a href="#Deploy-Lottery-contract-to-Rinkeby" class="headerlink" title="Deploy Lottery contract to Rinkeby"></a>Deploy Lottery contract to Rinkeby</h2><figure class="highlight js"><figcaption><span>:./deploy.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> HDWalletProvider = <span class="built_in">require</span>(<span class="string">'truffle-hdwallet-provider'</span>);</span><br><span class="line"><span class="keyword">const</span> Web3 = <span class="built_in">require</span>(<span class="string">'web3'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;interface, bytecode&#125; = <span class="built_in">require</span>(<span class="string">'./compile'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> provider = <span class="keyword">new</span> HDWalletProvider (</span><br><span class="line">    <span class="string">'dinosaur erupt zoo ...'</span>,</span><br><span class="line">    <span class="string">'https://rinkeby.infura.io/v3/451daf892abb4101b6845******'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> web3 = <span class="keyword">new</span> Web3(provider);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> deploy = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> accounts = <span class="keyword">await</span> web3.eth.getAccounts();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Attempting to deploy from account'</span>, accounts[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="keyword">new</span> web3.eth.Contract(<span class="built_in">JSON</span>.parse(interface))</span><br><span class="line">    .deploy(&#123;<span class="attr">data</span>: bytecode&#125;)</span><br><span class="line">    .send(&#123;<span class="attr">gas</span>: <span class="string">'5000000'</span>, <span class="attr">from</span>: accounts[<span class="number">0</span>]&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(interface);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Contract deployed to'</span>, result.options.address);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">deploy();</span><br></pre></td></tr></table></figure>

<p>after run <code>node deploy.js</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Attempting to deploy from account 0x01C65bfDeD8c69ef3C28d4EF58F1dA46DeAF13Cd</span><br><span class="line">[&#123;<span class="string">"constant"</span>:<span class="literal">true</span>,<span class="string">"inputs"</span>:[],<span class="string">"name"</span>:<span class="string">"manager"</span>,<span class="string">"outputs"</span>:[&#123;<span class="string">"name"</span>:<span class="string">""</span>,<span class="string">"type"</span>:<span class="string">"address"</span>&#125;],<span class="string">"payable"</span>:<span class="literal">false</span>,<span class="string">"stateMutability"</span>:<span class="string">"view"</span>,<span class="string">"type"</span>:<span class="string">"function"</span>&#125;,&#123;<span class="string">"constant"</span>:<span class="literal">false</span>,<span class="string">"inputs"</span>:[],<span class="string">"name"</span>:<span class="string">"pickWinner"</span>,<span class="string">"outputs"</span>:[],<span class="string">"payable"</span>:<span class="literal">false</span>,<span class="string">"stateMutability"</span>:<span class="string">"nonpayable"</span>,<span class="string">"type"</span>:<span class="string">"function"</span>&#125;,&#123;<span class="string">"constant"</span>:<span class="literal">true</span>,<span class="string">"inputs"</span>:[],<span class="string">"name"</span>:<span class="string">"random"</span>,<span class="string">"outputs"</span>:[&#123;<span class="string">"name"</span>:<span class="string">""</span>,<span class="string">"type"</span>:<span class="string">"uint256"</span>&#125;],<span class="string">"payable"</span>:<span class="literal">false</span>,<span class="string">"stateMutability"</span>:<span class="string">"view"</span>,<span class="string">"type"</span>:<span class="string">"function"</span>&#125;,&#123;<span class="string">"constant"</span>:<span class="literal">true</span>,<span class="string">"inputs"</span>:[],<span class="string">"name"</span>:<span class="string">"getPlayers"</span>,<span class="string">"outputs"</span>:[&#123;<span class="string">"name"</span>:<span class="string">""</span>,<span class="string">"type"</span>:<span class="string">"address[]"</span>&#125;],<span class="string">"payable"</span>:<span class="literal">false</span>,<span class="string">"stateMutability"</span>:<span class="string">"view"</span>,<span class="string">"type"</span>:<span class="string">"function"</span>&#125;,&#123;<span class="string">"constant"</span>:<span class="literal">false</span>,<span class="string">"inputs"</span>:[],<span class="string">"name"</span>:<span class="string">"enter"</span>,<span class="string">"outputs"</span>:[],<span class="string">"payable"</span>:<span class="literal">true</span>,<span class="string">"stateMutability"</span>:<span class="string">"payable"</span>,<span class="string">"type"</span>:<span class="string">"function"</span>&#125;,&#123;<span class="string">"constant"</span>:<span class="literal">true</span>,<span class="string">"inputs"</span>:[&#123;<span class="string">"name"</span>:<span class="string">""</span>,<span class="string">"type"</span>:<span class="string">"uint256"</span>&#125;],<span class="string">"name"</span>:<span class="string">"players"</span>,<span class="string">"outputs"</span>:[&#123;<span class="string">"name"</span>:<span class="string">""</span>,<span class="string">"type"</span>:<span class="string">"address"</span>&#125;],<span class="string">"payable"</span>:<span class="literal">false</span>,<span class="string">"stateMutability"</span>:<span class="string">"view"</span>,<span class="string">"type"</span>:<span class="string">"function"</span>&#125;,&#123;<span class="string">"inputs"</span>:[],<span class="string">"payable"</span>:<span class="literal">false</span>,<span class="string">"stateMutability"</span>:<span class="string">"nonpayable"</span>,<span class="string">"type"</span>:<span class="string">"constructor"</span>&#125;]</span><br><span class="line">Contract deployed to 0x2a8683527b110f5f37502CD5c7C62f574A75499A</span><br></pre></td></tr></table></figure>

<h2 id="Import-ABI"><a href="#Import-ABI" class="headerlink" title="Import ABI"></a>Import ABI</h2><p>create a new file <code>lottery.js</code> in <code>src</code> folder. And copy all the ABI and deployed address.</p>
<figure class="highlight js"><figcaption><span>:src/lottery.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> web3 <span class="keyword">from</span> <span class="string">`./web3`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> address = <span class="string">'0x2a8683527b110f5f37502CD5c7C62f574A75499A'</span>;</span><br><span class="line"><span class="keyword">const</span> abi = [&#123;</span><br><span class="line">    <span class="string">"constant"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"inputs"</span>: [],</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"manager"</span>,</span><br><span class="line">    <span class="string">"outputs"</span>: [&#123;</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"type"</span>: <span class="string">"address"</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">"payable"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"stateMutability"</span>: <span class="string">"view"</span>,</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"function"</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="string">"constant"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"inputs"</span>: [],</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"pickWinner"</span>,</span><br><span class="line">    <span class="string">"outputs"</span>: [],</span><br><span class="line">    <span class="string">"payable"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"stateMutability"</span>: <span class="string">"nonpayable"</span>,</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"function"</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="string">"constant"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"inputs"</span>: [],</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"random"</span>,</span><br><span class="line">    <span class="string">"outputs"</span>: [&#123;</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"type"</span>: <span class="string">"uint256"</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">"payable"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"stateMutability"</span>: <span class="string">"view"</span>,</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"function"</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="string">"constant"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"inputs"</span>: [],</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"getPlayers"</span>,</span><br><span class="line">    <span class="string">"outputs"</span>: [&#123;</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"type"</span>: <span class="string">"address[]"</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">"payable"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"stateMutability"</span>: <span class="string">"view"</span>,</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"function"</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="string">"constant"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"inputs"</span>: [],</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"enter"</span>,</span><br><span class="line">    <span class="string">"outputs"</span>: [],</span><br><span class="line">    <span class="string">"payable"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"stateMutability"</span>: <span class="string">"payable"</span>,</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"function"</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="string">"constant"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"inputs"</span>: [&#123;</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"type"</span>: <span class="string">"uint256"</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"players"</span>,</span><br><span class="line">    <span class="string">"outputs"</span>: [&#123;</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"type"</span>: <span class="string">"address"</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">"payable"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"stateMutability"</span>: <span class="string">"view"</span>,</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"function"</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="string">"inputs"</span>: [],</span><br><span class="line">    <span class="string">"payable"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"stateMutability"</span>: <span class="string">"nonpayable"</span>,</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"constructor"</span></span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> web3.eth.Contract(abi, address);</span><br></pre></td></tr></table></figure>

<p><img src="abi.png" alt="abi"></p>
<h2 id="Rendering-Contract-Data"><a href="#Rendering-Contract-Data" class="headerlink" title="Rendering Contract Data"></a>Rendering Contract Data</h2><p>Modify <code>src/App.js</code> code. See source code here:<br><a href="https://github.com/hansonzhao007/lottery/blob/master/src/App.js" target="_blank" rel="noopener">https://github.com/hansonzhao007/lottery/blob/master/src/App.js</a></p>
<h2 id="Deploying-React-app-to-GitHub-Pages"><a href="#Deploying-React-app-to-GitHub-Pages" class="headerlink" title="Deploying React app to GitHub Pages"></a>Deploying React app to GitHub Pages</h2><p>create a new repository, and connect your project.</p>
<p>install <code>gh-pages</code> package</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install gh-pages --save-dev</span><br></pre></td></tr></table></figure>

<p>Add some properties to the app‚Äôs package.json file</p>
<figure class="highlight js"><figcaption><span>:./package.json</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="string">"homepage"</span>: <span class="string">"http://gitname.github.io/react-gh-pages"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="string">"predeploy"</span>: <span class="string">"npm run build"</span>,</span><br><span class="line">  <span class="string">"deploy"</span>: <span class="string">"gh-pages -d build"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Generate a production build of your app, and deploy it to GitHub Pages</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm run deploy</span><br></pre></td></tr></table></figure>

<p>You can see the example on <a href="http://xszhao.science/lottery" target="_blank" rel="noopener">http://xszhao.science/lottery</a></p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://github.com/gitname/react-gh-pages" target="_blank" rel="noopener">Deploying a React App* to GitHub Pages</a></p>
]]></content>
      <categories>
        <category>blockchain</category>
      </categories>
      <tags>
        <tag>ethereum</tag>
        <tag>web3</tag>
      </tags>
  </entry>
  <entry>
    <title>Write ethereum test code</title>
    <url>/blog/Write-ethereum-test-code/</url>
    <content><![CDATA[<h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><p>The fold tree is like following:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">--| contracts</span><br><span class="line">----| Inbox.sol</span><br><span class="line">--| <span class="built_in">test</span></span><br><span class="line">----| Inbox_test.js</span><br><span class="line">--| compile.js</span><br><span class="line">--| package.json</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><h2 id="Smart-Contract"><a href="#Smart-Contract" class="headerlink" title="Smart Contract"></a>Smart Contract</h2><figure class="highlight js"><figcaption><span>:Inbox.sol</span></figcaption><table><tr><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.17</span>;</span><br><span class="line"></span><br><span class="line">contract Inbox &#123;</span><br><span class="line">    <span class="comment">// a globle store</span></span><br><span class="line">    string public message;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Inbox</span>(<span class="params">string initialMessage</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        message = initialMessage;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setMessage</span>(<span class="params">string newMessage</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        message = newMessage;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Compile-Script"><a href="#Compile-Script" class="headerlink" title="Compile Script"></a>Compile Script</h2><figure class="highlight js"><figcaption><span>:compile.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> solc = <span class="built_in">require</span>(<span class="string">'solc'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> inboxPath = path.resolve(__dirname, <span class="string">'contracts'</span>, <span class="string">'Inbox.sol'</span>);</span><br><span class="line"><span class="keyword">const</span> source = fs.readFileSync(inboxPath, <span class="string">'utf8'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(solc.compile(source, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// export the smart contract bytecode and interface, which are used to create or deploy a contract, interact with the contract.</span></span><br><span class="line"><span class="comment">// module.exports = solc.compile(source, 1).contracts[':Inbox'];</span></span><br></pre></td></tr></table></figure>

<p>run <code>node compile</code>:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123; contracts:</span><br><span class="line">  <span class="comment"># we will see multiple contract pairs if we use compile.js to compile multiple smart contracts</span></span><br><span class="line">   &#123; <span class="string">':Inbox'</span>: <span class="comment"># contract name</span></span><br><span class="line">      &#123; assembly: [Object],</span><br><span class="line">        <span class="comment"># `bytecode is the actual content that is deployed on ethereum network`</span></span><br><span class="line">        bytecode: <span class="string">'608060405234801561001057600080fd5b5060405161038c38038061038c83398101604052805101805161003a906000906020840190610041565b50506100dc565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061008257805160ff19168380011785556100af565b828001600101855582156100af579182015b828111156100af578251825591602001919060010190610094565b506100bb9291506100bf565b5090565b6100d991905b808211156100bb57600081556001016100c5565b90565b6102a1806100eb6000396000f30060806040526004361061004b5763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663368b87728114610050578063e21f37ce146100ab575b600080fd5b34801561005c57600080fd5b506040805160206004803580820135601f81018490048402850184019095528484526100a99436949293602493928401919081908401838280828437509497506101359650505050505050565b005b3480156100b757600080fd5b506100c061014c565b6040805160208082528351818301528351919283929083019185019080838360005b838110156100fa5781810151838201526020016100e2565b50505050905090810190601f1680156101275780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b80516101489060009060208401906101da565b5050565b6000805460408051602060026001851615610100026000190190941693909304601f810184900484028201840190925281815292918301828280156101d25780601f106101a7576101008083540402835291602001916101d2565b820191906000526020600020905b8154815290600101906020018083116101b557829003601f168201915b505050505081565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061021b57805160ff1916838001178555610248565b82800160010185558215610248579182015b8281111561024857825182559160200191906001019061022d565b50610254929150610258565b5090565b61027291905b80821115610254576000815560010161025e565b905600a165627a7a72305820387e3a84c249a8fe3de554c17239e7aefa478da030f9a901807f3b1989c4d9020029'</span>,</span><br><span class="line">        functionHashes: [Object],</span><br><span class="line">        gasEstimates: [Object],</span><br><span class="line">        <span class="comment"># `Our contract ABI`</span></span><br><span class="line">        <span class="comment"># `List out all the function we can use`</span></span><br><span class="line">        interface: <span class="string">'[&#123;"constant":false,"inputs":[&#123;"name":"newMessage","type":"string"&#125;],"name":"setMessage","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"&#125;,&#123;"constant":true,"inputs":[],"name":"message","outputs":[&#123;"name":"","type":"string"&#125;],"payable":false,"stateMutability":"view","type":"function"&#125;,&#123;"inputs":[&#123;"name":"initialMessage","type":"string"&#125;],"payable":false,"stateMutability":"nonpayable","type":"constructor"&#125;]'</span>,</span><br><span class="line">        metadata: <span class="string">'&#123;"compiler":&#123;"version":"0.4.25+commit.59dbf8f1"&#125;,"language":"Solidity","output":&#123;"abi":[&#123;"constant":false,"inputs":[&#123;"name":"newMessage","type":"string"&#125;],"name":"setMessage","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"&#125;,&#123;"constant":true,"inputs":[],"name":"message","outputs":[&#123;"name":"","type":"string"&#125;],"payable":false,"stateMutability":"view","type":"function"&#125;,&#123;"inputs":[&#123;"name":"initialMessage","type":"string"&#125;],"payable":false,"stateMutability":"nonpayable","type":"constructor"&#125;],"devdoc":&#123;"methods":&#123;&#125;&#125;,"userdoc":&#123;"methods":&#123;&#125;&#125;&#125;,"settings":&#123;"compilationTarget":&#123;"":"Inbox"&#125;,"evmVersion":"byzantium","libraries":&#123;&#125;,"optimizer":&#123;"enabled":true,"runs":200&#125;,"remappings":[]&#125;,"sources":&#123;"":&#123;"keccak256":"0xcbb1d3ea37d011841c666c5ac8aeb21eacca3d151de9e40dde61095138cc17c0","urls":["bzzr://2d2ff492c4461ba96d5e54274865acbc8bdb43f00337d4222681d001a6ea05f3"]&#125;&#125;,"version":1&#125;'</span>,</span><br><span class="line">        opcodes: <span class="string">'PUSH1 0x80 PUSH1 0x40 MSTORE CALLVALUE DUP1 ISZERO PUSH2 0x10 JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST POP PUSH1 0x40MLOAD PUSH2 0x38C CODESIZE SUB DUP1 PUSH2 0x38C DUP4 CODECOPY DUP2 ADD PUSH1 0x40 MSTORE DUP1 MLOAD ADD DUP1 MLOAD PUSH2 0x3A SWAP1PUSH1 0x0 SWAP1 PUSH1 0x20 DUP5 ADD SWAP1 PUSH2 0x41 JUMP JUMPDEST POP POP PUSH2 0xDC JUMP JUMPDEST DUP3 DUP1 SLOAD PUSH1 0x1 DUP2 PUSH1 0x1 AND ISZERO PUSH2 0x100 MUL SUB AND PUSH1 0x2 SWAP1 DIV SWAP1 PUSH1 0x0 MSTORE PUSH1 0x20 PUSH1 0x0 KECCAK256 SWAP1 PUSH1 0x1F ADD PUSH1 0x20 SWAP1 DIV DUP2 ADD SWAP3 DUP3 PUSH1 0x1F LT PUSH2 0x82 JUMPI DUP1 MLOAD PUSH1 0xFF NOT AND DUP4 DUP1 ADD OR DUP6 SSTORE PUSH2 0xAF JUMP JUMPDEST DUP3 DUP1 ADD PUSH1 0x1 ADD DUP6 SSTORE DUP3 ISZERO PUSH2 0xAF JUMPI SWAP2 DUP3 ADD JUMPDEST DUP3 DUP2 GT ISZERO PUSH2 0xAF JUMPI DUP3 MLOAD DUP3 SSTORE SWAP2 PUSH1 0x20 ADD SWAP2 SWAP1 PUSH1 0x1 ADD SWAP1 PUSH2 0x94 JUMP JUMPDEST POP PUSH2 0xBB SWAP3 SWAP2 POP PUSH2 0xBF JUMP JUMPDEST POP SWAP1 JUMP JUMPDEST PUSH2 0xD9 SWAP2 SWAP1 JUMPDEST DUP1 DUP3 GT ISZERO PUSH2 0xBB JUMPI PUSH1 0x0 DUP2 SSTORE PUSH1 0x1 ADD PUSH2 0xC5 JUMP JUMPDEST SWAP1 JUMP JUMPDEST PUSH2 0x2A1 DUP1 PUSH2 0xEB PUSH1 0x0 CODECOPY PUSH1 0x0 RETURN STOP PUSH1 0x80 PUSH1 0x40 MSTORE PUSH1 0x4 CALLDATASIZE LT PUSH2 0x4B JUMPI PUSH4 0xFFFFFFFF PUSH29 0x100000000000000000000000000000000000000000000000000000000 PUSH1 0x0 CALLDATALOAD DIV AND PUSH4 0x368B8772 DUP2 EQ PUSH2 0x50 JUMPI DUP1 PUSH4 0xE21F37CE EQ PUSH2 0xAB JUMPI JUMPDEST PUSH1 0x0 DUP1 REVERT JUMPDEST CALLVALUE DUP1 ISZERO PUSH2 0x5C JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST POP PUSH1 0x40 DUP1 MLOAD PUSH1 0x20 PUSH1 0x4 DUP1 CALLDATALOAD DUP1 DUP3 ADD CALLDATALOAD PUSH1 0x1F DUP2 ADD DUP5 SWAP1 DIV DUP5 MUL DUP6 ADD DUP5 ADD SWAP1 SWAP6 MSTORE DUP5 DUP5 MSTORE PUSH2 0xA9 SWAP5 CALLDATASIZE SWAP5 SWAP3 SWAP4 PUSH1 0x24 SWAP4 SWAP3 DUP5 ADD SWAP2 SWAP1 DUP2 SWAP1 DUP5 ADD DUP4 DUP3 DUP1 DUP3 DUP5 CALLDATACOPY POP SWAP5 SWAP8 POP PUSH2 0x135 SWAP7POP POP POP POP POP POP POP JUMP JUMPDEST STOP JUMPDEST CALLVALUE DUP1 ISZERO PUSH2 0xB7 JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST POP PUSH2 0xC0 PUSH2 0x14C JUMP JUMPDEST PUSH1 0x40 DUP1 MLOAD PUSH1 0x20 DUP1 DUP3 MSTORE DUP4 MLOAD DUP2 DUP4 ADD MSTORE DUP4 MLOAD SWAP2 SWAP3 DUP4 SWAP3 SWAP1 DUP4 ADD SWAP2 DUP6 ADD SWAP1 DUP1 DUP4 DUP4 PUSH1 0x0 JUMPDEST DUP4 DUP2 LT ISZERO PUSH2 0xFA JUMPI DUP2 DUP2 ADD MLOAD DUP4 DUP3 ADD MSTORE PUSH1 0x20 ADD PUSH2 0xE2 JUMP JUMPDEST POP POP POP POP SWAP1 POP SWAP1 DUP2 ADD SWAP1 PUSH1 0x1F AND DUP1 ISZERO PUSH2 0x127 JUMPI DUP1 DUP3 SUB DUP1 MLOAD PUSH1 0x1 DUP4 PUSH1 0x20 SUB PUSH2 0x100 EXP SUB NOT AND DUP2 MSTORE PUSH1 0x20 ADD SWAP2 POP JUMPDEST POP SWAP3 POP POP POP PUSH1 0x40 MLOAD DUP1 SWAP2 SUB SWAP1 RETURN JUMPDEST DUP1 MLOAD PUSH2 0x148 SWAP1 PUSH1 0x0 SWAP1 PUSH1 0x20 DUP5 ADD SWAP1 PUSH2 0x1DA JUMP JUMPDEST POP POP JUMP JUMPDEST PUSH1 0x0 DUP1 SLOAD PUSH1 0x40 DUP1MLOAD PUSH1 0x20 PUSH1 0x2 PUSH1 0x1 DUP6 AND ISZERO PUSH2 0x100 MUL PUSH1 0x0 NOT ADD SWAP1 SWAP5 AND SWAP4 SWAP1 SWAP4 DIV PUSH1 0x1F DUP2 ADD DUP5 SWAP1 DIV DUP5 MUL DUP3 ADD DUP5 ADD SWAP1 SWAP3 MSTORE DUP2 DUP2 MSTORE SWAP3 SWAP2 DUP4 ADD DUP3 DUP3 DUP1 ISZERO PUSH2 0x1D2 JUMPI DUP1 PUSH1 0x1F LT PUSH2 0x1A7 JUMPI PUSH2 0x100 DUP1 DUP4 SLOAD DIV MUL DUP4 MSTORE SWAP2 PUSH1 0x20 ADD SWAP2PUSH2 0x1D2 JUMP JUMPDEST DUP3 ADD SWAP2 SWAP1 PUSH1 0x0 MSTORE PUSH1 0x20 PUSH1 0x0 KECCAK256 SWAP1 JUMPDEST DUP2 SLOAD DUP2 MSTORE SWAP1 PUSH1 0x1 ADD SWAP1 PUSH1 0x20 ADD DUP1 DUP4 GT PUSH2 0x1B5 JUMPI DUP3 SWAP1 SUB PUSH1 0x1F AND DUP3 ADD SWAP2 JUMPDEST POP POP POP POP POP DUP2 JUMP JUMPDEST DUP3 DUP1 SLOAD PUSH1 0x1 DUP2 PUSH1 0x1 AND ISZERO PUSH2 0x100 MUL SUB AND PUSH1 0x2 SWAP1 DIV SWAP1 PUSH1 0x0 MSTORE PUSH1 0x20 PUSH1 0x0 KECCAK256 SWAP1 PUSH1 0x1F ADD PUSH1 0x20 SWAP1 DIV DUP2 ADD SWAP3 DUP3 PUSH1 0x1F LT PUSH2 0x21B JUMPI DUP1 MLOAD PUSH1 0xFF NOT AND DUP4 DUP1 ADD OR DUP6 SSTORE PUSH2 0x248 JUMP JUMPDEST DUP3 DUP1 ADD PUSH1 0x1 ADD DUP6SSTORE DUP3 ISZERO PUSH2 0x248 JUMPI SWAP2 DUP3 ADD JUMPDEST DUP3 DUP2 GT ISZERO PUSH2 0x248 JUMPI DUP3 MLOAD DUP3 SSTORE SWAP2 PUSH1 0x20 ADD SWAP2 SWAP1 PUSH1 0x1 ADD SWAP1 PUSH2 0x22D JUMP JUMPDEST POP PUSH2 0x254 SWAP3 SWAP2 POP PUSH2 0x258 JUMP JUMPDEST POP SWAP1 JUMP JUMPDEST PUSH2 0x272 SWAP2 SWAP1 JUMPDEST DUP1 DUP3 GT ISZERO PUSH2 0x254 JUMPI PUSH1 0x0 DUP2 SSTORE PUSH1 0x1 ADD PUSH20x25E JUMP JUMPDEST SWAP1 JUMP STOP LOG1 PUSH6 0x627A7A723058 KECCAK256 CODESIZE PUSH31 0x3A84C249A8FE3DE554C17239E7AEFA478DA030F9A901807F3B1989C4D90200 0x29 '</span>,</span><br><span class="line">        runtimeBytecode: <span class="string">'60806040526004361061004b5763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663368b87728114610050578063e21f37ce146100ab575b600080fd5b34801561005c57600080fd5b506040805160206004803580820135601f81018490048402850184019095528484526100a99436949293602493928401919081908401838280828437509497506101359650505050505050565b005b3480156100b757600080fd5b506100c061014c565b6040805160208082528351818301528351919283929083019185019080838360005b838110156100fa5781810151838201526020016100e2565b50505050905090810190601f1680156101275780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b80516101489060009060208401906101da565b5050565b6000805460408051602060026001851615610100026000190190941693909304601f810184900484028201840190925281815292918301828280156101d25780601f106101a7576101008083540402835291602001916101d2565b820191906000526020600020905b8154815290600101906020018083116101b557829003601f168201915b505050505081565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061021b57805160ff1916838001178555610248565b82800160010185558215610248579182015b8281111561024857825182559160200191906001019061022d565b50610254929150610258565b5090565b61027291905b80821115610254576000815560010161025e565b905600a165627a7a72305820387e3a84c249a8fe3de554c17239e7aefa478da030f9a901807f3b1989c4d9020029'</span>,</span><br><span class="line">        srcmap: <span class="string">'26:242:0:-;;;87:86;8:9:-1;5:2;;;30:1;27;20:12;5:2;87:86:0;;;;;;;;;;;;;;;;;142:24;;;;:7;;:24;;;;;:::i;:::-;;87:86;26:242;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;-1:-1:-1;26:242:0;;;-1:-1:-1;26:242:0;:::i;:::-;;;:::o;:::-;;;;;;;;;;;;;;;;;;;;:::o;:::-;;;;;;;'</span>,</span><br><span class="line">        srcmapRuntime: <span class="string">'26:242:0:-;;;;;;;;;;;;;;;;;;;;;;;;;;;;183:83;;8:9:-1;5:2;;;30:1;27;20:12;5:2;-1:-1;183:83:0;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;-1:-1:-1;183:83:0;;-1:-1:-1;183:83:0;;-1:-1:-1;;;;;;;183:83:0;;;55:21;;8:9:-1;5:2;;;30:1;27;20:12;5:2;55:21:0;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;8:100:-1;33:3;30:1;27:10;8:100;;;90:11;;;84:18;71:11;;;64:39;52:2;45:10;8:100;;;12:14;55:21:0;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;183:83;239:20;;;;:7;;:20;;;;;:::i;:::-;;183:83;:::o;55:21::-;;;;;;;;;;;;;;;-1:-1:-1;;55:21:0;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;:::o;26:242::-;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;-1:-1:-1;26:242:0;;;-1:-1:-1;26:242:0;:::i;:::-;;;:::o;:::-;;;;;;;;;;;;;;;;;;;;:::o'</span> &#125; &#125;,</span><br><span class="line">  errors:</span><br><span class="line">   [ <span class="string">':7:5: Warning: Defining constructors as functions with the same name as the contract is deprecated. Use "constructor(...) &#123; ... &#125;" instead.\n    function Inbox(string initialMessage) public &#123;\n    ^ (Relevant source part starts here and spans across multiple lines).\n'</span> ],</span><br><span class="line">  sourceList: [ <span class="string">''</span> ],</span><br><span class="line">  sources: &#123; <span class="string">''</span>: &#123; AST: [Object] &#125; &#125; &#125;</span><br></pre></td></tr></table></figure>
<h2 id="Test-case"><a href="#Test-case" class="headerlink" title="Test case"></a>Test case</h2><figure class="highlight js"><figcaption><span>:Inbox_test.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> assert = <span class="built_in">require</span>(<span class="string">'assert'</span>);</span><br><span class="line"><span class="keyword">const</span> ganache = <span class="built_in">require</span>(<span class="string">'ganache-cli'</span>);</span><br><span class="line"><span class="keyword">const</span> Web3 = <span class="built_in">require</span>(<span class="string">'web3'</span>)</span><br><span class="line"><span class="keyword">const</span> web3 = <span class="keyword">new</span> Web3(ganache.provider());</span><br><span class="line"><span class="comment">// in order to use the compiled module, change the last line in compile.js to </span></span><br><span class="line"><span class="comment">// module.exports = solc.compile(source, 1).contracts[':Inbox'];</span></span><br><span class="line"><span class="keyword">const</span> &#123;interface, bytecode&#125; = <span class="built_in">require</span>(<span class="string">'../compile'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> accounts;</span><br><span class="line"></span><br><span class="line">beforeEach(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// Get a list of all accounts</span></span><br><span class="line">    accounts = <span class="keyword">await</span> web3.eth.getAccounts();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Use one of those accounts to deploy</span></span><br><span class="line">    <span class="comment">// the constract</span></span><br><span class="line">    inbox = <span class="keyword">await</span> <span class="keyword">new</span> web3.eth.Contract(<span class="built_in">JSON</span>.parse(interface)) </span><br><span class="line">    <span class="comment">// use web3 module eth, and the function Contract of eth module. </span></span><br><span class="line">    <span class="comment">// This function can be used to interact with the contract exist </span></span><br><span class="line">    <span class="comment">// in blockchain or deploy a new contract instance.</span></span><br><span class="line">    .deploy(&#123;<span class="attr">data</span>: bytecode, <span class="attr">arguments</span>: [<span class="string">'Hi there!'</span>]&#125;)</span><br><span class="line">    <span class="comment">// create a smart contract, create a new instance and call Inbox() function</span></span><br><span class="line">    <span class="comment">// passing argument 'Hi there!'. deploy the instance to ethereum</span></span><br><span class="line">    .send(&#123;<span class="attr">from</span>: accounts[<span class="number">0</span>], <span class="attr">gas</span>: <span class="string">'1000000'</span>&#125;);</span><br><span class="line">    <span class="comment">// Instructs web3 to send out a transaction that creates this contract</span></span><br><span class="line">    <span class="comment">// specify who is going to deploying the contract</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">describe(<span class="string">'Inbox'</span>, () =&gt; &#123;</span><br><span class="line">    it(<span class="string">'deploys a contract'</span>, () =&gt; &#123;</span><br><span class="line">        assert.ok(inbox.options.address);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'has a default message'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> message = <span class="keyword">await</span> inbox.methods.message().call();</span><br><span class="line">        assert.equal(message, <span class="string">'Hi there!'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'can change message'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="comment">// because you want to modify, so you need to identify who is going to change and the gas you want to pay</span></span><br><span class="line">        <span class="keyword">await</span> inbox.methods.setMessage(<span class="string">'bye'</span>).send(&#123;<span class="attr">from</span>: accounts[<span class="number">0</span>], <span class="attr">gas</span>: <span class="string">'1000000'</span>&#125;);</span><br><span class="line">        <span class="keyword">const</span> message = <span class="keyword">await</span> inbox.methods.message().call();</span><br><span class="line">        assert.equal(message, <span class="string">'bye'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>then run <code>npm run text</code>:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; inbox@ <span class="built_in">test</span> /Users/mac/Code/blockchain</span><br><span class="line">&gt; mocha</span><br><span class="line"></span><br><span class="line">  Inbox</span><br><span class="line">(node:24604) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 data listeners added. Use emitter.setMaxListeners() to increase <span class="built_in">limit</span></span><br><span class="line">Contract &#123;</span><br><span class="line">  currentProvider: [Getter/Setter],</span><br><span class="line">  _requestManager:</span><br><span class="line">   RequestManager &#123;</span><br><span class="line">     provider:</span><br><span class="line">      l &#123;</span><br><span class="line">        domain: null,</span><br><span class="line">        _events: [Object],</span><br><span class="line">        _eventsCount: 1,</span><br><span class="line">        _maxListeners: undefined,</span><br><span class="line">        options: [Object],</span><br><span class="line">        engine: [Object],</span><br><span class="line">        manager: [Object],</span><br><span class="line">        sendAsync: [Function: bound ],</span><br><span class="line">        send: [Function: bound ],</span><br><span class="line">        close: [Function: bound ],</span><br><span class="line">        _queueRequest: [Function: bound ],</span><br><span class="line">        _processRequestQueue: [Function: bound ],</span><br><span class="line">        _requestQueue: [],</span><br><span class="line">        _requestInProgress: <span class="literal">false</span> &#125;,</span><br><span class="line">     providers:</span><br><span class="line">      &#123; WebsocketProvider: [Function: WebsocketProvider],</span><br><span class="line">        HttpProvider: [Function: HttpProvider],</span><br><span class="line">        IpcProvider: [Function: IpcProvider] &#125;,</span><br><span class="line">     subscriptions: &#123;&#125; &#125;,</span><br><span class="line">  givenProvider: null,</span><br><span class="line">  <span class="comment"># the communication layer with actual block chain</span></span><br><span class="line">  providers:</span><br><span class="line">   &#123; WebsocketProvider: [Function: WebsocketProvider],</span><br><span class="line">     HttpProvider: [Function: HttpProvider],</span><br><span class="line">     IpcProvider: [Function: IpcProvider] &#125;,</span><br><span class="line">  _provider:</span><br><span class="line">   l &#123;</span><br><span class="line">     domain: null,</span><br><span class="line">     _events: &#123; data: [Array] &#125;,</span><br><span class="line">     _eventsCount: 1,</span><br><span class="line">     _maxListeners: undefined,</span><br><span class="line">     options:</span><br><span class="line">      &#123; vmErrorsOnRPCResponse: <span class="literal">true</span>,</span><br><span class="line">        verbose: <span class="literal">false</span>,</span><br><span class="line">        asyncRequestProcessing: <span class="literal">false</span>,</span><br><span class="line">        logger: [Object],</span><br><span class="line">        seed: <span class="string">'lE5BIQtDPC'</span>,</span><br><span class="line">        mnemonic: <span class="string">'fetch frequent marble basket mad split print order census canyon spot ugly'</span>,</span><br><span class="line">        network_id: 1541867444670,</span><br><span class="line">        total_accounts: 10,</span><br><span class="line">        gasPrice: <span class="string">'0x77359400'</span>,</span><br><span class="line">        default_balance_ether: 100,</span><br><span class="line">        unlocked_accounts: [],</span><br><span class="line">        hdPath: <span class="string">'m/44\'</span>/60\<span class="string">'/0\'</span>/0/<span class="string">',</span></span><br><span class="line"><span class="string">        gasLimit: '</span>0x6691b7<span class="string">',</span></span><br><span class="line"><span class="string">        defaultTransactionGasLimit: '</span>0x15f90<span class="string">',</span></span><br><span class="line"><span class="string">        time: null,</span></span><br><span class="line"><span class="string">        debug: false,</span></span><br><span class="line"><span class="string">        allowUnlimitedContractSize: false &#125;,</span></span><br><span class="line"><span class="string">     engine:</span></span><br><span class="line"><span class="string">      s &#123;</span></span><br><span class="line"><span class="string">        domain: null,</span></span><br><span class="line"><span class="string">        _events: [Object],</span></span><br><span class="line"><span class="string">        _eventsCount: 1,</span></span><br><span class="line"><span class="string">        _maxListeners: 100,</span></span><br><span class="line"><span class="string">        _blockTracker: [Object],</span></span><br><span class="line"><span class="string">        _ready: [Object],</span></span><br><span class="line"><span class="string">        currentBlock: [Object],</span></span><br><span class="line"><span class="string">        _providers: [Array],</span></span><br><span class="line"><span class="string">        manager: [Object] &#125;,</span></span><br><span class="line"><span class="string">     manager:</span></span><br><span class="line"><span class="string">      s &#123;</span></span><br><span class="line"><span class="string">        state: [Object],</span></span><br><span class="line"><span class="string">        options: [Object],</span></span><br><span class="line"><span class="string">        initialized: true,</span></span><br><span class="line"><span class="string">        initialization_error: null,</span></span><br><span class="line"><span class="string">        post_initialization_callbacks: [],</span></span><br><span class="line"><span class="string">        engine: [Object],</span></span><br><span class="line"><span class="string">        currentBlock: [Object] &#125;,</span></span><br><span class="line"><span class="string">     sendAsync: [Function: bound ],</span></span><br><span class="line"><span class="string">     send: [Function: bound ],</span></span><br><span class="line"><span class="string">     close: [Function: bound ],</span></span><br><span class="line"><span class="string">     _queueRequest: [Function: bound ],</span></span><br><span class="line"><span class="string">     _processRequestQueue: [Function: bound ],</span></span><br><span class="line"><span class="string">     _requestQueue: [],</span></span><br><span class="line"><span class="string">     _requestInProgress: false &#125;,</span></span><br><span class="line"><span class="string">  setProvider: [Function],</span></span><br><span class="line"><span class="string">  BatchRequest: [Function: bound Batch],</span></span><br><span class="line"><span class="string">  extend:</span></span><br><span class="line"><span class="string">   &#123; [Function: ex]</span></span><br><span class="line"><span class="string">     formatters:</span></span><br><span class="line"><span class="string">      &#123; inputDefaultBlockNumberFormatter: [Function: inputDefaultBlockNumberFormatter],</span></span><br><span class="line"><span class="string">        inputBlockNumberFormatter: [Function: inputBlockNumberFormatter],</span></span><br><span class="line"><span class="string">        inputCallFormatter: [Function: inputCallFormatter],</span></span><br><span class="line"><span class="string">        inputTransactionFormatter: [Function: inputTransactionFormatter],</span></span><br><span class="line"><span class="string">        inputAddressFormatter: [Function: inputAddressFormatter],</span></span><br><span class="line"><span class="string">        inputPostFormatter: [Function: inputPostFormatter],</span></span><br><span class="line"><span class="string">        inputLogFormatter: [Function: inputLogFormatter],</span></span><br><span class="line"><span class="string">        inputSignFormatter: [Function: inputSignFormatter],</span></span><br><span class="line"><span class="string">        outputBigNumberFormatter: [Function: outputBigNumberFormatter],</span></span><br><span class="line"><span class="string">        outputTransactionFormatter: [Function: outputTransactionFormatter],</span></span><br><span class="line"><span class="string">        outputTransactionReceiptFormatter: [Function: outputTransactionReceiptFormatter],</span></span><br><span class="line"><span class="string">        outputBlockFormatter: [Function: outputBlockFormatter],</span></span><br><span class="line"><span class="string">        outputLogFormatter: [Function: outputLogFormatter],</span></span><br><span class="line"><span class="string">        outputPostFormatter: [Function: outputPostFormatter],</span></span><br><span class="line"><span class="string">        outputSyncingFormatter: [Function: outputSyncingFormatter] &#125;,</span></span><br><span class="line"><span class="string">     utils:</span></span><br><span class="line"><span class="string">      &#123; _fireError: [Function: _fireError],</span></span><br><span class="line"><span class="string">        _jsonInterfaceMethodToString: [Function: _jsonInterfaceMethodToString],</span></span><br><span class="line"><span class="string">        _flattenTypes: [Function: _flattenTypes],</span></span><br><span class="line"><span class="string">        randomHex: [Function: randomHex],</span></span><br><span class="line"><span class="string">        _: [Object],</span></span><br><span class="line"><span class="string">        BN: [Object],</span></span><br><span class="line"><span class="string">        isBN: [Function: isBN],</span></span><br><span class="line"><span class="string">        isBigNumber: [Function: isBigNumber],</span></span><br><span class="line"><span class="string">        isHex: [Function: isHex],</span></span><br><span class="line"><span class="string">        isHexStrict: [Function: isHexStrict],</span></span><br><span class="line"><span class="string">        sha3: [Object],</span></span><br><span class="line"><span class="string">        keccak256: [Object],</span></span><br><span class="line"><span class="string">        soliditySha3: [Function: soliditySha3],</span></span><br><span class="line"><span class="string">        isAddress: [Function: isAddress],</span></span><br><span class="line"><span class="string">        checkAddressChecksum: [Function: checkAddressChecksum],</span></span><br><span class="line"><span class="string">        toChecksumAddress: [Function: toChecksumAddress],</span></span><br><span class="line"><span class="string">        toHex: [Function: toHex],</span></span><br><span class="line"><span class="string">        toBN: [Function: toBN],</span></span><br><span class="line"><span class="string">        bytesToHex: [Function: bytesToHex],</span></span><br><span class="line"><span class="string">        hexToBytes: [Function: hexToBytes],</span></span><br><span class="line"><span class="string">        hexToNumberString: [Function: hexToNumberString],</span></span><br><span class="line"><span class="string">        hexToNumber: [Function: hexToNumber],</span></span><br><span class="line"><span class="string">        toDecimal: [Function: hexToNumber],</span></span><br><span class="line"><span class="string">        numberToHex: [Function: numberToHex],</span></span><br><span class="line"><span class="string">        fromDecimal: [Function: numberToHex],</span></span><br><span class="line"><span class="string">        hexToUtf8: [Function: hexToUtf8],</span></span><br><span class="line"><span class="string">        hexToString: [Function: hexToUtf8],</span></span><br><span class="line"><span class="string">        toUtf8: [Function: hexToUtf8],</span></span><br><span class="line"><span class="string">        utf8ToHex: [Function: utf8ToHex],</span></span><br><span class="line"><span class="string">        stringToHex: [Function: utf8ToHex],</span></span><br><span class="line"><span class="string">        fromUtf8: [Function: utf8ToHex],</span></span><br><span class="line"><span class="string">        hexToAscii: [Function: hexToAscii],</span></span><br><span class="line"><span class="string">        toAscii: [Function: hexToAscii],</span></span><br><span class="line"><span class="string">        asciiToHex: [Function: asciiToHex],</span></span><br><span class="line"><span class="string">        fromAscii: [Function: asciiToHex],</span></span><br><span class="line"><span class="string">        unitMap: [Object],</span></span><br><span class="line"><span class="string">        toWei: [Function: toWei],</span></span><br><span class="line"><span class="string">        fromWei: [Function: fromWei],</span></span><br><span class="line"><span class="string">        padLeft: [Function: leftPad],</span></span><br><span class="line"><span class="string">        leftPad: [Function: leftPad],</span></span><br><span class="line"><span class="string">        padRight: [Function: rightPad],</span></span><br><span class="line"><span class="string">        rightPad: [Function: rightPad],</span></span><br><span class="line"><span class="string">        toTwosComplement: [Function: toTwosComplement] &#125;,</span></span><br><span class="line"><span class="string">     Method: [Function: Method] &#125;,</span></span><br><span class="line"><span class="string">  clearSubscriptions: [Function],</span></span><br><span class="line"><span class="string">  options:</span></span><br><span class="line"><span class="string">   &#123; address: [Getter/Setter],</span></span><br><span class="line"><span class="string">     jsonInterface: [Getter/Setter],</span></span><br><span class="line"><span class="string">     data: undefined,</span></span><br><span class="line"><span class="string">     from: undefined,</span></span><br><span class="line"><span class="string">     gasPrice: undefined,</span></span><br><span class="line"><span class="string">     gas: undefined &#125;,</span></span><br><span class="line"><span class="string">  defaultAccount: [Getter/Setter],</span></span><br><span class="line"><span class="string">  defaultBlock: [Getter/Setter],</span></span><br><span class="line"><span class="string">  # methods you define in the smart contract</span></span><br><span class="line"><span class="string">  methods:</span></span><br><span class="line"><span class="string">   &#123; setMessage: [Function: bound _createTxObject],</span></span><br><span class="line"><span class="string">     '</span>0x368b8772<span class="string">': [Function: bound _createTxObject],</span></span><br><span class="line"><span class="string">     '</span>setMessage(string)<span class="string">': [Function: bound _createTxObject],</span></span><br><span class="line"><span class="string">     message: [Function: bound _createTxObject],</span></span><br><span class="line"><span class="string">     '</span>0xe21f37ce<span class="string">': [Function: bound _createTxObject],</span></span><br><span class="line"><span class="string">     '</span>message()<span class="string">': [Function: bound _createTxObject] &#125;,</span></span><br><span class="line"><span class="string">  events: &#123; allEvents: [Function: bound ] &#125;,</span></span><br><span class="line"><span class="string">  _address: '</span>0x2E4631F207D3564B7937Bf355d947c187D9a1Fad<span class="string">',</span></span><br><span class="line"><span class="string">  _jsonInterface:</span></span><br><span class="line"><span class="string">   [ &#123; constant: false,</span></span><br><span class="line"><span class="string">       inputs: [Array],</span></span><br><span class="line"><span class="string">       name: '</span>setMessage<span class="string">',</span></span><br><span class="line"><span class="string">       outputs: [],</span></span><br><span class="line"><span class="string">       payable: false,</span></span><br><span class="line"><span class="string">       stateMutability: '</span>nonpayable<span class="string">',</span></span><br><span class="line"><span class="string">       type: '</span><span class="keyword">function</span><span class="string">',</span></span><br><span class="line"><span class="string">       signature: '</span>0x368b8772<span class="string">' &#125;,</span></span><br><span class="line"><span class="string">     &#123; constant: true,</span></span><br><span class="line"><span class="string">       inputs: [],</span></span><br><span class="line"><span class="string">       name: '</span>message<span class="string">',</span></span><br><span class="line"><span class="string">       outputs: [Array],</span></span><br><span class="line"><span class="string">       payable: false,</span></span><br><span class="line"><span class="string">       stateMutability: '</span>view<span class="string">',</span></span><br><span class="line"><span class="string">       type: '</span><span class="keyword">function</span><span class="string">',</span></span><br><span class="line"><span class="string">       signature: '</span>0xe21f37ce<span class="string">' &#125;,</span></span><br><span class="line"><span class="string">     &#123; inputs: [Array],</span></span><br><span class="line"><span class="string">       payable: false,</span></span><br><span class="line"><span class="string">       stateMutability: '</span>nonpayable<span class="string">',</span></span><br><span class="line"><span class="string">       type: '</span>constructor<span class="string">',</span></span><br><span class="line"><span class="string">       constant: undefined,</span></span><br><span class="line"><span class="string">       signature: '</span>constructor<span class="string">' &#125; ] &#125;</span></span><br><span class="line"><span class="string">    ‚úì deploy a contract</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  1 passing (225ms)</span></span><br></pre></td></tr></table></figure>

<h1 id="Deploy-to-ethereum"><a href="#Deploy-to-ethereum" class="headerlink" title="Deploy to ethereum"></a>Deploy to ethereum</h1><p><img src="deploy.png" alt="deploy"></p>
<ul>
<li><code>Infura API</code>: provide the interface of real ethereum block chain.</li>
<li><code>Provider</code>: a interface layer to communicate with real block chain using your account.</li>
</ul>
<h2 id="Get-infura-api"><a href="#Get-infura-api" class="headerlink" title="Get infura api"></a>Get infura api</h2><p>Go to infura.io to creata a new account and project. </p>
<p><img src="infura.png" alt=""></p>
<h2 id="Deploy"><a href="#Deploy" class="headerlink" title="Deploy"></a>Deploy</h2><figure class="highlight js"><figcaption><span>:deploy.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> HDWalletProvider = <span class="built_in">require</span>(<span class="string">'truffle-hdwallet-provider'</span>);</span><br><span class="line"><span class="keyword">const</span> Web3 = <span class="built_in">require</span>(<span class="string">'web3'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;interface, bytecode&#125; = <span class="built_in">require</span>(<span class="string">'./compile'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> provider = <span class="keyword">new</span> HDWalletProvider (</span><br><span class="line">    <span class="string">'dinosaur erupt zoo ...'</span>, <span class="comment">// your account</span></span><br><span class="line">    <span class="string">'https://rinkeby.infura.io/v3/451daf892abb41***'</span> <span class="comment">// block chain api, you can obtain this from infura.io website inside your project.</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> web3 = <span class="keyword">new</span> Web3(provider);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> deploy = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> accounts = <span class="keyword">await</span> web3.eth.getAccounts();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Attempting to deploy from account'</span>, accounts[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="keyword">new</span> web3.eth.Contract(<span class="built_in">JSON</span>.parse(interface))</span><br><span class="line">    .deploy(&#123;<span class="attr">data</span>: bytecode, <span class="attr">arguments</span>: [<span class="string">'Hi there!'</span>]&#125;)</span><br><span class="line">    .send(&#123;<span class="attr">gas</span>: <span class="string">'5000000'</span>, <span class="attr">from</span>: accounts[<span class="number">0</span>]&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Contract deployed to'</span>, result.options.address);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">deploy();</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mac@HansonMac ÓÇ∞ ~/Code/blockchain ÓÇ∞ node deploy.js</span><br><span class="line">Attempting to deploy from account 0x01C65bfDeD8c69ef3C28d4EF58F1dA46DeAF13Cd</span><br><span class="line">Contract deployed to 0xF0f127B8eC22da8e811262B287BA6b8244B22891</span><br></pre></td></tr></table></figure>

<p>copy <code>0xF0f127B8eC22da8e811262B287BA6b8244B22891</code> to <code>rinkey.etherscan.io</code> to see the results.</p>
<p><img src="rinkeby.png" alt="rinkeby"></p>
<h1 id="Interact-with-real-ethereum"><a href="#Interact-with-real-ethereum" class="headerlink" title="Interact with real ethereum"></a>Interact with real ethereum</h1><p>Go to remix website</p>
<p>copy <code>0xF0f127B8eC22da8e811262B287BA6b8244B22891</code> to <code>At Address</code>, and click.</p>
<p>You will see the contract deployed in real ethereum network.</p>
<p><img src="remix.png" alt=""></p>
<p>You can then try to setMessage, for example: ‚ÄòTest real ethereum‚Äô.</p>
<p>After your submition, the transaction will be in <code>pending</code> state.</p>
<p><img src="pending.png" alt="pending"></p>
<p>While in the pending state, the value of message will not change. After the transaction is confirmed, <code>message</code> function will return the new value: ‚ÄòTest real ethereum‚Äô.</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><a href="https://stackoverflow.com/questions/50201353/unhandledpromiserejectionwarning-error-the-contract-code-couldnt-be-stored-p" target="_blank" rel="noopener">Error: The contract code couldn‚Äôt be stored, please check your gas limit</a></li>
<li><a href="https://rinkeby.etherscan.io/" target="_blank" rel="noopener">rinkey.etherscan.io</a></li>
</ul>
]]></content>
      <categories>
        <category>blockchain</category>
      </categories>
      <tags>
        <tag>ethereum</tag>
        <tag>web3</tag>
      </tags>
  </entry>
  <entry>
    <title>Review: bLSM:* A General Purpose Log Structured Merge Tree</title>
    <url>/blog/Review-bLSM-%E2%88%97-A-General-Purpose-Log-Structured-Merge-Tree/</url>
    <content><![CDATA[<h1 id="Big-question"><a href="#Big-question" class="headerlink" title="Big question"></a>Big question</h1><p>LSM tree will sacrifice read performance with write performance. This paper, <code>bLSM</code> ( a Log Structured Merge (LSM) tree with the advantages of B-Trees and log structured approaches), claims to have near optimal <code>read</code> and <code>scan</code> performance, and a bounded <code>write latency</code> with <code>spring and gear</code> merge scheduler.</p>
<h1 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h1><p>bLSM is designed as a backing storage for Yahoo‚Äôs geographically distributed key-value storage system, and Walnut, a elastic cloud storage system.</p>
<p><img src="result.png" alt="summary"></p>
<h1 id="Specific-question"><a href="#Specific-question" class="headerlink" title="Specific question"></a>Specific question</h1><h2 id="Reduce-read-amplification"><a href="#Reduce-read-amplification" class="headerlink" title="Reduce read amplification"></a>Reduce read amplification</h2><p>It seems like they are using fractal tree structure. But the design seems not clear to me. I haven‚Äôt get a clue about how they implement the idea.</p>
<h2 id="Write-pause"><a href="#Write-pause" class="headerlink" title="Write pause"></a>Write pause</h2><p><code>level scheduler</code>: A merge scheduler.</p>
<p>The explanation in the paper is not clear to me. Hard to understand.</p>
]]></content>
      <categories>
        <category>review</category>
      </categories>
      <tags>
        <tag>LSM tree</tag>
        <tag>kv</tag>
      </tags>
  </entry>
  <entry>
    <title>Review: ElasticBF: Fine-grained and Elastic Bloom Filter Towards Efficient Read for LSM-tree-based KV Stores</title>
    <url>/blog/Review-ElasticBF-Fine-grained-and-Elastic-Bloom-Filter-Towards-Efficient-Read-for-LSM-tree-based-KV-Stores/</url>
    <content><![CDATA[<h1 id="Big-question"><a href="#Big-question" class="headerlink" title="Big question"></a>Big question</h1><p>Current leveldb implementation uses uniform setting for all Bloom filters for hot and cold SSTable, which is not efficient to reduce unnecessary I/O.</p>
<h1 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h1><p>In leveldb, in order to reduce unnecessary I/O for non-exist data, bloom filter about SSTables are cached in the memory. When user search for a key, the key is first checked in related bloom filter. Then if bloom filter returns true, that SSTable is fetched from disk (one I/O) and leveldb uses binary search to locate that key.</p>
<p>Since bloom filter has a parameter, called <code>false positive rate (FPR)</code>. It may tell a lie when the key is not exist in SSTable. This will cause unnecessary I/O. In order to reduce those I/O, we must reduce <code>FPR</code> and use more memory.</p>
<p>$$ P = \left( 1 - e ^ { - k n / m } \right) ^ { k } $$</p>
<a id="more"></a>
<ul>
<li>k: number of function</li>
<li>n: number of inserted key</li>
<li>m: number of bit</li>
</ul>
<p>Assuming we uses 10 bit per key, and the function number k is 3, then the FPR will be 1.74%. </p>
<h1 id="Specific-questions"><a href="#Specific-questions" class="headerlink" title="Specific questions"></a>Specific questions</h1><p><img src="frequency.png" alt="frequency"></p>
<p>Because SSTable access pattern is not uniform. Using uniform size of bloom filter is not efficient. The basic idea is allocate more memory to hot data and less memory to cold data.</p>
<h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p><img src="solution.png" alt="solution"></p>
<p>The solution is building multiple filters when constructing each SSTable, and each filter is usually allocated with smaller memory size, which is called filter unit. Hot SSTable will cache more filter unit in memory.</p>
<h2 id="A-cost-function"><a href="#A-cost-function" class="headerlink" title="A cost function"></a>A cost function</h2><p>$$ E [Extra IO ] = \sum _ { i = 1 } ^ { n } f _ { i } \cdot f p _ { i } $$</p>
<ul>
<li>n: number of SSTable</li>
<li>fi: access frequency of SSTable i</li>
<li>fpi: false positive rate of SSTable i</li>
</ul>
<p>ElasticBF adjusts the number of filter units for each SSTable only when the metric E[Extra IO] could be reduced under the fixed memory usage.</p>
<h2 id="Multi-Queue-design"><a href="#Multi-Queue-design" class="headerlink" title="Multi Queue design"></a>Multi Queue design</h2><blockquote>
<p>The adjustment of Bloom filter proceeds as follows. Each time when a SSTable is accessed, we first increase its access frequency by one and update E[Extra IO], then we check whether E[Extra IO] could be decreased if enabling one more filter unit for this SSTable and disabling some filter units in other SSTables so as to guarantee the same memory usage. However, one critical issue is how to quickly find which filters should be disabled but not incurring a large overhead</p>
</blockquote>
<p><img src="computation.png" alt="compuation"></p>
<p>This paper maintained a LRU queue. Each element of a queue corresponds to one SSTable and keeps the metadata of the SSTable, including the enabled filter units residing in memory. Qi manages the SSTables which already enabled exactly i filter units, e.g., each SSTable in Q2 enabled two filter units.</p>
<p>Each metadata will have a <code>currentTime + lifeTime</code> counter as <code>expiredTime</code>.</p>
<ul>
<li>currentTime: number of total Get requests</li>
<li>lifeTime: when will this SSTable expire, the life interval</li>
</ul>
<p>A read will cause the metadata been updated (update currentTime).</p>
<div class="note danger"><p>I guess those multi level queue is priority queue, sorted by the the expireTime. Then this means every access will first locate the metadata, then reorder the queue.</p>
<p>How to located the metadata, brute force? How about the reorder overhead?</p></div>

<h1 id="My-comments"><a href="#My-comments" class="headerlink" title="My comments"></a>My comments</h1><p>This Elastic idea is not the first I head. In SIGMOD17,  a paper: Monkey, discussed how to use different size of bloom filter for SSTable in different level in LevelDB. Their idea is allocate more memory to higher lever SSTable and less memory to lower level SSTable.</p>
]]></content>
      <categories>
        <category>review</category>
      </categories>
      <tags>
        <tag>LSM tree</tag>
        <tag>kv</tag>
      </tags>
  </entry>
  <entry>
    <title>Review: Mutant: Balancing Storage Cost and Latency in LSM Tree Data Stores</title>
    <url>/blog/Review-Mutant-Balancing-Storage-Cost-and-Latency-in-LSM-Tree-Data-Stores/</url>
    <content><![CDATA[<h1 id="Big-question"><a href="#Big-question" class="headerlink" title="Big question"></a>Big question</h1><p>Cloud databases should support dynamic allocation of hot and cold data to fast and slow device. So the client can get the best performance within their budget.</p>
<p>The author introduced a system that support dynamic allocation of storage system based on LSM-tree.</p>
<a id="more"></a>
<h1 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h1><h2 id="Locality-in-SSTable"><a href="#Locality-in-SSTable" class="headerlink" title="Locality in SSTable"></a>Locality in SSTable</h2><p><img src="frequency.png" alt="frequency"></p>
<p>There are some locality in SSTable access. (This paper uses QuizUp workload to do the analysis)</p>
<ul>
<li><code>Figure 3</code> indicates that younger data will have more access while older data have less access.</li>
<li><code>Figure 4</code> illustrates that the hottest data can be 4 orders of magnitudes than the coldest data.</li>
<li><code>Figure 5</code> says that As more records are inserted over time, the number of infrequently accessed SSTables (‚Äúcold‚Äù SSTables) increases, while the number of frequently accessed SSTables (‚Äúhot‚Äù SSTables) stays about the same.</li>
</ul>
<h2 id="Locality-in-SSTable-components"><a href="#Locality-in-SSTable-components" class="headerlink" title="Locality in SSTable components"></a>Locality in SSTable components</h2><p>Components consist of <code>metadata</code>(including <code>bloomfilter</code>, <code>record index</code>) and <code>data records</code>.</p>
<h1 id="Specific-questions"><a href="#Specific-questions" class="headerlink" title="Specific questions"></a>Specific questions</h1><h2 id="Get-the-optimal-SSTable-to-be-stored-in-fast-storage"><a href="#Get-the-optimal-SSTable-to-be-stored-in-fast-storage" class="headerlink" title="Get the optimal SSTable to be stored in fast storage"></a>Get the optimal SSTable to be stored in fast storage</h2><p>With those pattern, this paper try to solve this specific question:</p>
<blockquote>
<p>Find a subset of SSTables to be stored in the fast storage (optimization goal) such that the sum of fast storage SSTable accesses is maximized, (constraint) while bounding the volume of SSTables in fast storage.</p>
</blockquote>
<p>They use this model to do some optimization.</p>
<p>$$<br>P _ { f } S _ { f } + P _ { s } S _ { s } \leq C _ { \max }<br>$$</p>
<p>$$<br>S _ { f } + S _ { s } = S<br>$$</p>
<ul>
<li>Pf, Ps: unit price for fast and slow device</li>
<li>Sf, Ss: sum of all SSTable sizes in the fast and slow storage</li>
</ul>
<p>$$<br>S _ { f } &lt; \frac { C _ { \max } - P _ { s } S } { P _ { f } - P _ { s } } = S _ { f , \max }$$</p>
<p>maximize<br>$$\sum _ { i \in SSTables} A _ { i } x _ { i }$$<br>subject to<br>$$\sum _ { i \in SSTables} S _ { i } x _ { i } \leq S _ { f , max }  and  x _ { i } \in { 0,1 } $$</p>
<ul>
<li>Ai: number of accesses to SSTable i</li>
<li>Si: the size of SSTable i</li>
<li>Xi: SSTable in fast storage or not</li>
</ul>
<p>This becomes a 0/1 knapsack problem. They use a greedy algorithm to solve this problem.</p>
<div class="note danger"><p>My comment:<br>Why not just sorting by the frequency, then put as many as SSTable to fast device directly.</p></div>

<h2 id="Solving-spike-or-dips"><a href="#Solving-spike-or-dips" class="headerlink" title="Solving spike or dips"></a>Solving spike or dips</h2><p>They use a counter to record the access frequency, but they can be affected severely by spike or dips. So they implement a filter through exponential average to smooth the frequency counter.</p>
<div class="note danger"><p>My comment:<br>This is like a digital signal filer. Transform function.</p></div>
<!-- 
# Approach

# Results

Write one or more paragraphs to summarize the results for each experiment, each figure, and each table -->

<h1 id="My-thoughts"><a href="#My-thoughts" class="headerlink" title="My thoughts"></a>My thoughts</h1><p>The thing I don‚Äôt understand is that why memory caching is not enough for those hot data. Maybe one possible explanation is that even hot data is too big to be stored in memory.</p>
]]></content>
      <categories>
        <category>review</category>
      </categories>
      <tags>
        <tag>LSM tree</tag>
        <tag>kv</tag>
      </tags>
  </entry>
  <entry>
    <title>first docker app</title>
    <url>/blog/first-docker-app/</url>
    <content><![CDATA[<h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><p>Create a new directory where all the files would live.</p>
<a id="more"></a>
<h2 id="Create-Node-js-app"><a href="#Create-Node-js-app" class="headerlink" title="Create Node.js app"></a>Create Node.js app</h2><figure class="highlight json"><figcaption><span>:package.json</span></figcaption><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"docker_web_app"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"Node.js on Docker"</span>,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">"First Last &lt;first.last@example.com&gt;"</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"server.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"start"</span>: <span class="string">"node server.js"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"express"</span>: <span class="string">"^4.16.1"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<!-- more -->

<p>With your new <code>package.json</code> file, run <code>npm install</code>. If you are using npm version 5 or later, this will generate a <code>package-lock.json</code> file which will be copied to your Docker image.</p>
<p>Then, create a <code>server.js</code> file that defines a web app using the Express.js framework:</p>
<figure class="highlight js"><figcaption><span>:server.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Constants</span></span><br><span class="line"><span class="keyword">const</span> PORT = <span class="number">8080</span>;</span><br><span class="line"><span class="keyword">const</span> HOST = <span class="string">'0.0.0.0'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// App</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  res.send(<span class="string">'Hello world\n'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(PORT, HOST);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`Running on http://<span class="subst">$&#123;HOST&#125;</span>:<span class="subst">$&#123;PORT&#125;</span>`</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Creating-a-Dockerfile"><a href="#Creating-a-Dockerfile" class="headerlink" title="Creating a Dockerfile"></a>Creating a Dockerfile</h2><figure class="highlight bash"><figcaption><span>:Dockerfile</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment"># use the latest LTS (long term support) version 8 of node available from the Docker Hub:</span></span><br><span class="line">FROM node:8</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create app directory</span></span><br><span class="line">WORKDIR /usr/src/app</span><br><span class="line"></span><br><span class="line"><span class="comment"># This image comes with Node.js and NPM already installed so the next thing we need to do </span></span><br><span class="line"><span class="comment"># is to install your app dependencies using the npm binary.</span></span><br><span class="line"><span class="comment"># Install app dependencies</span></span><br><span class="line"><span class="comment"># A wildcard is used to ensure both package.json AND package-lock.json are copied</span></span><br><span class="line"><span class="comment"># where available (npm@5+)</span></span><br><span class="line">COPY package*.json ./</span><br><span class="line"></span><br><span class="line">RUN npm install</span><br><span class="line"><span class="comment"># If you are building your code for production</span></span><br><span class="line"><span class="comment"># RUN npm install --only=production</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># To bundle your app's source code inside the Docker image, use the COPY instruction:</span></span><br><span class="line"><span class="comment"># Bundle app source</span></span><br><span class="line">COPY . .</span><br><span class="line"></span><br><span class="line"><span class="comment"># Your app binds to port 8080 so you'll use the EXPOSE instruction to have it mapped </span></span><br><span class="line"><span class="comment"># by the docker daemon:</span></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line"><span class="comment"># Last but not least, define the command to run your app using CMD which defines your runtime. # Here we will use the basic npm start which will run node server.js to start your server:</span></span><br><span class="line">CMD [ <span class="string">"npm"</span>, <span class="string">"start"</span> ]</span><br></pre></td></tr></table></figure>

<p>Create a <code>.dockerignore</code> file in the same directory as your <code>Dockerfile</code> with following content:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">node_modules</span><br><span class="line">npm-debug.log</span><br></pre></td></tr></table></figure>

<p>This will prevent your local modules and debug logs from being copied onto your Docker image and possibly overwriting modules installed within your image.</p>
<h1 id="Building-your-image"><a href="#Building-your-image" class="headerlink" title="Building your image"></a>Building your image</h1><p>Go to the directory that has your Dockerfile and run the following command to build the Docker image. The <code>-t</code> flag lets you tag your image so it‚Äôs easier to find later using the <code>docker images</code> command:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker build -t &lt;your username&gt;/node-web-app .</span><br></pre></td></tr></table></figure>

<p>Your image will now be listed by Docker:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mac@HansonMac ÓÇ∞ ~/Code/docker/test1 ÓÇ∞ docker images</span><br><span class="line">REPOSITORY                   TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hansonzhao007/node-web-app   latest              d9a6394dc754        21 minutes ago      675MB</span><br><span class="line">node                         8                   8198006b2b57        11 hours ago        673MB</span><br><span class="line">hello-world                  latest              2cb0d9787c4d        8 weeks ago         1.85kB</span><br></pre></td></tr></table></figure>

<h1 id="How-docker-utilize-layer-cache"><a href="#How-docker-utilize-layer-cache" class="headerlink" title="How docker utilize layer cache"></a>How docker utilize layer cache</h1><p>The first time we build docker image:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mac@HansonMac ÓÇ∞ ~/Code/docker/test1 ÓÇ∞ docker build -t hansonzhao007/node-web-app .</span><br><span class="line">Sending build context to Docker daemon  18.94kB</span><br><span class="line">Step 1/7 : FROM node:8</span><br><span class="line">8: Pulling from library/node</span><br><span class="line">f189db1b88b3: Pull complete</span><br><span class="line">3d06cf2f1b5e: Pull complete</span><br><span class="line">687ebdda822c: Pull complete</span><br><span class="line">99119ca3f34e: Pull complete</span><br><span class="line">e771d6006054: Pull complete</span><br><span class="line">b0cc28d0be2c: Pull complete</span><br><span class="line">9bbe77ca0944: Pull complete</span><br><span class="line">75f7d70e2d07: Pull complete</span><br><span class="line">Digest: sha256:47a2131abc86d41faa910465b35987bc06b014c335309b551c876e517b5a4402</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> node:8</span><br><span class="line"> ---&gt; 8198006b2b57</span><br><span class="line">Step 2/7 : WORKDIR /usr/src/app</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 4137ea639ed8</span><br><span class="line">Removing intermediate container 4137ea639ed8</span><br><span class="line"> ---&gt; 549d3e18b855</span><br><span class="line">Step 3/7 : COPY package*.json ./</span><br><span class="line"> ---&gt; f290910d8f59</span><br><span class="line">Step 4/7 : RUN npm install</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> eb632572e423</span><br><span class="line">npm WARN docker_web_app@1.0.0 No repository field.</span><br><span class="line">npm WARN docker_web_app@1.0.0 No license field.</span><br><span class="line"></span><br><span class="line">added 50 packages <span class="keyword">in</span> 1.753s</span><br><span class="line">Removing intermediate container eb632572e423</span><br><span class="line"> ---&gt; 17748bcde097</span><br><span class="line">Step 5/7 : COPY . .</span><br><span class="line"> ---&gt; fdb83d4c8598</span><br><span class="line">Step 6/7 : EXPOSE 8080</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 69d1ada16879</span><br><span class="line">Removing intermediate container 69d1ada16879</span><br><span class="line"> ---&gt; 87924dc046d8</span><br><span class="line">Step 7/7 : CMD [ <span class="string">"npm"</span>, <span class="string">"start"</span> ]</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 90c7d806a20b</span><br><span class="line">Removing intermediate container 90c7d806a20b</span><br><span class="line"> ---&gt; d9a6394dc754</span><br><span class="line">Successfully built d9a6394dc754</span><br><span class="line">Successfully tagged hansonzhao007/node-web-app:latest</span><br></pre></td></tr></table></figure>

<p>We see that every layer need to be rebuilt.</p>
<p>Then we try to rebuild it again:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mac@HansonMac ÓÇ∞ ~/Code/docker/test1 ÓÇ∞ docker build -t hansonzhao007/node-web-app .</span><br><span class="line">Sending build context to Docker daemon  18.94kB</span><br><span class="line">Step 1/7 : FROM node:8</span><br><span class="line"> ---&gt; 8198006b2b57</span><br><span class="line">Step 2/7 : WORKDIR /usr/src/app</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 549d3e18b855</span><br><span class="line">Step 3/7 : COPY package*.json ./</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; d124378627e9</span><br><span class="line">Step 4/7 : RUN npm install</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 2ce3c2c8249a</span><br><span class="line">Step 5/7 : COPY . .</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; ffca5856eb53</span><br><span class="line">Step 6/7 : EXPOSE 8080</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; bdcc9c0cc503</span><br><span class="line">Step 7/7 : CMD [ <span class="string">"npm"</span>, <span class="string">"start"</span> ]</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; d93edfeb4525</span><br><span class="line">Successfully built d93edfeb4525</span><br><span class="line">Successfully tagged hansonzhao007/node-web-app:latest</span><br></pre></td></tr></table></figure>

<p>We can see that for every CMD, there is a <code>Using cache</code>.</p>
<h2 id="What-are-the-layers"><a href="#What-are-the-layers" class="headerlink" title="What are the layers"></a>What are the layers</h2><p>Docker containers are building blocks for applications. Each container is an image with a readable/writeable layer on top of a bunch of read-only layers.</p>
<p>These layers (also called intermediate images) are generated when the commands in the Dockerfile are executed during the Docker image build.</p>
<p>When Docker builds the container from a Dockerfile, each step corresponds to a command run in the Dockerfile. And each layer is made up of the file generated from running that command.</p>
<p>For example, the layer ID for step 2 is <code>549d3e18b855</code>.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mac@HansonMac ÓÇ∞ ~/Code/docker/test1 ÓÇ∞ docker build -t hansonzhao007/node-web-app .</span><br><span class="line">Sending build context to Docker daemon  18.94kB</span><br><span class="line">Step 1/7 : FROM node:8</span><br><span class="line"> ---&gt; 8198006b2b57</span><br><span class="line">Step 2/7 : WORKDIR /usr/src/app</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 549d3e18b855</span><br><span class="line">Step 3/7 : COPY package*.json ./</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Once the image is built, you can view all the layers that make up the image with the docker history command. The ‚ÄúImage‚Äù column (i.e <code>intermediate image</code> or <code>layer</code>) shows the randomly generated UUID that correlates to that layer.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> mac@HansonMac ÓÇ∞ ~/Code/docker/test1 ÓÇ∞ docker <span class="built_in">history</span> hansonzhao007/node-web-app</span><br><span class="line">IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</span><br><span class="line">d93edfeb4525        7 minutes ago       /bin/sh -c <span class="comment">#(nop)  CMD ["npm" "start"]          0B</span></span><br><span class="line">bdcc9c0cc503        7 minutes ago       /bin/sh -c <span class="comment">#(nop)  EXPOSE 8080                  0B</span></span><br><span class="line">ffca5856eb53        7 minutes ago       /bin/sh -c <span class="comment">#(nop) COPY dir:61b10d9a51757f95e‚Ä¶   14kB</span></span><br><span class="line">2ce3c2c8249a        7 minutes ago       /bin/sh -c npm install                          2.91MB</span><br><span class="line">d124378627e9        7 minutes ago       /bin/sh -c <span class="comment">#(nop) COPY multi:6b51dc5ec4af055‚Ä¶   13.3kB</span></span><br><span class="line">549d3e18b855        31 minutes ago      /bin/sh -c <span class="comment">#(nop) WORKDIR /usr/src/app          0B</span></span><br><span class="line">8198006b2b57        11 hours ago        /bin/sh -c <span class="comment">#(nop)  CMD ["node"]                 0B</span></span><br></pre></td></tr></table></figure>

<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://medium.com/@jessgreb01/digging-into-docker-layers-c22f948ed612" target="_blank" rel="noopener">Digging into Docker layers</a><br><a href="https://nodejs.org/en/docs/guides/nodejs-docker-webapp/" target="_blank" rel="noopener">Dockerizing a Node.js web app</a><br><a href="http://bitjudo.com/blog/2014/03/13/building-efficient-dockerfiles-node-dot-js/" target="_blank" rel="noopener">Building Efficient Dockerfiles - Node.js</a></p>
]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>nodejs</tag>
      </tags>
  </entry>
  <entry>
    <title>MPI configuration</title>
    <url>/blog/MPI-configuration/</url>
    <content><![CDATA[<h1 id="Install-MPI-in-each-node-server"><a href="#Install-MPI-in-each-node-server" class="headerlink" title="Install MPI in each node server"></a>Install MPI in each node server</h1><p><a href="http://mpitutorial.com/tutorials/installing-mpich2/" target="_blank" rel="noopener">http://mpitutorial.com/tutorials/installing-mpich2/</a></p>
<h1 id="Run-hello-world"><a href="#Run-hello-world" class="headerlink" title="Run hello world."></a>Run hello world.</h1><p>ËøôÈáåÂè™ÊòØÁÆÄÂçïÁöÑÊääÁºñËØëÁ®ãÂ∫èÂ§çÂà∂Âà∞Áî®Êà∑ÁöÑ home ÁõÆÂΩï‰∏ãÔºåÁÑ∂ÂêéÊâßË°å„ÄÇ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># replace hello.c with your own source code file name</span></span><br><span class="line">filename=hello.c</span><br><span class="line">output=hello</span><br><span class="line"></span><br><span class="line">master=10.0.0.10</span><br><span class="line">slave1=10.0.0.15</span><br><span class="line">slave2=10.0.0.16</span><br><span class="line">slave3=10.0.0.18</span><br><span class="line"></span><br><span class="line"><span class="comment"># compile the source code</span></span><br><span class="line">mpicc -o <span class="variable">$output</span> <span class="variable">$filename</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># copy the executable file to other slaves</span></span><br><span class="line">scp <span class="variable">$output</span> <span class="variable">$USER</span>@<span class="variable">$slave1</span>:~/ </span><br><span class="line">scp <span class="variable">$output</span> <span class="variable">$USER</span>@<span class="variable">$slave2</span>:~/ </span><br><span class="line">scp <span class="variable">$output</span> <span class="variable">$USER</span>@<span class="variable">$slave3</span>:~/ </span><br><span class="line"></span><br><span class="line"><span class="comment"># deploy the program to 4 nodes</span></span><br><span class="line">mpirun -n 4 -H <span class="variable">$master</span>,<span class="variable">$slave1</span>,<span class="variable">$slave2</span>,<span class="variable">$slave3</span> ./<span class="variable">$output</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Author: Wes Kendall</span></span><br><span class="line"><span class="comment">// Copyright 2011 www.mpitutorial.com</span></span><br><span class="line"><span class="comment">// This code is provided freely with the tutorials on mpitutorial.com. Feel</span></span><br><span class="line"><span class="comment">// free to modify it for your own use. Any distribution of the code must</span></span><br><span class="line"><span class="comment">// either provide a link to www.mpitutorial.com or keep this header intact.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// An intro MPI hello world program that uses MPI_Init, MPI_Comm_size,</span></span><br><span class="line"><span class="comment">// MPI_Comm_rank, MPI_Finalize, and MPI_Get_processor_name.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Initialize the MPI environment. The two arguments to MPI Init are not</span></span><br><span class="line">  <span class="comment">// currently used by MPI implementations, but are there in case future</span></span><br><span class="line">  <span class="comment">// implementations might need the arguments.</span></span><br><span class="line">  MPI_Init(<span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Get the number of processes</span></span><br><span class="line">  <span class="keyword">int</span> world_size;</span><br><span class="line">  MPI_Comm_size(MPI_COMM_WORLD, &amp;world_size);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Get the rank of the process</span></span><br><span class="line">  <span class="keyword">int</span> world_rank;</span><br><span class="line">  MPI_Comm_rank(MPI_COMM_WORLD, &amp;world_rank);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Get the name of the processor</span></span><br><span class="line">  <span class="keyword">char</span> processor_name[MPI_MAX_PROCESSOR_NAME];</span><br><span class="line">  <span class="keyword">int</span> name_len;</span><br><span class="line">  MPI_Get_processor_name(processor_name, &amp;name_len);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Print off a hello world message</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Hello world from processor %s, rank %d out of %d processors\n"</span>,</span><br><span class="line">         processor_name, world_rank, world_size);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Finalize the MPI environment. No more MPI calls can be made after this</span></span><br><span class="line">  MPI_Finalize();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="‰ΩøÁî®-hostfile-Êñá‰ª∂"><a href="#‰ΩøÁî®-hostfile-Êñá‰ª∂" class="headerlink" title="‰ΩøÁî® hostfile Êñá‰ª∂"></a>‰ΩøÁî® hostfile Êñá‰ª∂</h1><figure class="highlight bash"><figcaption><span>:hostfile</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment"># This is an example hostfile.  Comments begin with #</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The following nodes have eight processor machine, we absolutely</span></span><br><span class="line"><span class="comment"># want to disallow over-subscribing it:</span></span><br><span class="line">p10 slots=8 max-slots=8</span><br><span class="line">p15 slots=8 max-slots=8</span><br><span class="line">p16 slots=8 max-slots=8</span><br><span class="line">p18 slots=8 max-slots=8</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mpirun -np 20 --hostfile hostfile ./hello</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>other</category>
      </categories>
  </entry>
  <entry>
    <title>Review: SuRF: Practical Range Query Filtering with Fast Succinct Tries</title>
    <url>/blog/Review-SuRF-Practical-Range-Query-Filtering-with-Fast-Succinct-Tries/</url>
    <content><![CDATA[<h1 id="Succinct-Data-Structure"><a href="#Succinct-Data-Structure" class="headerlink" title="Succinct Data Structure"></a>Succinct Data Structure</h1><p>Succinct: expressed clearly and in a few words. ‰∏≠ÊñáÊÑèÊÄùÂ∞±ÊòØÁÆÄÊ¥ÅÊòé‰∫ÜÁöÑ„ÄÇÈ¶ñÂÖàÁúã‰∏Ä‰∏ã wiki ÂºïÁî®ÂØπ‰∫é succinct data structure ÁöÑÊèèËø∞Ôºö</p>
<blockquote>
<p>In computer science, a succinct data structure is a data structure which uses an amount of space that is ‚Äúclose‚Äù to the information-theoretic lower bound, but (unlike other compressed representations) still allows for efficient query operations.</p>
</blockquote>
<p>Suppose that Z is the information-theoretical optimal number of bits needed to store some data. A representation of this data is called:</p>
<ul>
<li><code>implicit</code>: if it takes Z+O(1) bits of space,</li>
<li><code>succinct</code>: if it takes Z+o(Z) bits of space,</li>
<li><code>compact</code>: if it takes O(Z) bits of space.</li>
</ul>
<p>For example, a data structure that uses 2Z bits of storage is compact, Z + \sqrt{Z} bits is succinct,  Z+lgZ bits is also succinct, and Z+3 bits is implicit.</p>
<a id="more"></a>

<h1 id="Succinct-Tree"><a href="#Succinct-Tree" class="headerlink" title="Succinct Tree"></a>Succinct Tree</h1><p>Goal: represent the data in close to optimal space, while supporting the operations efficiently.</p>
<p>ËøôÈáåÂ∞±Ë¶ÅË∞àÂà∞ <code>Jacobson, FOCS ‚Äò89</code> ÊèêÂá∫Êù•ÁöÑÊñπÊ≥ï„ÄÇ</p>
<h2 id="Heap-like-notation-for-a-binary-tree"><a href="#Heap-like-notation-for-a-binary-tree" class="headerlink" title="Heap-like notation for a binary tree"></a>Heap-like notation for a binary tree</h2><h3 id="ÁªìÊûÑÊâ©Â±ï"><a href="#ÁªìÊûÑÊâ©Â±ï" class="headerlink" title="ÁªìÊûÑÊâ©Â±ï"></a>ÁªìÊûÑÊâ©Â±ï</h3><p>È¶ñÂÖàÁúã‰∫åÂèâÊ†ëÁöÑÁ§∫‰æãÔºö<br><img src="1.png" alt="1"></p>
<p>ÂØπ‰∏Ä‰∏™‰∫åÂèâÊ†ëÔºåÊàë‰ª¨ÁªôÊØè‰∏Ä‰∏™ leaf node Ê∑ªÂä† external node„ÄÇÁÑ∂ÂêéÔºåÊâÄÊúâ external node ËµãÂÄº 0Ôºåinternal node ËµãÂÄº 1„ÄÇÊåâÁÖßÂ±ÇÂ∫èÈÅçÂéÜÔºåÂ∞ÜÊâÄÊúâÁöÑÂÄºÁîüÊàê‰∏Ä‰∏™ <code>bit Â∫èÂàó</code>„ÄÇÊàë‰ª¨Â∞±‰ΩøÁî®ËØ•Â∫èÂàó‰ª£Ë°®Êï¥‰∏™Ê†ëÁöÑÁªìÊûÑ„ÄÇ</p>
<p>ÈÇ£‰πàÊúâ‰∫ÜËØ•Â∫èÂàóÔºåÂ∫îËØ•ÊÄéÊ†∑ÂÆûÁé∞Ê†ëÁöÑÂü∫Êú¨Êìç‰ΩúÂë¢ÔºüËØ∏Â¶ÇÔºöparent, left-children, right-children„ÄÇ</p>
<p><img src="2.png" alt="2"><br>È¶ñÂÖàÁªôÂéüÊú¨ÁöÑÊ†ë internal node ËøõË°åÁºñÂè∑ÔºåÁºñÂè∑‰ªé 1 ÂºÄÂßãÔºåÂ±ÇÂ∫èÈ°∫Â∫è„ÄÇËøôÊ†∑Ê†ëÁöÑ 8 ‰∏™ node Â∞±Ë¢´‰æùÊ¨°ÁºñÂè∑‰∏∫ 1-8„ÄÇ<br>ÁÑ∂ÂêéÁªôÊâÄÊúâ nodeÔºåÂåÖÊã¨ external node ËøõË°åÁºñÂè∑ÔºåÁºñÂè∑‰ªé 1 ÂºÄÂßãÔºåÂ±ÇÂ∫èÈÅçÂéÜ„ÄÇËøôÊ†∑ 17 ‰∏™ node Â∞±Ë¢´‰æùÊ¨°ÁºñÂè∑‰∏∫ 1 - 17„ÄÇ</p>
<h3 id="rank-amp-select"><a href="#rank-amp-select" class="headerlink" title="rank &amp; select"></a>rank &amp; select</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">R  : <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span>   <span class="number">5</span> <span class="number">6</span>   <span class="number">7</span>        <span class="number">8</span>                 <span class="comment">// use r to indicate the index</span></span><br><span class="line"><span class="built_in">bit</span>: <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span>  <span class="number">0</span>  <span class="number">0</span>  <span class="number">1</span>  <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line">S  : <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span> <span class="number">16</span> <span class="number">17</span>  <span class="comment">// use s to indicate the index</span></span><br></pre></td></tr></table></figure>

<p>ËøôÈáåÈúÄË¶Å‰ªãÁªçÈíàÂØπËØ• bit Â∫èÂàóÔºåÊâÄÈúÄË¶ÅÁöÑ‰∏§‰∏™Âü∫Êú¨Êìç‰ΩúÔºö</p>
<div class="note warning"><p><code>rank(s)</code>: Count the number of element in S less or equal than s.<br><code>select(i)</code>: Find the i-th smallest element in S.</p>
<ol>
<li><code>rank(s)</code>: ÂÖ∂ÂÆûÂ∞±ÊòØÂú® S Â∫èÂàóÁºñÂè∑ËåÉÂõ¥ [1,s]Ôºåbit Â∫èÂàó‰∏≠ 1 ÁöÑ‰∏™Êï∞„ÄÇÂèØ‰ª•ÁúãÂà∞Ôºårank(6) = 5, rank(9) = 7„ÄÇËøôÈáåÂèØ‰ª•ÁêÜËß£‰∏∫ S[s] ÊâÄÂú®ÁöÑ 1 bitÔºåÂú® R ‰∏≠ÂØπÂ∫îÁöÑÁºñÂè∑„ÄÇrank ÊòØ‰ªé <code>S Âà∞ R</code> ÁöÑÊò†Â∞Ñ„ÄÇ</li>
<li><code>select(i)</code>: Âú® S Â∫èÂàóÁºñÂè∑‰∏ãÔºåÂú® bit Â∫èÂàó‰∏≠ÊâæÂà∞Á¨¨ i ‰∏™ 1 ÊâÄÂú®ÁöÑÁºñÂè∑„ÄÇÂèØ‰ª•ÁúãÂà∞Ôºåselect(5) = 6, select(7) = 9„ÄÇËøôÈáåÂèØ‰ª•ÁêÜËß£Êàê‰∏∫ R[i] ÊâÄÂú®ÁöÑ 1 bitÔºåÂú® S ‰∏≠ÂØπÂ∫îÁöÑÁºñÂè∑„ÄÇselect ÊòØ <code>R Âà∞ S</code> ÁöÑÊò†Â∞Ñ„ÄÇ</li>
</ol></div>

<p>Ëøô‰∏§‰∏™Êìç‰ΩúÊòØ‰∫íË°•ÁöÑ„ÄÇÂèØ‰ª•ÁúãÂà∞ rank(select(5)) = 5. select(rank(9)) = 9„ÄÇÂΩìÁÑ∂ËøôÁßç‰∫íË°•Âè™ÂØπ internal node ÊàêÁ´ã„ÄÇÂØπ‰∫é external node ÊòØ‰∏çÊàêÁ´ãÁöÑ„ÄÇÊØîÂ¶Ç external node 11Ôºörank(13) = 8, select(8) = 12„ÄÇ</p>
<h3 id="left-right-child-and-parent"><a href="#left-right-child-and-parent" class="headerlink" title="left, right child and parent"></a>left, right child and parent</h3><p>Êúâ‰∫Ü rank Âíå select Ëøô‰∏§‰∏™Âü∫Êú¨Êìç‰ΩúÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•Âú®ËØ• <code>bit Â∫èÂàó</code>ËøõË°å left childÔºåright child Âíå parent ÁöÑÊìç‰Ωú‰∫Ü„ÄÇ</p>
<p>ÂØπ‰∫é internal node n:</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">R  : <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span>     <span class="number">5</span>  <span class="number">6</span>     <span class="number">7</span>            <span class="number">8</span>                           <span class="comment">// use r to indicate the index</span></span><br><span class="line"><span class="built_in">bit</span>: <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  <span class="number">0</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">0</span>  <span class="number">1</span>   <span class="number">0</span>    <span class="number">0</span>   <span class="number">1</span>   <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span></span><br><span class="line">S  : <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> (<span class="number">5</span>) <span class="number">6</span>  <span class="number">7</span> (<span class="number">8</span>) <span class="number">9</span> (<span class="number">10</span>) (<span class="number">11</span>) <span class="number">12</span> (<span class="number">13</span>) (<span class="number">14</span>) (<span class="number">15</span>) (<span class="number">16</span>) (<span class="number">17</span>)  <span class="comment">// use s to indicate the index, () means this number is not belonging to data set S.</span></span><br><span class="line"></span><br><span class="line">ÂÅáËÆænodeÊòØÂ¶Ç‰∏ãÁªìÊûÑÔºö</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">  <span class="built_in">bit</span> val;</span><br><span class="line">  <span class="keyword">int</span> r; <span class="comment">// value in R</span></span><br><span class="line">  <span class="keyword">int</span> s; <span class="comment">// value in S</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ÊúâÂ¶Ç‰∏ãÂÖ≥Á≥ªÔºö</span><br><span class="line">  rank(n.s) = n.r</span><br><span class="line">select(n.r) = n.s</span><br><span class="line"></span><br><span class="line">-  left-child(n).s = <span class="number">2</span> * rank(n.s)     = <span class="number">2</span> * n.r     <span class="comment">// ËøôÈáåÁúãÂá∫ node ÁöÑ r ÁºñÂè∑‰πò‰∫åÔºåÂæóÂà∞ÂÖ∂ left child ÁöÑ s ÁºñÂè∑</span></span><br><span class="line">- right-child(n).s = <span class="number">2</span> * rank(n.s) + <span class="number">1</span> = <span class="number">2</span> * n.r + <span class="number">1</span> <span class="comment">// ËøôÈáåÁúãÂá∫ node ÁöÑ r ÁºñÂè∑‰πò‰∫åÂä†‰∏ÄÔºåÂæóÂà∞ÂÖ∂ right child ÁöÑ s ÁºñÂè∑</span></span><br><span class="line">-      parent(n).s = select(n.s / <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">parent ÂèØ‰ª•Êé®Âá∫Êù•„ÄÇÂØπ‰∫é left-childÔºåÊúâÔºö</span><br><span class="line">       left-child(n).s      = <span class="number">2</span> * n.r</span><br><span class="line">       left-child(n).s / <span class="number">2</span>  = n.r           <span class="comment">// ËøôÈáåÁúãÂá∫ node ÁöÑ s ÁºñÂè∑Áõ¥Êé•Èô§‰ª•‰∫åÔºåÂæóÂà∞ÂÖ∂ parent node ÁöÑ r ÁºñÂè∑</span></span><br><span class="line">select(left-child(n).s / <span class="number">2</span>) = select(n.r)</span><br><span class="line">select(left-child(n).s / <span class="number">2</span>) = n.s</span><br><span class="line">ÂØπ right-child ÂêåÁêÜ„ÄÇ</span><br><span class="line"></span><br><span class="line">ÁÆÄÂçïÁúãÊù•Â∞±ÊòØ:</span><br><span class="line">-  left-node(n).s = S[<span class="number">2</span> * n.r]</span><br><span class="line">- right-node(n).s = S[<span class="number">2</span> * n.r + <span class="number">1</span>]</span><br><span class="line">-     parent(n).r = R[n.s / <span class="number">2</span>]</span><br></pre></td></tr></table></figure>

<div class="note success"><p><strong>Left Child:</strong></p>
<p>internal node 6 (bit Â∫èÂàó‰∏≠ÔºåÁ¨¨ 6 ‰∏™ 1 bit ÊâÄÂú® node, R ‰∏≠ÁºñÂè∑‰∏∫ 6 ÁöÑ node)„ÄÇ</p>
<ul>
<li>rank(6.s) = rank(7) = 6</li>
<li>left-node(6).s = 2 * rank(6.s) = 2 * 6 = 12</li>
<li>S ÁºñÂè∑‰∏≠Ôºå12 ÂØπÂ∫îÁöÑ node ÊòØ R ‰∏≠ÁºñÂè∑‰∏∫ 8 ÁöÑ node„ÄÇ</li>
</ul></div>


<div class="note success"><p><strong>Right Child</strong><br>internal node 4 (bit Â∫èÂàó‰∏≠ÔºåÁ¨¨ 4 ‰∏™ 1 bit ÊâÄÂú® node, R ‰∏≠ÁºñÂè∑‰∏∫ 4 ÁöÑ node)„ÄÇ</p>
<ul>
<li>rank(4.s) = rank(4) = 4</li>
<li>right-node(4).s = 2 * rank(4.s) + 1 = 2 * 4 = 8 + 1 = 9</li>
<li>S ÁºñÂè∑‰∏≠Ôºå9 ÂØπÂ∫îÁöÑ node ÊòØ R ‰∏≠ÁºñÂè∑‰∏∫ 7 ÁöÑ node„ÄÇ</li>
</ul></div>

<div class="note success"><p><strong>Parent</strong><br>internal node 8 (bit Â∫èÂàó‰∏≠ÔºåÁ¨¨ 8 ‰∏™ 1 bit ÊâÄÂú® node, R ‰∏≠ÁºñÂè∑‰∏∫ 8 ÁöÑ node)„ÄÇ</p>
<ul>
<li>select(8.r) = select(8) = 12</li>
<li>parent(8).r = select(8.r) / 2 = 12 / 2 = 6</li>
<li>R ÁºñÂè∑‰∏≠Ôºå6 ÂØπÂ∫îÁöÑ node ÊòØ S ‰∏≠ÁºñÂè∑‰∏∫ 7 ÁöÑ node„ÄÇ</li>
</ul></div>

<h2 id="Level-Order-Unary-Degree-Sequence-LOUDS"><a href="#Level-Order-Unary-Degree-Sequence-LOUDS" class="headerlink" title="Level Order Unary Degree Sequence (LOUDS)"></a>Level Order Unary Degree Sequence (LOUDS)</h2><p>‰∏ãÈù¢ÂØπ‰∫é‰ªªÊÑèÁöÑ tree ËøõË°åÁºñÁ†Å„ÄÇ<br>È¶ñÂÖàÂØπÂ∑≤ÊúâÁöÑ tree ÁöÑ root ‰πã‰∏äÔºåÊ∑ªÂä†‰∏Ä‰∏™ super root„ÄÇÁªôÊØè‰∏™ËäÇÁÇπÁºñÁ†ÅÁöÑÊñπÂºè‰πüÂæàÁÆÄÂçïÔºö<code>ËØ•ËäÇÁÇπÂ≠êËäÇÁÇπÁöÑ‰∏™Êï∞‰∏™ ‚Äú1‚Äù Âä†‰∏ä‰∏Ä‰∏™ ‚Äú0‚Äù</code>„ÄÇÁÑ∂ÂêéÊåâÁÖßÂ±ÇÂ∫èÈÅçÂéÜÁöÑÊñπÂºèÔºåÂ∞ÜËøô‰∫õÁºñÁ†ÅÁªÑÊàê‰∏Ä‰∏™ <code>bit Â∫èÂàó</code>„ÄÇ </p>
<p><img src="3.png" alt="3"></p>
<p><img src="6.png" alt="6"></p>
<p><img src="4.png" alt="4"></p>
<p><img src="5.png" alt="5"></p>
<p>LOUDS ÊòØ‰∏Ä‰∏™ bit vector„ÄÇÊàë‰ª¨ÈúÄË¶ÅÂ¶Ç‰∏ãÁöÑÂü∫Êú¨Êìç‰Ωú</p>
<blockquote>
<p><code>rank1(i)</code> ‚Äì returns number of ‚Äò1‚Äô in the range [0, i)<br><code>rank0(i)</code> ‚Äì returns number of ‚Äò0‚Äô in the range [0, i). <code>rank0(i) = i - rank1(i)</code><br><code>select1(rnk)</code> ‚Äì returns position of rnk-th ‚Äò1‚Äô in the LOUDS string, rnk = 1, 2, 3, ‚Ä¶<br><code>select0(rnk)</code> ‚Äì returns position of rnk-th ‚Äò0‚Äô in the LOUDS string, rnk = 1, 2, 3, ‚Ä¶</p>
</blockquote>
<p>ËøôÂõõ‰∏™Âü∫Êú¨Êìç‰ΩúÂèØ‰ª•Âú® O(1) Êó∂Èó¥Â§çÊùÇÂ∫¶‰∏ãÂÆûÁé∞ÔºåËøô‰∏™ÂêéÈù¢Êàë‰ª¨ÂÜçËÅäÂÆûÁé∞„ÄÇËøô‰∫õÊìç‰ΩúÂèØ‰ª•Ë°çÁîüÂá∫‰∏ãÈù¢ÁöÑÂØπÊ†ëÁöÑÊìç‰ΩúÔºö</p>
<p>Different ways of tree node numbering for LOUDS are possible, Memoria uses the simplest one. Tree node positions are coded by ‚Äò1‚Äô.</p>
<ul>
<li><code>node_num = rank1(i)</code> ‚Äì gets tree node number at position i;</li>
<li><code>i = select1(node_num)</code> ‚Äì finds position of a node in LOUDS given its number in the tree.</li>
</ul>
<p>Having this node numbering we can define the following tree navigation operations:</p>
<ul>
<li><code>fist_child(i) = select0(rank1(i)) + 1</code> ‚Äì finds position of the first child for node at the position i;</li>
<li><code>last_child(i) = select0(rank1(i) + 1) - 1</code>‚Äì finds position of the last child for node at the position i;</li>
<li><code>parent(i) = select1(rank0(i))</code> ‚Äì finds position of the parent for the node at the position i;</li>
<li><code>children(i) = last_child(i) - first_child(i)</code> ‚Äì return number of children for node at the position i;</li>
<li><code>child(i, num) = first_child(i) + num</code> ‚Äì returns position of num-th child for the node at the position i, num &gt;= 0;</li>
<li><code>is_node(i) = LOUDS[i] == 1 ? true : false</code> ‚Äì checks if i-th position in tree node.</li>
</ul>
<p>Note that navigation operations only defined for positions i for those <code>is_leaf(i) == true</code>.</p>
<p><img src="7.png" alt="7"></p>
<p>ÊØîÂ¶ÇÊàëÊÉ≥Êâæ <code>node_num = 8</code> ÁöÑ first child 11Ôºålast child 12Ôºåparent 4Ôºö</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">       node_num = <span class="number">8</span></span><br><span class="line">i =  select1(<span class="number">8</span>) = <span class="number">12</span></span><br><span class="line"></span><br><span class="line">first_child(<span class="number">12</span>) = select0(rank1(<span class="number">12</span>)) + <span class="number">1</span></span><br><span class="line">                = select0(<span class="number">8</span>) + <span class="number">1</span></span><br><span class="line">                = <span class="number">19</span></span><br><span class="line">      rank1(<span class="number">19</span>) = <span class="number">11</span></span><br><span class="line"></span><br><span class="line"> last_child(<span class="number">12</span>) = select0(rank1(<span class="number">12</span>) + <span class="number">1</span>) - <span class="number">1</span></span><br><span class="line">                = select0(<span class="number">8</span> + <span class="number">1</span>) - <span class="number">1</span></span><br><span class="line">                = select0(<span class="number">9</span>) - <span class="number">1</span></span><br><span class="line">                = <span class="number">21</span> - <span class="number">1</span></span><br><span class="line">                = <span class="number">20</span></span><br><span class="line">      rank1(<span class="number">20</span>) = <span class="number">12</span></span><br><span class="line"></span><br><span class="line">     parent(<span class="number">12</span>) = select1(rank0(<span class="number">12</span>))</span><br><span class="line">                = select1(<span class="number">4</span>)</span><br><span class="line">                = <span class="number">5</span></span><br><span class="line">       rank1(<span class="number">5</span>) = <span class="number">4</span></span><br></pre></td></tr></table></figure>


<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://www.computer.org/csdl/proceedings/focs/1989/1982/00/063533.pdf" target="_blank" rel="noopener">Space-efficient Static Trees and Graphs</a><br><a href="https://db.cs.cmu.edu/papers/2018/mod601-zhangA-hm.pdf" target="_blank" rel="noopener">SuRF: Practical Range Query Filtering with Fast Succinct Tries</a><br><a href="https://courses.cs.ut.ee/MTAT.03.238/2013_fall/uploads/Main/06_alg_Succinct.6up.pdf" target="_blank" rel="noopener">Advanced(Algorithmics((6EAP)</a><br><a href="https://cs.uwaterloo.ca/~imunro/cs840/Notes16/SuccinctDS.pdf" target="_blank" rel="noopener">Succinct Data Structures</a><br><a href="https://en.wikipedia.org/wiki/Succinct_data_structure#cite_note-jacobson1989space-4" target="_blank" rel="noopener">Succinct data structure</a><br><a href="https://lra.le.ac.uk/bitstream/2381/318/4/rank-select.pdf" target="_blank" rel="noopener">Rank and Select Operations on Binary Strings (1974; Elias)</a><br><a href="http://chuansong.me/n/2035229" target="_blank" rel="noopener">‰∏ÄÁßçÁ•ûÂ•áÁöÑÊï∞ÊçÆÁªìÊûÑ‚ÄîÂ∞èÊ≥¢Ê†ë</a><br><a href="https://en.wikipedia.org/wiki/Range_minimum_query" target="_blank" rel="noopener">Range minimum query</a><br><a href="http://alexbowe.com/rrr/" target="_blank" rel="noopener">RRR ‚Äì A Succinct Rank/Select Index for Bit Vectors</a></p>
]]></content>
      <categories>
        <category>review</category>
      </categories>
      <tags>
        <tag>leveldb</tag>
        <tag>bloomfilter</tag>
      </tags>
  </entry>
  <entry>
    <title>inode symbolic and hard link</title>
    <url>/blog/inode-symblic-and-hard-link/</url>
    <content><![CDATA[<p>‰∏ÄÂº†Âõæ‰ªãÁªç symbolic Âíå hard link„ÄÇ<br><img src="1.png" alt="inode"></p>
<a id="more"></a>
<h1 id="hard-link-explain-in-bash"><a href="#hard-link-explain-in-bash" class="headerlink" title="hard link explain in bash"></a>hard link explain in bash</h1><script src="https://asciinema.org/a/aBvSNT6fDqNQ3F6Zl631XVU7S.js" id="asciicast-aBvSNT6fDqNQ3F6Zl631XVU7S" async></script>

<h1 id="symbolic-link-explain-in-bash"><a href="#symbolic-link-explain-in-bash" class="headerlink" title="symbolic link explain in bash"></a>symbolic link explain in bash</h1><script src="https://asciinema.org/a/Zd3vj73pAnRSxXDrtPR5ldKcy.js" id="asciicast-Zd3vj73pAnRSxXDrtPR5ldKcy" async></script>
]]></content>
      <categories>
        <category>database</category>
      </categories>
  </entry>
  <entry>
    <title>mit 6.828: lab1</title>
    <url>/blog/mit-6-828-lab1/</url>
    <content><![CDATA[<h1 id="ÂÆâË£Ö-QEMU"><a href="#ÂÆâË£Ö-QEMU" class="headerlink" title="ÂÆâË£Ö QEMU"></a>ÂÆâË£Ö QEMU</h1><p>‰ΩøÁî® Ubuntu 16.04.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install libglib2.0-dev libgcrypt20-dev zlib1g-dev gcc-multilib autoconf automake bison flex</span><br><span class="line">sudo apt install libpixman-1-dev libz-dev libtool libtool-bin libsdl1.2-dev</span><br><span class="line">git submodule update --init dtc</span><br><span class="line">./configure --<span class="built_in">disable</span>-kvm --target-list=<span class="string">"i386-softmmu x86_64-softmmu"</span> <span class="comment"># ÈªòËÆ§ÂÆâË£ÖÂà∞ /usr/local</span></span><br><span class="line">make -j8</span><br><span class="line">make -j8 install</span><br></pre></td></tr></table></figure>

<h1 id="Software-Setup"><a href="#Software-Setup" class="headerlink" title="Software Setup"></a>Software Setup</h1><p>‰∏ãËΩΩÂÆûÈ™åÊùêÊñôÔºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">athena% mkdir ~/6.828</span><br><span class="line">athena% <span class="built_in">cd</span> ~/6.828</span><br><span class="line">athena% add git</span><br><span class="line">athena% git <span class="built_in">clone</span> https://pdos.csail.mit.edu/6.828/2017/jos.git lab</span><br><span class="line">Cloning into lab...</span><br><span class="line">athena% <span class="built_in">cd</span> lab</span><br><span class="line">athena%</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h1 id="Part-1-PC-Bootstrap"><a href="#Part-1-PC-Bootstrap" class="headerlink" title="Part 1: PC Bootstrap"></a>Part 1: PC Bootstrap</h1><p>Ëøô‰∏ÄÈÉ®ÂàÜ‰∏çÈúÄË¶ÅÁºñÁ†ÅÔºåÂè™‰∏∫‰∫ÜËÆ©Êàë‰ª¨‰∫ÜËß£ PC bootstrap ÁöÑËøáÁ®ã„ÄÇÂπ∂‰∏îËÆ©Êàë‰ª¨ÁÜüÊÇâ QEMU Âíå QEMU/GDB ÁöÑ debug ËøáÁ®ã„ÄÇ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> lab</span><br><span class="line">make</span><br></pre></td></tr></table></figure>

<p>Ëøô‰ºö build ‰∏Ä‰∏™ boot loader Âíå kernel : <code>kernel.img</code>„ÄÇ</p>
<h2 id="Simulating-the-x86"><a href="#Simulating-the-x86" class="headerlink" title="Simulating the x86"></a>Simulating the x86</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">parallels@parallels-vm:~/Desktop/mit/lab$ make</span><br><span class="line">+ as kern/entry.S</span><br><span class="line">+ cc kern/entrypgdir.c</span><br><span class="line">+ cc kern/init.c</span><br><span class="line">+ cc kern/console.c</span><br><span class="line">+ cc kern/monitor.c</span><br><span class="line">+ cc kern/printf.c</span><br><span class="line">+ cc kern/kdebug.c</span><br><span class="line">+ cc lib/printfmt.c</span><br><span class="line">+ cc lib/readline.c</span><br><span class="line">+ cc lib/string.c</span><br><span class="line">+ ld obj/kern/kernel</span><br><span class="line">+ as boot/boot.S</span><br><span class="line">+ cc -Os boot/main.c</span><br><span class="line">+ ld boot/boot</span><br><span class="line">boot block is 390 bytes (max 510)</span><br><span class="line">+ mk obj/kern/kernel.img</span><br></pre></td></tr></table></figure>

<p><code>kernel.img</code> ÂåÖÂê´‰∫Ü boot loader (<code>obj/boot/boot</code>) Âíå kernel (<code>obj/kernel</code>)„ÄÇ</p>
<p>ÁÑ∂Âêé‰ΩøÁî®ÂëΩ‰ª§Ôºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">make qemu</span><br><span class="line">or</span><br><span class="line">make qemu-nox</span><br></pre></td></tr></table></figure>

<p>‰∏∫‰∫ÜÈÄÄÂá∫Ôºå‰ΩøÁî®ÂëΩ‰ª§ <code>Ctrl+a x</code></p>
<p>Âú®ÂΩìÂâçÁöÑ kernel ÈáåÈù¢ÔºåÂèØ‰ª•‰ΩøÁî®Â¶Ç‰∏ã‰∏§‰∏™ÂëΩ‰ª§Ôºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">K&gt; <span class="built_in">help</span></span><br><span class="line"><span class="built_in">help</span> - Display this list of commands</span><br><span class="line">kerninfo - Display information about the kernel</span><br><span class="line">K&gt; kerninfo</span><br><span class="line">Special kernel symbols:</span><br><span class="line">  _start                  0010000c (phys)</span><br><span class="line">  entry  f010000c (virt)  0010000c (phys)</span><br><span class="line">  etext  f0101871 (virt)  00101871 (phys)</span><br><span class="line">  edata  f0112300 (virt)  00112300 (phys)</span><br><span class="line">  end    f0112944 (virt)  00112944 (phys)</span><br><span class="line">Kernel executable memory footprint: 75KB</span><br><span class="line">K&gt;</span><br></pre></td></tr></table></figure>

<h2 id="The-PC‚Äôs-Physical-Address-Space"><a href="#The-PC‚Äôs-Physical-Address-Space" class="headerlink" title="The PC‚Äôs Physical Address Space"></a>The PC‚Äôs Physical Address Space</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">     +------------------+  &lt;- 0xFFFFFFFF (4GB)</span><br><span class="line">     |      32-bit      |</span><br><span class="line">     |  memory mapped   |</span><br><span class="line">     |     devices      |</span><br><span class="line">     |                  |</span><br><span class="line">     /\/\/\/\/\/\/\/\/\/\</span><br><span class="line"></span><br><span class="line">     /\/\/\/\/\/\/\/\/\/\</span><br><span class="line">     |                  |</span><br><span class="line">     |      Unused      |</span><br><span class="line">     |                  |</span><br><span class="line">     +------------------+  &lt;- depends on amount of RAM</span><br><span class="line">     |                  |</span><br><span class="line">     |                  |</span><br><span class="line">     | Extended Memory  |</span><br><span class="line">     |                  |</span><br><span class="line">     |                  |</span><br><span class="line">---  +------------------+  &lt;- 0x00100000 (1MB)</span><br><span class="line"> |   |     BIOS ROM     |</span><br><span class="line"> |   +------------------+  &lt;- 0x000F0000 (960KB)</span><br><span class="line">hole |  16-bit devices, |</span><br><span class="line"> |   |  expansion ROMs  |</span><br><span class="line"> |   +------------------+  &lt;- 0x000C0000 (768KB)</span><br><span class="line"> |   |   VGA Display    |</span><br><span class="line">---  +------------------+  &lt;- 0x000A0000 (640KB)</span><br><span class="line">     |                  |</span><br><span class="line">     |    Low Memory    |</span><br><span class="line">     |                  |</span><br><span class="line">     +------------------+  &lt;- 0x00000000</span><br></pre></td></tr></table></figure>

<blockquote>
<p>The first PCs, which were based on the 16-bit Intel 8088 processor, were only capable of addressing 1MB of physical memory. The physical address space of an early PC would therefore start at 0x00000000 but end at 0x000FFFFF instead of 0xFFFFFFFF. The 640KB area marked <code>&quot;Low Memory&quot;</code> was the only random-access memory (RAM) that an early PC could use; in fact the very earliest PCs only could be configured with 16KB, 32KB, or 64KB of RAM!</p>
</blockquote>
<blockquote>
<p>The 384KB area from 0x000A0000 through 0x000FFFFF was reserved by the hardware for special uses such as video display buffers and firmware held in non-volatile memory. The most important part of this reserved area is the <code>Basic Input/Output System</code> (BIOS), which occupies the 64KB region from 0x000F0000 through 0x000FFFFF. In early PCs the BIOS was held in true read-only memory (ROM), but current PCs store the BIOS in updateable flash memory. The BIOS is responsible for <code>performing basic system initialization</code> such as activating the video card and checking the amount of memory installed. After performing this initialization, the BIOS <code>loads the operating system</code> from some appropriate location such as floppy disk, hard disk, CD-ROM, or the network, and <code>passes control</code> of the machine <code>to the operating system</code>.</p>
</blockquote>
<blockquote>
<p>When Intel finally ‚Äúbroke the one megabyte barrier‚Äù with the 80286 and 80386 processors, which supported 16MB and 4GB physical address spaces respectively, the PC architects nevertheless preserved the original layout for the low 1MB of physical address space in order to ensure backward compatibility with existing software. Modern PCs therefore have a <code>&quot;hole&quot;</code> in physical memory from <code>0x000A0000 to 0x00100000</code>, dividing RAM into ‚Äúlow‚Äù or ‚Äúconventional memory‚Äù (the first 640KB) and ‚Äúextended memory‚Äù (everything else). In addition, some space at the very top of the PC‚Äôs 32-bit physical address space, above all physical RAM, is now commonly reserved by the BIOS for use by 32-bit PCI devices.</p>
</blockquote>
<blockquote>
<p>Recent x86 processors can support more than 4GB of physical RAM, so RAM can extend further above 0xFFFFFFFF. In this case the BIOS must arrange to leave a <code>second hole</code> in the system‚Äôs RAM at the top of the 32-bit addressable region, to leave room for these 32-bit devices to be mapped. Because of design limitations JOS will use only the first 256MB of a PC‚Äôs physical memory anyway, so for now we will pretend that all PCs have ‚Äúonly‚Äù a 32-bit physical address space. But dealing with complicated physical address spaces and other aspects of hardware organization that evolved over many years is one of the important practical challenges of OS development.</p>
</blockquote>
<h2 id="The-ROM-BIOS"><a href="#The-ROM-BIOS" class="headerlink" title="The ROM BIOS"></a>The ROM BIOS</h2><p>ËøôÈÉ®ÂàÜÁî®Êù•Êé¢Á¥¢ IA-32 ÂÖºÂÆπÁöÑÁîµËÑëÊòØÊÄé‰πàÂêØÂä®ÁöÑ„ÄÇ</p>
<p>È¶ñÂÖàËøõÂÖ• lab ÁõÆÂΩïÔºåÊâìÂºÄ‰∏§‰∏™ terminal„ÄÇ</p>
<ul>
<li>In one, enter <code>make qemu-gdb</code> (or <code>make qemu-nox-gdb</code>). This starts up QEMU, but <code>QEMU stops</code> just before the processor executes <code>the first instruction</code> and waits for a debugging connection from GDB. </li>
<li>In the second terminal, from the same directory you ran make, run <code>make gdb</code>. You should see something like this:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">parallels@parallels-vm:~/Desktop/mit/lab$ make gdb</span><br><span class="line">gdb -n -x .gdbinit</span><br><span class="line">GNU gdb (Ubuntu 7.11.1-0ubuntu1~16.5) 7.11.1</span><br><span class="line">...</span><br><span class="line">The target architecture is assumed to be i8086</span><br><span class="line">[f000:fff0]    0xffff0:	ljmp   <span class="variable">$0xf000</span>,<span class="variable">$0xe05b</span></span><br><span class="line">0x0000fff0 <span class="keyword">in</span> ?? ()</span><br><span class="line">+ symbol-file obj/kern/kernel</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>

<p>Êàë‰ª¨Êù•Áúã‰∏ãPC boot Êó∂ÂÄôÁöÑËøô‰∏™Á¨¨‰∏ÄÊù°Êåá‰ª§Ôºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[f000:fff0] 0xffff0:	ljmp   <span class="variable">$0xf000</span>,<span class="variable">$0xe05b</span></span><br></pre></td></tr></table></figure>

<p>‰ªéËøôÊù°Êåá‰ª§ÂèØ‰ª•ÁúãÂá∫Â¶Ç‰∏ãÂá†ÁÇπÔºö</p>
<ul>
<li>The IBM PC starts executing at physical address 0x000ffff0, which is at the very top of the 64KB area reserved for the ROM BIOS.</li>
<li>The PC starts executing with CS = 0xf000 and IP = 0xfff0.</li>
<li>The first instruction to be executed is a jmp instruction, which jumps to the segmented address CS = 0xf000 and IP = 0xe05b.</li>
</ul>
<p>On processor reset, the (simulated) processor enters real mode and sets CS to 0xf000 and the IP to 0xfff0, so that execution begins at that (CS:IP) segment address. </p>
<h2 id="Part-2-The-Boot-Loader"><a href="#Part-2-The-Boot-Loader" class="headerlink" title="Part 2: The Boot Loader"></a>Part 2: The Boot Loader</h2><p>After initializing the PCI bus and all the important devices the BIOS knows about, it searches for a <code>bootable device</code> such as a floppy, hard drive, or CD-ROM.</p>
<p>If the disk is <code>bootable</code>, the <code>first sector</code> of the disk is called the <code>boot sector</code>, since this is where the boot loader code resides. </p>
<p>When the BIOS finds a bootable floppy or hard disk, it loads the <code>512-byte boot sector</code> into memory at physical addresses <code>0x7c00</code> through <code>0x7dff</code>, and then uses a jmp instruction to set the CS:IP to 0000:7c00, passing control to the boot loader.</p>
<p>For 6.828, the bootload code is in <code>boot/boot.s</code> and <code>boot/main.c</code>. The bootloader perform two main functions:</p>
<ol>
<li>switch from <code>real mode</code> to <code>32bit protected mode</code>, so the software can access memory above 1MB. And the segmented addresses change from 16bit to 32bit.</li>
<li>boot loader reads kernel from hard disk.</li>
</ol>
]]></content>
      <categories>
        <category>os</category>
      </categories>
      <tags>
        <tag>mit6.828</tag>
      </tags>
  </entry>
  <entry>
    <title>Paper Review:HOT: A Height Optimized Trie Index for Main-Memory Database Systems</title>
    <url>/blog/Paper-Review-HOT-A-Height-Optimized-Trie-Index-for-Main-MemoryDatabase-Systems/</url>
    <content><![CDATA[<h1 id="Backgroud"><a href="#Backgroud" class="headerlink" title="Backgroud"></a>Backgroud</h1><h2 id="Patricia-Tree-or-Radix-Tree-or-Compact-Prefix-Tree"><a href="#Patricia-Tree-or-Radix-Tree-or-Compact-Prefix-Tree" class="headerlink" title="Patricia Tree or Radix Tree or Compact Prefix Tree"></a><a href="https://en.wikipedia.org/wiki/Radix_tree" target="_blank" rel="noopener">Patricia Tree or Radix Tree or Compact Prefix Tree</a></h2><p><img src="1.png" alt="Radix Tree"><br>A trie that each node which is the only child is merged with its parent.</p>
<h2 id="Adaptive-Radix-Tree-ART"><a href="#Adaptive-Radix-Tree-ART" class="headerlink" title="Adaptive Radix Tree (ART)"></a>Adaptive Radix Tree (ART)</h2><p><img src="2.png" alt="ART"><br>The adaptive radix tree is a radix tree variant that integrates <code>adaptive node sizes</code> to the radix tree. One major drawback of the usual <code>radix trees</code> is the use of space, because it uses a <code>constant node</code> size in every level. The <code>major difference</code> between the radix tree and the adaptive radix tree is <code>its variable size for each node</code> based on the number of child elements, which grows while adding new entries. Hence, the adaptive radix tree leads to a better use of space without reducing its speed.</p>
<div class="note danger"><p>Êó¢ÁÑ∂ÊòØÂä®ÊÄÅÂ¢ûÂä†ÁöÑÔºånode Êú¨Ë∫´ÁöÑ memory ÂàÜÈÖç‰πüÂ∫îËØ•ÊòØÂä®ÊÄÅÁöÑÔºåÈÇ£‰πà memory ‰∏çËøûÁª≠ÔºåÂèØËÉΩ‰ºöÂØºËá¥ cache miss ÈóÆÈ¢ò„ÄÇËøô‰∏™ÈúÄË¶ÅÁúãÂéüÊñá paper ÁúãÊòØÂê¶Â≠òÂú®„ÄÇ<a href="https://db.in.tum.de/~leis/papers/ART.pdf" target="_blank" rel="noopener">link</a></p></div>
<a id="more"></a>

<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p><img src="3.png" alt="HOT"></p>
<ul>
<li>Each trie depicted in Figure 2 stores the same 13 keys, all of which are 9 bits long.</li>
<li>The shape with the same color represent a node.</li>
<li>Compound nodes are surrounded by solid lines.</li>
<li>Dots in the figures represent either leaf values or bit positions in compound nodes which are used to distinguish between different keys.</li>
</ul>
<p><strong>Height Optimized Trie</strong></p>
<ul>
<li>HOT combines multiple nodes of a binary Patricia trie into compound nodes having a <code>maximum node fanout</code> of a predefined value k</li>
<li>Thus each node uses a custom span suitable to represent the discriminative bits of the combined nodes.</li>
<li>Adaptive node sizes (same as ART) are used to reduce memory consumption</li>
<li>Figure 2f shows a Height Optimized Trie with a maximum node fanout ofk = 4 that has 4 compound nodes and an overall height of 2 to store the same 13 keys as the other trie structures</li>
</ul>
<p>This paper want to minimize the over height of the trie such that <code>maximum number of partitions along a path</code> from the root node <code>to any leaf node</code> is minimized.</p>
<p><a href="https://www.sciencedirect.com/science/article/pii/S0020019003005118" target="_blank" rel="noopener">Partitioning of trees for minimizing height and cardinality</a> solves this optimization in static tree. This paper present a <code>dynamic algorithm</code>, which is able to preserve the height optimized partitioning <code>while new data is inserted</code>.</p>
<h1 id="Details"><a href="#Details" class="headerlink" title="Details"></a>Details</h1><p><img src="4.png" alt="Dynamic Insertion"></p>
<h2 id="Terminology"><a href="#Terminology" class="headerlink" title="Terminology"></a>Terminology</h2><ul>
<li><code>BiNode</code> denote a node in a binary Patricia trie.</li>
<li>Term <code>node</code> stands for a compound node.</li>
<li>Here maximum node fanout of k = 3.</li>
</ul>
<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><ul>
<li><p><code>normal case</code><br>Insertion is performed by locally modifying the BiNode structure of the affected node. More precisely, and as shown in <code>Figure 4b</code>, a new discriminating BiNode, which discriminates the new key from the keys contained in the subtree of the mismatching BiNode, is created and inserted into the affected node.</p>
</li>
<li><p><code>leaf-node pushdown</code>: This involves <code>creating a new node</code> instead of adding a new BiNode to an existing node.<br>If the mismatching BiNode is a leaf and the affected node is an inner node (h(n) &gt; 1), we replace the leaf with a new node.<br>This case is triggered when the key 010 is inserted into the tree shown in Figure 4b. Leaf-node pushdown does not affect the maximum tree height as can be observed in Figure 4c: Even after leaf-node pushdown, the height of the root node (and thus the tree) is still 2.</p>
</li>
<li><p><code>overflow</code>: fanout is bigger than k = 3.<br>An overflow happens when neither leaf-node pushdown nor normal insert are applicable. As Figure 4d shows, such an invalid intermediate state occurs after inserting 0011000.</p>
</li>
<li><p>Two ways to resolve <code>overflow</code>:</p>
<ul>
<li><code>Parent Pull Up</code>: Figure 4e<br>Moving the <code>root BiNode of the overflowed node</code> into its parent node. This approach is taken when growing the tree ‚Äúdownwards‚Äù would increase the tree height, and it is therefore better try to grow the tree ‚Äúupwards‚Äù. More formally, parent pull up is triggered when the height of the overflowed node n is ‚Äúalmost‚Äù the height of its parent: <code>h(n) + 1 = h(parent(n))</code>. Overflow handling therefore needs to be <code>recursively</code> applied to the affected parent node. Similar to a B-tree, the overall height of HOT only increases when a new root node is created.</li>
<li><code>intermediate node creation</code>:<br><code>Root BiNode</code> of the overflowed node is moved into a <code>newly created intermediate node</code>. Intermediate node creation is only applicable if adding an additional intermediate node does not increase the overall tree height, which is the case if: <code>h(n) + 1 &lt; h(parent(n))</code>. As shown in Figure 4g.</li>
</ul>
</li>
</ul>
<p>The paper also conjecture the HOT trie has the property that that any given set of keys results in the same structure, regardless of the insertion order.</p>
<h2 id="Design"><a href="#Design" class="headerlink" title="Design"></a>Design</h2><p><code>Key idea</code>: Linearizing a k-constrained trie to a compact bit string that can be search in parallel using <code>SIMD instructions</code>. To achieve this, this paper store the discriminative bits of each key consecutively.</p>
<p><img src="5.png" alt="desing"></p>
<ul>
<li>using <code>bit position</code> to form discriminative bits which is called <code>partial key (dense)</code></li>
<li>maximum fanout is k = 32 so as to utilizing the cache and fast update.</li>
<li>partial keys is aligned to enable SIMD operations.</li>
<li>key extraction (<code>PEXT</code> instruction: <a href="https://www.felixcloutier.com/x86/PEXT.html" target="_blank" rel="noopener">_pext_u64</a> and <a href="https://software.intel.com/sites/landingpage/IntrinsicsGuide/#text=_pext_u64&expand=3893,4072" target="_blank" rel="noopener">link</a>):<br><img src="6.png" alt="PDEP"><br>key extraction is done for every node to extract bits from the search key bit-by-bit to form the comparison key (partial key).</li>
</ul>
]]></content>
      <categories>
        <category>review</category>
      </categories>
      <tags>
        <tag>index</tag>
      </tags>
  </entry>
  <entry>
    <title>Paper Review: A Comparative Study of Secondary Indexing Techniques in LSM-based NoSQL Databases</title>
    <url>/blog/Paper-Review-A-Comparative-Study-of-Secondary-Indexing-Techniques-inLSM-based-NoSQL-Databases/</url>
    <content><![CDATA[<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p>NoSql databases have fast write throughput and fast lookup on primary key. And they also have good scalability and reliability.</p>
<p>However, in order to search non-primary attributes, <code>secondary index</code> should be maintained and this could hurts <code>write performance</code>.</p>
<p>This paper compares two types of secondary index:</p>
<ul>
<li><p>Embedded Indexes: lightweight filters embedded inside the primary table</p>
</li>
<li><p>Stand-Alone Indexes: separate data structure</p>
</li>
</ul>
<p>by implementing 2 <code>Embedded Indexes</code> and 3 <code>Stand-Alone Indexes</code> on top of LevelDB.</p>
<p>They conclude that : the <code>embedded indexes</code> offer superior <code>write throughput</code> and are more space efficient, whereas the <code>stand-alone secondary indexes</code> achieve <code>faster query</code> response times. So the optimal choice depends on the application workload.</p>
<a id="more"></a>
<h1 id="Details"><a href="#Details" class="headerlink" title="Details"></a>Details</h1><h2 id="Stand-Alone-Indexes"><a href="#Stand-Alone-Indexes" class="headerlink" title="Stand-Alone Indexes"></a>Stand-Alone Indexes</h2><p>Using tweets as example: <code>PUT(t1, {u1, text1})</code></p>
<ul>
<li>t1: tweet id</li>
<li>u1: user id</li>
<li>text1: tweet content</li>
</ul>
<p>There are <code>three types</code> of Stand-Alone Indexes update:</p>
<p><img src="1.png" alt=""></p>
<ul>
<li><code>Eager updates</code>: Earlier version of Cassandra<br>to execute <code>PUT(t4, {u1, text4})</code> on an Eager Index, we must retrieve the list for u1, add t4 and save it back.</li>
</ul>
<p><strong>Draw Back</strong>: degrades the write performance.</p>
<ul>
<li><p><code>Lazy updates</code>:<br>simply issue a PUT(u1, {t4}) on the user id index table without retrieving the existing posting list for u1. The old postings list of u1 is merged with (u1, {t4}) later, during the periodic compaction phase.</p>
</li>
<li><p><code>Composite</code>: <a href="https://asterixdb.apache.org/" target="_blank" rel="noopener">AsterixDB</a> and <a href="https://ai.google/research/pubs/pub39966" target="_blank" rel="noopener">Spanner</a><br>each entry in the secondary indexes is a composite key consisting of (secondary key + primary key). The secondary lookup is a prefix search on secondary key, which can be implemented using regular <code>range search</code> on the index table.<br>Write and compaction can be faster than <code>Lazy</code>, but the secondary attribute lookup may be slower because of range scan.</p>
</li>
</ul>
<h2 id="Embedded-Secondary-Indexes"><a href="#Embedded-Secondary-Indexes" class="headerlink" title="Embedded Secondary Indexes"></a>Embedded Secondary Indexes</h2><p>There is no separate secondary index structure,  secondary attribute information is stored inside the original (primary) data blocks. As shown in figure (b).</p>
]]></content>
      <categories>
        <category>review</category>
      </categories>
      <tags>
        <tag>database</tag>
        <tag>nosql</tag>
      </tags>
  </entry>
  <entry>
    <title>Á¨¨‰∏Ä‰∏™ Dapp</title>
    <url>/blog/%E7%AC%AC%E4%B8%80%E4%B8%AA-Dapp/</url>
    <content><![CDATA[<h1 id="ÈÖçÁΩÆÂºÄÂèëÁéØÂ¢É"><a href="#ÈÖçÁΩÆÂºÄÂèëÁéØÂ¢É" class="headerlink" title="ÈÖçÁΩÆÂºÄÂèëÁéØÂ¢É"></a>ÈÖçÁΩÆÂºÄÂèëÁéØÂ¢É</h1><h2 id="ÂÆâË£Ö-Nodejs"><a href="#ÂÆâË£Ö-Nodejs" class="headerlink" title="ÂÆâË£Ö Nodejs"></a>ÂÆâË£Ö <a href="https://nodejs.org" target="_blank" rel="noopener">Nodejs</a></h2><p>Mac ‰∏äÂÆâË£Ö nodejsÔºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brew install node</span><br></pre></td></tr></table></figure>

<h2 id="ÂÆâË£Ö-Truffle"><a href="#ÂÆâË£Ö-Truffle" class="headerlink" title="ÂÆâË£Ö Truffle"></a>ÂÆâË£Ö <a href="http://truffleframework.com/" target="_blank" rel="noopener">Truffle</a></h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -g truffle <span class="comment"># http://truffleframework.com/</span></span><br></pre></td></tr></table></figure>
<p>truffle ÊòØ‰∏Ä‰∏™Áî®‰∫éÂú® Etherem ‰∏äÂºÄÂèë Dapp ÁöÑÊ°ÜÊû∂„ÄÇÂÆÉËÆ©Êàë‰ª¨ËÉΩÂ§üÁî® solidity ÁºñÁ®ãËØ≠Ë®ÄÂéªÂÜô Dapp Âπ∂ËøõË°åË∞ÉËØï„ÄÇ</p>
<h2 id="ÂÆâË£Ö-Ganache"><a href="#ÂÆâË£Ö-Ganache" class="headerlink" title="ÂÆâË£Ö Ganache"></a>ÂÆâË£Ö <a href="http://truffleframework.com/ganache/" target="_blank" rel="noopener">Ganache</a></h2><p>Ganache ÊòØ‰∏Ä‰∏™Êú¨Âú∞ÁöÑ in memory blockchainÔºåËÆ©Êàë‰ª¨Áî®‰∫éÊµãËØïËá™Â∑±ÁºñÂÜôÁöÑ Dapp<br><img src="1.png" alt=""></p>
<h2 id="ÂÆâË£Ö-Metamask-google-Êèí‰ª∂"><a href="#ÂÆâË£Ö-Metamask-google-Êèí‰ª∂" class="headerlink" title="ÂÆâË£Ö Metamask google Êèí‰ª∂"></a>ÂÆâË£Ö <a href="https://metamask.io/" target="_blank" rel="noopener">Metamask</a> google Êèí‰ª∂</h2><p>‰∏∫‰∫ÜËÉΩÂ§ü‰ΩøÁî® ethereum blockchainÔºåÊàë‰ª¨ÈúÄË¶ÅÂÆâË£Ö Google Chrome ÁöÑ METAMASK Êâ©Â±ïÊèí‰ª∂„ÄÇ‰ΩøÁî® METAMASK Â∞±ÂèØ‰ª•ËÆ©Êàë‰ª¨ËøûÊé•Âà∞Êú¨Âú∞ÁöÑ etherum blockchain (Ganache ÂàõÂª∫ÁöÑ)ÔºåÂπ∂ÂíåÊàë‰ª¨ÁöÑ smart contract ÂÅö‰∫§‰∫í„ÄÇ</p>
<p>MetaMask ËÉΩÂ§üÊòØÊàë‰ª¨ÁöÑ Chrome ÊµèËßàÂô®ÂèòÊàê‰∏Ä‰∏™ blockchain ÁöÑÊµèËßàÂô®Ôºå‰∏Ä‰∏™ËøûÊé•Âà∞ Ethereum network ÁöÑÊµèËßàÂô®„ÄÇ<br><img src="2.gif" alt=""></p>
<a id="more"></a>
<h2 id="Âø´ÈÄüÈÉ®ÁΩ≤-truffle-È°πÁõÆ"><a href="#Âø´ÈÄüÈÉ®ÁΩ≤-truffle-È°πÁõÆ" class="headerlink" title="Âø´ÈÄüÈÉ®ÁΩ≤ truffle È°πÁõÆ"></a>Âø´ÈÄüÈÉ®ÁΩ≤ truffle È°πÁõÆ</h2><p>truffle ÁªôÊàë‰ª¨Êèê‰æõ‰∫ÜÊ®°ÊùøÔºàËøôÈáåÁß∞‰Ωú‰∏∫ boxÔºâÔºåÁî®‰∫éÊàë‰ª¨ËøõË°åÂø´ÈÄüÂºÄÂèë„ÄÇÊâÄ‰ª•Âè™Ë¶Å‰ΩøÁî® <code>unbox</code> ÂëΩ‰ª§Êù•Ëß£ÂéãÊ®°ÊùøÔºåÂ∞±ÂèØ‰ª•‰∫Ü„ÄÇ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mac@macs-macbook ÓÇ∞ ~/Code/blockchain/election ÓÇ∞ truffle unbox pet-shop</span><br><span class="line">Downloading...</span><br><span class="line">Unpacking...</span><br><span class="line">Setting up...</span><br><span class="line">Unbox successful. Sweet!</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line"></span><br><span class="line">  Compile:        truffle compile</span><br><span class="line">  Migrate:        truffle migrate</span><br><span class="line">  Test contracts: truffle <span class="built_in">test</span></span><br><span class="line">  Run dev server: npm run dev</span><br></pre></td></tr></table></figure>


<h1 id="ÁºñÂÜô‰ª£Á†Å"><a href="#ÁºñÂÜô‰ª£Á†Å" class="headerlink" title="ÁºñÂÜô‰ª£Á†Å"></a>ÁºñÂÜô‰ª£Á†Å</h1><h2 id="Á§∫‰æã1"><a href="#Á§∫‰æã1" class="headerlink" title="Á§∫‰æã1"></a>Á§∫‰æã1</h2><p>ÂàÜÂà´Âú® contracts Âíå migrations Êñá‰ª∂Â§πÂàõÂª∫Â¶Ç‰∏ã‰ª£Á†ÅÔºö<br><img src="4.png" alt=""><br><img src="5.png" alt=""></p>
<figure class="highlight bash"><figcaption><span>:./contracts/Election.sol</span></figcaption><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.11;</span><br><span class="line">contract Election &#123;</span><br><span class="line">    // Read cnadidate</span><br><span class="line">    string public candidate;</span><br><span class="line">    // Constructor</span><br><span class="line">    constructor() public &#123;</span><br><span class="line">        candidate = <span class="string">"Candidate 1"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><figcaption><span>:./migrations/2_deploy_contracts.js</span></figcaption><table><tr><td class="code"><pre><span class="line">var Election = artifacts.require(<span class="string">"./Election.sol"</span>);</span><br><span class="line">module.exports = <span class="keyword">function</span>(deployer) &#123;</span><br><span class="line">  deployer.deploy(Election);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Ëé∑Âèñ-smart-contract-ÁöÑ-instanceÔºàÂÆû‰æãÔºâ"><a href="#Ëé∑Âèñ-smart-contract-ÁöÑ-instanceÔºàÂÆû‰æãÔºâ" class="headerlink" title="Ëé∑Âèñ smart contract ÁöÑ instanceÔºàÂÆû‰æãÔºâ"></a>Ëé∑Âèñ smart contract ÁöÑ instanceÔºàÂÆû‰æãÔºâ</h3><p>Election ÊòØÊàë‰ª¨ÂÆö‰πâÁöÑ contract Âêç„ÄÇ<br>È¶ñÂÖà‰ΩøÁî®Â¶Ç‰∏ãÂëΩ‰ª§ÔºåÂ∞ÜÊàë‰ª¨ÂÆö‰πâÁöÑ smart contract ÂèëÂ∏ÉÂà∞ blockchain ‰∏≠„ÄÇ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">truffle migrate</span><br></pre></td></tr></table></figure>
<p>ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÊØèÊ¨° deploy ‰∏Ä‰∏™ smart contract ÈÉΩ‰ºöÊ∂àËÄó ETHÔºåËøôÈáåÊ∂àËÄó‰∫Ü 0,05 ÁöÑ ETH<br><img src="3.png" alt=""><br>ÁÑ∂Âêé‰ΩøÁî®‰∏ãÈù¢ÁöÑÂëΩ‰ª§ÔºåËé∑Âèñ smart contract ÁöÑ‰∏Ä‰∏™ instanceÔºàÂÆû‰æãÔºâÔºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mac@macs-macbook ÓÇ∞ ~/Code/blockchain/election ÓÇ∞ truffle console</span><br><span class="line">truffle(development)&gt; Election.deployed().<span class="keyword">then</span>( <span class="keyword">function</span> (instance) &#123; app = instance &#125;)</span><br><span class="line">undefined</span><br><span class="line">truffle(development)&gt; app.address</span><br><span class="line"><span class="string">'0x139c2cafabda6bd79b41e0d484e5ad440adf4bcb'</span></span><br><span class="line">truffle(development)&gt; app.candidate()</span><br><span class="line"><span class="string">'Candidate 1'</span></span><br></pre></td></tr></table></figure>

<h2 id="Á§∫‰æã2"><a href="#Á§∫‰æã2" class="headerlink" title="Á§∫‰æã2"></a>Á§∫‰æã2</h2><p>‰∏ãÈù¢‰ΩøÁî®‰∏Ä‰∏™Êñ∞ÁöÑ smart contract ÂÆûÁé∞ÊäïÁ•®ÁöÑ Dapp„ÄÇ</p>
<figure class="highlight bash"><figcaption><span>:./contracts/Election.sol</span></figcaption><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.2;</span><br><span class="line"></span><br><span class="line">contract Election &#123;</span><br><span class="line">    // Model a Candidate</span><br><span class="line">    struct Candidate &#123;</span><br><span class="line">        uint id;</span><br><span class="line">        string name;</span><br><span class="line">        uint voteCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Store accounts that have voted</span><br><span class="line">    mapping(address =&gt; bool) public voters;</span><br><span class="line">    // Store Candidates</span><br><span class="line">    // Fetch Candidate</span><br><span class="line">    mapping(uint =&gt; Candidate) public candidates;</span><br><span class="line">    // Store Candidates Count</span><br><span class="line">    uint public candidatesCount;</span><br><span class="line"></span><br><span class="line">    // voted event</span><br><span class="line">    event votedEvent (</span><br><span class="line">        uint indexed _candidateId</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> Election () public &#123;</span><br><span class="line">        addCandidate(<span class="string">"Tom"</span>);</span><br><span class="line">        addCandidate(<span class="string">"Jerry"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> addCandidate (string _name) private &#123;</span><br><span class="line">        candidatesCount ++;</span><br><span class="line">        candidates[candidatesCount] = Candidate(candidatesCount, _name, 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> vote (uint _candidateId) public &#123;</span><br><span class="line">        // require that they havent voted before</span><br><span class="line">        require(!voters[msg.sender]);</span><br><span class="line"></span><br><span class="line">        // require a valid candidate</span><br><span class="line">        require(_candidateId &gt; 0 &amp;&amp; _candidateId &lt;= candidatesCount);</span><br><span class="line"></span><br><span class="line">        // record that voter has voted</span><br><span class="line">        voters[msg.sender] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        // update candidate vote Count</span><br><span class="line">        candidates[_candidateId].voteCount ++;</span><br><span class="line"></span><br><span class="line">        // trigger voted event</span><br><span class="line">        votedEvent(_candidateId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ËÄåÂêéÂú® terminal ÈáåÈù¢ÈáçÊñ∞ deploy ‰∏Ä‰∏ãËØ• contract„ÄÇÂõ†‰∏∫ contract ÁöÑ‰ª£Á†ÅË¢´‰øÆÊîπ‰∫ÜÔºåÊâÄ‰ª•ÈúÄË¶Å reset„ÄÇ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">truffle migrate --reset</span><br></pre></td></tr></table></figure>

<p>‰πãÂêéÈáçÊñ∞ËøõÂÖ• console Êü•ËØ¢Áä∂ÊÄÅÔºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mac@macs-macbook ÓÇ∞ ~/Code/blockchain/election ÓÇ∞ truffle console</span><br><span class="line">truffle(development)&gt; Election.deployed().<span class="keyword">then</span>( <span class="keyword">function</span> (instance) &#123; app = instance &#125;)</span><br><span class="line">undefined</span><br><span class="line">truffle(development)&gt; app.candidates(1)</span><br><span class="line">[ BigNumber &#123; s: 1, e: 0, c: [ 1 ] &#125;,</span><br><span class="line">  <span class="string">'Tom'</span>,</span><br><span class="line">  BigNumber &#123; s: 1, e: 0, c: [ 0 ] &#125; ]</span><br><span class="line">truffle(development)&gt; app.candidates(2)</span><br><span class="line">[ BigNumber &#123; s: 1, e: 0, c: [ 2 ] &#125;,</span><br><span class="line">  <span class="string">'Jerry'</span>,</span><br><span class="line">  BigNumber &#123; s: 1, e: 0, c: [ 0 ] &#125; ]</span><br><span class="line">truffle(development)&gt; app.candidates(99) <span class="comment"># ËøôÈáåÂõ†‰∏∫Ê≤°Êúâ key ‰∏∫99ÁöÑ candidateÔºåÊâÄ‰ª•ËøîÂõûÁ©∫</span></span><br><span class="line">[ BigNumber &#123; s: 1, e: 0, c: [ 0 ] &#125;,</span><br><span class="line">  <span class="string">''</span>,</span><br><span class="line">  BigNumber &#123; s: 1, e: 0, c: [ 0 ] &#125; ]</span><br><span class="line">truffle(development)&gt; app.candidatesCount()</span><br><span class="line">BigNumber &#123; s: 1, e: 0, c: [ 2 ] &#125;</span><br></pre></td></tr></table></figure>

<h2 id="Ëé∑ÂèñÊåáÂÆö-candidate-ÁöÑÂÄº"><a href="#Ëé∑ÂèñÊåáÂÆö-candidate-ÁöÑÂÄº" class="headerlink" title="Ëé∑ÂèñÊåáÂÆö candidate ÁöÑÂÄº"></a>Ëé∑ÂèñÊåáÂÆö candidate ÁöÑÂÄº</h2><p>Âú® smart contract ‰∏≠Ôºåvalue ÁöÑËé∑ÂèñÊòØ async ÁöÑÔºåÊâÄ‰ª•‰∏çÂèØ‰ª•Â∞ÜËµãÂÄºÂÜô‰∏∫Ôºö<code>candidate = app.candidates(1)</code>„ÄÇÂøÖÈ°ªÂú®ÂõûË∞ÉÂáΩÊï∞ÈáåÈù¢ËµãÂÄºÔºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">truffle(development)&gt; app.candidates(1).<span class="keyword">then</span>( <span class="keyword">function</span>(c) &#123; candidate = c;&#125;)</span><br><span class="line">undefined</span><br><span class="line">truffle(development)&gt; candidate</span><br><span class="line">[ BigNumber &#123; s: 1, e: 0, c: [ 1 ] &#125;,</span><br><span class="line">  <span class="string">'Tom'</span>,</span><br><span class="line">  BigNumber &#123; s: 1, e: 0, c: [ 0 ] &#125; ]</span><br><span class="line"><span class="comment"># Ëé∑ÂèñÂæóÂà∞ÁöÑ candidate struct ÈáåÂØπÂ∫îÁöÑ idÔºånameÔºåvoteCount ÂÄº</span></span><br><span class="line">truffle(development)&gt; candidate[0].toNumber()</span><br><span class="line">1</span><br><span class="line">truffle(development)&gt; candidate[1]</span><br><span class="line"><span class="string">'Tom'</span></span><br><span class="line">truffle(development)&gt; candidate[2].toNumber()</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<h2 id="Êü•Áúã-blockchain-‰∏≠ÁöÑ-account"><a href="#Êü•Áúã-blockchain-‰∏≠ÁöÑ-account" class="headerlink" title="Êü•Áúã blockchain ‰∏≠ÁöÑ account"></a>Êü•Áúã blockchain ‰∏≠ÁöÑ account</h2><p>Âú® Ganache ‰∏≠ÔºåÊàë‰ª¨ÂàõÂª∫‰∫Ü 10 ‰∏™ accounts<br><img src="6.png" alt=""></p>
<p>ÂêåÊó∂Ëøô‰∫õË¥¶Êà∑ÂèØ‰ª•Âú® truffl ÁöÑ console ÈáåÈù¢‰ΩøÁî® web3 Êü•ÊâæÂà∞„ÄÇ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">truffle(development)&gt; web3.eth.accounts</span><br><span class="line">[ <span class="string">'0xdde9664954edb28dc2afb866e668447256b15365'</span>,</span><br><span class="line">  <span class="string">'0x062f0fb7e869943884698ec2bd67d8de1e612eac'</span>,</span><br><span class="line">  <span class="string">'0x26d8d3a6e3c84775150939505b407ebef4391f8e'</span>,</span><br><span class="line">  <span class="string">'0x31de3718ca3a2d6e0df954fe585b1bee596e0642'</span>,</span><br><span class="line">  <span class="string">'0x00645cf254bdb1ff4004c1f91a17a71032eb8bbf'</span>,</span><br><span class="line">  <span class="string">'0x6c8fdd7a767e8182270b301c83974a614b6d79b3'</span>,</span><br><span class="line">  <span class="string">'0x8d29c76eb9f4d978defe7e624ca95207e926fcb8'</span>,</span><br><span class="line">  <span class="string">'0xecad6764d5eacaf402ae61726c5768866c15ee4b'</span>,</span><br><span class="line">  <span class="string">'0xa2f4ba6a56c738f968e1509851b84de27207bcc3'</span>,</span><br><span class="line">  <span class="string">'0xf654b8f4bbee0a95cab96aabf3fddb77813b493e'</span> ]</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><figcaption><span>:ÊµãËØï vote</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment"># solidity ÂÖÅËÆ∏Áªô function ‰º†ÈÄíÈô§‰∫ÜÂèÇÊï∞‰ª•Â§ñÁöÑ‰∏Ä‰∫õ metadataÔºåËøôÈáå‰º†ÈÄí‰∫Ü‰∏Ä‰∏™ &#123;from: &lt;account address&gt;&#125;„ÄÇ</span></span><br><span class="line"><span class="comment"># ËøôÈáå "&#123;from: ...&#125;" Â∞±ÊòØÊåáÂÆö‰∫Ü msg.sender ÂèÇÊï∞„ÄÇ</span></span><br><span class="line"><span class="comment"># ÊúÄÂêéËæìÂá∫ÁöÑÂÄºÔºåÂÖ∂ÂÆûÊòØ‰∏ÄÊ¨° transaction ÁöÑ recipt„ÄÇread blockchain ‰∏çÊ∂àËÄó ethÔºå‰ΩÜÊòØÂÜô Ê∂àËÄóÔºåËøôÈáåÊ∂àËÄó‰∫Ü 49101 gas„ÄÇgas Âà∞ eth ÁöÑËΩ¨ÂåñÔºåÊòØ gas * gas_price„ÄÇËøô‰∏™ÁïôÂæÖËß£Èáä„ÄÇ TODO</span></span><br><span class="line">truffle(development)&gt; app.vote(1,&#123;from: web3.eth.accounts[4]&#125;)</span><br><span class="line">&#123; tx: <span class="string">'0x4d33e6442f55fbc5f11cafc4c4d33d6e8fec879d24c5d200c82bb0d2486e01d8'</span>,</span><br><span class="line">  receipt:</span><br><span class="line">   &#123; transactionHash: <span class="string">'0x4d33e6442f55fbc5f11cafc4c4d33d6e8fec879d24c5d200c82bb0d2486e01d8'</span>,</span><br><span class="line">     transactionIndex: 0,</span><br><span class="line">     blockHash: <span class="string">'0xf524dd8578c2ef4f0d63f24f947f0eb83c551520fa856eb02c41d6d4c8e57884'</span>,</span><br><span class="line">     blockNumber: 66,</span><br><span class="line">     gasUsed: 49101,</span><br><span class="line">     cumulativeGasUsed: 49101,</span><br><span class="line">     contractAddress: null,</span><br><span class="line">     logs: [ [Object] ],</span><br><span class="line">     status: <span class="string">'0x01'</span>,</span><br><span class="line">     logsBloom: <span class="string">'0x00000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000008000000000000000000000000000040000000000004000000000000000000000000000000000040000000000004000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000'</span> &#125;,</span><br><span class="line">  logs:</span><br><span class="line">   [ &#123; logIndex: 0,</span><br><span class="line">       transactionIndex: 0,</span><br><span class="line">       transactionHash: <span class="string">'0x4d33e6442f55fbc5f11cafc4c4d33d6e8fec879d24c5d200c82bb0d2486e01d8'</span>,</span><br><span class="line">       blockHash: <span class="string">'0xf524dd8578c2ef4f0d63f24f947f0eb83c551520fa856eb02c41d6d4c8e57884'</span>,</span><br><span class="line">       blockNumber: 66,</span><br><span class="line">       address: <span class="string">'0xeb7e9f45214c6b13dece3a14be570d9eaaa9144c'</span>,</span><br><span class="line">       <span class="built_in">type</span>: <span class="string">'mined'</span>,</span><br><span class="line">       event: <span class="string">'votedEvent'</span>,</span><br><span class="line">       args: [Object] &#125; ] &#125;</span><br></pre></td></tr></table></figure>


<h2 id="ÁºñÂÜôÊµãËØïÁî®‰æã"><a href="#ÁºñÂÜôÊµãËØïÁî®‰æã" class="headerlink" title="ÁºñÂÜôÊµãËØïÁî®‰æã"></a>ÁºñÂÜôÊµãËØïÁî®‰æã</h2><p>truffle ÂÜÖÈÉ®‰ΩøÁî® <a href="https://mochajs.org/" target="_blank" rel="noopener">mochajs</a> Âíå <a href="http://www.chaijs.com/" target="_blank" rel="noopener">chaijs</a> ËøõË°åÊµãËØï</p>
<blockquote>
<p>Mocha is a feature-rich JavaScript test framework running on Node.js and in the browser, making asynchronous testing simple and fun</p>
</blockquote>
<blockquote>
<p>Chai is a BDD / TDD assertion library for node and the browser that can be delightfully paired with any javascript testing framework.</p>
</blockquote>
<figure class="highlight javascript"><figcaption><span>:./test/election.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> Election = artifacts.require(<span class="string">"./Election.sol"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ÂàùÂßãÂåñ contract ÂÆû‰æãÔºå‰º†ÂÖ•ÁöÑÊòØ web3.eth.accounts ÂèÇÊï∞</span></span><br><span class="line">contract(<span class="string">"Election"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">accounts</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> electionInstance;</span><br><span class="line"></span><br><span class="line">  it(<span class="string">"initializes with two candidates"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Election.deployed().then(<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> instance.candidatesCount();</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">count</span>) </span>&#123;</span><br><span class="line">      assert.equal(count, <span class="number">2</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">"it initializes the candidates with the correct values"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Election.deployed().then(<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>) </span>&#123;</span><br><span class="line">      electionInstance = instance;</span><br><span class="line">      <span class="keyword">return</span> electionInstance.candidates(<span class="number">1</span>);</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">candidate</span>) </span>&#123;</span><br><span class="line">      assert.equal(candidate[<span class="number">0</span>], <span class="number">1</span>, <span class="string">"contains the correct id"</span>);</span><br><span class="line">      assert.equal(candidate[<span class="number">1</span>], <span class="string">"Tom"</span>, <span class="string">"contains the correct name"</span>);</span><br><span class="line">      assert.equal(candidate[<span class="number">2</span>], <span class="number">0</span>, <span class="string">"contains the correct votes count"</span>);</span><br><span class="line">      <span class="keyword">return</span> electionInstance.candidates(<span class="number">2</span>);</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">candidate</span>) </span>&#123;</span><br><span class="line">      assert.equal(candidate[<span class="number">0</span>], <span class="number">2</span>, <span class="string">"contains the correct id"</span>);</span><br><span class="line">      assert.equal(candidate[<span class="number">1</span>], <span class="string">"Jerry"</span>, <span class="string">"contains the correct name"</span>);</span><br><span class="line">      assert.equal(candidate[<span class="number">2</span>], <span class="number">0</span>, <span class="string">"contains the correct votes count"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">"allows a voter to cast a vote"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Election.deployed().then(<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>) </span>&#123;</span><br><span class="line">      electionInstance = instance;</span><br><span class="line">      candidateId = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">return</span> electionInstance.vote(candidateId, &#123; <span class="attr">from</span>: accounts[<span class="number">0</span>] &#125;);</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">receipt</span>) </span>&#123;</span><br><span class="line">      assert.equal(receipt.logs.length, <span class="number">1</span>, <span class="string">"an event was triggered"</span>);</span><br><span class="line">      assert.equal(receipt.logs[<span class="number">0</span>].event, <span class="string">"votedEvent"</span>, <span class="string">"the event type is correct"</span>);</span><br><span class="line">      assert.equal(receipt.logs[<span class="number">0</span>].args._candidateId.toNumber(), candidateId, <span class="string">"the candidate id is correct"</span>);</span><br><span class="line">      <span class="keyword">return</span> electionInstance.voters(accounts[<span class="number">0</span>]);</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">voted</span>) </span>&#123;</span><br><span class="line">      assert(voted, <span class="string">"the voter was marked as voted"</span>);</span><br><span class="line">      <span class="keyword">return</span> electionInstance.candidates(candidateId);</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">candidate</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> voteCount = candidate[<span class="number">2</span>];</span><br><span class="line">      assert.equal(voteCount, <span class="number">1</span>, <span class="string">"increments the candidate's vote count"</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">"throws an exception for invalid candiates"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Election.deployed().then(<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>) </span>&#123;</span><br><span class="line">      electionInstance = instance;</span><br><span class="line">      <span class="keyword">return</span> electionInstance.vote(<span class="number">99</span>, &#123; <span class="attr">from</span>: accounts[<span class="number">1</span>] &#125;)</span><br><span class="line">    &#125;).then(assert.fail).catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">      assert(error.message.indexOf(<span class="string">'revert'</span>) &gt;= <span class="number">0</span>, <span class="string">"error message must contain revert"</span>);</span><br><span class="line">      <span class="keyword">return</span> electionInstance.candidates(<span class="number">1</span>);</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">candidate1</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> voteCount = candidate1[<span class="number">2</span>];</span><br><span class="line">      assert.equal(voteCount, <span class="number">1</span>, <span class="string">"candidate 1 did not receive any votes"</span>);</span><br><span class="line">      <span class="keyword">return</span> electionInstance.candidates(<span class="number">2</span>);</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">candidate2</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> voteCount = candidate2[<span class="number">2</span>];</span><br><span class="line">      assert.equal(voteCount, <span class="number">0</span>, <span class="string">"candidate 2 did not receive any votes"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">"throws an exception for double voting"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Election.deployed().then(<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>) </span>&#123;</span><br><span class="line">      electionInstance = instance;</span><br><span class="line">      candidateId = <span class="number">2</span>;</span><br><span class="line">      <span class="comment">// solidity ÂÖÅËÆ∏Áªô function ‰º†ÈÄíÈô§‰∫ÜÂèÇÊï∞‰ª•Â§ñÁöÑ‰∏Ä‰∫õ metadataÔºåËøôÈáå‰º†ÈÄí‰∫Ü‰∏Ä‰∏™ &#123;from: &lt;account address&gt;&#125;„ÄÇ</span></span><br><span class="line">      <span class="comment">// ËøôÈáå "&#123;from: ...&#125;" Â∞±ÊòØÊåáÂÆö‰∫Ü msg.sender ÂèÇÊï∞„ÄÇ</span></span><br><span class="line">      electionInstance.vote(candidateId, &#123; <span class="attr">from</span>: accounts[<span class="number">1</span>] &#125;);</span><br><span class="line">      <span class="keyword">return</span> electionInstance.candidates(candidateId);</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">candidate</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> voteCount = candidate[<span class="number">2</span>];</span><br><span class="line">      assert.equal(voteCount, <span class="number">1</span>, <span class="string">"accepts first vote"</span>);</span><br><span class="line">      <span class="comment">// Try to vote again</span></span><br><span class="line">      <span class="keyword">return</span> electionInstance.vote(candidateId, &#123; <span class="attr">from</span>: accounts[<span class="number">1</span>] &#125;);</span><br><span class="line">    &#125;).then(assert.fail).catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">      assert(error.message.indexOf(<span class="string">'revert'</span>) &gt;= <span class="number">0</span>, <span class="string">"error message must contain revert"</span>);</span><br><span class="line">      <span class="keyword">return</span> electionInstance.candidates(<span class="number">1</span>);</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">candidate1</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> voteCount = candidate1[<span class="number">2</span>];</span><br><span class="line">      assert.equal(voteCount, <span class="number">1</span>, <span class="string">"candidate 1 did not receive any votes"</span>);</span><br><span class="line">      <span class="keyword">return</span> electionInstance.candidates(<span class="number">2</span>);</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">candidate2</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> voteCount = candidate2[<span class="number">2</span>];</span><br><span class="line">      assert.equal(voteCount, <span class="number">1</span>, <span class="string">"candidate 2 did not receive any votes"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><figcaption><span>:ÊµãËØïÁªìÊûú</span></figcaption><table><tr><td class="code"><pre><span class="line">mac@macs-macbook ÓÇ∞ ~/Code/blockchain/election ÓÇ∞ truffle <span class="built_in">test</span></span><br><span class="line">Using network <span class="string">'development'</span>.</span><br><span class="line"></span><br><span class="line">  Contract: Election</span><br><span class="line">    ‚úì initializes with two candidates</span><br><span class="line">    ‚úì it initializes the candidates with the correct values (45ms)</span><br><span class="line">    ‚úì allows a voter to cast a vote (229ms)</span><br><span class="line">    ‚úì throws an exception <span class="keyword">for</span> invalid candiates (117ms)</span><br><span class="line">    ‚úì throws an exception <span class="keyword">for</span> double voting (194ms)</span><br><span class="line"></span><br><span class="line">  5 passing (658ms)</span><br></pre></td></tr></table></figure>

<h2 id="ÁΩëÈ°µ‰ª£Á†Å"><a href="#ÁΩëÈ°µ‰ª£Á†Å" class="headerlink" title="ÁΩëÈ°µ‰ª£Á†Å"></a>ÁΩëÈ°µ‰ª£Á†Å</h2><figure class="highlight html"><figcaption><span>:./src/index.html</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Election Results<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"css/bootstrap.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- WARNING: Respond.js doesn't work if you view the page via file:// --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--[if lt IE 9]&gt;</span></span><br><span class="line"><span class="comment">      &lt;script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="comment">      &lt;script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="comment">    &lt;![endif]--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span> <span class="attr">style</span>=<span class="string">"width: 650px;"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-lg-12"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span>Election Results<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"loader"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span> <span class="attr">style</span>=<span class="string">"display: none;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">"col"</span>&gt;</span>#<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">"col"</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">"col"</span>&gt;</span>Votes<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">tbody</span> <span class="attr">id</span>=<span class="string">"candidatesResults"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">form</span> <span class="attr">onSubmit</span>=<span class="string">"App.castVote(); return false;"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"candidatesSelect"</span>&gt;</span>Select Candidate<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">id</span>=<span class="string">"candidatesSelect"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>Vote<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"accountAddress"</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- jQuery (necessary for Bootstrap's JavaScript plugins) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Include all compiled plugins (below), or include individual files as needed --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/bootstrap.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/web3.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/truffle-contract.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/app.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><figcaption><span>:./src/js/app.js</span></figcaption><table><tr><td class="code"><pre><span class="line">App = &#123;</span><br><span class="line">  web3Provider: <span class="literal">null</span>,</span><br><span class="line">  contracts: &#123;&#125;,</span><br><span class="line">  account: <span class="string">'0x0'</span>,</span><br><span class="line">  hasVoted: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">  init: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> App.initWeb3();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  initWeb3: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> refactor conditional</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> web3 !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">      <span class="comment">// If a web3 instance is already provided by Meta Mask.</span></span><br><span class="line">      App.web3Provider = web3.currentProvider;</span><br><span class="line">      web3 = <span class="keyword">new</span> Web3(web3.currentProvider);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// Specify default instance if no web3 instance provided</span></span><br><span class="line">      App.web3Provider = <span class="keyword">new</span> Web3.providers.HttpProvider(<span class="string">'http://localhost:7545'</span>);</span><br><span class="line">      web3 = <span class="keyword">new</span> Web3(App.web3Provider);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> App.initContract();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ÂàùÂßãÂåñ smart contract ÂÆû‰æã</span></span><br><span class="line">  initContract: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $.getJSON(<span class="string">"Election.json"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">election</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// Instantiate a new truffle contract from the artifact</span></span><br><span class="line">      App.contracts.Election = TruffleContract(election);</span><br><span class="line">      <span class="comment">// Connect provider to interact with contract</span></span><br><span class="line">      App.contracts.Election.setProvider(App.web3Provider);</span><br><span class="line"></span><br><span class="line">      App.listenForEvents();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> App.render();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Listen for events emitted from the contract</span></span><br><span class="line">  listenForEvents: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    App.contracts.Election.deployed().then(<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// Restart Chrome if you are unable to receive this event</span></span><br><span class="line">      <span class="comment">// This is a known issue with Metamask</span></span><br><span class="line">      <span class="comment">// https://github.com/MetaMask/metamask-extension/issues/2393</span></span><br><span class="line">      instance.votedEvent(&#123;&#125;, &#123;</span><br><span class="line">        fromBlock: <span class="number">0</span>,</span><br><span class="line">        toBlock: <span class="string">'latest'</span></span><br><span class="line">      &#125;).watch(<span class="function"><span class="keyword">function</span>(<span class="params">error, event</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"event triggered"</span>, event)</span><br><span class="line">        <span class="comment">// Reload when a new vote is recorded</span></span><br><span class="line">        App.render();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Ê∏≤ÊüìÊòæÁ§∫</span></span><br><span class="line">  render: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> electionInstance;</span><br><span class="line">    <span class="keyword">var</span> loader = $(<span class="string">"#loader"</span>);</span><br><span class="line">    <span class="keyword">var</span> content = $(<span class="string">"#content"</span>);</span><br><span class="line"></span><br><span class="line">    loader.show();</span><br><span class="line">    content.hide();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Load account data</span></span><br><span class="line">    web3.eth.getCoinbase(<span class="function"><span class="keyword">function</span>(<span class="params">err, account</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err === <span class="literal">null</span>) &#123;</span><br><span class="line">        App.account = account;</span><br><span class="line">        $(<span class="string">"#accountAddress"</span>).html(<span class="string">"Your Account: "</span> + account);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Load contract data</span></span><br><span class="line">    App.contracts.Election.deployed().then(<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>) </span>&#123;</span><br><span class="line">      electionInstance = instance;</span><br><span class="line">      <span class="keyword">return</span> electionInstance.candidatesCount();</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">candidatesCount</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> candidatesResults = $(<span class="string">"#candidatesResults"</span>);</span><br><span class="line">      candidatesResults.empty();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> candidatesSelect = $(<span class="string">'#candidatesSelect'</span>);</span><br><span class="line">      candidatesSelect.empty();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt;= candidatesCount; i++) &#123;</span><br><span class="line">        electionInstance.candidates(i).then(<span class="function"><span class="keyword">function</span>(<span class="params">candidate</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> id = candidate[<span class="number">0</span>];</span><br><span class="line">          <span class="keyword">var</span> name = candidate[<span class="number">1</span>];</span><br><span class="line">          <span class="keyword">var</span> voteCount = candidate[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Render candidate Result</span></span><br><span class="line">          <span class="keyword">var</span> candidateTemplate = <span class="string">"&lt;tr&gt;&lt;th&gt;"</span> + id + <span class="string">"&lt;/th&gt;&lt;td&gt;"</span> + name + <span class="string">"&lt;/td&gt;&lt;td&gt;"</span> + voteCount + <span class="string">"&lt;/td&gt;&lt;/tr&gt;"</span></span><br><span class="line">          candidatesResults.append(candidateTemplate);</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Render candidate ballot option</span></span><br><span class="line">          <span class="keyword">var</span> candidateOption = <span class="string">"&lt;option value='"</span> + id + <span class="string">"' &gt;"</span> + name + <span class="string">"&lt;/ option&gt;"</span></span><br><span class="line">          candidatesSelect.append(candidateOption);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> electionInstance.voters(App.account);</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">hasVoted</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// Do not allow a user to vote</span></span><br><span class="line">      <span class="keyword">if</span>(hasVoted) &#123;</span><br><span class="line">        $(<span class="string">'form'</span>).hide();</span><br><span class="line">      &#125;</span><br><span class="line">      loader.hide();</span><br><span class="line">      content.show();</span><br><span class="line">    &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.warn(error);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  castVote: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> candidateId = $(<span class="string">'#candidatesSelect'</span>).val();</span><br><span class="line">    App.contracts.Election.deployed().then(<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> instance.vote(candidateId, &#123; <span class="attr">from</span>: App.account &#125;);</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// Wait for votes to update</span></span><br><span class="line">      $(<span class="string">"#content"</span>).hide();</span><br><span class="line">      $(<span class="string">"#loader"</span>).show();</span><br><span class="line">    &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.error(err);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  $(<span class="built_in">window</span>).load(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    App.init();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="ËøêË°åÂÆû‰æã"><a href="#ËøêË°åÂÆû‰æã" class="headerlink" title="ËøêË°åÂÆû‰æã"></a>ËøêË°åÂÆû‰æã</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">truffle migrate --reset</span><br><span class="line">npm run dev</span><br><span class="line"></span><br><span class="line">&gt; pet-shop@1.0.0 dev /Users/mac/Code/blockchain/election</span><br><span class="line">&gt; lite-server</span><br><span class="line"></span><br><span class="line">** browser-sync config **</span><br><span class="line">&#123; injectChanges: <span class="literal">false</span>,</span><br><span class="line">  files: [ <span class="string">'./**/*.&#123;html,htm,css,js&#125;'</span> ],</span><br><span class="line">  watchOptions: &#123; ignored: <span class="string">'node_modules'</span> &#125;,</span><br><span class="line">  server:</span><br><span class="line">   &#123; baseDir: [ <span class="string">'./src'</span>, <span class="string">'./build/contracts'</span> ],</span><br><span class="line">     middleware: [ [Function], [Function] ] &#125; &#125;</span><br><span class="line">[Browsersync] Access URLs:</span><br><span class="line"> --------------------------------------</span><br><span class="line">       Local: http://localhost:3000</span><br><span class="line">    External: http://10.181.60.166:3000</span><br><span class="line"> --------------------------------------</span><br><span class="line">          UI: http://localhost:3001</span><br><span class="line"> UI External: http://10.181.60.166:3001</span><br><span class="line"> --------------------------------------</span><br><span class="line">[Browsersync] Serving files from: ./src</span><br><span class="line">[Browsersync] Serving files from: ./build/contracts</span><br><span class="line">[Browsersync] Watching files...</span><br><span class="line">18.05.03 21:38:06 200 GET /index.html</span><br><span class="line">18.05.03 21:38:06 200 GET /js/bootstrap.min.js</span><br><span class="line">18.05.03 21:38:06 200 GET /css/bootstrap.min.css</span><br><span class="line">18.05.03 21:38:06 200 GET /js/app.js</span><br><span class="line">18.05.03 21:38:06 200 GET /js/web3.min.js</span><br><span class="line">18.05.03 21:38:06 200 GET /js/truffle-contract.js</span><br><span class="line">18.05.03 21:38:08 200 GET /Election.json</span><br><span class="line">18.05.03 21:38:08 404 GET /favicon.ico</span><br></pre></td></tr></table></figure>

<p>ËøêË°å‰πãÂêé‰ºöÂºπÂá∫ÁΩëÈ°µÔºå‰ΩÜÊòØ‰∏ÄÁõ¥ÊòæÁ§∫ <code>loading</code>ÔºåÁúã‰∏çÂà∞‰ªª‰Ωï‰ªé smart contract ËøîÂõûÁöÑÊï∞ÊçÆ„ÄÇ<br><img src="7.png" alt=""></p>
<p>ËøôÊòØÂõ†‰∏∫Êàë‰ª¨ÁöÑÂÆ¢Êà∑Á´ØÁ®ãÂ∫èËôΩÁÑ∂Âú®ËøêË°åÔºå‰ΩÜÊòØËøòÊ≤°ÊúâÈìæÊé•Âà∞Êàë‰ª¨ÂàõÂª∫ÁöÑ blockchain instance ‰∏ä„ÄÇÊàë‰ª¨ÈúÄË¶ÅÊâìÂºÄ GanacheÔºåÊâæÂà∞Êú¨Âú∞ in memory blockchain ÁöÑ RPC server url addressÔºö<br><img src="8.png" alt=""></p>
<p>ÁÑ∂ÂêéÂú® Google Chrome(ÊàñËÄÖ Firefox) ÊµèËßàÂô®‰∏≠ MetaMask Êèí‰ª∂ÈáåËá™ÂÆö‰πâ RPC ÈìæÊé•Ôºö<br><img src="9.png" alt=""></p>
<p>‰πãÂêéÂ∞±ÂèØ‰ª•ÁúãÂà∞Â¶Ç‰∏ãÁïåÈù¢Ôºö<br><img src="10.png" alt=""></p>
<p>ÁÇπÂáª vote ‰ª•ÂêéÔºåÂèØ‰ª•ÁúãÂà∞Â¶Ç‰∏ãÁªìÊûúÔºö<br><img src="11.png" alt=""></p>
<h1 id="ÂèÇËÄÉ"><a href="#ÂèÇËÄÉ" class="headerlink" title="ÂèÇËÄÉ"></a>ÂèÇËÄÉ</h1><ol>
<li><a href="https://www.youtube.com/watch?v=3681ZYbDSSk&list=PLS5SEs8ZftgXXPYBH6rDk4TKnDOvinwJr" target="_blank" rel="noopener">How to Build Ethereum Dapp</a></li>
<li><a href="https://github.com/dappuniversity/election" target="_blank" rel="noopener">dappuniversity/election</a></li>
</ol>
]]></content>
      <categories>
        <category>blockchain</category>
      </categories>
      <tags>
        <tag>dapp</tag>
        <tag>ethereum</tag>
      </tags>
  </entry>
  <entry>
    <title>Hadoop Installation</title>
    <url>/blog/Hadoop-Installation/</url>
    <content><![CDATA[<h1 id="Hadoop-Single-Node-Installation"><a href="#Hadoop-Single-Node-Installation" class="headerlink" title="Hadoop Single Node Installation"></a>Hadoop Single Node Installation</h1><h2 id="Java-environment-setup"><a href="#Java-environment-setup" class="headerlink" title="Java environment setup"></a>Java environment setup</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install default-jdk</span><br></pre></td></tr></table></figure>
<h2 id="Adding-a-dedicated-Hadoop-system-user"><a href="#Adding-a-dedicated-Hadoop-system-user" class="headerlink" title="Adding a dedicated Hadoop system user"></a>Adding a dedicated Hadoop system user</h2><p>This will add the user hduser and the group hadoop to your local machine.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo addgroup hadoop</span><br><span class="line">sudo adduser --ingroup hadoop hduser</span><br></pre></td></tr></table></figure>

<h2 id="Configuring-SSH"><a href="#Configuring-SSH" class="headerlink" title="Configuring SSH"></a>Configuring SSH</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">su hduser</span><br><span class="line">ssh-keygen -t rsa -P <span class="string">""</span></span><br><span class="line">cat <span class="variable">$HOME</span>/.ssh/id_rsa.pub &gt;&gt; <span class="variable">$HOME</span>/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>The output looks like this:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hduser@hanson:~$ ssh-keygen -t rsa -P &quot;&quot;</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/home/hduser/.ssh/id_rsa):</span><br><span class="line">Created directory &apos;/home/hduser/.ssh&apos;.</span><br><span class="line">Your identification has been saved in /home/hduser/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /home/hduser/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:VJjkPSKe0LsRjcS+avfbA/kolHR5iPP6OVDp1QaT2EM hduser@hanson</span><br><span class="line">The key&apos;s randomart image is:</span><br><span class="line">+---[RSA 2048]----+</span><br><span class="line">|     ....*E.     |</span><br><span class="line">|     o.++o*      |</span><br><span class="line">|    ..=.=+o=     |</span><br><span class="line">|     o=**.o.o    |</span><br><span class="line">|     .=OS+ .     |</span><br><span class="line">|      =o=        |</span><br><span class="line">|     o.o +       |</span><br><span class="line">|    o + ooo      |</span><br><span class="line">|   . . +=o..     |</span><br><span class="line">+----[SHA256]-----+</span><br></pre></td></tr></table></figure>

<p><strong>enable SSH access to your local machine with this newly created key.</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hduser@hanson:~$ s</span><br></pre></td></tr></table></figure>
<p><strong>test the SSH setup by connecting to your local machine with the <code>hduser</code> user</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hduser@hanson:~$ ssh localhost</span><br></pre></td></tr></table></figure>
<p>You should install <code>ssh</code> first ( sudo apt-get install ssh)</p>
<p>Output should be like this:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">The authenticity of host <span class="string">'localhost (127.0.0.1)'</span> can<span class="string">'t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:emnk3O6O2N7CK8chUMIThK3CGFUwFOS44kzsa0phArE.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added '</span>localhost<span class="string">' (ECDSA) to the list of known hosts.</span></span><br><span class="line"><span class="string">Welcome to Ubuntu 17.10 (GNU/Linux 4.13.0-17-generic x86_64)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">* Documentation:  https://help.ubuntu.com</span></span><br><span class="line"><span class="string">* Management:     https://landscape.canonical.com</span></span><br><span class="line"><span class="string">* Support:        https://ubuntu.com/advantage</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0 packages can be updated.</span></span><br><span class="line"><span class="string">0 updates are security updates.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The programs included with the Ubuntu system are free software;</span></span><br><span class="line"><span class="string">the exact distribution terms for each program are described in the</span></span><br><span class="line"><span class="string">individual files in /usr/share/doc/*/copyright.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by</span></span><br><span class="line"><span class="string">applicable law.</span></span><br></pre></td></tr></table></figure>

<h2 id="Disabling-IPv6"><a href="#Disabling-IPv6" class="headerlink" title="Disabling IPv6"></a>Disabling IPv6</h2><p>One problem with IPv6 on Ubuntu is that using <code>0.0.0.0</code> for the various networking-related Hadoop configuration options will result in Hadoop binding to the IPv6 addresses of my Ubuntu box. In my case, I realized that there‚Äôs no practical point in enabling IPv6 on a box when you are not connected to any IPv6 network. Hence, I simply disabled IPv6 on my Ubuntu machine. Your mileage may vary.</p>
<p>To disable IPv6 on Ubuntu 10.04 LTS, open <code>/etc/sysctl.conf</code> in the editor of your choice and add the following lines to the end of the file:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># disable ipv6</span></span><br><span class="line">net.ipv6.conf.all.disable_ipv6 = 1</span><br><span class="line">net.ipv6.conf.default.disable_ipv6 = 1</span><br><span class="line">net.ipv6.conf.lo.disable_ipv6 = 1</span><br></pre></td></tr></table></figure>
<p>You have to reboot your machine in order to make the changes take effect.</p>
<p>You can check whether IPv6 is enabled on your machine with the following command:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat /proc/sys/net/ipv6/conf/all/disable_ipv6</span><br></pre></td></tr></table></figure>
<p>If output is 1, then ipv6 is disabled.</p>
<h3 id="Alternative"><a href="#Alternative" class="headerlink" title="Alternative"></a>Alternative</h3><p>You can also disable IPv6 only for Hadoop as documented in <a href="https://issues.apache.org/jira/browse/HADOOP-3437" target="_blank" rel="noopener">HADOOP-3437</a>. You can do so by adding the following line to <code>hadoop/etc/hadoop/hadoop-env.sh</code>:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> HADOOP_OPTS=-Djava.net.preferIPv4Stack=<span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h2 id="Hadoop-installation"><a href="#Hadoop-installation" class="headerlink" title="Hadoop installation"></a>Hadoop installation</h2><p>Download Hadoop from the <code>Apache Download Mirrors</code> and extract the contents of the Hadoop package to a location of your choice. I picked $HADOOP_HOME. Make sure to change the owner of all the files to the hduser user and hadoop group, for example:</p>
<ul>
<li>wget <a href="http://mirrors.ocf.berkeley.edu/apache/hadoop/common/hadoop-2.7.4/hadoop-2.7.4.tar.gz" target="_blank" rel="noopener">http://mirrors.ocf.berkeley.edu/apache/hadoop/common/hadoop-2.7.4/hadoop-2.7.4.tar.gz</a> (download hadoop)</li>
<li>tar -xzvf hadoop-2.7.4.tar.gz (extract compressed file)</li>
<li>sudo mv hadoop-2.7.4 $HADOOP_HOME</li>
<li>sudo chown -R hduser:hadoop hadoop</li>
</ul>
<h2 id="Update-HOME-bashrc"><a href="#Update-HOME-bashrc" class="headerlink" title="Update $HOME/.bashrc"></a>Update $HOME/.bashrc</h2><p>Add the following lines to the <code>end</code> of the <code>$HOME/.bashrc</code> file of user hduser. If you use a shell other than bash, you should of course update its appropriate configuration files instead of <code>.bashrc</code>.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Set Hadoop-related environment variables</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_PREFIX=~/Program/hadoop <span class="comment">#This is where your put your hadoop program</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=<span class="variable">$HADOOP_PREFIX</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_COMMON_HOME=<span class="variable">$HADOOP_PREFIX</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_CONF_DIR=<span class="variable">$HADOOP_PREFIX</span>/etc/hadoop</span><br><span class="line"><span class="built_in">export</span> HADOOP_HDFS_HOME=<span class="variable">$HADOOP_PREFIX</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_MAPRED_HOME=<span class="variable">$HADOOP_PREFIX</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_YARN_HOME=<span class="variable">$HADOOP_PREFIX</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set JAVA_HOME (we will also configure JAVA_HOME directly for Hadoop later on)</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=$(readlink -f /usr/bin/java | sed <span class="string">"s:bin/java::"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Some convenient aliases and functions for running Hadoop-related commands</span></span><br><span class="line"><span class="built_in">unalias</span> fs &amp;&gt; /dev/null</span><br><span class="line"><span class="built_in">alias</span> fs=<span class="string">"hadoop fs"</span></span><br><span class="line"><span class="built_in">unalias</span> hls &amp;&gt; /dev/null</span><br><span class="line"><span class="built_in">alias</span> hls=<span class="string">"fs -ls"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If you have LZO compression enabled in your Hadoop cluster and</span></span><br><span class="line"><span class="comment"># compress job outputs with LZOP (not covered in this tutorial):</span></span><br><span class="line"><span class="comment"># Conveniently inspect an LZOP compressed file from the command</span></span><br><span class="line"><span class="comment"># line; run via:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># $ lzohead /hdfs/path/to/lzop/compressed/file.lzo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Requires installed 'lzop' command.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="function"><span class="title">lzohead</span></span> () &#123;</span><br><span class="line">hadoop fs -cat <span class="variable">$1</span> | lzop -dc | head -1000 | less</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add Hadoop bin/ directory to PATH</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/bin</span><br></pre></td></tr></table></figure>
<p>Then you should run ‚Äòsource .bashrc‚Äô to enable the new configuration.</p>
<h2 id="hadoop-env-sh"><a href="#hadoop-env-sh" class="headerlink" title="hadoop-env.sh"></a>hadoop-env.sh</h2><p>The only required environment variable we have to configure for Hadoop in this tutorial is <code>JAVA_HOME</code>. Open <code>hadoop/etc/hadoop/hadoop-env.sh</code></p>
<ul>
<li><p>readlink -f /usr/bin/java | sed ‚Äús:bin/java::‚Äù (find the default Java path)</p>
</li>
<li><p>sudo vim $HADOOP_HOME/etc/hadoop/hadoop-env.sh</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># $HADOOP_HOME/etc/hadoop/hadoop-env.sh</span></span><br><span class="line"><span class="comment">#export JAVA_HOME=$&#123;JAVA_HOME&#125;</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=$(readlink -f /usr/bin/java | sed <span class="string">"s:bin/java::"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>$HADOOP_HOME/bin/hadoop</code> or <code>hadoop</code>(run hadoop, following appears, then hadoop is installed correctly)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Usage: hadoop [--config confdir] [COMMAND | CLASSNAME]</span><br><span class="line">CLASSNAME            run the class named CLASSNAME</span><br><span class="line">or</span><br><span class="line"><span class="built_in">where</span> COMMAND is one of:</span><br><span class="line">fs                   run a generic filesystem user client</span><br><span class="line">version              <span class="built_in">print</span> the version</span><br><span class="line">jar &lt;jar&gt;            run a jar file</span><br><span class="line">note: please use <span class="string">"yarn jar"</span> to launch</span><br><span class="line">YARN applications, not this <span class="built_in">command</span>.</span><br><span class="line">checknative [-a|-h]  check native hadoop and compression libraries availability</span><br><span class="line">distcp &lt;srcurl&gt; &lt;desturl&gt; copy file or directories recursively</span><br><span class="line">archive -archiveName NAME -p &lt;parent path&gt; &lt;src&gt;* &lt;dest&gt; create a hadoop archive</span><br><span class="line">classpath            prints the class path needed to get the</span><br><span class="line">credential           interact with credential providers</span><br><span class="line">Hadoop jar and the required libraries</span><br><span class="line">daemonlog            get/<span class="built_in">set</span> the <span class="built_in">log</span> level <span class="keyword">for</span> each daemon</span><br></pre></td></tr></table></figure>
<p>You can repeat this exercise also for other users who want to use Hadoop.</p>
</li>
</ul>
<p>Create a directory called input in our home directory and copy Hadoop‚Äôs configuration files into it to use those files as our data.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir ~/input</span><br><span class="line">cp <span class="variable">$HADOOP_HOME</span>/etc/hadoop/*.xml ~/input</span><br></pre></td></tr></table></figure>

<p>run cmd:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hadoop jar <span class="variable">$HADOOP_HOME</span>/share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.4.jar grep ~/input ~/grep_example <span class="string">'principal[.]*'</span></span><br></pre></td></tr></table></figure>
<p>You can see output like following:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Output</span><br><span class="line">. . .</span><br><span class="line">File System Counters</span><br><span class="line">FILE: Number of bytes <span class="built_in">read</span>=1247674</span><br><span class="line">FILE: Number of bytes written=2324248</span><br><span class="line">FILE: Number of <span class="built_in">read</span> operations=0</span><br><span class="line">FILE: Number of large <span class="built_in">read</span> operations=0</span><br><span class="line">FILE: Number of write operations=0</span><br><span class="line">Map-Reduce Framework</span><br><span class="line">Map input records=2</span><br><span class="line">Map output records=2</span><br><span class="line">Map output bytes=37</span><br><span class="line">Map output materialized bytes=47</span><br><span class="line">Input split bytes=114</span><br><span class="line">Combine input records=0</span><br><span class="line">Combine output records=0</span><br><span class="line">Reduce input groups=2</span><br><span class="line">Reduce shuffle bytes=47</span><br><span class="line">Reduce input records=2</span><br><span class="line">Reduce output records=2</span><br><span class="line">Spilled Records=4</span><br><span class="line">Shuffled Maps =1</span><br><span class="line">Failed Shuffles=0</span><br><span class="line">Merged Map outputs=1</span><br><span class="line">GC time elapsed (ms)=61</span><br><span class="line">Total committed heap usage (bytes)=263520256</span><br><span class="line">Shuffle Errors</span><br><span class="line">BAD_ID=0</span><br><span class="line">CONNECTION=0</span><br><span class="line">IO_ERROR=0</span><br><span class="line">WRONG_LENGTH=0</span><br><span class="line">WRONG_MAP=0</span><br><span class="line">WRONG_REDUCE=0</span><br><span class="line">File Input Format Counters</span><br><span class="line">Bytes Read=151</span><br><span class="line">File Output Format Counters</span><br><span class="line">Bytes Written=37</span><br></pre></td></tr></table></figure>

<p>If you run cmd:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat ~/grep_example/*</span><br></pre></td></tr></table></figure>

<p>You will see:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Output</span><br><span class="line">6       principal</span><br><span class="line">1       principal.</span><br></pre></td></tr></table></figure>
<p>But if you run this test again, it will give some error. Don‚Äôt worry, just delete the <code>grep_example</code> folder then everything will work fine.</p>
<h2 id="Hadoop-Pseudo-distributed-Mode"><a href="#Hadoop-Pseudo-distributed-Mode" class="headerlink" title="Hadoop Pseudo-distributed Mode"></a>Hadoop Pseudo-distributed Mode</h2><h3 id="HDFS-Configuration"><a href="#HDFS-Configuration" class="headerlink" title="HDFS Configuration"></a>HDFS Configuration</h3><p>In this section, we will configure the directory where Hadoop will store its data files, the network ports it listens to, etc. Our setup will use Hadoop‚Äôs Distributed File System, <code>HDFS</code>, even though our little ‚Äúcluster‚Äù only contains our single local machine.</p>
<p>You can leave the settings below ‚Äúas is‚Äù with the exception of the <code>hadoop.tmp.dir</code> parameter ‚Äì this parameter you must change to a directory of your choice. We will use the directory <code>/app/hadoop/tmp</code> in this tutorial. Hadoop‚Äôs default configurations use <code>hadoop.tmp.dir</code> as the base temporary directory both for the local file system and HDFS, so don‚Äôt be surprised if you see Hadoop creating the specified directory automatically on HDFS at some later point.</p>
<p>Now we create the directory and set the required ownerships and permissions:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir -p ~/Program/hadoop/tmp</span><br><span class="line">sudo chown hduser:hadoop ~/Program/hadoop/tmp</span><br><span class="line"><span class="comment"># ...and if you want to tighten up security, chmod from 755 to 750...</span></span><br><span class="line">sudo chmod 750 ~/Program/hadoop/tmp</span><br></pre></td></tr></table></figure>

<p>Add the following snippets between the <configuration> ‚Ä¶ </configuration> tags in the respective configuration XML file.</p>
<p>HDFS is the distributed file system used by Hadoop to store data in the cluster, capable of hosting very very (very) large files, splitting them over the nodes of the cluster. Theoretically, you don‚Äôt need to have it running and files could instead be stored elsewhere like S3 or even the local file system (if using a purely local Hadoop installation). However, some applications require interactions with HDFS so you may have to set it up sooner or later if you‚Äôre using third party modules. HDFS is composed of a<code>NameNode</code> which holds all the metadata regarding the stored files, and <code>DataNodes</code> (one per node in the cluster) which hold the actual data.</p>
<p>The main HDFS configuration file is located at <code>$HADOOP_PREFIX/etc/hadoop/hdfs-site.xml</code>. If you‚Äôve been following since the beginning, this file should be empty so it will use the default configurations outlined in <a href="http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/hdfs-default.xml" target="_blank" rel="noopener">this page</a>. For a single-node installation of HDFS you‚Äôll want to change <code>hdfs-site.xml</code> to have, at the very least, the following:</p>
<p>First you should create <code>dfs</code> folder, <code>datanode</code> &amp; <code>namenode</code> folder under <code>tmp</code> folder.<br>tmp<br> |‚Äì dfs<br>   |‚Äì datanode<br>   |‚Äì namenode</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>file:///home/osboxes/Program/hadoop/tmp/dfs/datanode<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>Comma separated list of paths on the local filesystem of a DataNode where it should store its blocks.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>file:///home/osboxes/Program/hadoop/tmp/dfs/namenode<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>Path on the local filesystem where the NameNode stores the namespace and transaction logs persistently.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>Default block replication.</span><br><span class="line">The actual number of replications can be specified when the file is created.</span><br><span class="line">The default is used if replication is not specified in create time.</span><br><span class="line"><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>In addition, add the following to <code>$HADOOP_PREFIX/etc/hadoop/core-site.xml</code> to let the Hadoop modules know where the <code>HDFS NameNode</code> is located.</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>file:///home/osboxes/Program/hadoop/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>Abase for other temporary directories.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://localhost:9000/<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>NameNode URI<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>Note</code>:<br>If you configured <code>core-site.xml</code>, then the bellow example testing will fail.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># This test will fail in to connection refuse</span></span><br><span class="line">hadoop jar <span class="variable">$HADOOP_HOME</span>/share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.4.jar grep ~/input ~/grep_example <span class="string">'principal[.]*'</span></span><br></pre></td></tr></table></figure>

<h3 id="YARN-on-a-Single-Node"><a href="#YARN-on-a-Single-Node" class="headerlink" title="YARN on a Single Node"></a>YARN on a Single Node</h3><p>YARN is the component responsible for allocating containers to run tasks, coordinating the execution of said tasks, restart them in case of failure, among other housekeeping. Just like HDFS, it also has 2 main components: a ResourceManager which keeps track of the cluster resources and NodeManagers in each of the nodes which communicates with the ResourceManager and sets up containers for execution of tasks.</p>
<p>You can run a MapReduce job on YARN in a pseudo-distributed mode by setting a few parameters and running ResourceManager daemon and NodeManager daemon in addition.</p>
<p>Configure parameters as follows: etc/hadoop/<code>mapred-site.xml:</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;mapreduce.framework.name&lt;/name&gt;</span><br><span class="line">&lt;value&gt;yarn&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<p> <code>$HADOOP_PREFIX/etc/hadoop/yarn-site.xml</code>. The file should currently be empty which means it‚Äôs using the default configurations you can find <a href="http://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-common/yarn-default.xml" target="_blank" rel="noopener">here</a>. For a single-node installation of YARN you‚Äôll want to add the following to that file:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;yarn.scheduler.minimum-allocation-mb&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;128&lt;/value&gt;</span><br><span class="line">        &lt;description&gt;Minimum <span class="built_in">limit</span> of memory to allocate to each container request at the Resource Manager.&lt;/description&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;yarn.scheduler.maximum-allocation-mb&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;2048&lt;/value&gt;</span><br><span class="line">        &lt;description&gt;Maximum <span class="built_in">limit</span> of memory to allocate to each container request at the Resource Manager.&lt;/description&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;yarn.scheduler.minimum-allocation-vcores&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;1&lt;/value&gt;</span><br><span class="line">        &lt;description&gt;The minimum allocation <span class="keyword">for</span> every container request at the RM, <span class="keyword">in</span> terms of virtual CPU cores. Requests lower than this won<span class="string">'t take effect, and the specified value will get allocated the minimum.&lt;/description&gt;</span></span><br><span class="line"><span class="string">    &lt;/property&gt;</span></span><br><span class="line"><span class="string">    &lt;property&gt;</span></span><br><span class="line"><span class="string">        &lt;name&gt;yarn.scheduler.maximum-allocation-vcores&lt;/name&gt;</span></span><br><span class="line"><span class="string">        &lt;value&gt;2&lt;/value&gt;</span></span><br><span class="line"><span class="string">        &lt;description&gt;The maximum allocation for every container request at the RM, in terms of virtual CPU cores. Requests higher than this won'</span>t take effect, and will get capped to this value.&lt;/description&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;yarn.nodemanager.resource.memory-mb&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;4096&lt;/value&gt;</span><br><span class="line">        &lt;description&gt;Physical memory, <span class="keyword">in</span> MB, to be made available to running containers&lt;/description&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;yarn.nodemanager.resource.cpu-vcores&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;4&lt;/value&gt;</span><br><span class="line">        &lt;description&gt;Number of CPU cores that can be allocated <span class="keyword">for</span> containers.&lt;/description&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;property&gt;</span><br><span class="line">    &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;mapreduce_shuffle&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;property&gt;</span><br><span class="line">    &lt;name&gt;yarn.nodemanager.vmem-pmem-ratio&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;4&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<h1 id="Starting"><a href="#Starting" class="headerlink" title="Starting"></a>Starting</h1><p>Now that we‚Äôve finished configuring everything, it‚Äôs time to setup the folders and start the daemons:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">## Start HDFS daemons</span></span><br><span class="line"><span class="comment"># Format the namenode directory (DO THIS ONLY ONCE, THE FIRST TIME)</span></span><br><span class="line"><span class="variable">$HADOOP_PREFIX</span>/bin/hdfs namenode -format</span><br><span class="line"><span class="comment"># Start the namenode daemon</span></span><br><span class="line"><span class="variable">$HADOOP_PREFIX</span>/sbin/hadoop-daemon.sh start namenode</span><br><span class="line"><span class="comment"># Start the datanode daemon</span></span><br><span class="line"><span class="variable">$HADOOP_PREFIX</span>/sbin/hadoop-daemon.sh start datanode</span><br><span class="line"><span class="comment">## Start YARN daemons</span></span><br><span class="line"><span class="comment"># Start the resourcemanager daemon</span></span><br><span class="line"><span class="variable">$HADOOP_PREFIX</span>/sbin/yarn-daemon.sh start resourcemanager</span><br><span class="line"><span class="comment"># Start the nodemanager daemon</span></span><br><span class="line"><span class="variable">$HADOOP_PREFIX</span>/sbin/yarn-daemon.sh start nodemanager</span><br></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Format the namenode directory (DO THIS ONLY ONCE, THE FIRST TIME)</span><br><span class="line">$HADOOP_PREFIX/bin/hdfs namenode -format</span><br><span class="line"># Start NameNode daemon and DataNode daemon, The hadoop daemon log output is written to the $HADOOP_LOG_DIR directory (defaults to $HADOOP_HOME/logs).</span><br><span class="line">$HADOOP_PREFIX/sbin/start-dfs.sh</span><br><span class="line">$HADOOP_PREFIX/sbin/start-yarn.sh</span><br></pre></td></tr></table></figure>
<p>Hopefully, everything should be running. Use the command <code>jps</code> to see if all daemons are launched. If one is missing, check <code>$HADOOP_PREFIX/logs/&lt;daemon with problems&gt;.log</code> for any errors.</p>
<p>The output looks like this:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hduser@hanson:<span class="variable">$HADOOP_HOME</span>/etc/hadoop$ jps</span><br><span class="line">7890 DataNode</span><br><span class="line">16585 SecondaryNameNode</span><br><span class="line">12722 ResourceManager</span><br><span class="line">13013 NodeManager</span><br><span class="line">13126 Jps</span><br><span class="line">7703 NameNode</span><br></pre></td></tr></table></figure>

<p>Make the HDFS directories required to execute MapReduce jobs:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ bin/hdfs dfs -mkdir /user</span><br><span class="line">$ bin/hdfs dfs -mkdir /user/&lt;username&gt;</span><br></pre></td></tr></table></figure>

<h1 id="Testing"><a href="#Testing" class="headerlink" title="Testing"></a>Testing</h1><p>To test if everything is working ok, lets run one of the example applications shipped with Hadoop called DistributedShell. This application spawns a specified number of containers and runs a shell command in each of them. Lets run DistributedShell with the ‚Äòdate‚Äô command which outputs the current time:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Run Distributed shell with 2 containers and executing the script `date`.</span></span><br><span class="line"><span class="variable">$HADOOP_PREFIX</span>/bin/hadoop jar <span class="variable">$HADOOP_PREFIX</span>/share/hadoop/yarn/hadoop-yarn-applications-distributedshell-2.7.4.jar org.apache.hadoop.yarn.applications.distributedshell.Client --jar <span class="variable">$HADOOP_PREFIX</span>/share/hadoop/yarn/hadoop-yarn-applications-distributedshell-2.7.4.jar --shell_command date --num_containers 2 --master_memory 1024</span><br></pre></td></tr></table></figure>

<p>The output looks like this:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">17/11/26 11:20:20 INFO distributedshell.Client: Initializing Client</span><br><span class="line">17/11/26 11:20:20 INFO distributedshell.Client: Running Client</span><br><span class="line">17/11/26 11:20:20 INFO client.RMProxy: Connecting to ResourceManager at /0.0.0.0:8032</span><br><span class="line">17/11/26 11:20:20 INFO distributedshell.Client: Got Cluster metric info from ASM, numNodeManagers=1</span><br><span class="line">17/11/26 11:20:20 INFO distributedshell.Client: Got Cluster node info from ASM</span><br><span class="line">17/11/26 11:20:20 INFO distributedshell.Client: Got node report from ASM <span class="keyword">for</span>, nodeId=hanson:35765, nodeAddresshanson:8042, nodeRackName/default-rack, nodeNumContainers0</span><br><span class="line">17/11/26 11:20:20 INFO distributedshell.Client: Queue info, queueName=default, queueCurrentCapacity=0.0, queueMaxCapacity=1.0, queueApplicationCount=0, queueChildQueueCount=0</span><br><span class="line">17/11/26 11:20:20 INFO distributedshell.Client: User ACL Info <span class="keyword">for</span> Queue, queueName=root, userAcl=SUBMIT_APPLICATIONS</span><br><span class="line">...</span><br><span class="line">17/11/26 11:20:32 INFO distributedshell.Client: Got application report from ASM <span class="keyword">for</span>, appId=1, clientToAMToken=null, appDiagnostics=, appMasterHost=hanson/10.211.55.3, appQueue=default, appMasterRpcPort=-1, appStartTime=1511716821975, yarnAppState=FINISHED, distributedFinalState=SUCCEEDED, appTrackingUrl=http://hanson:8088/proxy/application_1511716475099_0001/, appUser=hduser</span><br><span class="line">17/11/26 11:20:32 INFO distributedshell.Client: Application has completed successfully. Breaking monitoring loop</span><br><span class="line">17/11/26 11:20:32 INFO distributedshell.Client: Application completed successfully</span><br></pre></td></tr></table></figure>
<p>With this command we are telling hadoop to run the <code>Client class</code> in the <code>hadoop-yarn-applications-distributedshell-2.7.4.jar</code>, passing it the jar containing the definition of the ApplicationMaster (the same jar), the shell command to run in each of the <code>hosts (date)</code>, the number of containers to spawn (2) and the memory used by the ApplicationMaster (1024MB). The value of 1024 was set empirically by trying to run the program several times until it stopped failing due to the ApplicationMaster using more memory than that which had been allocated to it. You can <code>check the entire set of parameters</code> you can pass to DistributedShell by using the same command <code>without any arguments</code>:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Check the parameters for the DistributedShell client.</span></span><br><span class="line"><span class="variable">$HADOOP_PREFIX</span>/bin/hadoop jar <span class="variable">$HADOOP_PREFIX</span>/share/hadoop/yarn/hadoop-yarn-applications-distributedshell-2.7.4.jar org.apache.hadoop.yarn.applications.distributedshell.Client</span><br></pre></td></tr></table></figure>
<p>The output should look like this:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">17/11/26 11:29:46 INFO distributedshell.Client: Initializing Client</span><br><span class="line">No jar file specified <span class="keyword">for</span> application master</span><br><span class="line">usage: Client</span><br><span class="line">-appname &lt;arg&gt;                                 Application Name. Default</span><br><span class="line">value - DistributedShell</span><br><span class="line">-attempt_failures_validity_interval &lt;arg&gt;      when</span><br><span class="line">attempt_failures_validity_</span><br><span class="line">interval <span class="keyword">in</span> milliseconds</span><br><span class="line">is <span class="built_in">set</span> to &gt; 0,the failure</span><br><span class="line">number will not take</span><br><span class="line">failures <span class="built_in">which</span> happen out</span><br><span class="line">of the validityInterval</span><br><span class="line">into failure count. If</span><br><span class="line">failure count reaches to</span><br><span class="line">maxAppAttempts, the</span><br><span class="line">application will be</span><br><span class="line">failed.</span><br><span class="line">...</span><br></pre></td></tr></table></figure>


<h1 id="Hadoop-Web-Interfaces"><a href="#Hadoop-Web-Interfaces" class="headerlink" title="Hadoop Web Interfaces"></a>Hadoop Web Interfaces</h1><h2 id="Web-UIs-for-the-Common-User"><a href="#Web-UIs-for-the-Common-User" class="headerlink" title="Web UIs for the Common User"></a>Web UIs for the Common User</h2><hr>
<p>The default Hadoop ports are as follows:</p>
<table>
<thead>
<tr>
<th>Daemon</th>
<th>Default Port</th>
<th>Configuration Parameter</th>
</tr>
</thead>
<tbody><tr>
<td>‚Äî‚ÄîHDFS‚Äî‚Äî-</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Namenode</td>
<td>50070</td>
<td>dfs.http.address</td>
</tr>
<tr>
<td>Datanodes</td>
<td>50075</td>
<td>dfs.datanode.http.address</td>
</tr>
<tr>
<td>Secondarynamenode</td>
<td>50090</td>
<td>dfs.secondary.http.address</td>
</tr>
<tr>
<td>Backup/Checkpoint node?</td>
<td>50105</td>
<td>dfs.backup.http.address</td>
</tr>
<tr>
<td>‚Äî-MapReduce‚Äî-</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Jobracker</td>
<td>50030</td>
<td>mapred.job.tracker.http.address</td>
</tr>
<tr>
<td>Tasktrackers</td>
<td>50060</td>
<td>mapred.task.tracker.http.address</td>
</tr>
</tbody></table>
<p>Hadoop daemons expose some information over HTTP. All Hadoop daemons expose the following:</p>
<ul>
<li><code>/logs</code>:<br>Exposes, for downloading, log files in the Java system property <strong>hadoop.log.dir</strong>.</li>
<li><code>/logLevel</code>:<br>Allows you to dial up or down <strong>log4j</strong> logging levels. This is similar to <strong>hadoop daemonlog</strong> on the command line.</li>
<li><code>/stacks</code>:<br>Stack traces for all threads. Useful for debugging.</li>
<li><code>/metrics</code>:<br>Metrics for the server. Use /metrics?format=json to retrieve the data in a structured form. <code>Available in 0.21</code>.</li>
</ul>
<p>Individual daemons expose extra daemon-specific endpoints as well. Note that these are not necessarily part of Hadoop‚Äôs public API, so they tend to change over time.</p>
<p>The <code>Namenode</code> exposes:</p>
<ul>
<li><code>/</code>:<br>Shows information about the namenode as well as the HDFS. There‚Äôs a link from here to browse the filesystem, as well.</li>
<li><code>/dfsnodelist.jsp?whatNodes=(DEAD|LIVE)</code>:<br>Shows lists of nodes that are disconnected from (DEAD) or connected to (LIVE) the namenode.</li>
<li><code>/fsck</code>:<br>Runs the ‚Äúfsck‚Äù command. Not recommended on a busy cluster.</li>
<li><code>/listPaths</code>:<br>Returns an XML-formatted directory listing. This is useful if you wish (for example) to poll HDFS to see if a file exists. The URL can include a path (e.g., /listPaths/user/philip) and can take optional GET arguments: /listPaths?recursive=yes will return all files on the file system; /listPaths/user/philip?filter=s.* will return all files in the home directory that start with s; and /listPaths/user/philip?exclude=.txt will return all files except text files in the home directory. Beware that filter and exclude operate on the directory listed in the URL, and they ignore the recursive flag.</li>
<li><code>/data</code> and <code>/fileChecksum</code><br>These forward your HTTP request to an appropriate datanode, which in turn returns the data or the checksum.</li>
</ul>
<p><code>Datanodes</code> expose the following:</p>
<ul>
<li><code>/browseBlock.jsp</code>, <code>/browseDirectory.jsp, tail.jsp</code>, <code>/streamFile</code>, <code>/getFileChecksum</code><br>These are the endpoints that the namenode redirects to when you are browsing filesystem content. You probably wouldn‚Äôt use these directly, but this is what‚Äôs going on underneath.</li>
<li><code>/blockScannerReport</code><br>Every datanode verifies its blocks at configurable intervals. This endpoint provides a listing of that check.</li>
</ul>
<p>The <code>secondarynamenode</code> exposes a simple status page with information including which namenode it‚Äôs talking to, when the last checkpoint was, how big it was, and which directories it‚Äôs using.</p>
<p>The <code>jobtracker</code>‚Äòs UI is commonly used to look at running jobs, and, especially, to find the causes of failed jobs. The UI is best browsed starting at <code>/jobtracker.jsp</code>. There are over a dozen related pages providing details on tasks, history, scheduling queues, jobs, etc.</p>
<p><code>Tasktrackers</code> have a simple page (<code>/tasktracker.jsp</code>), which shows running tasks. They also expose <code>/taskLog?taskid=</code>to query logs for a specific task. They use <code>/mapOutput</code> to serve the output of map tasks to reducers, but this is an internal API.</p>
<h2 id="Under-the-Covers-for-the-Developer-and-the-System-Administrator"><a href="#Under-the-Covers-for-the-Developer-and-the-System-Administrator" class="headerlink" title="Under the Covers for the Developer and the System Administrator"></a>Under the Covers for the Developer and the System Administrator</h2><hr>
<p>Internally, Hadoop mostly uses Hadoop IPC to communicate amongst servers. (Part of the goal of the Apache Avro project is to replace Hadoop IPC with something that is easier to evolve and more language-agnostic; HADOOP-6170 is the relevant ticket.) Hadoop also uses HTTP (for the secondarynamenode communicating with the namenode and for the tasktrackers serving map outputs to the reducers) and a raw network socket protocol (for datanodes copying around data).</p>
<p>The following table presents the ports and protocols (including the relevant Java class) that Hadoop uses. This table does not include the HTTP ports mentioned above.</p>
<table>
<thead>
<tr>
<th>Daemon</th>
<th>Default Port</th>
<th>Configuration Parameter</th>
<th>Protocol</th>
<th>Used for</th>
</tr>
</thead>
<tbody><tr>
<td>Namenode</td>
<td>8020</td>
<td>fs.default.name</td>
<td>IPC: ClientProtocol</td>
<td>Filesystem metadata operations</td>
</tr>
<tr>
<td>Datanode</td>
<td>50010</td>
<td>dfs.datanode.address</td>
<td>Custom Hadoop Xceiver: DataNode and DFSClient</td>
<td>DFS data transfer</td>
</tr>
<tr>
<td>Datanode</td>
<td>50020</td>
<td>dfs.datanode.ipc.address</td>
<td>IPC: InterDatanodeProtocol, ClientDatanodeProtocolClientProtocol</td>
<td>Block metadata operations and recovery</td>
</tr>
<tr>
<td>Backupnode</td>
<td>50100</td>
<td>dfs.backup.address</td>
<td>Same as namenode</td>
<td>HDFS Metadata Operations</td>
</tr>
<tr>
<td>&gt; This is the port part of hdfs://host:8020/.</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Default is not well-defined. Common values are 8021, 9001, or 8012. See <a href="http://issues.apache.org/jira/browse/MAPREDUCE-566" target="_blank" rel="noopener">MAPREDUCE-566</a>.</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Binds to an unused local port.</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h1 id="Multinode-configuration"><a href="#Multinode-configuration" class="headerlink" title="Multinode configuration"></a>Multinode configuration</h1><h2 id="Node-configure"><a href="#Node-configure" class="headerlink" title="Node configure"></a>Node configure</h2><p>First get every machine‚Äôs ip address. Assuming we have 3 machine, 1 master and 2 slaves.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">master: 10.211.55.3</span><br><span class="line">slave1: 10.211.55.6</span><br><span class="line">slave2: 10.211.55.7</span><br></pre></td></tr></table></figure>

<p>Then go to every machine‚Äôs <code>/etc/hostname</code> file, change them:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/hostname</span><br><span class="line"># change hostname to master, slave1, slave2</span><br></pre></td></tr></table></figure>

<p>Then go to every machine‚Äôs <code>/etc/hosts</code> file, add the same content:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">10.211.55.3 master</span><br><span class="line">10.211.55.6 slave1</span><br><span class="line">10.211.55.7 slave2</span><br></pre></td></tr></table></figure>

<p>Then reboot 3 machine and conform every machine‚Äôs hostname:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">osboxes@master:~$ hostname</span><br><span class="line">master</span><br><span class="line">osboxes@master:~$ ping slave1</span><br><span class="line">PING slave1 (10.211.55.6) 56(84) bytes of data.</span><br><span class="line">64 bytes from slave1 (10.211.55.6): icmp_seq=1 ttl=64 time=0.466 ms</span><br><span class="line">64 bytes from slave1 (10.211.55.6): icmp_seq=2 ttl=64 time=0.417 ms</span><br><span class="line">64 bytes from slave1 (10.211.55.6): icmp_seq=3 ttl=64 time=0.402 ms</span><br><span class="line"></span><br><span class="line">osboxes@master:~$ ping slave2</span><br><span class="line">PING slave2 (10.211.55.7) 56(84) bytes of data.</span><br><span class="line">64 bytes from slave2 (10.211.55.7): icmp_seq=1 ttl=64 time=0.491 ms</span><br><span class="line">64 bytes from slave2 (10.211.55.7): icmp_seq=2 ttl=64 time=0.336 ms</span><br><span class="line">64 bytes from slave2 (10.211.55.7): icmp_seq=3 ttl=64 time=0.392 ms</span><br></pre></td></tr></table></figure>

<p>Then in every machine, use <code>ssh</code> command to link every other machine: ( This is used to enable ssh without password)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">osboxes@master:~$ ssh slave1</span><br><span class="line">The authenticity of host <span class="string">'slave1 (10.211.55.6)'</span> can<span class="string">'t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:emnk3O6O2N7CK8chUMIThK3CGFUwFOS44kzsa0phArE.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added '</span>slave1,10.211.55.6<span class="string">' (ECDSA) to the list of known hosts.</span></span><br><span class="line"><span class="string">Welcome to Ubuntu 17.10 (GNU/Linux 4.13.0-17-generic x86_64)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">* Documentation:  https://help.ubuntu.com</span></span><br><span class="line"><span class="string">* Management:     https://landscape.canonical.com</span></span><br><span class="line"><span class="string">* Support:        https://ubuntu.com/advantage</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">21 packages can be updated.</span></span><br><span class="line"><span class="string">0 updates are security updates.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Last login: Wed Nov 29 17:08:56 2017 from 127.0.0.1</span></span><br><span class="line"><span class="string">osboxes@slave1:~$ exit</span></span><br><span class="line"><span class="string">logout</span></span><br><span class="line"><span class="string">Connection to slave1 closed.</span></span><br><span class="line"><span class="string">osboxes@master:~$ ssh slave2</span></span><br><span class="line"><span class="string">The authenticity of host '</span>slave2 (10.211.55.7)<span class="string">' can'</span>t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:emnk3O6O2N7CK8chUMIThK3CGFUwFOS44kzsa0phArE.</span><br><span class="line">Are you sure you want to <span class="built_in">continue</span> connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added <span class="string">'slave2,10.211.55.7'</span> (ECDSA) to the list of known hosts.</span><br><span class="line">Welcome to Ubuntu 17.10 (GNU/Linux 4.13.0-17-generic x86_64)</span><br><span class="line"></span><br><span class="line">* Documentation:  https://help.ubuntu.com</span><br><span class="line">* Management:     https://landscape.canonical.com</span><br><span class="line">* Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">21 packages can be updated.</span><br><span class="line">0 updates are security updates.</span><br><span class="line"></span><br><span class="line">Last login: Wed Nov 29 17:08:56 2017 from 127.0.0.1</span><br><span class="line">osboxes@slave2:~$ <span class="built_in">exit</span></span><br><span class="line"><span class="built_in">logout</span></span><br><span class="line">Connection to slave2 closed.</span><br><span class="line">osboxes@master:~$ ssh master</span><br><span class="line">The authenticity of host <span class="string">'master (10.211.55.3)'</span> can<span class="string">'t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:emnk3O6O2N7CK8chUMIThK3CGFUwFOS44kzsa0phArE.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added '</span>master,10.211.55.3<span class="string">' (ECDSA) to the list of known hosts.</span></span><br><span class="line"><span class="string">Welcome to Ubuntu 17.10 (GNU/Linux 4.13.0-17-generic x86_64)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">* Documentation:  https://help.ubuntu.com</span></span><br><span class="line"><span class="string">* Management:     https://landscape.canonical.com</span></span><br><span class="line"><span class="string">* Support:        https://ubuntu.com/advantage</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">21 packages can be updated.</span></span><br><span class="line"><span class="string">0 updates are security updates.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Last login: Wed Nov 29 17:08:56 2017 from 127.0.0.1</span></span><br><span class="line"><span class="string">osboxes@master:~$ exit</span></span><br><span class="line"><span class="string">logout</span></span><br><span class="line"><span class="string">Connection to master closed.</span></span><br><span class="line"><span class="string">osboxes@master:~$</span></span><br></pre></td></tr></table></figure>

<h2 id="Update-core-site-xml-in-all-machine"><a href="#Update-core-site-xml-in-all-machine" class="headerlink" title="Update core-site.xml in all machine"></a>Update core-site.xml in all machine</h2><p>Delete this configure:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;file:///home/osboxes/Program/hadoop/tmp&lt;/value&gt;</span><br><span class="line">    &lt;description&gt;Abase for other temporary directories.&lt;/description&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>

<p>And change all <code>fs.default</code> property to:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;fs.defaultFS&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;hdfs://master:9000/&lt;/value&gt;</span><br><span class="line">    &lt;description&gt;NameNode URI&lt;/description&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Update-hdfs-site-xml-in-all-machine"><a href="#Update-hdfs-site-xml-in-all-machine" class="headerlink" title="Update hdfs-site.xml in all machine"></a>Update hdfs-site.xml in all machine</h2><p>in master node, delete <code>datanode</code> property and change <code>dfs.replication</code> to 2:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;!-- Put site-specific property overrides <span class="keyword">in</span> this file. --&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;dfs.namenode.name.dir&lt;/name&gt;</span><br><span class="line">&lt;value&gt;file:///home/osboxes/Program/hadoop/tmp/dfs/namenode&lt;/value&gt;</span><br><span class="line">&lt;description&gt;Path on the <span class="built_in">local</span> filesystem <span class="built_in">where</span> the NameNode stores the namespace and transaction logs persistently.&lt;/description&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;dfs.replication&lt;/name&gt;</span><br><span class="line">&lt;value&gt;2&lt;/value&gt;</span><br><span class="line">&lt;description&gt;Default block replication.</span><br><span class="line">The actual number of replications can be specified when the file is created.</span><br><span class="line">The default is used <span class="keyword">if</span> replication is not specified <span class="keyword">in</span> create time.</span><br><span class="line">&lt;/description&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<p>In the slave node, delete <code>namenode</code> property and change <code>dfs.replication</code> to 2</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;dfs.datanode.data.dir&lt;/name&gt;</span><br><span class="line">&lt;value&gt;file:///home/osboxes/Program/hadoop/tmp/dfs/datanode&lt;/value&gt;</span><br><span class="line">&lt;description&gt;Comma separated list of paths on the <span class="built_in">local</span> filesystem of a DataNode <span class="built_in">where</span> it should store its blocks.&lt;/description&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;dfs.replication&lt;/name&gt;</span><br><span class="line">&lt;value&gt;2&lt;/value&gt;</span><br><span class="line">&lt;description&gt;Default block replication.</span><br><span class="line">The actual number of replications can be specified when the file is created.</span><br><span class="line">The default is used <span class="keyword">if</span> replication is not specified <span class="keyword">in</span> create time.</span><br><span class="line">&lt;/description&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Update-yarn-site-xml-in-all-machine"><a href="#Update-yarn-site-xml-in-all-machine" class="headerlink" title="Update yarn-site.xml in all machine"></a>Update yarn-site.xml in all machine</h2><p>insert the following to all 3 machines.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;yarn.resourcemanager.resource-tracker.address&lt;/name&gt;</span><br><span class="line">&lt;value&gt;master:8025&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;yarn.resourcemanager.scheduler.address&lt;/name&gt;</span><br><span class="line">&lt;value&gt;master:8030&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;yarn.resourcemanager.address&lt;/name&gt;</span><br><span class="line">&lt;value&gt;master:8050&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Update-mapred-site-xml"><a href="#Update-mapred-site-xml" class="headerlink" title="Update mapred-site.xml"></a>Update mapred-site.xml</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;mapreduce.jobhistory.address&lt;/name&gt;</span><br><span class="line">&lt;value&gt;master:10020&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Master-or-Slaves-only-configuration"><a href="#Master-or-Slaves-only-configuration" class="headerlink" title="Master or Slaves only configuration"></a>Master or Slaves only configuration</h2><p>edit <code>~/Program/hadoop/etc/hadoop/slaves</code> file (Master only)<br>change to this value:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">slave1</span><br><span class="line">slave2</span><br></pre></td></tr></table></figure>

<p>edit <code>~/Program/hadoop/etc/hadoop/masters</code> file (Master only)<br>change to this value:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">master</span><br></pre></td></tr></table></figure>

<p>Recreate Namenode folder (Master Only):</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir -p ~/Program/hadoop/tmp/dfs/namenode</span><br><span class="line">chown osboxes:osboxes -R ~/Program/hadoop/tmp/</span><br><span class="line">chmod 777 ~/Program/hadoop/tmp/dfs/namenode</span><br></pre></td></tr></table></figure>

<p>Recreate Datanode folder (All slave Nodes only):</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir -p ~/Program/hadoop/tmp/dfs/datanode</span><br><span class="line">chown osboxes:osboxes -R ~/Program/hadoop/tmp/</span><br><span class="line">chmod 777 ~/Program/hadoop/tmp/dfs/datanode</span><br></pre></td></tr></table></figure>

<p>Format the Namenode ÔºàMaster onlyÔºâ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hdfs namenode -format</span><br></pre></td></tr></table></figure>

<h2 id="Start-the-DFS-amp-YarnÔºàMaster-onlyÔºâ"><a href="#Start-the-DFS-amp-YarnÔºàMaster-onlyÔºâ" class="headerlink" title="Start the DFS &amp; YarnÔºàMaster onlyÔºâ"></a>Start the DFS &amp; YarnÔºàMaster onlyÔºâ</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">osboxes@master:~/Program/hadoop/sbin$ ./start-dfs.sh</span><br><span class="line">Starting namenodes on [master]</span><br><span class="line">master: starting namenode, logging to /home/osboxes/Program/hadoop/logs/hadoop-osboxes-namenode-master.out</span><br><span class="line">slave2: starting datanode, logging to /home/osboxes/Program/hadoop/logs/hadoop-osboxes-datanode-slave2.out</span><br><span class="line">slave1: starting datanode, logging to /home/osboxes/Program/hadoop/logs/hadoop-osboxes-datanode-slave1.out</span><br><span class="line">Starting secondary namenodes [0.0.0.0]</span><br><span class="line">0.0.0.0: starting secondarynamenode, logging to /home/osboxes/Program/hadoop/logs/hadoop-osboxes-secondarynamenode-master.out</span><br><span class="line">osboxes@master:~/Program/hadoop/sbin$ jps</span><br><span class="line">7316 Jps</span><br><span class="line">6904 NameNode</span><br><span class="line">7180 SecondaryNameNode</span><br><span class="line">osboxes@master:~/Program/hadoop/sbin$ ./start-yarn.sh</span><br><span class="line">starting yarn daemons</span><br><span class="line">starting resourcemanager, logging to /home/osboxes/Program/hadoop/logs/yarn-osboxes-resourcemanager-master.out</span><br><span class="line">slave2: starting nodemanager, logging to /home/osboxes/Program/hadoop/logs/yarn-osboxes-nodemanager-slave2.out</span><br><span class="line">slave1: starting nodemanager, logging to /home/osboxes/Program/hadoop/logs/yarn-osboxes-nodemanager-slave1.out</span><br><span class="line">osboxes@master:~/Program/hadoop/sbin$ jps</span><br><span class="line">7665 Jps</span><br><span class="line">7382 ResourceManager</span><br><span class="line">6904 NameNode</span><br><span class="line">7180 SecondaryNameNode</span><br></pre></td></tr></table></figure>

<p>If you go to your slave machine, then you will seeÔºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">osboxes@slave1:~/Program/hadoop/tmp/dfs$ jps</span><br><span class="line">2769 NodeManager</span><br><span class="line">2538 DataNode</span><br><span class="line">2891 Jps</span><br></pre></td></tr></table></figure>

<h2 id="Review-Yarn-console"><a href="#Review-Yarn-console" class="headerlink" title="Review Yarn console"></a>Review Yarn console</h2><p>If all the services started successfully on all nodes, then you should see all of your nodes listed under Yarn nodes. You can hit the following url on your browser and verify that:</p>
<p><a href="http://master:8088/cluster/nodes" target="_blank" rel="noopener">http://master:8088/cluster/nodes</a><br><a href="http://master:50070" target="_blank" rel="noopener">http://master:50070</a></p>
<p>You can also get the report of your cluster by issuing the below commands:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hdfs dfsadmin -report</span><br></pre></td></tr></table></figure>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><a href="http://www.michael-noll.com/tutorials/running-hadoop-on-ubuntu-linux-single-node-cluster/#installation" target="_blank" rel="noopener">Running Hadoop on Ubuntu Linux (Single-Node Cluster)</a></li>
<li><a href="https://www.alexjf.net/blog/distributed-systems/hadoop-yarn-installation-definitive-guide/" target="_blank" rel="noopener">Hadoop YARN Installation: The definitive guide</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-hadoop-in-stand-alone-mode-on-ubuntu-16-04" target="_blank" rel="noopener">How to Install Hadoop in Stand-Alone Mode on Ubuntu 16.04</a></li>
<li><a href="http://www.powerxing.com/install-hadoop/" target="_blank" rel="noopener">HadoopÂÆâË£ÖÊïôÁ®ã_ÂçïÊú∫/‰º™ÂàÜÂ∏ÉÂºèÈÖçÁΩÆ_Hadoop2.6.0/Ubuntu14.04</a></li>
<li><a href="http://blog.cloudera.com/blog/2009/08/hadoop-default-ports-quick-reference/" target="_blank" rel="noopener">Hadoop Default Ports Quick Reference</a></li>
<li><a href="https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/SingleCluster.html" target="_blank" rel="noopener">Hadoop: Setting up a Single Node Cluster.</a></li>
</ul>
]]></content>
      <categories>
        <category>os</category>
      </categories>
      <tags>
        <tag>hadoop</tag>
        <tag>mapreudce</tag>
      </tags>
  </entry>
  <entry>
    <title>Shared Libraries Ê¶ÇËø∞</title>
    <url>/blog/shared-libraries-%E6%A6%82%E8%BF%B0/</url>
    <content><![CDATA[<p>ÊúÄËøë‰ΩøÁî® <code>make</code> ÁºñËØë‰ª£Á†ÅÁöÑÊó∂ÂÄôÔºåÈÅáÂà∞‰∫ÜÂíå Shared Libraries Áõ∏ÂÖ≥ÁöÑ‰∏Ä‰∫õÈóÆÈ¢òÔºåÂÅö‰∏Ä‰∏ãÊÄªÁªì„ÄÇ</p>
<h1 id="‰ªÄ‰πàÊòØ-Shared-Libraries"><a href="#‰ªÄ‰πàÊòØ-Shared-Libraries" class="headerlink" title="‰ªÄ‰πàÊòØ Shared Libraries"></a>‰ªÄ‰πàÊòØ Shared Libraries</h1><p>Shared Libraries ÊòØÁ®ãÂ∫èÂú®ËøêË°åÁöÑÊó∂ÂÄôÊâçË£ÖËΩΩÁöÑ librariesÔºåÊç¢Âè•ËØùËØ¥ÔºåÂ∞±ÊòØËøô‰∫õ‰ª£Á†ÅÂπ∂Ê≤°ÊúâÁºñËØëÈìæÊé•Âà∞ÂèØÊâßË°åÊñá‰ª∂‰∏≠„ÄÇ</p>
<h1 id="Shared-Libraries-name"><a href="#Shared-Libraries-name" class="headerlink" title="Shared Libraries name"></a>Shared Libraries name</h1><p>Shared Libraries Êúâ‰∏ãÈù¢‰∏âÁßçÂêçÂ≠óÔºö</p>
<h2 id="soname"><a href="#soname" class="headerlink" title="soname"></a>soname</h2><p><code>lib</code>+ <code>library name</code> + <code>.so</code> + <code>period</code> + <code>version number</code><br>ÊØîÂ¶ÇÔºölibleveldb.so.1.20„ÄÇÂú® linux Á≥ªÁªü‰∏≠Ôºåsoname ÊòØ shared libraries ÁöÑ real name ÁöÑ symlink„ÄÇ</p>
<figure class="highlight bash"><figcaption><span>:sonameÁ§∫‰æã</span></figcaption><table><tr><td class="code"><pre><span class="line">$ ls -al | grep level</span><br><span class="line">-rw-r--r--  1 root root 789K 2018-04-03 01:42 libleveldb.a</span><br><span class="line">lrwxrwxrwx  1 root root   18 2018-04-03 01:42 libleveldb.so -&gt; libleveldb.so.1.20* <span class="comment"># linker name</span></span><br><span class="line">lrwxrwxrwx  1 root root   18 2018-04-03 01:42 libleveldb.so.1 -&gt; libleveldb.so.1.20* <span class="comment"># soname</span></span><br><span class="line">-rwxr-xr-x  1 root root 459K 2018-04-03 01:42 libleveldb.so.1.20* <span class="comment"># real name</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>

<p>ÂèØ‰ª•ÁúãÂà∞ <code>libleveldb.so</code> Âíå <code>libleveldb.so.1</code>ÈÉΩÊòØ <code>libleveldb.so.1.20*</code> ÁöÑ symlink„ÄÇ‰ªéÊñá‰ª∂Â§ßÂ∞èÂ∞±ËÉΩÁúãÂá∫‰∏çÂêå„ÄÇ</p>
<h2 id="real-name"><a href="#real-name" class="headerlink" title="real name"></a>real name</h2><p>ÊØè‰∏Ä‰∏™ shared library ÈÉΩÊúâ‰∏Ä‰∏™ <code>real name</code>Ôºåreal name ‰∏ãÁöÑÊñá‰ª∂ÊâçÊòØÁúüÊ≠£ÂåÖÂê´Ê∫ê‰ª£Á†ÅÁöÑÊñá‰ª∂„ÄÇreal name ‰ºöÂú® soname ÂêéÈù¢Ê∑ªÂä† periodÔºåminor numberÔºå[another periodÔºårelease number]ÔºåÂêéÈù¢‰∏§‰∏™ÊòØ optional ÁöÑ„ÄÇ</p>
<h2 id="linker-name"><a href="#linker-name" class="headerlink" title="linker name"></a>linker name</h2><p>Â∞±ÊòØ‰∏çÂåÖÂê´‰ªª‰Ωï version number ÁöÑ soname„ÄÇËøô‰∏™Â∞±ÊòØÊàë‰ª¨Âú® compile ÁöÑÊó∂ÂÄôÁî®Âà∞Âà∞ÁöÑ name„ÄÇ</p>
<p>ÁÆ°ÁêÜ shared library ÁöÑÂÖ≥ÈîÆÂú®‰∫éÂå∫ÂàÜÂ•ΩËøô‰∫õ name„ÄÇÁ®ãÂ∫èÂ∫îËØ•Âè™ÂàóÂá∫ÂÆÉ‰ª¨ÊÉ≥Ë¶ÅÁî®Âà∞ÁöÑ soname„ÄÇÂΩìÊàë‰ª¨ÂàõÂª∫‰∏Ä‰∏™ shared library ÂêéÔºåÂ∫îËØ•ÁªôÂÆÉÂëΩÂêç‰∏Ä‰∏™ÂåÖÂê´ version information ÁöÑ name„ÄÇÁÑ∂ÂêéÂ∞ÜÂàõÂª∫ÁöÑ shared library ÂÆâË£ÖÔºàÂ§çÂà∂ÔºâÂà∞ÊåáÂÆöÁõÆÂΩïÔºàÊØîÂ¶Ç <code>/usr/local/lib</code> <code>/usr/lib</code> ÔºâÔºåÁÑ∂ÂêéËøêË°å <code>ldconfig</code> ÂëΩ‰ª§„ÄÇ ldconfig ‰ºöÊ£ÄÊµãÁõÆÂΩï‰∏≠Â∑≤Â≠òÂú®ÁöÑfilesÔºåÂπ∂Áªô‰ªñ‰ª¨ÁöÑ real name ÂàõÂª∫ÂØπÂ∫îÁöÑ soname„ÄÇÂπ∂ËÆæÁΩÆ cache file: <code>/etc/ld.so.chache</code>„ÄÇ</p>
<p><code>ldconfig</code> Âπ∂‰∏ç‰ºöËÆæÁΩÆ linker name„ÄÇlinker name ÁöÑÂàõÂª∫‰∏ÄËà¨Âú® library installation ÁöÑÊó∂ÂÄôÔºåÂπ∂‰∏î linker name Âè™ÊòØÂØπÊúÄÊñ∞ÁöÑ soname ÊàñËÄÖ real name ÂàõÂª∫‰∏Ä‰∏™ symlink„ÄÇ</p>
<h1 id="ÂèÇËÄÉ"><a href="#ÂèÇËÄÉ" class="headerlink" title="ÂèÇËÄÉ"></a>ÂèÇËÄÉ</h1><ol>
<li><a href="http://www.tldp.org/HOWTO/Program-Library-HOWTO/shared-libraries.html" target="_blank" rel="noopener">Program Library HOWTO</a></li>
</ol>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>make</tag>
      </tags>
  </entry>
  <entry>
    <title>google s2 Â∫ìÂÆâË£ÖÈÖçÁΩÆ</title>
    <url>/blog/google-s2-%E5%BA%93%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<p>ÂÆâË£Ö openssl1.0.2 ÁâàÊú¨„ÄÇ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># --prefix Áî®Êù•ÊåáÂÆö openssl Ë¶ÅË¢´ÂÆâË£ÖÂú®Âì™Èáå</span></span><br><span class="line">./config shared --prefix=/home/hanson/program/usr</span><br><span class="line">make -j32</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/google/s2geometry" target="_blank" rel="noopener">ÂÆâË£Ö s2</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake ..</span><br><span class="line"><span class="comment"># Â¶ÇÊûúÊÉ≥ÊâãÂä®ÊåáÂÆö openssl ÁöÑË∑ØÂæÑÔºå‰ΩøÁî®Â¶Ç‰∏ãÂëΩ‰ª§„ÄÇËøôÊòØÂõ†‰∏∫ÂΩìÂâçÁâàÊú¨(2018/04/01)ÁöÑ s2 </span></span><br><span class="line"><span class="comment"># openssl Âè™ÊîØÊåÅÂà∞ 1.0.2„ÄÇÂ¶ÇÊûú‰ΩøÁî®ÊúÄÊñ∞1.1.0ÁâàÊú¨‰ºöÁºñËØëÂá∫Èîô„ÄÇ</span></span><br><span class="line">OPENSSL_ROOT_DIR=/home/hanson/program/usr/  cmake ..</span><br><span class="line">sudo make install <span class="comment"># ‰ºöÂ∞Ü libs2.so share library ÂÆâË£ÖÂà∞ /usr/local/lib ‰∏≠ÔºåÂ§¥Êñá‰ª∂ÊîæÂÖ• /usr/local/include/s2</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
]]></content>
      <categories>
        <category>database</category>
      </categories>
  </entry>
  <entry>
    <title>pythonÂú®‰∏ÄÂº†Âõæ‰∏≠‰ΩøÁî®‰∏§ÁªÑyÂùêÊ†á</title>
    <url>/blog/python%E5%9C%A8%E4%B8%80%E5%BC%A0%E5%9B%BE%E4%B8%AD%E4%BD%BF%E7%94%A8%E4%B8%A4%E7%BB%84y%E5%9D%90%E6%A0%87/</url>
    <content><![CDATA[<p>Â∞ëËØ¥Èó≤ËØùÁõ¥Êé•‰∏ä‰ª£Á†ÅÔºö</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">csv_file = file_path_name</span><br><span class="line">df = pd.read_csv(csv_file,header=<span class="literal">None</span>)</span><br><span class="line">df.columns = [[<span class="string">'max cell'</span>,<span class="string">'avg cell'</span>,<span class="string">'time'</span>]]</span><br><span class="line">df[<span class="string">'index'</span>] = range(len(df))</span><br><span class="line">fig, ax0 = plt.subplots()</span><br><span class="line">ax1 = ax0.twinx()</span><br><span class="line"></span><br><span class="line">df.plot(x=[<span class="string">'index'</span>], <span class="comment"># ËÆæÁΩÆ x ËΩ¥ÂÄºÂüü</span></span><br><span class="line">        y=[<span class="string">'max cell'</span>,<span class="string">'avg cell'</span>], <span class="comment"># ËÆæÁΩÆ y ËΩ¥ÂÄºÂüü</span></span><br><span class="line">        ax=ax0, <span class="comment"># ÊåáÂÆöÂú®Âì™Â•ó y ÂùêÊ†áÁîª</span></span><br><span class="line">        color=[<span class="string">'b'</span>,<span class="string">'g'</span>], <span class="comment"># ÊåáÂÆöÈ¢úËâ≤</span></span><br><span class="line">       )</span><br><span class="line">df.plot(x=[<span class="string">'index'</span>],</span><br><span class="line">        y=[<span class="string">'time'</span>],</span><br><span class="line">        ax=ax1,</span><br><span class="line">        style=<span class="string">'r--'</span> <span class="comment"># ÊåáÂÆö style</span></span><br><span class="line">       )</span><br><span class="line"></span><br><span class="line"><span class="comment"># ------------ ‰∏ãÈù¢ÁöÑÊìç‰ΩúÂ∞Ü‰∏§‰∏™ÂõæÁöÑ legend Êï¥ÂêàÊàê‰∏Ä‰∏™ -------------</span></span><br><span class="line"><span class="comment"># ÊèêÂèñÂá∫Âõæ‰∏≠ÁöÑ lines Âíå labels</span></span><br><span class="line">lines0, labels0 = ax0.get_legend_handles_labels()</span><br><span class="line">lines1, labels1 = ax1.get_legend_handles_labels()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Âà†Èô§ ax0 ‰∏äÁöÑ legend </span></span><br><span class="line">ax0.legend_.remove()  </span><br><span class="line"></span><br><span class="line"><span class="comment"># ÈáçÂëΩÂêç legendÔºåÂπ∂Ê∑ªÂä†Êï¥Âêà‰ª•ÂêéÁöÑ legend Âà∞Âõæ‰∏≠</span></span><br><span class="line">labels = [<span class="string">"Max cell #"</span>, <span class="string">"Avg cell #"</span>, <span class="string">"Time"</span>]</span><br><span class="line">ax1.legend(lines0 + lines1, <span class="comment"># Êï¥ÂêàÊâÄÊúâÁöÑ line</span></span><br><span class="line">           labels, <span class="comment"># ËÆæÁΩÆÊñ∞ÁöÑ labels</span></span><br><span class="line">           loc=<span class="number">4</span>,  <span class="comment"># ËÆæÁΩÆ legend ÁöÑ‰ΩçÁΩÆÔºå1 ‰ªéÂè≥‰∏äËßíÂºÄÂßãÔºåÈÄÜÊó∂ÈíàÁÆó‰ΩçÁΩÆ</span></span><br><span class="line">          )</span><br><span class="line">          </span><br><span class="line"><span class="comment"># ËÆæÁΩÆÂõæË°®ÁöÑ‰∏§Â•ó y ËΩ¥Ê†áÈ¢òÂíåÂÖ¨Áî®ÁöÑ x ËΩ¥Ê†áÈ¢ò</span></span><br><span class="line">ax0.set_xlabel(<span class="string">"Max cell setting"</span>)</span><br><span class="line">ax0.set_ylabel(<span class="string">"Cell number"</span>)</span><br><span class="line">ax1.set_ylabel(<span class="string">"Cover time(ms)"</span>)</span><br></pre></td></tr></table></figure>
<a id="more"></a>

<p><img src="1.png" alt=""></p>
<p><code>loc</code> ‰ΩçÁΩÆÂèÇËÄÉÂ¶Ç‰∏ãÔºö</p>
<table>
<thead>
<tr>
<th>Location String</th>
<th align="center">Location Code</th>
</tr>
</thead>
<tbody><tr>
<td>‚Äòbest‚Äô</td>
<td align="center">0</td>
</tr>
<tr>
<td>‚Äòupper right‚Äô</td>
<td align="center">1</td>
</tr>
<tr>
<td>‚Äòupper left‚Äô</td>
<td align="center">2</td>
</tr>
<tr>
<td>‚Äòlower left‚Äô</td>
<td align="center">3</td>
</tr>
<tr>
<td>‚Äòlower right‚Äô</td>
<td align="center">4</td>
</tr>
<tr>
<td>‚Äòright‚Äô</td>
<td align="center">5</td>
</tr>
<tr>
<td>‚Äòcenter left‚Äô</td>
<td align="center">6</td>
</tr>
<tr>
<td>‚Äòcenter right‚Äô</td>
<td align="center">7</td>
</tr>
<tr>
<td>‚Äòlower center‚Äô</td>
<td align="center">8</td>
</tr>
<tr>
<td>‚Äòupper center‚Äô</td>
<td align="center">9</td>
</tr>
<tr>
<td>‚Äòcenter‚Äô</td>
<td align="center">10</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>pyplot</tag>
      </tags>
  </entry>
  <entry>
    <title>LinuxÊâπÈáèÈáçÂëΩÂêçÊñá‰ª∂</title>
    <url>/blog/Linux%E6%89%B9%E9%87%8F%E9%87%8D%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<p>Âú®ÂΩì TA Êó∂ÂÄôÔºåË¶ÅÁªôÊú¨ÁßëÁîüÊîπ program ‰Ωú‰∏öÔºåÊâπÈáè‰∏ãËΩΩÁöÑÊñá‰ª∂ÂêçÂèàÈïøÂèàËá≠ÔºåÂ¶Ç‰∏ãÔºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-rw-r--r--  1 mac  staff   4.0K Mar 27 13:36 Program 1_and7697_attempt_2018-03-22-16-56-45_and7697_p1.s</span><br><span class="line">-rw-r--r--  1 mac  staff   1.3K Mar 27 13:36 Program 1_axg6672_attempt_2018-03-20-14-13-01_axg6672_p1.s</span><br><span class="line">-rw-r--r--  1 mac  staff   799B Mar 27 13:36 Program 1_axk5863_attempt_2018-03-21-23-31-29_axk5863_p1.s</span><br><span class="line">-rw-r--r--  1 mac  staff   797B Mar 27 13:36 Program 1_axr8361_attempt_2018-03-21-22-27-28_axr8361_p1.s</span><br><span class="line">-rw-r--r--  1 mac  staff   1.1K Mar 27 13:36 Program 1_bxk5485_attempt_2018-03-21-21-19-30_bxk5485_p1.s</span><br><span class="line">-rw-r--r--  1 mac  staff   1.7K Mar 27 13:36 Program 1_cra5824_attempt_2018-03-19-09-43-14_cra5824_p1.s</span><br><span class="line">-rw-r--r--  1 mac  staff   1.7K Mar 27 13:36 Program 1_cxx4741_attempt_2018-03-21-21-13-51_cxx4741_p1.s</span><br><span class="line">-rw-r--r--  1 mac  staff   1.5K Mar 27 13:36 Program 1_daa5782_attempt_2018-03-21-16-23-26_daa5782_p1.s</span><br><span class="line">-rw-r--r--  1 mac  staff   4.8K Mar 27 13:36 Program 1_dbp4110_attempt_2018-03-16-23-09-09_dbp4110_p1.s</span><br><span class="line">-rw-r--r--  1 mac  staff   1.9K Mar 27 13:36 Program 1_dtn5102_attempt_2018-03-20-20-29-06_dtn5102-p1.s</span><br><span class="line">-rw-r--r--  1 mac  staff   2.1K Mar 27 13:36 Program 1_eep5180_attempt_2018-03-21-23-23-13_eep5180_p1.s</span><br><span class="line">-rw-r--r--  1 mac  staff   3.6K Mar 27 13:36 Program 1_egc8644_attempt_2018-03-23-22-02-19_egc8644_p1.s</span><br><span class="line">-rw-r--r--  1 mac  staff   969B Mar 27 13:36 Program 1_exg6686_attempt_2018-03-21-22-30-05_exgg6686_p1.s</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>ÊâÄ‰ª•Â∞±ÊÉ≥Êää‰ªñ‰ª¨ÈáçÂëΩÂêç‰∏Ä‰∏ãÔºåÂèòÊàêÂè™Êúâ <code>xxx1111.s</code> ÁöÑÂΩ¢Âºè„ÄÇÊü•Êâæ‰∫Ü‰∏Ä‰∫õ Linux ‰∏ãÊâπÈáèÈáçÂëΩÂêçÁöÑÊñπÊ≥ïÔºåÊÄªÁªìÂ¶Ç‰∏ãÔºö</p>
<a id="more"></a>

<h1 id="cut-ÂëΩ‰ª§"><a href="#cut-ÂëΩ‰ª§" class="headerlink" title="cut ÂëΩ‰ª§"></a>cut ÂëΩ‰ª§</h1><p>ËøôÈáå‰ΩøÁî® <code>cut</code> ÂëΩ‰ª§Êà™ÂèñÊñá‰ª∂Âêç‰∏≠ÊÉ≥Ë¶ÅÁöÑ‰∏ÄÊÆµÂ≠óÁ¨¶ÔºåÁÑ∂ÂêéÂÜçÂ∞æÈÉ®Ê∑ªÂä† <code>.s</code> ÂÖ±ÂêåÊûÑÊàêÊñ∞ÁöÑÊñá‰ª∂Âêç„ÄÇ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> *.s</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    newname=<span class="string">"<span class="variable">$(echo "$name" | cut -c 11-17)</span>"</span>.s</span><br><span class="line">    mv <span class="string">"<span class="variable">$name</span>"</span>  <span class="string">"<span class="variable">$newname</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>ÊÄéÊ†∑Âø´ÈÄüËØªÂèñÊñá‰ª∂</title>
    <url>/blog/%E6%80%8E%E6%A0%B7%E5%BF%AB%E9%80%9F%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<p>È¶ñÂÖà‰ΩøÁî® mmap Êò†Â∞ÑÊñá‰ª∂Âà∞ÂÜÖÂ≠ò‰∏≠ÔºåÁÑ∂ÂêéËøîÂõûËØ•Êñá‰ª∂ÂØπÂ∫îÁöÑ memory È¶ñÂú∞ÂùÄ„ÄÇ char* data„ÄÇ</p>
<p>ÁÑ∂ÂêéÂØπËØ• char* Á±ªÂûã ÊûÑÈÄ†‰∏Ä‰∏™ ifstreamÔºà‰∏çÂ§çÂà∂ data ÂÜÖÂÆπÂà∞ ifstream ‰∏≠Ôºâ„ÄÇ</p>
<p>‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<a id="more"></a>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;streambuf&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;istream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;numeric&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">membuf</span>:</span> <span class="built_in">std</span>::streambuf &#123;</span><br><span class="line">    membuf(<span class="keyword">char</span> <span class="keyword">const</span>* base, <span class="keyword">size_t</span> size) &#123;</span><br><span class="line">        <span class="function"><span class="keyword">char</span>* <span class="title">p</span><span class="params">(<span class="keyword">const_cast</span>&lt;<span class="keyword">char</span>*&gt;(base))</span></span>;</span><br><span class="line">        <span class="keyword">this</span>-&gt;setg(p, p, p + size);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">imemstream</span>:</span> <span class="keyword">virtual</span> membuf, <span class="built_in">std</span>::istream &#123;</span><br><span class="line">    imemstream(<span class="keyword">char</span> <span class="keyword">const</span>* base, <span class="keyword">size_t</span> size)</span><br><span class="line">        : membuf(base, size)</span><br><span class="line">        , <span class="built_in">std</span>::istream(<span class="keyword">static_cast</span>&lt;<span class="built_in">std</span>::streambuf*&gt;(<span class="keyword">this</span>)) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> fd = open(<span class="string">"../XXXX"</span>, O_RDONLY, (<span class="keyword">mode_t</span>)<span class="number">0600</span>);</span><br><span class="line">    <span class="keyword">if</span> (fd == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(<span class="string">"Error opening file for writing"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;        </span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">stat</span> <span class="title">fileInfo</span> = &#123;</span><span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span> (fstat(fd, &amp;fileInfo) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(<span class="string">"Error getting the file size"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (fileInfo.st_size == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Error: File is empty, nothing to do\n"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"File size is %ji\n"</span>, (<span class="keyword">intmax_t</span>)fileInfo.st_size);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">char</span> *<span class="built_in">map</span> = (<span class="keyword">char</span>*)mmap(<span class="number">0</span>, fileInfo.st_size, PROT_READ, MAP_SHARED, fd, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">map</span> == MAP_FAILED)</span><br><span class="line">    &#123;</span><br><span class="line">        close(fd);</span><br><span class="line">        perror(<span class="string">"Error mmapping the file"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> inserted = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ËØªÂèñÊï∞ÊçÆÁöÑÂºÄÂßã</span></span><br><span class="line">    <span class="built_in">string</span> line;</span><br><span class="line">    <span class="function">imemstream <span class="title">in</span><span class="params">(<span class="built_in">map</span>, fileInfo.st_size)</span></span>;</span><br><span class="line">    <span class="keyword">auto</span> started = <span class="built_in">std</span>::chrono::high_resolution_clock::now();</span><br><span class="line">    <span class="comment">// ËøôÈáåÈÅáÂà∞Á©∫Ê†ºÂíåÊç¢Ë°åÈÉΩ‰ºöÂΩìÂÅö‰∏Ä‰∏™ string ÁöÑÁªìÊùü</span></span><br><span class="line">    <span class="keyword">while</span>(in &gt;&gt; line &amp;&amp; inserted &lt; <span class="number">100000</span>) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; line &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">auto</span> done = <span class="built_in">std</span>::chrono::high_resolution_clock::now();</span><br><span class="line">    <span class="keyword">double</span> time_in_ms = <span class="built_in">std</span>::chrono::duration_cast&lt;<span class="built_in">std</span>::chrono::milliseconds&gt;(done-started).count();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Total "</span> &lt;&lt; time_in_ms &lt;&lt;<span class="string">" ms"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Don't forget to free the mmapped memory</span></span><br><span class="line">    <span class="keyword">if</span> (munmap(<span class="built_in">map</span>, fileInfo.st_size) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        close(fd);</span><br><span class="line">        perror(<span class="string">"Error un-mmapping the file"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Un-mmaping doesn't close the file, so we still need to do that.</span></span><br><span class="line">    close(fd);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ÂèÇËÄÉ"><a href="#ÂèÇËÄÉ" class="headerlink" title="ÂèÇËÄÉ"></a>ÂèÇËÄÉ</h1><ol>
<li><a href="http://insanecoding.blogspot.com/2011/11/how-to-read-in-file-in-c.html" target="_blank" rel="noopener">How to read in a file in C++</a></li>
<li><a href="https://www.byvoid.com/zhs/blog/fast-readfile" target="_blank" rel="noopener">Êé¢ÂØªC++ÊúÄÂø´ÁöÑËØªÂèñÊñá‰ª∂ÁöÑÊñπÊ°à</a></li>
<li><a href="https://stackoverflow.com/questions/13059091/creating-an-input-stream-from-constant-memory" target="_blank" rel="noopener">Creating an input stream from constant memory</a></li>
<li><a href="https://gist.github.com/marcetcheverry/991042" target="_blank" rel="noopener">mapread.c</a></li>
</ol>
]]></content>
      <categories>
        <category>OS</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Pymongo ËØïÈ™å</title>
    <url>/blog/Pymongo-%E8%AF%95%E9%AA%8C/</url>
    <content><![CDATA[<p>È¶ñÂÖàÂ∞Ü geojson Êï∞ÊçÆÂØºÂÖ•Âà∞ MongoDB ‰∏≠ÔºåÂÖ∑‰ΩìÊìç‰Ωú<a href="https://stackoverflow.com/questions/22029114/how-to-import-geojson-file-to-mongodb" target="_blank" rel="noopener">ÂèÇËÄÉÂ¶Ç‰∏ã</a>„ÄÇ</p>
<p>ÈúÄË¶Å‰ΩøÁî®‰∏§Êù°ÂëΩ‰ª§Ôºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">jq --compact-output <span class="string">".features"</span> input.geojson &gt; output.geojson</span><br><span class="line">mongoimport --db dbname -c collectionname --file <span class="string">"output.geojson"</span> --jsonArray</span><br></pre></td></tr></table></figure>
<p>ÈÄöËøá‰∏äËø∞ÂëΩ‰ª§ÔºåÊàëÂØºÂÖ•‰∫Ü nyu yellow taxi ÁöÑ json Êï∞ÊçÆ„ÄÇËØ• json Êï∞ÊçÆÊòØÁªèËøáÂêéÊúüÂ§ÑÁêÜÁöÑÔºåÊ†ºÂºèÂ¶Ç‰∏ãÔºö</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;type&quot;: &quot;FeatureCollection&quot;,</span><br><span class="line">    &quot;features&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;type&quot;: &quot;Feature&quot;,</span><br><span class="line">            &quot;properties&quot;: &#123;</span><br><span class="line">                &quot;place&quot;: &quot;nyu&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;geometry&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;Point&quot;,</span><br><span class="line">                &quot;coordinates&quot;: [</span><br><span class="line">                    -73.98268127441406,</span><br><span class="line">                    40.731311798095696</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;type&quot;: &quot;Feature&quot;,</span><br><span class="line">            &quot;properties&quot;: &#123;</span><br><span class="line">                &quot;place&quot;: &quot;nyu&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;geometry&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;Point&quot;,</span><br><span class="line">                &quot;coordinates&quot;: [</span><br><span class="line">                    -73.99224853515625,</span><br><span class="line">                    40.74908065795898</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>
<a id="more"></a>

<p>ÊØîÂ¶ÇÊàëÊÉ≥Ë¶ÅËé∑Âæó nyu ÂçóËæπ‰∏Ä‰∏™ÂúÜÈáåÈù¢ÁöÑÊâÄÊúâ taxi ‰ø°ÊÅØ„ÄÇ<br><img src="1.png" alt=""></p>
<p>find ËØ∑Ê±ÇÂ¶Ç‰∏ãÔºö</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;geometry: &#123;$geoWithin: &#123; $centerSphere: [ [ -74.0093912556225, 40.7094698471372 ], 0.00008092516322998259 ]&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ËÄåÊîπÂÜôÂà∞ pymongo ÈáåÈù¢ÂàôÊòØÔºö</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"><span class="keyword">import</span> pprint <span class="keyword">as</span> pp</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="comment"># Replace XXXX with your connection URI from the Atlas UI</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mongodb:// is the protocol definition</span></span><br><span class="line"><span class="comment"># localhost:27017 is the server we are connecting to</span></span><br><span class="line"><span class="comment"># /myproject is the database we wish to connect to</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">'mongodb://localhost:27017/m201'</span></span><br><span class="line">client = pymongo.MongoClient(url)</span><br><span class="line">taxi = client[<span class="string">'m201'</span>][<span class="string">'nyu_taxi'</span>]</span><br><span class="line"></span><br><span class="line">query = &#123;</span><br><span class="line">    <span class="string">"geometry"</span>: &#123;</span><br><span class="line">        <span class="string">"$geoWithin"</span>: &#123;</span><br><span class="line">            <span class="string">"$centerSphere"</span>: [</span><br><span class="line">                [ <span class="number">-74.0093912556225</span>, <span class="number">40.7094698471372</span> ],</span><br><span class="line">                <span class="number">0.00008092516322998259</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">projection = &#123;<span class="string">"_id"</span>:<span class="number">0</span>&#125;</span><br><span class="line"></span><br><span class="line">points = &#123;&#125;</span><br><span class="line">points[<span class="string">'type'</span>] = <span class="string">'FeatureCollection'</span></span><br><span class="line">points[<span class="string">'features'</span>] = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> taxi.find(query,projection):</span><br><span class="line"><span class="comment">#     print(t)</span></span><br><span class="line">    points[<span class="string">'features'</span>].append(t)</span><br><span class="line"></span><br><span class="line">pp.pprint(points)</span><br><span class="line"></span><br><span class="line"><span class="comment"># save as geojson format</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'./filter_nyu_taxi.json'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> outfile:  </span><br><span class="line">    json.dump(points,outfile, indent=<span class="number">4</span>)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title>S2 ËÆ°ÁÆóÁªôÂÆöÁÇπÂà∞Âì™Êù°ËæπÊúÄËøë</title>
    <url>/blog/S2-%E8%AE%A1%E7%AE%97%E7%BB%99%E5%AE%9A%E7%82%B9%E5%88%B0%E5%93%AA%E6%9D%A1%E8%BE%B9%E6%9C%80%E8%BF%91/</url>
    <content><![CDATA[<p>Âú® GIS Á≥ªÁªüÈáåÔºåÊàë‰ª¨ÂèØËÉΩ‰ºöÈÅáÂà∞Â¶Ç‰∏ãÁöÑÂú∫ÊôØÔºåÁªôÂÆö‰∏Ä‰∏™ÂùêÊ†áÁÇπÔºåËÆ°ÁÆóÂÖ∂Âà∞Âì™Êù°ËæπÊúÄËøë„ÄÇËÄåÁîüÊ¥ª‰∏≠ÂØπÂ∫îÁöÑÂÆû‰æãÊòØÔºöÊ†πÊçÆ‰Ω†ÁöÑ GPS ‰ΩçÁΩÆ‰ø°Âè∑ÔºåÊâæÂà∞Á¶ª‰Ω†ÊúÄËøëÁöÑ‰∏ÄÊù°ÂÖ¨Ë∑ØÊòØÂì™‰∏™„ÄÇ</p>
<p>Âú® google s2 ÁöÑÂ∫ì‰∏≠ÔºåÊèê‰æõ‰∫ÜÂ¶Ç‰∏ãÁ±ªÔºåÁî®Êù•ËøõË°åËØ•Á±ªÂûãÁöÑÁ©∫Èó¥Á¥¢ÂºïÔºö<code>S2ClosestEdgeQuery</code>„ÄÇ</p>
<p>È¶ñÂÖàÊàë‰ª¨Â∞ÜÂ∑≤ÊúâÁöÑ geospatial objects Â≠òÂà∞‰∏Ä‰∏™ index ‰∏≠Ôºå‰πüÂ∞±ÊòØÂØπËøô‰∫õ objects Âª∫Á´ã‰∫Ü‰∏Ä‰∏™Á©∫Èó¥Á¥¢ÂºïÔºåÊàë‰ª¨ÊöÇ‰∏îÁß∞Ëøô‰∏™Á¥¢Âºï‰∏∫ <code>index</code>„ÄÇ</p>
<p>‰πãÂêéÊàë‰ª¨ÁªôÂÆö‰∏Ä‰∏™Êü•ËØ¢ÁõÆÊ†áÔºå<code>Target</code>Ôºå‰ªé <code>index</code> ÈáåÈù¢Êü•ÊâæÂà∞Âú® <code>Target</code> Âë®Âõ¥ÔºåÁ¨¶ÂêàÊàë‰ª¨Ë¶ÅÊ±ÇÁöÑ spatial objectsÔºåËøôÂ∞±ÊòØ query ‰ª•ÂêéËøîÂõûÁöÑ <code>results</code>„ÄÇ</p>
<p>‰∏ãÈù¢Áúã‰∏ÄÊÆµÁÆÄÂçïÁöÑÊü•ËØ¢‰ª£Á†ÅÔºåÁªôÂÆö Target ÁÇπÔºåÊâæÂà∞Ë∑ùÁ¶ªÂÆÉÊúÄËøëÁöÑËæπÊòØÂì™‰∫õÔºö</p>
<a id="more"></a>

<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"s2/s2closest_edge_query.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gtest/gtest.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"s2/third_party/absl/memory/memory.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"s2/mutable_s2shape_index.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"s2/s1angle.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"s2/s2cap.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"s2/s2cell.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"s2/s2cell_id.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"s2/s2edge_distances.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"s2/s2loop.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"s2/s2metrics.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"s2/s2edge_vector_shape.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"s2/s2point_vector_shape.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"s2/s2polygon.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"s2/s2predicates.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"s2/s2testing.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"s2/s2text_format.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> absl::make_unique;</span><br><span class="line"><span class="keyword">using</span> s2textformat::MakeIndexOrDie;</span><br><span class="line"><span class="keyword">using</span> s2textformat::MakePointOrDie;</span><br><span class="line"><span class="keyword">using</span> s2textformat::MakePolygonOrDie;</span><br><span class="line"><span class="keyword">using</span> s2textformat::ParsePointsOrDie;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">fabs</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::make_pair;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::min;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::ostream;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::pair;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">unique_ptr</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">vector</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> absl::make_unique;</span><br><span class="line"><span class="keyword">using</span> s2textformat::MakeIndexOrDie;</span><br><span class="line"><span class="keyword">using</span> s2textformat::MakePointOrDie;</span><br><span class="line"><span class="keyword">using</span> s2textformat::MakePolygonOrDie;</span><br><span class="line"><span class="keyword">using</span> s2textformat::ParsePointsOrDie;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">fabs</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::make_pair;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::min;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::ostream;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::pair;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">unique_ptr</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">vector</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::numeric_limits;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Tests a target point in the interior of an indexed polygon.</span></span><br><span class="line">  <span class="comment">// (The index also includes a polyline loop with no interior.)</span></span><br><span class="line">  <span class="comment">// ËøôÈáåÂÆö‰πâ‰∫Ü‰∏âÊù°Á∫øÊÆµÔºå(0,0)-(0,5) (5,5)-(5,0)ÔºåÁ¨¨‰∏âÊù°Áî±‰∏â‰∏™Â∞èÊÆµÁªÑÊàêÔºö(0,6)-(0,7)-(0,9)-(0,10)</span></span><br><span class="line">  <span class="keyword">auto</span> index = MakeIndexOrDie(<span class="string">"# 0:0, 0:5 | 5:5, 5:0| 0:6, 0:7, 0:9, 0:10 #"</span>);</span><br><span class="line">  S2ClosestEdgeQuery::Options options;</span><br><span class="line">  <span class="comment">// KNN ÁÆóÊ≥ïÔºåËÆæÁΩÆ K = 2</span></span><br><span class="line">  options.set_max_edges(<span class="number">2</span>);</span><br><span class="line">  <span class="function">S2ClosestEdgeQuery <span class="title">query</span><span class="params">(index.get(), options)</span></span>;</span><br><span class="line">  <span class="comment">// ËÆæÂÆöÊü•ËØ¢ÁöÑÁõÆÊ†áÁÇπ</span></span><br><span class="line">  S2ClosestEdgeQuery::<span class="function">PointTarget <span class="title">target</span><span class="params">(MakePointOrDie(<span class="string">"2:12"</span>))</span></span>;</span><br><span class="line">  <span class="comment">// Êü•ÊâæË∑ùÁ¶ªËØ•ÁÇπÊúÄËøëÁöÑ‰∏§Êù°Á∫øÊÆµ</span></span><br><span class="line">  <span class="keyword">auto</span> results = query.FindClosestEdges(&amp;target);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ÊúÄÁªàËøîÂõûÁªìÊûúÔºå‰∏ÄÂÆöÊòØÂ∞è‰∫éÁ≠â‰∫é 2</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"should be 2:"</span> &lt;&lt; results.size() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="comment">// ÊúÄËøëÁöÑ edge id ÊòØÂì™‰∏™Ôºå‰πüÂ∞±ÊòØ‰∏äÈù¢ÈÄöËøá MakeIndexOrDie ‰∏≠ÁöÑÁ¨¨Âá†‰∏™ edge„ÄÇËøôÈáåÂ∫îËØ•ÊòØÊòØ 2Ôºå‰ª£Ë°®Á¨¨‰∏âÊù°Á∫øÊÆµ</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; results[<span class="number">0</span>].shape_id &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="comment">// Âõ†‰∏∫ÂèØËÉΩ‰∏ÄÊù°Á∫øÊÆµÁî±Â§ö‰∏™Â∞èÊÆµÁªÑÊàêÔºåÊâÄ‰ª•ÂÜçÂÆö‰ΩçÂà∞ÊòØÂì™‰∏™Â∞èÊÆµÔºåËøôÈáåÊòØ2ÔºåË°®Á§∫ÊúÄÂêé‰∏ÄÂ∞èÊÆµ (0,9)-(0,10)</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; results[<span class="number">0</span>].edge_id &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="comment">// ËæìÂá∫ÊúÄËøëÁöÑË∑ùÁ¶ªÂÄº</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; results[<span class="number">0</span>].distance &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ÂèØ‰ª•‰ªé‰∏ãÈù¢ÁöÑÁ§∫‰æãÂõæ‰∏≠ÁúãÂá∫Êù•Ôºö<br><img src="1.png" alt=""></p>
<p>ÂΩìÁÑ∂Ôºås2 ÁöÑËØ•Á±ª‰∏ç‰ªÖ‰ªÖÂè™ËÉΩËÆ°ÁÆóÁÇπÂà∞Âì™Êù°ËæπÊúÄËøëÔºåÊäΩË±°‰∏Ä‰∏ãÂÆÉËÉΩÂ§üÂÆûÁé∞ÁöÑÂäüËÉΩ‰∏∫Ôºö</p>
<ol>
<li>ËÆ°ÁÆóË∑ùÁ¶ªÁªôÂÆö TargetÔºàÂèØ‰ª•ÊòØ pointÔºåedgeÔºåÊàñËÄÖÂ§çÊùÇÁöÑ polygonÔºâÊúÄËøëÁöÑ spatial objects ÔºàËøô‰∫õ object ‰πüÂèØ‰ª•ÊòØ point, edge, polygonÔºâÊòØÂì™‰∫õ„ÄÇ</li>
<li>ÁªôÂÆö‰∏Ä‰∏™ËåÉÂõ¥ rÔºåÊòØÂê¶Âú®Ë∑ùÁ¶ª Target ‰∏∫ r ÁöÑÂë®Âõ¥ÔºåÊúâ spatial object Â≠òÂú®„ÄÇ</li>
</ol>
<p>ÂÖ∑‰ΩìÁöÑ‰æãÂ≠êÂèØ‰ª•Âà∞‰∏ãÈù¢ÂéªÊü•ÈòÖÔºö<br><a href="http://s2geometry.io/devguide/s2closestedgequery" target="_blank" rel="noopener">http://s2geometry.io/devguide/s2closestedgequery</a><br><a href="https://github.com/google/s2geometry/blob/master/src/s2/s2closest_edge_query_test.cc" target="_blank" rel="noopener">https://github.com/google/s2geometry/blob/master/src/s2/s2closest_edge_query_test.cc</a></p>
]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>s2</tag>
      </tags>
  </entry>
  <entry>
    <title>Review:The bright side of sitting in traffic: Crowdsourcing road congestion data</title>
    <url>/blog/Review-The-bright-side-of-sitting-in-traffic-Crowdsourcing-road-congestion-data/</url>
    <content><![CDATA[<p><a href="https://googleblog.blogspot.com/2009/08/bright-side-of-sitting-in-traffic.html" target="_blank" rel="noopener">This blog</a> is written on Aug. 25, 2009, it discusses how to use cell phone GPS signal to identify crowded road in the U.S.</p>
<blockquote>
<p>If you use Google Maps for mobile with GPS enabled on your phone, that‚Äôs exactly what you can do. When you choose to enable Google Maps with My Location, your phone sends anonymous bits of data back to Google describing how fast you‚Äôre moving. When we combine your speed with the speed of other phones on the road, across thousands of phones moving around a city at any given time, we can get a pretty good picture of live traffic conditions. We continuously combine this data and send it back to you for free in the Google Maps <code>traffic layers</code>.</p>
</blockquote>
<p>The more users participant in this process, the more precise the report is. And this system was online to cover all U.S. highways and arterials in that week.</p>
<a id="more"></a>
<p>An issue that is addressed in the blog is <code>privacy</code>. People may not want to share their location and their destination data with others.</p>
<blockquote>
<p>We understand that many people would be concerned about telling the world how fast their car was moving if they also had to tell the world where they were going, so we built privacy protections in from the start. We only use anonymous speed and location information to calculate traffic conditions, and only do so when you have chosen to enable location services on your phone.</p>
</blockquote>
<p>Google solve the <code>privacy</code> issue by using <code>anonymous speed and location</code> information. Also they <code>aggregate</code> the data to make it safer:</p>
<blockquote>
<p>When a lot of people are reporting data from the same area, we <code>combine their data together</code> to make it hard to tell one phone from another.</p>
</blockquote>
<p>Google says they delete the <code>start and end point</code> of every trip. So I guess these data could only be stored in the cell phone temporarily.</p>
<blockquote>
<p>Even though the vehicle carrying a phone is anonymous, we don‚Äôt want anybody to be able to find out where that anonymous vehicle came from or where it went ‚Äî so we find the start and end points of every trip and permanently delete that data so that even Google ceases to have access to it.</p>
</blockquote>
]]></content>
      <categories>
        <category>review</category>
      </categories>
      <tags>
        <tag>google map</tag>
      </tags>
  </entry>
  <entry>
    <title>MongoDB M201 - Query Plan</title>
    <url>/blog/MongoDB-M201-Query-Plan/</url>
    <content><![CDATA[<h1 id="‰ªÄ‰πàÊòØ-Quary-Plan"><a href="#‰ªÄ‰πàÊòØ-Quary-Plan" class="headerlink" title="‰ªÄ‰πàÊòØ Quary Plan"></a>‰ªÄ‰πàÊòØ Quary Plan</h1><p>ÂΩìÂèëËµ∑‰∏Ä‰∏™ query ËØ∑Ê±ÇÊó∂ÔºåÂΩìÊúâÂ§ö‰∏™Á∫¶ÊùüÊù°‰ª∂ÔºåÂ∞±‰ºöÂΩ¢Êàê‰∏Ä‰∏™ query planÔºåÊú¨Ë¥®‰∏äÊòØÊÄé‰πàÊ†∑ÂéªÁªÑÁªá pipeline ÁöÑ stageÔºå‰ΩøÂæó query Êõ¥ÊúâÊïàÁéá„ÄÇ</p>
<p>ÊØîÂ¶ÇÊúâ‰∏ãÈù¢ÁöÑ‰∏Ä‰∏™ query ËØ∑Ê±ÇÔºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// ÊâæÂá∫ zip code Â§ß‰∫é 50000ÔºåÂπ∂‰∏î`cuisine` field ÂåÖÂê´ `Sushi`ÁöÑ documents `stars` ÈôçÂ∫èÊéíÂ∫è</span><br><span class="line">db.restaurants.find(&#123;<span class="string">"address.zipcode"</span>: &#123;<span class="variable">$gt</span>:<span class="string">'50000'</span>&#125;, cuisine: <span class="string">'Sushi'</span>&#125;).sort(&#123;<span class="string">"stars"</span>: -1&#125;)</span><br></pre></td></tr></table></figure>

<p>ÈÇ£‰πàÊàë‰ª¨Â∫îËØ•ÊÄéÊ†∑ÁªÑÁªá query ËøáÁ®ãÂë¢ÔºüÊòØÂÖàÊâæÂà∞ documents ÁÑ∂ÂêéÊéíÂ∫èÔºåËøòÊòØÂÖàÊéíÂ∫èÔºåÁÑ∂ÂêéÂÜçÊâæ documentÔºü</p>
<p>‰ΩøÁî®‰ªÄ‰πàÊ†∑ÁöÑ query plan ÊòØË∑üÊàë‰ª¨Âª∫Á´ãÁöÑ index Áõ∏ÂÖ≥ÁöÑ„ÄÇ‰ΩøÁî®‰∏çÂêåÁöÑ indexÔºåÂàô‰ºöÂæóÂà∞‰∏çÂêåÁöÑ query plan„ÄÇ</p>
<p>ÊØîÂ¶ÇÂΩìindexÂàÜÂà´‰∏∫Â¶Ç‰∏ã‰∏§‰∏™Êó∂ÂÄôÔºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;address.zipcode: 1, cuisine: 1&#125;</span><br><span class="line">&#123;cuisine: 1, stars: 1&#125;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>1)ÁöÑ index ‰∏ãÔºåquery plan ÊòØÔºöIXSCAN -„ÄãFETCH -„ÄãSORT<br>2)ÁöÑ index ‰∏ãÔºåquery plan ÊòØÔºöIXSCAN -„ÄãFETCH„ÄÇÂõ†‰∏∫Â∑≤ÁªèÊåâÁÖß stars ÂçáÂ∫èÊéíÂ∫è‰∫ÜÔºåMongoDB ‰ºöÂèçÂêëscanÔºåÂæóÂà∞ stars ÈôçÂ∫èÁöÑÁªìÊûú„ÄÇËäÇÁúÅ‰∫Ü‰∏ÄÊ¨° sort ËøáÁ®ã„ÄÇ</p>
<h1 id="ÊÄéÊ†∑ÈÄâÊã©-Query-Plan"><a href="#ÊÄéÊ†∑ÈÄâÊã©-Query-Plan" class="headerlink" title="ÊÄéÊ†∑ÈÄâÊã© Query Plan"></a>ÊÄéÊ†∑ÈÄâÊã© Query Plan</h1><p>ËøòÊòØ‰∏äÈù¢ÁöÑ query ËØ∑Ê±ÇÔºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">db.restaurants.find(&#123;<span class="string">"address.zipcode"</span>: &#123;<span class="variable">$gt</span>:<span class="string">'50000'</span>&#125;, cuisine: <span class="string">'Sushi'</span>&#125;).sort(&#123;<span class="string">"stars"</span>: -1&#125;)</span><br></pre></td></tr></table></figure>

<p>‰ΩÜÊòØÂΩìÂêåÊó∂Â≠òÂú®Â§ö‰∏™ indexÔºåÂ¶Ç‰∏ãÔºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;_id: 1&#125;</span><br><span class="line">&#123;name: 1, cuisine: 1, stars: 1&#125;</span><br><span class="line">&#123;<span class="string">"address.zipcode"</span>: 1, cuisine: 1&#125;</span><br><span class="line">&#123;<span class="string">"address.zipcode"</span>: 1, stars: 1&#125;</span><br><span class="line">&#123;cuisine: 1, stars: 1&#125;</span><br></pre></td></tr></table></figure>

<p>ÈÇ£‰πà query plan Â∫îËØ•ÊÄé‰πàÂÆâÊéíÊâçËÉΩÂ§üÊõ¥ÊúâÊïàÂà©Áî®Ëøô‰∫õ indexÔºåÊòØÁöÑ query ÁöÑËÄóÊó∂Êõ¥Áü≠Âë¢Ôºü</p>
<p><code>Á¨¨‰∏ÄÊ¨°Ë∞ÉÁî®</code> ËØ• query Êó∂ÂÄôÔºåMongoDB È¶ñÂÖà‰ºöÊâ´ÊèèÂ∑≤ÊúâÁöÑ indexÔºåÂπ∂‰ªé‰∏≠ÊâæÂá∫ËÉΩÂ§üÂà©Áî®ÁöÑ indexÔºàwhich indexes are viable to satisfy the queryÔºâÔºå‰Ωú‰∏∫ <code>candidate indexes</code>„ÄÇÂú®ËøôÈáåÔºåcandidate index ÊòØËøôÂá†‰∏™Ôºö</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line">    &#123;_id: 1&#125;</span><br><span class="line">    &#123;name: 1, cuisine: 1, stars: 1&#125;</span><br><span class="line"><span class="addition">+   &#123;"address.zipcode": 1, cuisine: 1&#125;</span></span><br><span class="line"><span class="addition">+   &#123;"address.zipcode": 1, stars: 1&#125;</span></span><br><span class="line"><span class="addition">+   &#123;cuisine: 1, stars: 1&#125;</span></span><br></pre></td></tr></table></figure>

<p>ÁÑ∂ÂêéÊ†πÊçÆ <code>candidate indexed</code>Ôºå MongoDB ÁöÑ <code>query optimizer</code> ‰ºöÁîüÊàê <code>candidate plans</code>„ÄÇÂêåÊó∂ÔºåMongoDB Êúâ‰∏Ä‰∏™ <code>empirical query planer</code>ÔºåÂÆÉ‰ºöÂØπÊØè‰∏™ candidate planÔºåËøêË°å‰∏ÄÂ∞èÊÆµÊó∂Èó¥Ôºàtrial runÔºâÔºåÁÑ∂Âêé‰ªéËøô‰∫õÊµãËØï‰∏≠ÔºåÊâæÂá∫ performance ÊúÄÂ•ΩÁöÑ‰∏Ä‰∏™„ÄÇ</p>
<p>ÂØπÊú¨ query ËÄåË®ÄÔºåÊúÄÂ•ΩÁöÑ plan Â¶Ç‰∏ãÔºö<br><img src="1.png" alt=""></p>
<p>‰πãÂêéÔºåMongoDB ‰ºö <code>cache</code> ËØ• query ‰∏ãÁöÑ best planÔºåÊàë‰ª¨ÊääËøô‰∏™ cache Áß∞‰∏∫ <code>plan cache</code>„ÄÇ<br>Êàë‰ª¨ÂΩ¢ÂÆπÁõ∏ÂêåÁöÑ query ÂÖ∑ÊúâÁõ∏ÂêåÁöÑ <code>query shape</code>„ÄÇÈÇ£‰πà‰∏ãÊ¨°ÔºåÂÖ∑ÊúâÁõ∏ÂêåÁöÑ query shape ÁöÑ query ËøõÊù•‰ª•ÂêéÔºåÂ∞±‰ºöÁõ¥Êé•‰ªé <code>plan cache</code> ÈáåÈù¢Ë∞ÉÁî®ÂØπÂ∫îÁöÑ query plan„ÄÇ</p>
<h1 id="Evict-a-plan"><a href="#Evict-a-plan" class="headerlink" title="Evict a plan"></a>Evict a plan</h1><p>ÈöèÁùÄÊó∂Èó¥ÔºåÊï∞ÊçÆÂ∫ìÁöÑ collection Êï∞ÊçÆ‰ºöÂèëÁîüÂèòÂåñÔºåindex ‰πüÊòØÂ¶ÇÊ≠§„ÄÇÊâÄ‰ª•ÊúâÊó∂ÂÄôÔºåplan cache ÈúÄË¶ÅÂâîÈô§Êüê‰∫õ query planÔºåËøô‰∏™ËøáÁ®ãÂè´ÂÅö <code>evict</code>„ÄÇ<br>‰∏ãÈù¢Ëøô‰∫õÊÉÖÂÜµ‰∏ãÔºå‰ºö evictÔºö<br><img src="2.png" alt=""></p>
<ul>
<li>Server restart</li>
<li>Rebuild index</li>
<li>Create/Drop indexes</li>
</ul>
]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title>MongoDB M201 - Building Indexes </title>
    <url>/blog/MongoDB-M201-Building-Indexes/</url>
    <content><![CDATA[<h1 id="Building-Indexes"><a href="#Building-Indexes" class="headerlink" title="Building Indexes"></a>Building Indexes</h1><p>‰∏§ÁßçÊñπÂºèÔºö</p>
<ul>
<li>forground indexes: Âª∫Á´ãÊó∂ÂÄô‰ºö block user inputÔºåÂØºËá¥ËøôÊÆµÊó∂Èó¥ DB ‰∏çÂèØÁî®„ÄÇËøôÂú®‰∫ßÂìÅ‰∏≠‰∏çÂèØÊé•Âèó„ÄÇ</li>
<li>background indexes: ÂêéÂè∞Âª∫Á´ã indexÔºå‰∏ç‰ºö block operationÔºå‰ª£‰ª∑ÊòØbuild ÁöÑÊó∂Èó¥Êõ¥Èïø„ÄÇ<a id="more"></a>

</li>
</ul>
<h1 id="ÂØºÂÖ•Êï∞ÊçÆ"><a href="#ÂØºÂÖ•Êï∞ÊçÆ" class="headerlink" title="ÂØºÂÖ•Êï∞ÊçÆ"></a>ÂØºÂÖ•Êï∞ÊçÆ</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mongoimport -d m201 -c restaurants --drop restaurants.json</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mac@macs-MacBook ÓÇ∞ ~/Desktop ÓÇ∞ mongoimport -d m201 -c restaurants --drop restaurants.json</span><br><span class="line">2018-03-01T14:45:48.743-0600	connected to: localhost</span><br><span class="line">2018-03-01T14:45:48.745-0600	dropping: m201.restaurants</span><br><span class="line">2018-03-01T14:45:51.732-0600	[<span class="comment">######..................] m201.restaurants	40.0MB/144MB (27.9%)</span></span><br><span class="line">2018-03-01T14:45:54.731-0600	[<span class="comment">#############...........] m201.restaurants	78.9MB/144MB (54.9%)</span></span><br><span class="line">2018-03-01T14:45:57.731-0600	[<span class="comment">###################.....] m201.restaurants	115MB/144MB (80.1%)</span></span><br><span class="line">2018-03-01T14:45:59.862-0600	[<span class="comment">########################] m201.restaurants	144MB/144MB (100.0%)</span></span><br><span class="line">2018-03-01T14:45:59.862-0600	imported 1000000 documents</span><br></pre></td></tr></table></figure>

<h1 id="Build-background-index"><a href="#Build-background-index" class="headerlink" title="Build background index"></a>Build background index</h1><p>ÈªòËÆ§Âª∫Á´ãÁöÑ index ÈÉΩÊòØ forground ÁöÑÔºåÊâÄ‰ª•‰∏∫‰∫Ü‰∏ç block operationÔºåËøôÈáå‰ΩøÁî® mongo shell ÂàõÂª∫ indexÔºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">db.restaurants.createIndex(&#123;<span class="string">"cuisine"</span>:1,<span class="string">"name"</span>:1,<span class="string">"address.zipcode"</span>:1&#125;,&#123;<span class="string">"background"</span>:<span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure>

<p>Ëøô‰∏™Âª∫Á´ãËøáÁ®ãËôΩÁÑ∂‰∏ç‰ºö block db operationÔºå‰ΩÜÊòØ‰ºö block ÂΩìÂâçÁöÑ mongo shell„ÄÇÊàë‰ª¨ÂèØ‰ª•ÊâìÂºÄÂè¶‰∏Ä‰∏™ mongo shell ‰ΩøÁî® <code>db.currentOp()</code> ÂéªÊü•ÁúãÂΩìÂâçÁä∂ÊÄÅ„ÄÇ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="string">"opid"</span> : 2381,</span><br><span class="line"><span class="string">"secs_running"</span> : NumberLong(2),</span><br><span class="line"><span class="string">"microsecs_running"</span> : NumberLong(2389863),</span><br><span class="line"><span class="string">"op"</span> : <span class="string">"command"</span>,</span><br><span class="line"><span class="string">"ns"</span> : <span class="string">"m201.<span class="variable">$cmd</span>"</span>,</span><br><span class="line"><span class="string">"command"</span> : &#123;</span><br><span class="line">	<span class="string">"createIndexes"</span> : <span class="string">"restaurants"</span>,</span><br><span class="line">	<span class="string">"indexes"</span> : [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">"key"</span> : &#123;</span><br><span class="line">				<span class="string">"cuisine"</span> : 1,</span><br><span class="line">				<span class="string">"name"</span> : 1,</span><br><span class="line">				<span class="string">"address.zipcode"</span> : 1</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">"name"</span> : <span class="string">"cuisine_1_name_1_address.zipcode_1"</span>,</span><br><span class="line">			<span class="string">"background"</span> : <span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">"<span class="variable">$db</span>"</span> : <span class="string">"m201"</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">"msg"</span> : <span class="string">"Index Build (background) Index Build (background): 280957/1000000 28%"</span>,</span><br><span class="line"><span class="string">"progress"</span> : &#123;</span><br><span class="line">	<span class="string">"done"</span> : 280958,</span><br><span class="line">	<span class="string">"total"</span> : 1000000</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>ÂèØ‰ª•ÁúãÂà∞ÂΩìÂâçÁä∂ÊÄÅÊòØ db Ê≠£Âú® background ÁöÑÊñπÂºèÂª∫Á´ã indexÔºåËøõË°å‰∫Ü 28%„ÄÇ<br>ËÆ∞‰Ωè opidÔºåÊàë‰ª¨ÂèØ‰ª•‰ΩøÁî® <code>db.killOp(opid)</code> ÂëΩ‰ª§Êù• kill operation before it finish„ÄÇ</p>
<p>index Âª∫Á´ãÁªìÊùü‰ª•ÂêéÁöÑÁä∂ÊÄÅÂ¶Ç‰∏ãÔºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">db.restaurants.createIndex(&#123;<span class="string">"cuisine"</span>:1,<span class="string">"name"</span>:1,<span class="string">"address.zipcode"</span>:1&#125;,&#123;<span class="string">"background"</span>:<span class="literal">true</span>&#125;)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"createdCollectionAutomatically"</span> : <span class="literal">false</span>,</span><br><span class="line">	<span class="string">"numIndexesBefore"</span> : 1,</span><br><span class="line">	<span class="string">"numIndexesAfter"</span> : 2,</span><br><span class="line">	<span class="string">"ok"</span> : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title>MongoDB in Python</title>
    <url>/blog/MongoDB-in-Python/</url>
    <content><![CDATA[<h1 id="ÂØºÂÖ•Êï∞ÊçÆ"><a href="#ÂØºÂÖ•Êï∞ÊçÆ" class="headerlink" title="ÂØºÂÖ•Êï∞ÊçÆ"></a>ÂØºÂÖ•Êï∞ÊçÆ</h1><h2 id="ÂØºÂÖ•‰∏Ä‰∏™-collection"><a href="#ÂØºÂÖ•‰∏Ä‰∏™-collection" class="headerlink" title="ÂØºÂÖ•‰∏Ä‰∏™ collection"></a>ÂØºÂÖ•‰∏Ä‰∏™ collection</h2><p><a href="https://s3.amazonaws.com/edu-static.mongodb.com/lessons/coursera/building-an-app/getting-data-into-mongodb/movies_initial.csv" target="_blank" rel="noopener">https://s3.amazonaws.com/edu-static.mongodb.com/lessons/coursera/building-an-app/getting-data-into-mongodb/movies_initial.csv</a></p>
<p>after create MongoDB Altas cluster, import movies_initial.csv file to the cluster.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mongoimport --<span class="built_in">type</span> csv --headerline --db mflix --c movies_initial --host <span class="string">"mflix-shard-00-00-1cvum.mongodb.net:27017,mflix-shard-00-01-1cvum.mongodb.net:27017,mflix-shard-00-02-1cvum.mongodb.net:27017"</span>--authenticationDatabase admin --ssl --username hansonzhao007 --password Zxsh3017568 --file movies_initial.csv</span><br></pre></td></tr></table></figure>

<a id="more"></a>
<h1 id="ÂØºÂÖ•ÊâÄÊúâ-collection"><a href="#ÂØºÂÖ•ÊâÄÊúâ-collection" class="headerlink" title="ÂØºÂÖ•ÊâÄÊúâ collection"></a>ÂØºÂÖ•ÊâÄÊúâ collection</h1><p>È¶ñÂÖà‰ªéËøôÈáå <a href="https://s3.amazonaws.com/edu-static.mongodb.com/lessons/coursera/building-an-app/mflix.zip" target="_blank" rel="noopener">https://s3.amazonaws.com/edu-static.mongodb.com/lessons/coursera/building-an-app/mflix.zip</a> ‰∏ãËΩΩÂéãÁº©Êñá‰ª∂Âπ∂Ëß£Âéã„ÄÇ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ËøõÂÖ•mflixÊñá‰ª∂Â§πÔºåÂπ∂ÂÆâË£Ö‰æùËµñÁéØÂ¢É</span></span><br><span class="line">pip3 install -r requirements.txt</span><br></pre></td></tr></table></figure>

<p>After installing all the dependencies you can import the data required by mflix into your MongoDB Atlas cluster.<br>To import this data you‚Äôll first need to paste your connection URI (from the Atlas UI) into env.sh (or env.bat on Windows).<br>After you‚Äôve update env.sh (or env.bat on Windows) with your Atlas connection URI you can run init.sh (or init.bat on Windows) to import all the required data:<br>On Windows your env.bat should look like this:<br><img src="1.png" alt=""></p>
<p>ÂØºÂÖ•ËøáÁ®ãÂ¶Ç‰∏ãÔºö<br><img src="2.png" alt=""></p>
<p>ÊúÄÁªàÊï∞ÊçÆÂ¶Ç‰∏ãÔºö<br><img src="3.png" alt=""></p>
<h1 id="ÁéØÂ¢ÉÈÖçÁΩÆ"><a href="#ÁéØÂ¢ÉÈÖçÁΩÆ" class="headerlink" title="ÁéØÂ¢ÉÈÖçÁΩÆ"></a>ÁéØÂ¢ÉÈÖçÁΩÆ</h1><p>Èô§‰∫ÜÂÆâË£Ö MongoDB ÔºåË¶Å‰ΩøÁî® python Êù•Êìç‰Ωú mongoDBÔºåÈúÄË¶Å‰ΩøÁî® PyMongo plugin„ÄÇÂÆâË£ÖËøáÁ®ãËßÅ<a href="https://api.mongodb.com/python/current/installation.html" target="_blank" rel="noopener">ËøôÈáå</a>„ÄÇ</p>
<h1 id="ÈìæÊé•-MongoDB-atlas"><a href="#ÈìæÊé•-MongoDB-atlas" class="headerlink" title="ÈìæÊé• MongoDB atlas"></a>ÈìæÊé• MongoDB atlas</h1><p>Âõ†‰∏∫ÂàõÂª∫ÁöÑ atlas cluster ÊòØÂü∫‰∫é mongoDB 3.4 ÁöÑÔºåÊâÄ‰ª•ÈìæÊé•ÁöÑ URI Â¶Ç‰∏ãÔºö<br><img src="4.png" alt=""></p>
<p>ÁÑ∂Âêé‰ΩøÁî®Â¶Ç‰∏ã code ÊµãËØïÈìæÊé•ÊïàÊûúÔºö<br><img src="5.png" alt=""></p>
<p>ÂèØ‰ª•ÁúãÂà∞Ê≤°Êúâ error ËæìÂá∫ÔºåË°®Á§∫ÈìæÊé•ÊàêÂäü„ÄÇ</p>
<h1 id="MongoDB-aggregation"><a href="#MongoDB-aggregation" class="headerlink" title="MongoDB aggregation"></a>MongoDB aggregation</h1><p>‰∏ãÈù¢ÊµãËØï mongodb ÁöÑ pipeline stage„ÄÇÂú®ËøûÊé• mongodb cluster ‰ª•ÂêéÔºö</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> clear_output</span><br><span class="line"><span class="comment"># ËøôÈáåÊòØ MongoDB pipeline stage ÁöÑËØ≠Ê≥ïÂÜôÊ≥ï„ÄÇ</span></span><br><span class="line">pipeline = [</span><br><span class="line">¬†¬†¬†¬†<span class="comment"># group stage</span></span><br><span class="line">¬†¬†¬†¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="string">'$group'</span>:&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="string">'_id'</span>:&#123;<span class="string">"language"</span>:<span class="string">"$language"</span>&#125;,</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="string">'count'</span>:&#123;<span class="string">'$sum'</span>:<span class="number">1</span>&#125;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†&#125;,</span><br><span class="line">¬†¬†¬†¬†<span class="comment"># sort stage</span></span><br><span class="line">¬†¬†¬†¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="string">'$sort'</span>:&#123;<span class="string">'count'</span>:<span class="number">-1</span>&#125;</span><br><span class="line">¬†¬†¬†¬†&#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment"># ‰∏äÈù¢Á≠âÂêå‰∫éËøôÈáåÔºö‰ΩúÁî®ÊòØÊ†πÊçÆ language ËÅöÁ±ªÔºåÁªüËÆ°Êï∞ÈáèÔºåÂπ∂ÊåâÁÖßÁî±Â§öÂà∞Â∞ëÁöÑÈ°∫Â∫èÊéíÂàó</span></span><br><span class="line"><span class="comment"># pipeline = [</span></span><br><span class="line"><span class="comment">#¬†¬†¬†¬† &#123;</span></span><br><span class="line"><span class="comment">#¬†¬†¬†¬†¬†¬†¬†¬† '$sortByCount': "$language"</span></span><br><span class="line"><span class="comment">#¬†¬†¬†¬† &#125;</span></span><br><span class="line"><span class="comment"># ]</span></span><br><span class="line">pprint.pprint(list(client.mflix.movies_initial.aggregate(pipeline)))</span><br></pre></td></tr></table></figure>

<h1 id="Facet"><a href="#Facet" class="headerlink" title="Facet"></a>Facet</h1><p>ËøôÈáåfacet ÁöÑ‰ΩúÁî®ÊòØÊé•Âèó‰∏ä‰∏Ä‰∏™ stage ÁöÑËæìÂÖ•ÔºåÂ∞ÜÂΩìÂâç stage ÊãÜÂàÜÊàêÂπ∂ÂàóÁöÑ pipelineÔºåËæìÂá∫Â§ö‰∏™ÁªìÊûú„ÄÇ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pipeline = [</span><br><span class="line">¬†¬†¬†¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="string">'$sortByCount'</span>:<span class="string">'$language'</span></span><br><span class="line">¬†¬†¬†¬†&#125;,</span><br><span class="line">¬†¬†¬†¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="string">'$facet'</span>:&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="string">'top language combination'</span>:[&#123;<span class="string">'$limit'</span>:<span class="number">100</span>&#125;],</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="string">'unusual combinations shared by'</span>:[</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="string">'$skip'</span>:<span class="number">100</span></span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&#125;,</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="string">'$bucketAuto'</span>:&#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="string">'groupBy'</span>: <span class="string">'$count'</span>,</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="string">'buckets'</span>: <span class="number">5</span>,</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="string">'output'</span>: &#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†<span class="string">'language combinations'</span>:&#123;<span class="string">'$sum'</span>:<span class="number">1</span>&#125;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†]</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†¬†¬†&#125;</span><br><span class="line">]</span><br><span class="line">pprint.pprint(list(client.mflix.movies_initial.aggregate(pipeline)))</span><br></pre></td></tr></table></figure>
<p><img src="6.png" alt=""></p>
<h1 id="Filter-on-Scalar-Field"><a href="#Filter-on-Scalar-Field" class="headerlink" title="Filter on Scalar Field"></a>Filter on Scalar Field</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">filter = &#123;<span class="string">'language'</span>:<span class="string">'Korean, English'</span>&#125;</span><br><span class="line">projection = &#123;<span class="string">'language'</span>:<span class="number">1</span>,<span class="string">'title'</span>:<span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line">pprint.pprint(list(client.mflix.movies_initial.find(filter,projection)))</span><br></pre></td></tr></table></figure>

<h1 id="Geospatial-queries"><a href="#Geospatial-queries" class="headerlink" title="Geospatial queries"></a>Geospatial queries</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line"><span class="comment"># Replace XXXX with your connection URI from the Atlas UI</span></span><br><span class="line">course_cluster_uri = <span class="string">"mongodb://hansonzhao007:&lt;PASSWORD&gt;@mflix-shard-00-00-1cvum.mongodb.net:27017,mflix-shard-00-01-1cvum.mongodb.net:27017,mflix-shard-00-02-1cvum.mongodb.net:27017/test?ssl=true&amp;replicaSet=mflix-shard-0&amp;authSource=admin"</span></span><br><span class="line"></span><br><span class="line">course_client = pymongo.MongoClient(course_cluster_uri)</span><br><span class="line">theaters = course_client[<span class="string">'mflix'</span>][<span class="string">'theaters'</span>]</span><br><span class="line"></span><br><span class="line">theater = theaters.find_one(&#123;&#125;)</span><br><span class="line"></span><br><span class="line">pprint.pprint(theater)</span><br><span class="line"></span><br><span class="line">pprint.pprint(theater[<span class="string">'location'</span>][<span class="string">'geo'</span>])</span><br><span class="line"></span><br><span class="line">EARTH_RADIUS_MILES = <span class="number">3963.2</span></span><br><span class="line">EARTH_RADIUS_KILOMETERS = <span class="number">6378.1</span></span><br><span class="line">example_radius = <span class="number">0.1747728893434987</span></span><br><span class="line"></span><br><span class="line">radius_in_miles = example_radius * EARTH_RADIUS_MILES</span><br><span class="line"></span><br><span class="line">print(radius_in_miles)</span><br><span class="line"></span><br><span class="line">query = &#123;</span><br><span class="line">¬†¬†<span class="string">"location.geo"</span>: &#123;</span><br><span class="line">¬†¬†¬†¬†<span class="string">"$nearSphere"</span>: &#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="string">"$geometry"</span>: &#123;</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="string">"type"</span>: <span class="string">"Point"</span>,</span><br><span class="line">¬†¬†¬†¬†¬†¬†¬†¬†<span class="string">"coordinates"</span>: [<span class="number">-73.9899604</span>, <span class="number">40.7575067</span>]</span><br><span class="line">¬†¬†¬†¬†¬†¬†&#125;,</span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="string">"$minDistance"</span>: <span class="number">0</span>,</span><br><span class="line">¬†¬†¬†¬†¬†¬†<span class="string">"$maxDistance"</span>: <span class="number">10000</span></span><br><span class="line">¬†¬†¬†¬†&#125;</span><br><span class="line">¬†¬†&#125;</span><br><span class="line">&#125;</span><br><span class="line">projection = &#123;<span class="string">"location.address"</span>:<span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> theater <span class="keyword">in</span> theaters.find(query,projection).limit(<span class="number">5</span>):</span><br><span class="line">¬†¬†¬†¬†pprint.pprint(theater)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title>MongoDB M201 - Sorting with indexes</title>
    <url>/blog/MongoDB-M201-Sorting-with-indexes/</url>
    <content><![CDATA[<p>‰ªª‰Ωï‰∏ÄÊ¨° query ÁöÑÁªìÊûúÈÉΩÂèØ‰ª•Ë¢´ÊéíÂ∫èÔºåÂ¶Ç‰∏ãÔºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">exp.find(&#123;first_name:<span class="string">"James"</span>&#125;).sort(&#123;first_name:1&#125;)</span><br></pre></td></tr></table></figure>

<p>Êúâ‰∏§ÁßçÊéíÂ∫èÊñπÂºèÔºö<br>    1. ‰ªé disk ÈáåÈù¢ËØªÂèñ documentsÔºåÁÑ∂ÂêéÂÅö in memory ÊéíÂ∫è„ÄÇ<br>    2. Ê†πÊçÆ field ÁîüÊàê indexÔºåindex ÊòØÊéíÂ∫èÁöÑ„ÄÇ</p>
<p>ÂΩìÊàë‰ª¨ÂØπÊ≤°ÊúâÂª∫Á´ã index ÁöÑ field query ÂêéÔºà‰ª•‰∏äÈù¢ÁöÑfirst_name Êü•ÊâæÊéíÂ∫è‰∏∫‰æãÔºâËøõË°åÊéíÂ∫è„ÄÇmongoDB ‰ºöÈ¶ñÂÖà‰ªé collection ÈáåÈù¢ÈÅçÂéÜÔºåÂÆåÊàê query Êìç‰ΩúÔºåËøô‰ºö touch Âà∞ÊâÄÊúâÁöÑ documents„ÄÇÁÑ∂Âêé filter ‰ª•ÂêéÁöÑÁªìÊûúÔºåÂú® memory ‰∏≠ËøõË°åÊéíÂ∫è„ÄÇÂ¶ÇÊûú query ÂæóÂà∞ documents ÂæàÂ§öÔºåÈÇ£‰πàËØ•ËøáÁ®ã‰ºöÂæàË¥πÊó∂(mongoDB ‰ºöÈÅøÂÖçË∂ÖËøá 32MB ÁöÑ in memory ÊéíÂ∫è)„ÄÇ</p>
<a id="more"></a>
<h1 id="Compound-index-sorting"><a href="#Compound-index-sorting" class="headerlink" title="Compound index sorting"></a>Compound index sorting</h1><p>index prefix: ÂΩì‰ΩøÁî® compound index ÁöÑÊó∂ÂÄôÔºåÂ¶ÇÊûú query ÁöÑ field ÁªÑÊàê‰∫Ü‰∏Ä‰∏™ compound index ÁöÑ prefixÔºåÈÇ£‰πàÂ∞±ÂèØ‰ª•Âà©Áî® index ËæìÂá∫ sorting ÁöÑÁªìÊûú„ÄÇ</p>
<p><img src="1.png" alt=""><br>Âõ†‰∏∫ÈÄâ‰∏≠ÁöÑ‰∏âÈ°πÈÉΩÂèØ‰ª•ÊûÑÊàê compound index ÁöÑ prefixÔºåÊâÄ‰ª•ÂèØ‰ª•Áî®Êù•ÂêåÊó∂ÂÅö filter Âíå sorting„ÄÇ</p>
<ul>
<li>Á¨¨‰∏ÄÈ°π‰∏çÊòØ prefixÔºåÂè™ÊòØ‰∏≠Èó¥ÁöÑÊüê‰∏™Â≠êÈõÜÔºåÊâÄ‰ª•‰∏çË°å„ÄÇ</li>
<li>Á¨¨ÂõõÈ°πÂõ†‰∏∫Ë∑≥Ëøá‰∫Ü address.state ÔºåÊâÄ‰ª•‰πü‰∏çÊòØÂ≠êÈõÜÔºåÁî®‰∏ç‰∫Ü compound index Âéª filter Âíå sorting„ÄÇÂè™ËÉΩÂÅö memory sorting„ÄÇ</li>
</ul>
]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title>MongoDB M201 - Single Field Indexes </title>
    <url>/blog/MongoDB-M201-Single-Field-Indexes/</url>
    <content><![CDATA[<h1 id="ÂØºÂÖ•Êï∞ÊçÆ"><a href="#ÂØºÂÖ•Êï∞ÊçÆ" class="headerlink" title="ÂØºÂÖ•Êï∞ÊçÆ"></a>ÂØºÂÖ•Êï∞ÊçÆ</h1><p>È¶ñÂÖàÂà∞ <a href="https://s3.amazonaws.com/m312/people.json" target="_blank" rel="noopener">https://s3.amazonaws.com/m312/people.json</a> ‰∏ãËΩΩÊï∞ÊçÆ„ÄÇÁÑ∂ÂêéÂØºÂÖ•Êú¨Âú∞ MongoDB Êï∞ÊçÆÂ∫ìÈáå„ÄÇ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mongoimport -d m201 -c people --drop people.json</span><br></pre></td></tr></table></figure>
<p>MongoDB ÂêØÂä®‰ª•ÂêéÔºàÂç≥ mongod ËøêË°åÔºâÔºå‰ΩøÁî® MongoDB compass ÈìæÊé•Êú¨Âú∞Êï∞ÊçÆÂ∫ìÔºåÊü•ÁúãÔºö<br><img src="1.png" alt=""></p>
<a id="more"></a>
<p>ÁÑ∂ÂêéÂèØ‰ª•ËøõÂÖ• mongo shell ‰ΩøÁî®Â¶Ç‰∏ãÂëΩ‰ª§Êü•Áúã m201 ÁöÑÊï∞ÊçÆ„ÄÇ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">db.people.count(&#123; <span class="string">"email"</span> : &#123;<span class="string">"<span class="variable">$exists</span>"</span>: 1&#125; &#125;)</span><br></pre></td></tr></table></figure>

<h1 id="Êü•ËØ¢ÂàÜÊûê"><a href="#Êü•ËØ¢ÂàÜÊûê" class="headerlink" title="Êü•ËØ¢ÂàÜÊûê"></a>Êü•ËØ¢ÂàÜÊûê</h1><p>È¶ñÂÖà Âú® mongo shell ‰∏≠‰ΩøÁî®‰∏ÄÊù°Êü•ËØ¢ÂëΩ‰ª§Ôºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">db.people.find(&#123;<span class="string">"ssn"</span>:<span class="string">"720-38-5636"</span>&#125;).explain(<span class="string">"executionStats"</span>)</span><br></pre></td></tr></table></figure>
<p>ËøôÈáå explain ÊòØÁî®‰∫éÊòæÁ§∫Êü•ËØ¢ÁöÑËøáÁ®ãÁöÑÔºå‰πüÂèØ‰ª•‰ΩøÁî® compass ÁöÑ explain Á™óÂè£ÊòæÁ§∫Ôºö<br><img src="2.png" alt=""></p>
<p>ÂèØ‰ª•ÁúãÂà∞ËøôÊ¨°Êü•ËØ¢ËÄóË¥π 21ms„ÄÇ‰∏∫‰∫ÜËøîÂõû‰∏Ä‰∏™ÁªìÊûúÔºåÊ£ÄÊü•‰∫ÜÊâÄÊúâÁöÑ document„ÄÇÊïàÁéáÂæà‰Ωé„ÄÇ</p>
<h1 id="ÂàõÂª∫-index"><a href="#ÂàõÂª∫-index" class="headerlink" title="ÂàõÂª∫ index"></a>ÂàõÂª∫ index</h1><p>‰ΩøÁî®ÂëΩ‰ª§Ôºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">db.people.createIndex(&#123;ssn:1&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="3.png" alt=""></p>
<p>ÂèØ‰ª•ÁúãÂà∞ index ÂàõÂª∫ÊàêÂäü„ÄÇ‰∏ãÈù¢ÈáçÊñ∞ÈáçÂ§ç‰∏äÊ¨°ÁöÑÊü•ËØ¢„ÄÇ<br><img src="4.png" alt=""></p>
<p>ÂèØ‰ª•ÁúãÂà∞Âõ†‰∏∫ index ÁöÑÂä†ÈÄüÔºåÂè™ touch ‰∫Ü‰∏Ä‰∏™ documentÔºåÂπ∂‰∏îÊü•ËØ¢Êó∂Èó¥‰∏∫ 0ms„ÄÇ</p>
<p>Êàë‰ª¨ÂèØ‰ª•ÂàõÂª∫‰∏Ä‰∏™ explain ÁöÑÊü•ËØ¢Âô®Ôºå‰ª•Êñπ‰æøËßÇÂØüÂë¢ÊØèÊ¨° query ÁöÑËøáÁ®ãÔºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">exp = db.people.explain(<span class="string">"executionStats"</span>)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title>MongoDB M201 - How Data is stored on disk</title>
    <url>/blog/M201-How-Data-is-stored-on-disk/</url>
    <content><![CDATA[<h1 id="ÈÖçÁΩÆÊú¨Âú∞ÁéØÂ¢É"><a href="#ÈÖçÁΩÆÊú¨Âú∞ÁéØÂ¢É" class="headerlink" title="ÈÖçÁΩÆÊú¨Âú∞ÁéØÂ¢É"></a>ÈÖçÁΩÆÊú¨Âú∞ÁéØÂ¢É</h1><p>ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåMongoDB Êï∞ÊçÆÂ∫ìÁõÆÂΩïÁöÑÁªÑÁªáÁªìÊûÑÂ¶Ç‰∏ãÔºö<br><img src="1.png" alt=""></p>
<ul>
<li>collection-*.wt: Êï∞ÊçÆÂ∫ìÁöÑ collection Êñá‰ª∂</li>
<li>index-*.wt: Êï∞ÊçÆÂ∫ìÂª∫Á´ãÁöÑ index Êñá‰ª∂</li>
</ul>
<p><img src="2.png" alt=""></p>
<a id="more"></a>
<p>Áé∞Âú®ÁöÑÊï∞ÊçÆÂ∫ìÁªÑÁªáÂΩ¢ÂºèËøòÊòØ flat ÁöÑÔºå‰πüÂ∞±ÊòØÊâÄÊúâÊï∞ÊçÆÂ∫ì collection Â≠òÂÇ®Âú®‰∏Ä‰∏™ÁõÆÂΩï‰∏ã„ÄÇ</p>
<h1 id="ÂàõÂª∫Êï∞ÊçÆÂ∫ìÂ≠êÁõÆÂΩï"><a href="#ÂàõÂª∫Êï∞ÊçÆÂ∫ìÂ≠êÁõÆÂΩï" class="headerlink" title="ÂàõÂª∫Êï∞ÊçÆÂ∫ìÂ≠êÁõÆÂΩï"></a>ÂàõÂª∫Êï∞ÊçÆÂ∫ìÂ≠êÁõÆÂΩï</h1><p>Êàë‰ª¨ÂèØ‰ª•‰ΩøÁî® ‚Äìdirectoryperdb ÂëΩ‰ª§ËÆ© MongoDB Â∞ÜÊï∞ÊçÆÂ∫ìÂ≠òÂÇ®Êó∂ÂÄôÊåâÁÖßÊñá‰ª∂Â§πÂå∫ÂàÜÂºÄÔºö<br>È¶ñÂÖà‰ΩøÁî®ÂëΩ‰ª§ÔºåÂÖ≥Èó≠ mongodb server„ÄÇÁÑ∂ÂêéÂà†Èô§ db ÁõÆÂΩïÂπ∂ÈáçÊñ∞Âª∫Á´ã‰∏Ä‰∏™ db ÁõÆÂΩï„ÄÇ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">‚Ä¢ mongo admin --<span class="built_in">eval</span> <span class="string">'db.shutdownServer()'</span></span><br><span class="line">‚Ä¢ rm -rf /data/db</span><br><span class="line">‚Ä¢ mkdir -p /data/db</span><br></pre></td></tr></table></figure>


<p>‰∏ãÈù¢ÂØπÊØè‰∏Ä‰∏™ database ÈÉΩÂàõÂª∫Ëá™Â∑±ÁöÑÁõÆÂΩï„ÄÇ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">‚Ä¢ mongod --dbpath /data/db --fork --logpath /data/db/mongodb.log --directoryperdb</span><br></pre></td></tr></table></figure>
<p><img src="3.png" alt=""></p>
<p>ÂèØ‰ª•ÁúãÂà∞ÂàùÁ∫ßÁõÆÂΩïÈáåÈù¢Â∑≤ÁªèÊ≤°Êúâ collection Âíå index Êñá‰ª∂‰∫Ü„ÄÇÂ¶ÇÊûúËøõÂÖ• local Â≠êÁõÆÂΩïÔºåÂèØ‰ª•ÁúãÂà∞Ôºö<br><img src="4.png" alt=""></p>
<h1 id="ÂàõÂª∫-collection-Âíå-index-Â≠êÁõÆÂΩï"><a href="#ÂàõÂª∫-collection-Âíå-index-Â≠êÁõÆÂΩï" class="headerlink" title="ÂàõÂª∫ collection Âíå index Â≠êÁõÆÂΩï"></a>ÂàõÂª∫ collection Âíå index Â≠êÁõÆÂΩï</h1><p>‰∏äÈù¢Êàë‰ª¨Â∑≤ÁªèÊää‰∏çÂêåÁöÑ database ÊîæÂà∞‰∫Ü‰∏çÂêåÁõÆÂΩï‰∏ãÔºåÁé∞Âú®Êàë‰ª¨ËøòÂèØ‰ª•Â∞Ü collection Âíå index Êñá‰ª∂ÊîæÂú®ÂêÑËá™ÁöÑÁõÆÂΩï‰∏ã„ÄÇ</p>
<p>È¶ñÂÖà‰ΩøÁî®ÂëΩ‰ª§ÔºåÂÖ≥Èó≠ mongodb server„ÄÇÁÑ∂ÂêéÂà†Èô§ db ÁõÆÂΩïÂπ∂ÈáçÊñ∞Âª∫Á´ã‰∏Ä‰∏™ db ÁõÆÂΩï„ÄÇ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">‚Ä¢ mongo admin --<span class="built_in">eval</span> <span class="string">'db.shutdownServer()'</span></span><br><span class="line">‚Ä¢ rm -rf /data/db</span><br><span class="line">‚Ä¢ mkdir -p /data/db</span><br></pre></td></tr></table></figure>
<p>‰ΩøÁî®Â¶Ç‰∏ãÂëΩ‰ª§Ôºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">‚Ä¢ mongod --dbpath /data/db --fork --logpath /data/db/mongodb.log --directoryperdb --wiredTigerDirectoryForIndexes</span><br></pre></td></tr></table></figure>

<p><img src="5.png" alt=""></p>
<p>ÂèØ‰ª•ÁúãÂà∞ local Êï∞ÊçÆÂ∫ìÁõÆÂΩï‰∏ãÂ§ö‰∫Ü‰∏§‰∏™Â≠êÁõÆÂΩïÔºå‰∏Ä‰∏™ÊòØ collection Ôºå‰∏Ä‰∏™ÊòØ index„ÄÇ‰πãÊâÄ‰ª•Ëøô‰πàÂÅöÔºåÊòØ‰∏∫‰∫ÜÊèêÂçáÊï∞ÊçÆÂ∫ìÁöÑÊÄßËÉΩ„ÄÇÊàë‰ª¨ÂèØ‰ª•Â∞Ü collection Âíå index ÊîæÂú®‰∏§‰∏™‰∏çÂêåÁöÑ disk ‰∏ä„ÄÇËøôÊ†∑Âà©Áî®‰∏§‰∏™ disk ÁöÑ parallel ËØªÂÜôÔºàparallel I/OÔºâÔºåÊèêÂçá mongodb ÁöÑÊï∞ÊçÆÂêûÂêêÈáè„ÄÇ</p>
<p><img src="6.png" alt=""></p>
]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title>lock</title>
    <url>/blog/lock/</url>
    <content><![CDATA[<h1 id="What-a-lock-do"><a href="#What-a-lock-do" class="headerlink" title="What a lock do?"></a>What a lock do?</h1><p>Lock is used to make sure code in critical section been executed atomically.</p>
<p><code>Atomic</code>: An operation (or set of operations) is atomic, linearizable, indivisible or uninterruptible if it appears to the rest of the system to occur at once without being interrupted. Atomicity is a guarantee of isolation from interrupts, signals, concurrent processes and threads.</p>
<h1 id="build-a-Lock"><a href="#build-a-Lock" class="headerlink" title="build a Lock"></a>build a Lock</h1><p>with the help of hardware and os, some primitive instructions can help to build a lock.</p>
<a id="more"></a>
<h1 id="Evaluating-a-Lock"><a href="#Evaluating-a-Lock" class="headerlink" title="Evaluating a Lock"></a>Evaluating a Lock</h1><ol>
<li>provide mutual exclusion</li>
<li>fairness, no starvation</li>
<li>how is the performance</li>
</ol>
<h1 id="Spin-lock-with-Test-and-set"><a href="#Spin-lock-with-Test-and-set" class="headerlink" title="Spin lock with Test-and-set"></a>Spin lock with Test-and-set</h1><p>We can test the old value while simultaneously setting the memory location to new value.<br>atomic test-and-set instruction(in C)</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">TestAndSet</span><span class="params">(<span class="keyword">int</span> *old_ptr, <span class="keyword">int</span> <span class="keyword">new</span>)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> old = *old_ptr; <span class="comment">// fetch old value at old_ptr</span></span><br><span class="line">  *old_ptr = <span class="keyword">new</span>; <span class="comment">// store ‚Äônew‚Äô into old_ptr</span></span><br><span class="line">  <span class="keyword">return</span> old; <span class="comment">// return the old value</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>spin lock:</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> __<span class="title">lock_t</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> flag;</span><br><span class="line">&#125; <span class="keyword">lock_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">lock_t</span> *lock)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 0 indicates that lock is available, 1 that it is held</span></span><br><span class="line">  lock-&gt;flag = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">lock</span><span class="params">(<span class="keyword">lock_t</span> *lock)</span> </span>&#123;</span><br><span class="line"> <span class="keyword">while</span> (TestAndSet(&amp;lock-&gt;flag, <span class="number">1</span>) == <span class="number">1</span>)</span><br><span class="line"> ; <span class="comment">// spin-wait (do nothing)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">unlock</span><span class="params">(<span class="keyword">lock_t</span> *lock)</span> </span>&#123;</span><br><span class="line"> lock-&gt;flag = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ÂàùÂßãÂåñÔºåÊ≤°ÊúâÈîÅ„ÄÇÂÅáÂ¶ÇÊúâ‰∏Ä‰∏™ thread Ë∞ÉÁî® lock() ÂáΩÊï∞ÔºõÈÇ£‰πàÂõ†‰∏∫ËøîÂõûÂÄºÊòØ0Ôºå‰∏ç‰ºöËøõÂÖ• spin lock„ÄÇ‰ΩÜÊòØËøôÊó∂ÂÄôÔºålock-&gt;flag Ë¢´ÁΩÆ‰∏∫ new value 1ÔºõÂÅáÂ¶ÇËØ• thread Âπ∂Ê≤°ÊúâÈáäÊîælockÔºåÈÇ£‰πà lock-&gt;flag Â∞±‰∏ÄÁõ¥‰∏∫ 1ÔºõÂΩìÂè¶‰∏Ä‰∏™ thread Ë∞ÉÁî® lock() Êó∂ÂÄôÔºåtest-and-set ËøîÂõû 1ÔºåÂπ∂ÁªßÁª≠ËÆæÁΩÆ‰∏∫ 1„ÄÇËøõÂÖ• spin lock„ÄÇ</p>
<ol>
<li>Êèê‰æõ mutual exclusion</li>
<li>‰∏çÊèê‰æõ fairnessÔºåÂèØËÉΩÂá∫Áé∞ starvation</li>
<li>performanceÔºöÂØπ‰∫éÂçïÊ†∏Êù•ËØ¥ÔºåÂæà‰∏çÂ•Ω„ÄÇÂÅáÂ¶ÇÊúâ N ‰∏™ thread ÂÖ±Áî®‰∏Ä‰∏™ lockÔºå‰∏ÄÊó¶‰∏Ä‰∏™ thread ÈîÅ‰Ωè lockÔºåÂÖ∂‰ªñ thread Âõ†‰∏∫‰ºö‰∏ÄÁõ¥ spinÔºåÊâÄ‰ª•‰ºöÂç†Áî® (N-1) ‰∏™ time period ÂÅöÊó†Áî®ÁöÑÂæ™ÁéØ„ÄÇ</li>
</ol>
<h1 id="Spin-lock-with-compare-and-swap"><a href="#Spin-lock-with-compare-and-swap" class="headerlink" title="Spin lock with compare-and-swap"></a>Spin lock with compare-and-swap</h1><h1 id="Spin-lock-with-Load-Linked-and-Store-Conditional"><a href="#Spin-lock-with-Load-Linked-and-Store-Conditional" class="headerlink" title="Spin lock with Load-Linked and Store-Conditional"></a>Spin lock with Load-Linked and Store-Conditional</h1><h1 id="Spin-lock-with-Fetch-And-Add"><a href="#Spin-lock-with-Fetch-And-Add" class="headerlink" title="Spin lock with Fetch-And-Add"></a>Spin lock with Fetch-And-Add</h1>]]></content>
      <categories>
        <category>program</category>
      </categories>
      <tags>
        <tag>multi-thread</tag>
      </tags>
  </entry>
  <entry>
    <title>C++ Atomic</title>
    <url>/blog/cplusAtomic/</url>
    <content><![CDATA[<p><a href="https://stackoverflow.com/questions/6319146/c11-introduced-a-standardized-memory-model-what-does-it-mean-and-how-is-it-g" target="_blank" rel="noopener">What exactly is std::atomic</a><br><a href="https://bartoszmilewski.com/2008/12/01/c-atomics-and-memory-ordering/" target="_blank" rel="noopener">C++ atomics and memory ordering</a></p>
<p>This is used to prevent the CPU from doing the instruction reordering.</p>
<p>An operation (or set of operations) is atomic, linearizable, indivisible or uninterruptible if it appears to the rest of the system to occur at once without being interrupted. Atomicity is a guarantee of isolation from interrupts, signals, concurrent processes and threads.</p>
<a id="more"></a>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">atomic&lt;<span class="keyword">bool</span>&gt; ready = <span class="literal">false</span>;</span><br><span class="line">atomic&lt;<span class="keyword">int</span>&gt; data = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<p>Thread 0:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">data.store(<span class="number">1</span>, memory_order_release);</span><br><span class="line">ready.store(<span class="literal">true</span>, memory_order_release);</span><br></pre></td></tr></table></figure>
<p>Thread 1:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (ready.load(memory_order_acquire))</span><br><span class="line">  assert (data.load(memory_order_acquire) == <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p>The code below will not create a memory fence.</p>
<p><code>[memory fence](https://en.wikipedia.org/wiki/Memory_barrier)</code>:CPUs often execute instructions <a href="https://en.wikipedia.org/wiki/Out-of-order_execution" target="_blank" rel="noopener">out of order</a> to make maximum use of the available silicon (including memory read/writes). Because the hardware enforces instructions integrity you never notice this in a single thread of execution. However for multiple threads or environments with volatile memory (memory mapped I/O for example) this can lead to unpredictable behavior.</p>
<p>A memory fence/barrier is a class of instructions that mean memory read/writes occur in the order you expect. For example a ‚Äòfull fence‚Äô means all read/writes before the fence are comitted before those after the fence.</p>
<ul>
<li><code>memory_order_acquire</code>: guarantees that <code>subsequent loads</code> are not moved before the current load or any preceding loads.</li>
<li><code>memory_order_release</code>: <code>preceding stores</code> are not moved past the current store or any subsequent stores.</li>
<li><code>memory_order_acq_rel</code>: combines the two previous guarantees.</li>
<li><code>memory_order_consume</code>: potentially weaker form of memory_order_acquire that enforces ordering of the current load before other operations that are data-dependent on it (for instance, when a load of a pointer is marked memory_order_consume, subsequent operations that dereference this pointer won‚Äôt be moved before it (yes, even that is not guaranteed on all platforms!).</li>
<li><code>memory_order_relaxed</code>: all reorderings are okay.</li>
</ul>
]]></content>
      <categories>
        <category>program</category>
      </categories>
      <tags>
        <tag>multi-thread</tag>
        <tag>levelDB</tag>
      </tags>
  </entry>
  <entry>
    <title>what is mutual exclusion ‰∫íÊñ•</title>
    <url>/blog/mutex/</url>
    <content><![CDATA[<p>it is the requirement that one thread of execution never enter its critical section at the same time that another concurrent thread of execution enters its own critical section</p>
<p>‰∏çÂÖÅËÆ∏Â§öÁ∫øÁ®ãÂØπ critical section ÔºàÂèØ‰ª•ÊòØ share variablesÔºâÁöÑÂêåÊó∂ËÆøÈóÆ„ÄÇ</p>
<p>‰∏ãÈù¢ÊòØÁî® linked list ÁöÑÂà†Èô§Êìç‰ΩúÊù•ËØ¥Êòé„ÄÇ</p>
<p><img src="1.png" alt="1"></p>
<p>‰∏§‰∏™Á∫øÁ®ãÂêåÊó∂ËøõË°åÂà†Èô§Êìç‰ΩúÔºåÂàÜÂà´ÊÉ≥Âà†Èô§ i Âíå i+1ÔºåÂêåÊó∂ÊâßË°å‰∫Ü</p>
<ul>
<li>node(i-1)-&gt;next = node(i)-&gt;next (‰∏∫‰∫ÜÂà†Èô§ node(iÔºâ)</li>
<li>node(i)-&gt;next = node(i+1)-&gt;next (‰∏∫‰∫ÜÂà†Èô§ node(i+1))<a id="more"></a>
ÊúÄÂêéÁªìÊûúÂ∞±ÂÉèÁ¨¨‰∏âË°åÊâÄÁ§∫Ôºå node(i+1)Ê≤°ÊúâË¢´Âà†Èô§„ÄÇ</li>
</ul>
<p>‰ΩÜÊòØËøô‰πãÂêéÔºåÂõ†‰∏∫ËøòÊúâÈáäÊîæÁ©∫Èó¥Êìç‰ΩúÔºåÁªìÊûúÂ∞±ÊòØ node(i) Âíå node(i+1) ÂêåÊó∂Ë¢´ delete„ÄÇÊâÄ‰ª•ÊúÄÂêéÊúÄÂêéÁöÑ list ÁªìÊûÑÂèòÊàêÔºö</p>
<ul>
<li>node(i-1) ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî&gt; unknown ‚Äî node(i+2)</li>
</ul>
<p>list ÁªìÊûÑË¢´Á†¥Âùè„ÄÇ</p>
<p>ÊâÄ‰ª•ÈúÄË¶ÅÂØπÂà†Èô§ linked list ÁöÑÂáΩÊï∞Ôºådelete Âä† mutex ÈîÅ„ÄÇ</p>
]]></content>
      <categories>
        <category>program</category>
      </categories>
      <tags>
        <tag>multi-thread</tag>
        <tag>levelDB</tag>
      </tags>
  </entry>
  <entry>
    <title>review on Geospatial Performance Improvements in MongoDB 3.2</title>
    <url>/blog/mongodb-geoindex-improvement/</url>
    <content><![CDATA[<p><a href="https://www.mongodb.com/blog/post/geospatial-performance-improvements-in-mongodb-3-2" target="_blank" rel="noopener">link</a></p>
<p>In mongoDB version before v3.2, <code>$geoNear</code> operation was sometimes slow for queries on dense datasets.</p>
<p>After version v3.2, this algorithm had been upgrade. This is a brief explanation about the upgrade.</p>
<p>The <code>$geoNear</code> algorithm iteratively expands its search in distance <code>intervals</code> (the red annulus shown below), aiming to have a few hundred documents per interval. Searching all documents in an interval is accomplished by finding an index <code>cell covering</code>. This covering ensures that all of the documents in the interval can be found using an index scan. The documents in the covering but not in the interval are filtered out afterwards. After all of the documents in an interval are found, they are sorted and returned.</p>
<a id="more"></a>
<p><img src="1.png" alt=""></p>
<p>Problem is that the cell covering may have overlaps in different iterations (Also called stages).</p>
<p><img src="2.png" alt=""></p>
<p><img src="3.png" alt=""></p>
<p>The original $geoNear algorithm did not account for this problem. At every interval, it would create a covering independent of what was already covered during searches of previous intervals. The <code>repeated index scans</code> could become very expensive in dense datasets where the search intervals were thin.</p>
<p><code>new $geoNear algorithm</code></p>
<ul>
<li>buffer the documents in current covering but not in current iteration‚Äôs interval, and provide them for next iteration.</li>
<li>current iteration(or stage) only fetch the documents in current coverings that has no overlap with previous iteration. (the new fetched documents with the buffered documents from previous iteration will be used)</li>
</ul>
<p><img src="4.png" alt=""></p>
<p><img src="5.png" alt=""></p>
<p>Since the algorithm now only needs to visit the cells that have not been visited before, the number of index scans required in large queries drops dramatically</p>
]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title>Paper review: A Scalable Distributed Spatial Index for the Internet-of-Things</title>
    <url>/blog/socc17-iot/</url>
    <content><![CDATA[<p>This is an article about partitioning geo-index at SOCC17 from UCB by Anand.</p>
<h1 id="Main-idea"><a href="#Main-idea" class="headerlink" title="Main idea"></a>Main idea</h1><p>The era of the Internet of things is imminent. Big data of IoT is inherently geospatial in nature and has unpredictable <code>skews in space and time</code>.</p>
<p>In order to overcome the skews and give the best performance, partition and re-balance are critical to the database and key-value store. However, frequent re-balance operation will harm insertion performance.</p>
<a id="more"></a>
<p>This paper proposes a method called <code>sift</code> which claims can migrate skew at ingest time. By utilizing additional dimension, sift can distribute spatial data which originally be put in one node now be put in several nodes. This is how it overcomes spatial data skew.</p>
<h1 id="Future-relevance"><a href="#Future-relevance" class="headerlink" title="Future relevance"></a>Future relevance</h1><p>I have some doubts about this paper.</p>
<ol>
<li><p>MongoDB does not support spatial index partition, and this paper says in order to query a spatial index, MongoDB has to query all partition based on other index and aggregate all results together to serve one spatial query.<br>Yes, MongoDB does not support spatial index sharding, however, we can use another field to reduce the range of spatial query. For example, use state, city and then go to that partition to do a spatial query.</p>
</li>
<li><p>Sift does not limit the number of objects that one node can hold (only limited by its memory) and never move objects once they are inserted. I really doubt this can work, even with its hyper-dimension mechanism to migrate the data skew. Because I think if data in one place explode, the data could overflow even though they can be stored in several nodes instead of one node.</p>
</li>
</ol>
<p>Following is an illustration of its hyper-dimension mechanism.</p>
<p><img src="1.png" alt=""></p>
<p>Actually, the <code>main idea</code> is that both leaf node and inter node can store object data.</p>
]]></content>
      <categories>
        <category>review</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
        <tag>big data</tag>
      </tags>
  </entry>
  <entry>
    <title>Dynamo: Amazon's Highly Available Key-value Store</title>
    <url>/blog/Casandra/</url>
    <content><![CDATA[<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p>This is the paper presented at 2007‚Äôs SOSP by Amazon.</p>
<p>In order to <code>provide high availability</code> Dynamo <code>sacrifices consistency</code> under certain failure scenarios ().</p>
<p>Amazon‚Äôs primary usecase for Dynamo is its shopping cart, where it‚Äôs really important to be highly available, or customers should be able to view and add items to shopping cart dispite of datacenter failure.</p>
<p>In a cluster consists of millions of components, it always have small but significant number of server or network components failing at any giving time. Dynamo should be able to treats these as normal case without impacting availability or performance.</p>
<a id="more"></a>
<p>For many service, such as shopping carts, customer preference, sales rank, they only need a primary-key to retrieve data and not require complex querying, and this is how Dynamo works. It provides <code>primary-key only</code> interface.</p>
<ul>
<li>consistent hashing(no need to redistribution when storage nodes added or removed). Differ from traditional consistent hashing, it assigns key to multiple point in the ring.(<code>virtual nodes</code>)</li>
<li>Lamport algorithm for synchronization (clock sync)</li>
<li>quorum-based protocol (Replicated-write protocol)</li>
<li>gossip failure detection in which each node regularly announces to its neighbors that it is still up and running.</li>
</ul>
<p>Dynamo provides eventual consistency. Some replica servers may fail before all updates come. So, for example, the shopping cart may have different version. Dynamo merges different version shopping cart to avoid any ‚Äúadd to cart‚Äù operation lost, however, some deleted items can resurface. Dynamo uses <code>vector clock</code> to decide whether to implement a merge operation.</p>
<p>#</p>
]]></content>
      <categories>
        <category>review</category>
      </categories>
      <tags>
        <tag>database</tag>
        <tag>nosql</tag>
        <tag>big data</tag>
      </tags>
  </entry>
  <entry>
    <title>mongoDB index ‰∏é performance</title>
    <url>/blog/mongo-index/</url>
    <content><![CDATA[<ul>
<li><a href="https://www.youtube.com/watch?v=qI_g07C_Q5I" target="_blank" rel="noopener">Introduce to NoSql</a></li>
</ul>
<h1 id="Single-Field-indexes"><a href="#Single-Field-indexes" class="headerlink" title="Single Field indexes"></a>Single Field indexes</h1><p>ÂØπ collection ÈáåÁöÑÊüê‰∏Ä‰∏™ field ÂàõÂª∫ÁöÑ index Â∞±ÊòØ sigle  field indexes„ÄÇÂÆÉÁöÑÁâπÁÇπÔºö</p>
<ul>
<li>keys from only one Field</li>
<li>can find a single value for the indexes field</li>
<li>can find a range of values</li>
<li>can use dot notation to index field in subdocuments</li>
<li>can be used to find several distinct values in a single query<a id="more"></a>
È¶ñÂÖà‰∏ãËΩΩ <a href="https://university.mongodb.com/static/MongoDB_2018_M201_January/handouts/people.json" target="_blank" rel="noopener">people</a> Êñá‰ª∂„ÄÇÁÑ∂ÂêéÂà©Áî®‰∏ãÈù¢ÁöÑÂëΩ‰ª§ÂØºÂÖ•Êï∞ÊçÆÂ∫ì„ÄÇ<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mongoimport -d m201 -c people --drop people.json</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>ÁÑ∂ÂêéÊâßË°åÊü•ËØ¢ÂëΩ‰ª§(ËøõÂÖ• mongo shell ‰∏≠)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">db.people.find(&#123;<span class="string">"ssn"</span>:<span class="string">"720-38-5636"</span>&#125;).explain(<span class="string">"executionStats"</span>)</span><br></pre></td></tr></table></figure>
<p>ÂèØ‰ª•ÁúãÂà∞ÊÄªÂÖ±Ê£ÄÊü•‰∫Ü 50474 ‰∏™Ôºàpeople collection ÁöÑÊÄª document Êï∞ÈáèÂ∞±ÊòØ 50474Ôºå‰πüÂ∞±ÊòØÈÅçÂéÜ‰∫ÜÊï¥‰∏™Êï∞ÊçÆÂ∫ìÔºâ documentsÔºåËøîÂõû‰∫Ü 1 ‰∏™ÁªìÊûú„ÄÇÊïàÁéáÂæà‰Ωé„ÄÇ<br><img src="result1.png" alt="result1"></p>
<p>Êé•‰∏ãÊù•Êàë‰ª¨Áªô people collection ÁöÑ ssn field ÂàõÂª∫ indexes„ÄÇ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; db.people.createIndex(&#123;ssn:1&#125;)</span><br><span class="line">&#123;</span><br><span class="line">	&quot;createdCollectionAutomatically&quot; : false,</span><br><span class="line">	&quot;numIndexesBefore&quot; : 1,</span><br><span class="line">	&quot;numIndexesAfter&quot; : 2,</span><br><span class="line">	&quot;ok&quot; : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ÂèØ‰ª•ÂàõÂª∫‰∏Ä‰∏™ object Áî®‰∫éËßÇÂØüÊü•ËØ¢ÁªìÊûúÔºö</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; exp = db.people.explain(&quot;executionStats&quot;)</span><br><span class="line">Explainable(m201.people)</span><br><span class="line">&gt; exp.find(&#123;&quot;ssn&quot;:&quot;720-38-5636&quot;&#125;)</span><br></pre></td></tr></table></figure>

<p>ÂèØ‰ª•ÁúãÂà∞Êúâ‰∫Ü index ‰ª•ÂêéÔºåÊ£ÄÁ¥¢ÁöÑ document ÂèòÊàê‰∫Ü 1„ÄÇÂπ∂‰∏î query Êó∂Èó¥‰ªé 32ms ÂèòÊàê‰∫Ü 4ms„ÄÇ</p>
<p><img src="result2.png" alt="res2"></p>
<h1 id="Sorting"><a href="#Sorting" class="headerlink" title="Sorting"></a>Sorting</h1><p>‰ªª‰Ωï‰∏ÄÊ¨° query ÁöÑÁªìÊûúÈÉΩÂèØ‰ª•Ë¢´ÊéíÂ∫èÔºåÂ¶Ç‰∏ãÔºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ÊâæÂà∞ÊâÄÊúâ James Âπ∂ÊåâÁÖß first name ÊéíÂ∫è</span></span><br><span class="line">exp.find(&#123;first_name:<span class="string">"James"</span>&#125;).sort(&#123;first_name:1&#125;)</span><br></pre></td></tr></table></figure>

<p>Êúâ‰∏§ÁßçÊéíÂ∫èÊñπÂºèÔºö</p>
<ol>
<li>‰ªé disk ÈáåÈù¢ËØªÂèñ documentsÔºåÁÑ∂ÂêéÂÅö in memory ÊéíÂ∫è„ÄÇ</li>
<li>Ê†πÊçÆ field ÁîüÊàê indexÔºåindex ÊòØÊéíÂ∫èÁöÑ„ÄÇ</li>
</ol>
<p>1.ÂΩìÊàë‰ª¨ÂØπÊ≤°ÊúâÂª∫Á´ã index ÁöÑ field query ÂêéÔºà‰ª•‰∏äÈù¢ÁöÑfirst_name Êü•ÊâæÊéíÂ∫è‰∏∫‰æãÔºâËøõË°åÊéíÂ∫è„ÄÇmongoDB ‰ºöÈ¶ñÂÖà‰ªé collection ÈáåÈù¢ÈÅçÂéÜÔºåÂÆåÊàê query Êìç‰ΩúÔºåËøô‰ºö touch Âà∞ÊâÄÊúâÁöÑ documents„ÄÇÁÑ∂Âêé filter ‰ª•ÂêéÁöÑÁªìÊûúÔºåÂú® memory ‰∏≠ËøõË°åÊéíÂ∫è„ÄÇÂ¶ÇÊûú query ÂæóÂà∞ documents ÂæàÂ§öÔºåÈÇ£‰πàËØ•ËøáÁ®ã‰ºöÂæàË¥πÊó∂(mongoDB ‰ºöÈÅøÂÖçË∂ÖËøá 32GB ÁöÑ in memory ÊéíÂ∫è)„ÄÇ</p>
<p><img src="sort-in-memory.png" alt="sm"></p>
<p>ÂèØ‰ª•ÁúãÂà∞ËøôÁªÑËØ≠Âè• touch ‰∫ÜÊâÄÊúâÁöÑ documentÔºåÂπ∂‰∏îËÄóÊó∂33ms„ÄÇ</p>
<p>2.Â¶ÇÊûúÊòØ query Âª∫Á´ã‰∫Ü index ÁöÑ field Âπ∂‰∏îÂÜçËøõË°åÊéíÂ∫èÔºåÊØîÂ¶Ç ssn„ÄÇ‰∏∫‰∫Ü‰øùËØÅÂØπÊØîÁªìÊûúÂú®ÂêåÊ†∑ÁöÑÊù°‰ª∂ÔºåÊàë‰ª¨ÈôêÂà∂ÂÖ∂ query ÁªìÊûúÂè™Áî® 751Êù°ÔºåÂíå‰∏äÈù¢ÁöÑÁõ∏ÂêåÔºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">exp.find(&#123;ssn:&#123;<span class="variable">$gte</span>:<span class="string">"200-00-1000"</span>&#125;&#125;).<span class="built_in">limit</span>(751).sort(&#123;ssn:-1&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="sort-index.png" alt=""></p>
<p>ÂèØ‰ª•ÁúãÂà∞Âú®ÂêåÊ†∑ 751 ÁªìÊûúÊéíÂ∫èÔºåÊúâ index ÁöÑÂè™ËÄóË¥π 2ms„ÄÇËøôÊòØÂõ†‰∏∫ mongoDB Âú®ÂØπÊúâ index ÁöÑ field ËøõË°å query ËøáÁ®ã‰∏≠ÔºåÊòØÊåâÁÖßÂ∑≤ÁªèÂª∫Á´ãÁöÑ index Âéª fetch ÁöÑÔºåËÄå‰∏çÊòØÊåâÁÖß document ÁöÑÂéüÂßãÈ°∫Â∫è„ÄÇÊâÄ‰ª•Âç≥‰ΩøÊàë‰ª¨‰∏çÂØπ query ÁªìÊûúËøõË°åÊéíÂ∫èÔºåÂæóÂà∞ÁöÑÁªìÊûú‰πüÊòØÊéíÂ•ΩÂ∫èÁöÑÔºàÊåâÁÖßÂΩìÂàùÂª∫Á´ã ssn index ÁöÑÈ°∫Â∫èÔºâ„ÄÇÂ¶ÇÊûúÊàë‰ª¨ÊåâÁÖßÂíåÂΩìÂàùÂª∫Á´ã index ÁöÑÈ°∫Â∫èÁöÑÁõ∏ÂèçÈ°∫Â∫èÂéª sort ÁªìÊûúÔºàÂª∫Á´ãÊó∂ÂÄô accendingÔºåsort Êó∂ÂÄô decendingÔºâÔºåÈÇ£‰πàmongoDB Ëá™Âä®Â∞±‰ºö‰ªéÂêéÂæÄÂâçÂéªÊü•Êâæ indexÔºåËøôÊ†∑ query ÂêéÁöÑÈ°∫Â∫è‰ªçÁÑ∂ÊòØÊª°Ë∂≥Ë¶ÅÊ±ÇÁöÑÔºå‰∏çÈúÄË¶ÅÈ¢ùÂ§ñÊéíÂ∫èÔºàquery Êó∂ÂÄô‰ªé forward ÂèòÊàê‰∫Ü backward È°∫Â∫èÔºâ„ÄÇ</p>
<h1 id="Compound-Index"><a href="#Compound-Index" class="headerlink" title="Compound Index"></a>Compound Index</h1><p>ÂØπÂ§ö‰∏™ field Âª∫Á´ã index Âπ∂ÁªÑÂêàÂú®‰∏ÄËµ∑‰ΩøÁî®ÔºåÊúâÁÇπÂÉèÂ§öÁ∫ßÊéíÂ∫è„ÄÇÊØîÂ¶ÇÁ¨¨‰∏ÄÁ∫ßÊåâÁÖß first name accendingÔºåÁ¨¨‰∫åÁ∫ßÊåâÁÖß last name accending„ÄÇ</p>
<p>ÊØîÂ¶ÇÂú®Ê≤°ÊúâÂª∫Á´ã‰ªª‰Ωï index Êó∂ÂÄôÔºåËøõË°åÂ¶Ç‰∏ã queryÔºö<br><img src="noindex.png" alt="noindex"></p>
<p>ÂèØ‰ª•ÁúãÂà∞‰∏∫‰∫ÜÊü•Âà∞ Jasmine FrazierÔºåÈÅçÂéÜ‰∫ÜÊï¥‰∏™ documentÔºåËÄóÊó∂62ms„ÄÇ</p>
<p>ÁÑ∂ÂêéÂª∫Á´ã last_name ÁöÑ indexÔºåÈáçÂ§çÊü•ËØ¢Ôºö<br><img src="1index.png" alt="1index"></p>
<p>ÂèØ‰ª•ÁúãÂà∞Âè™Ê£ÄÊü•‰∫Ü 31 ‰∏™ documentÔºåËÄóÊó∂ 0ms„ÄÇÊïàÁéáÊòéÊòæÊèêÂçá„ÄÇ</p>
<p>Êé•‰∏ãÊù•Êàë‰ª¨Âª∫Á´ã compound indexÔºö<br><img src="cpindex.png" alt="cpindex"></p>
<p>ÁÑ∂ÂêéÈáçÂ§çÊü•ËØ¢Ôºö<br><img src="cpresult.png" alt="cpresult"></p>
<p>ÂèØ‰ª•ÁúãÂà∞Âú® compound index ‰∏ãÔºåÂè™ touch ‰∫Ü‰∏Ä‰∏™ document„ÄÇÊïàÁéáÊõ¥È´ò„ÄÇ</p>
<h1 id="Multikey-index"><a href="#Multikey-index" class="headerlink" title="Multikey index"></a>Multikey index</h1><h1 id="Partial-index"><a href="#Partial-index" class="headerlink" title="Partial index"></a>Partial index</h1><h1 id="Text-index"><a href="#Text-index" class="headerlink" title="Text index"></a>Text index</h1>]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title>mongoDB Âü∫Á°Ä</title>
    <url>/blog/mongo-beginner/</url>
    <content><![CDATA[<h1 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h1><ul>
<li>NoSQL Êï∞ÊçÆÂ∫ì</li>
<li>compass app: ËøûÊé• mongodb atlas ÁöÑÂÆòÊñπ app</li>
<li>mongod: mongoDB ÁöÑ database application</li>
<li>mongo: Êèê‰æõÂíå database ËøõË°å‰∫§‰∫íÁöÑ shell Êé•Âè£ application</li>
<li>Âêë mongodb atlas ‰∏ä‰º†Êï∞ÊçÆ<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mongoimport --<span class="built_in">type</span> csv --headerline --db mflix --collection movies_initial --host <span class="string">"cluster0-shard-00-00-1cvum.mongodb.net:27017,cluster0-shard-00-01-1cvum.mongodb.net:27017,cluster0-shard-00-02-1cvum.mongodb.net:27017"</span> --authenticationDatabase admin --ssl --username hansonzhao007 --password XXXXXX --file movies_initial.csv</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h1 id="Aggregation-Framework"><a href="#Aggregation-Framework" class="headerlink" title="Aggregation Framework"></a>Aggregation Framework</h1><h2 id="pipeline"><a href="#pipeline" class="headerlink" title="pipeline"></a>pipeline</h2><img src="pipeline.png" alt="pipeline"><br>‰ªé collection ÈáåÈù¢Ëé∑ÂæóÊï∞ÊçÆÔºåÂπ∂ËæìÂÖ•Âà∞ÂêéÈù¢ÁöÑ stagesÔºåÊØè‰∏™ÈÉΩËøõË°å‰∏çÂêåÁöÑÊìç‰Ωú„ÄÇËøô‰∫õËæìÂÖ•ËæìÂá∫ÈÉΩÊòØ documents„ÄÇ</li>
</ul>
<h2 id="stages"><a href="#stages" class="headerlink" title="stages"></a>stages</h2><p><img src="stages.png" alt="stages"><br>stage ÈáåÈù¢ÂèØ‰ª•ÂÆö‰πâËá™Â∑±ÂØπ document ÁöÑÊìç‰Ωú„ÄÇÂèØ‰ª•ÊòØ reshapeÔºåaccumulation Á≠âÁ≠â„ÄÇ</p>
<p><img src="stage-function.png" alt="stage-function"><br>ËøôÈáåÁöÑ stage1 ÂèØ‰ª•Áî®Êù•ËøáÊª§ËæìÂÖ•Êï∞ÊçÆÔºå‰∏çÁî®ÂØπÊØè‰∏™Êï∞ÊçÆÈÉΩÂ§ÑÁêÜ„ÄÇstage2 ÂèØ‰ª•Áî®Êù•Ëá™ÂÆö‰πâ‰∏Ä‰∫õÊï∞ÊçÆÊìç‰ΩúÔºõstage3 ÂèØ‰ª•ÂÜçÊ¨°ËøáÊª§‰∏Ä‰∏ã„ÄÇ</p>
<h2 id="write-a-pipeline"><a href="#write-a-pipeline" class="headerlink" title="write a pipeline"></a>write a pipeline</h2><p>‰∏ãÂõæÊòØpython ÂÜô mongodb pipeline ÁöÑÂõæ‰æãÔºö<br><img src="pipeline-python.png" alt="python-pipeline"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"><span class="keyword">from</span> pymongo <span class="keyword">import</span> MongoClient</span><br><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> clear_output</span><br><span class="line"></span><br><span class="line">client = MongoClient(<span class="string">"mongodb+srv://hansonzhao007:yourpassword@cluster0-1cvum.mongodb.net"</span>)</span><br><span class="line"></span><br><span class="line">pipeline = [</span><br><span class="line">    <span class="comment"># group stage</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">'$group'</span>:&#123;</span><br><span class="line">            <span class="string">'_id'</span>:&#123;<span class="string">"language"</span>:<span class="string">"$language"</span>&#125;,</span><br><span class="line">            <span class="string">'count'</span>:&#123;<span class="string">'$sum'</span>: <span class="number">1</span>&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment"># sort stage</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">'$sort'</span>:&#123;<span class="string">'count'</span>: <span class="number">-1</span>&#125; <span class="comment"># decending order, 1 is accending order</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># # a simplify version is:</span></span><br><span class="line"><span class="comment"># pipeline = [</span></span><br><span class="line"><span class="comment">#   &#123;</span></span><br><span class="line"><span class="comment">#     '$sortByCount':"$language"</span></span><br><span class="line"><span class="comment">#   &#125;</span></span><br><span class="line"><span class="comment"># ]</span></span><br><span class="line"></span><br><span class="line">clear_output()</span><br><span class="line">pprint.pprint(list(client.mflix.movies_initial.aggregate(pipeline)))</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[&#123;<span class="string">'_id'</span>: &#123;<span class="string">'language'</span>: <span class="string">'English'</span>&#125;, <span class="string">'count'</span>: 25325&#125;,</span><br><span class="line"> &#123;<span class="string">'_id'</span>: &#123;<span class="string">'language'</span>: <span class="string">'French'</span>&#125;, <span class="string">'count'</span>: 1784&#125;,</span><br><span class="line"> &#123;<span class="string">'_id'</span>: &#123;<span class="string">'language'</span>: <span class="string">'Italian'</span>&#125;, <span class="string">'count'</span>: 1480&#125;,</span><br><span class="line"> &#123;<span class="string">'_id'</span>: &#123;<span class="string">'language'</span>: <span class="string">'Japanese'</span>&#125;, <span class="string">'count'</span>: 1290&#125;,</span><br><span class="line"> &#123;<span class="string">'_id'</span>: &#123;<span class="string">'language'</span>: <span class="string">''</span>&#125;, <span class="string">'count'</span>: 1115&#125;,</span><br><span class="line"> &#123;<span class="string">'_id'</span>: &#123;<span class="string">'language'</span>: <span class="string">'Spanish'</span>&#125;, <span class="string">'count'</span>: 875&#125;,</span><br><span class="line"> &#123;<span class="string">'_id'</span>: &#123;<span class="string">'language'</span>: <span class="string">'Russian'</span>&#125;, <span class="string">'count'</span>: 777&#125;,</span><br><span class="line"> ...</span><br></pre></td></tr></table></figure>

<h1 id="indexes"><a href="#indexes" class="headerlink" title="indexes"></a>indexes</h1><h2 id="Âä†ÈÄü"><a href="#Âä†ÈÄü" class="headerlink" title="Âä†ÈÄü"></a>Âä†ÈÄü</h2><p>‰ΩøÁî® index Êù•Âä†ÈÄü mongodb ÁöÑÊü•Êâæ„ÄÇ</p>
<p><img src="indexes.png" alt="indexes"></p>
<p>collection Â∞±ÂÉèÊòØ‰∏ÄÊú¨‰π¶Ôºådocument Â∞±ÊòØ‰π¶ÈáåÈù¢ÁöÑÁ´†ËäÇÂÜÖÂÆπÔºåËÄå indexes ÁöÑ‰ΩúÁî®Â∞±ÊòØÁ´†ËäÇÁõÆÂΩï„ÄÇÂ¶ÇÊûúÊ≤°ÊúâÁ´†ËäÇÁõÆÂΩïÔºåÊàë‰ª¨ÊÉ≥Ë¶ÅÊêúÁ¥¢ÊÉ≥Ë¶ÅÁöÑÂÜÖÂÆπÔºåÂ∞±Âè™ËÉΩÊää‰π¶‰ªéÂ§¥ÊâæÂà∞Â∞æÔºåËÄóÊó∂O(N)„ÄÇÂ¶ÇÊûúÊúâÁõÆÂΩïÔºåÁõÆÂΩïÊåâÁÖßÂ≠óÊØçÈ°∫Â∫èÊéíÂ∫èÔºåÈÇ£‰πàÊÉ≥Ë¶ÅÊüê‰∏ÄÁ´†ËäÇÔºåÂ∞±ÂèØ‰ª•ÂØπÁõÆÂΩïËøõË°å binary searchÔºåËÄóÊó∂ O(N)ÔºåÁÑ∂ÂêéÁõ¥Êé•ÂÆö‰ΩçÂà∞ÂØπÂ∫îÁ´†ËäÇ„ÄÇ</p>
<p>ÂêåÊó∂‰∏∫‰∫ÜÊª°Ë∂≥ÈíàÂØπ‰∏çÂêå filed ÁöÑÁ¥¢ÂºïÈúÄÊ±ÇÔºåmongodb ÁöÑ‰∏Ä‰∏™ collection ÂèØ‰ª•ÊúâÂ§ö‰∏™ indexÔºåÁî®Êù•ËøõË°åÁ¥¢Âºï„ÄÇ</p>
<p><img src="multi-indexes.png" alt="multi-indexes"></p>
<p>mongodb ‰ΩøÁî® B tree Êù•ÂØπ index ËøõË°åÁ¥¢Âºï„ÄÇ</p>
<p><img src="btree-index.png" alt="btree-index"></p>
<p>‰∏ãÈù¢ÊòØ‰ΩøÁî® index Âíå‰∏ç‰ΩøÁî® index ËøõË°åÊêúÁ¥¢Êó∂ÔºåÊâÄÊ£ÄÊµãÁöÑ document Êï∞ÈáèÂØπÊØî„ÄÇ</p>
<p><img src="wovsw.png" alt="wovsw"></p>
<h2 id="overhead-È¢ùÂ§ñÂºÄÈîÄ"><a href="#overhead-È¢ùÂ§ñÂºÄÈîÄ" class="headerlink" title="overhead È¢ùÂ§ñÂºÄÈîÄ"></a>overhead È¢ùÂ§ñÂºÄÈîÄ</h2><p>ËôΩÁÑ∂‰ΩøÁî® index ÂØπÊü•ÊâæËøõË°åÂä†ÈÄüÔºå‰ΩÜÊòØËøô‰ºöÂØπÊèíÂÖ•ÂºïÂÖ•È¢ùÂ§ñÁöÑ overheadÔºàÂºÄÈîÄÔºâÔºå‰πüÂ∞±ÊòØÂ¢ûÂä†‰∫ÜÊèíÂÖ•Êï∞ÊçÆÁöÑÊó∂Èó¥ÂºÄÈîÄ„ÄÇ</p>
<p>ËøôÊòØÂõ†‰∏∫ÊØè‰∏™ index ÁöÑÁªÑÁªáÁªìÊûÑÊòØ b-tree„ÄÇÂú® collection ‰∏≠ÊèíÂÖ• document ÁöÑÊó∂ÂÄôÔºå‰ºöÊõ¥Êñ∞ b-tree ÁöÑÊï∞ÊçÆÔºåÂøÖË¶ÅÊó∂ËøòÈúÄË¶ÅÂÅö rebalance Êìç‰Ωú„ÄÇ</p>
<h1 id="ÁªÑÁªáÁªìÊûÑ"><a href="#ÁªÑÁªáÁªìÊûÑ" class="headerlink" title="ÁªÑÁªáÁªìÊûÑ"></a>ÁªÑÁªáÁªìÊûÑ</h1><p>Êï∞ÊçÆÊòØÊÄé‰πàÂ≠òÂÇ®ÁöÑ„ÄÇ</p>
<p><img src="organization.png" alt="org"></p>
<p><img src="org2.png" alt="org2"></p>
<p>Âú® mongodb Â≠òÂÇ®Êï∞ÊçÆÂ∫ìÁöÑÊñá‰ª∂ÁõÆÂΩï‰∏ãÔºåÊúâËøô‰∫õÊñá‰ª∂Ôºö<br><img src="files.png" alt="file"></p>
<ul>
<li><code>collection-*.wt</code>: Êï∞ÊçÆÂ∫ìÁöÑ collection Êñá‰ª∂</li>
<li><code>index-*.wt</code>: Êï∞ÊçÆÂ∫ìÂª∫Á´ãÁöÑ index Êñá‰ª∂</li>
</ul>
<p>Áé∞Âú®ÁöÑÊï∞ÊçÆÂ∫ìÁªÑÁªáÂΩ¢ÂºèËøòÊòØ flat ÁöÑÔºå‰πüÂ∞±ÊòØÊâÄÊúâÊï∞ÊçÆÂ∫ìÊñá‰ª∂Â≠òÂÇ®Âú®‰∏Ä‰∏™ÁõÆÂΩï‰∏ã„ÄÇ</p>
<p>Êàë‰ª¨ÂèØ‰ª•‰ΩøÁî® <code>--directoryperdb</code> ÂëΩ‰ª§ËÆ© mongodb Â∞ÜÊï∞ÊçÆÂ∫ìÂ≠òÂÇ®Êó∂ÂÄôÊåâÁÖßÊñá‰ª∂Â§πÂå∫ÂàÜÂºÄÔºö</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mongod --dbpath --/data/db --fork --logpath /data/db/mongodb.log --directoryperdb</span><br></pre></td></tr></table></figure>

<p>ËøôÊ†∑ÂÜçÁúãÁõÆÂΩïÔºö<br><img src="files2.png" alt="file2"><br>ÂèØ‰ª•ÁúãÂà∞ÊØè‰∏™Êï∞ÊçÆÂ∫ìÈÉΩÊúâËá™Â∑±ÁöÑÊñá‰ª∂Â§πÁõÆÂΩï‰∫Ü„ÄÇ‰ΩÜÊòØÂú®Êñá‰ª∂ÁõÆÂΩïÈáåÈù¢ÔºåÊØîÂ¶Ç local Êñá‰ª∂ÈáåÈù¢Ôºåcollection Âíå index Êñá‰ª∂ÊòØ flat ÁöÑÂπ≥Èì∫Âú®ÈáåÈù¢ÁöÑÔºåÂπ∂Ê≤°ÊúâÂå∫ÂàÜÊñá‰ª∂Â§π„ÄÇ<br><img src="dir.png" alt="dir"></p>
<p>Êàë‰ª¨ËøòÂèØ‰ª•‰ΩøÁî® <code>--wiredTigerDirectoryForIndexes</code> ÂëΩ‰ª§ÔºåÂú®Êï∞ÊçÆÂ∫ìÊñá‰ª∂Â§πÈáåÔºåÁªô collection Âíå index ÂêÑËá™‰πüÂª∫Á´ãÊñá‰ª∂Â§π„ÄÇ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mongod --dbpath --/data/db --fork --logpath /data/db/mongodb.log --directoryperdb --wiredTigerDirectoryForIndexes</span><br></pre></td></tr></table></figure>

<p>ËøôÊó∂ÂÄôÂÜçÁúã local Êñá‰ª∂Â§πÈáåÔºö<br><img src="subdir.png" alt="subdir"></p>
<p>Â∑≤ÁªèÊúâ‰∫Ü collection Âíå index ‰∏§‰∏™Êñá‰ª∂Â§π‰∫Ü„ÄÇ</p>
<p>‰πãÊâÄ‰ª•Ëøô‰πàÂÅöÔºåÊòØ‰∏∫‰∫ÜÊèêÂçáÊï∞ÊçÆÂ∫ìÁöÑÊÄßËÉΩ„ÄÇÊàë‰ª¨ÂèØ‰ª•Â∞Ü collection Âíå index ÊîæÂú®‰∏§‰∏™‰∏çÂêåÁöÑ disk ‰∏ä„ÄÇËøôÊ†∑Âà©Áî®‰∏§‰∏™ disk ÁöÑ parallel ËØªÂÜôÔºàparallel I/OÔºâÔºåÊèêÂçá mongodb ÁöÑÊï∞ÊçÆÂêûÂêêÈáè„ÄÇ<br><img src="parallel.png" alt="parallel"></p>
]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title>„ÄêWEP„ÄëCPU Caching</title>
    <url>/blog/wep-cache/</url>
    <content><![CDATA[<p>hierarchy<br><img src="introduction.png" alt=""><br>Program code and data has <code>temporal</code> and <code>spatial locality</code>. This means that, over short periods of time, there is a good chance that the same code or data gets reused.</p>
<p>For code this means that there are most likely loops in the code so that the same code gets executed over and over again (the perfect case for <code>spatial locality</code>ÂØπ‰∫éÂàöË¢´ËÆøÈóÆÁöÑÊï∞ÊçÆÔºåÂÖ∂Áõ∏ÈÇªÁöÑÊï∞ÊçÆÂú®Â∞ÜÊù•Ë¢´ËÆøÈóÆÁöÑÊ¶ÇÁéáÈ´ò). Data accesses are also ideally limited to small regions. Even if the memory used over short time periods is not close together there is a high chance that the same data will be reused before long (<code>temporal locality</code>ÂØπ‰∫éÂàöË¢´ËÆøÈóÆÁöÑÊï∞ÊçÆÔºåÂÖ∂Êú¨Ë∫´Âú®Â∞ÜÊù•Ë¢´ËÆøÈóÆÁöÑÊ¶ÇÁéáÈ´ò).</p>
<a id="more"></a>
<p>Assume access to main memory takes 200 cycles and access to the cache memory take 15 cycles. Then code using 100 data elements 100 times each will spend 2,000,000 cycles on memory operations if there is no cache and only 168,500 cycles if all data can be cached. That is an improvement of 91.5%.</p>
<h1 id="3-1-CPU-Caches-in-the-Big-Picture"><a href="#3-1-CPU-Caches-in-the-Big-Picture" class="headerlink" title="3.1 CPU Caches in the Big Picture"></a>3.1 CPU Caches in the Big Picture</h1><p><img src="Selection_001.png" alt="Figure 3.1"><br>Figure 3.1 shows the minimum cache configuration. It corresponds to the architecture which could be found in early systems which deployed CPU caches. The CPU core is no longer directly connected to the main memory.</p>
<p><img src="Selection_002.png" alt="Figure 3.2"><br>Figure 3.2 shows three levels of cache and introduces the nomenclature we will use in the remainder of the document. L1d is the level 1 data cache, L1i is the level 1 instruction cache, etc.</p>
<p> cpu cache<br><img src="Selection_003.png" alt="Figure 3.3"><br><img src="mac_cpu_cache_info.png" alt="Figure cache ex"><br>In this figure we have two processors, each with two cores, each of which has two threads. The threads share the Level 1 caches. The cores (shaded in the darker gray) have individual Level 1 caches. All cores of the CPU share the higher-level caches. The two processors (the two big boxes shaded in the lighter gray) of course do not share any caches. All this will be important, especially when we are discussing the cache effects on multiprocess and multi-thread applications.</p>
<h1 id="3-2-Cache-Operation-at-High-Level"><a href="#3-2-Cache-Operation-at-High-Level" class="headerlink" title="3.2 Cache Operation at High Level"></a>3.2 Cache Operation at High Level</h1><p><em>By default all data read or written by the CPU cores is stored in the cache</em>. There are memory regions which cannot be cached but this is something only the OS implementers have to be concerned about; it is not visible to the application programmer. There are also instructions which allow the programmer to deliberately <code>bypass certain caches</code>. ÈªòËÆ§ÊÉÖÂÜµ‰ªéCPU cache‰∏≠ËØªÂÜôÊï∞ÊçÆÔºåÂÜÖÂ≠ò‰∏≠‰πüÊúâ‰∏çËÉΩcacheÁöÑÈÉ®ÂàÜÔºå‰ΩÜËøôÊòØÁî±Êìç‰ΩúÁ≥ªÁªüÂÖ≥ÂøÉÁöÑÔºåÊó†ÂÖ≥ programmer„ÄÇ‰πüÂèØ‰ª•ÈÄöËøáÁâπÂÆöÁöÑÊåá‰ª§ÔºåÁªïËøá cache„ÄÇ</p>
<p>If the CPU needs a data word the caches are searched first. Obviously, the cache cannot contain the content of the entire main memory (otherwise we would need no cache), but since all memory addresses are cacheable, each cache entry is <code>tagged</code> using the address of the data word in the main memory. This way a request to read or write to an address can search the caches for a matching tag. The address in this context can be either the virtual or physical address, varying based on the cache implementation.</p>
<p>Since for the tag, in addition to the actual memory, additional space is required, it is inefficient to chose a word as the granularity of the cache. For a 32-bit word on an x86 machine the tag itself might need 32 bits or more. Furthermore, since spatial locality is one of the principles on which caches are based, it would be bad to not take this into account. Since neighboring memory is likely to be used together it should also be loaded into the cache together. In early caches these lines were 32 bytes long; nowadays the norm is 64 bytes. <code>If the memory bus is 64 bits wide this means 8 transfers per cache line</code>. DDR supports this transport mode efficiently.</p>
<p>When memory content is needed by the processor the entire cache line is loaded into the L1d. The memory address for each cache line is computed by masking the address value according to the cache line size. For a 64 byte cache line this means the low 6 bits are zeroed. The discarded bits are used as the offset into the cache line. The remaining bits are in some cases used to locate the line in the cache and as the tag. In practice an address value is split into three parts. For a 32-bit address it might look as follows:</p>
<p><img src="Selection_004.png" alt=""></p>
<p>With a cache line size of $2^O$ the low $O$ bits are used as the offset into the cache line. The next $S$ bits select the ‚Äúcache set‚Äù.</p>
<p>For now it is sufficient to understand there are $2^S$ sets of cache lines. This leaves the top $32‚àíS‚àíO = T$ bits which form the tag. These $T$ bits are the value associated with each cache line to distinguish all the aliases(<code>All cache lines with the same S part of the address are known by the same alias</code>) which are cached in the same cache set. The $S$ bits used to address the cache set do not have to be stored since they are the same for all cache lines in the same set. The $S$ bits used to address the cache set do not have to be stored since they are the same for all cache lines in the same set.</p>
<p>When an instruction modifies memory the processor still has to load a cache line first because no instruction modifies an entire cache line at once (exception to the rule: write-combining as explained in section 6.1). The content of the cache line before the write operation therefore has to be loaded. It is not possible for a cache to hold partial cache lines. A cache line which has been written to and which has not been written back to main memory is said to be ‚Äúdirty‚Äù. Once it is written the dirty flag is cleared. ÂΩìinstruction‰øÆÊîπmemoryÊó∂ÂÄôÔºå‰ªçÁÑ∂ÈúÄË¶Åload cache line„ÄÇÂ∑≤ÁªèË¢´written‰ΩÜÊòØÂπ∂Ê≤°ÊúâË¢´ÂÜô‰ºö memory ÁöÑ cache lineÔºå‰ºöË¢´Êàê‰∏∫ <code>‚Äúdirty‚Äù</code>„ÄÇ‰∏ÄÊó¶Ë¢´ÂÜôÂõû memoryÔºåÈÇ£‰πà dirty flag Â∞±‰ºöË¢´ cleard„ÄÇ</p>
<p><code>cache coherency</code>:<br>MESI</p>
<ul>
<li>A dirty cache line is not present in any other processor‚Äôs cache.</li>
<li>Clean copies of the same cache line can reside in arbitrarily many caches.</li>
</ul>
<p>Costs associated with cache hits and misses</p>
<p><img src="cache_cost.png" alt=""><br>For the on-die L2 cache a large part (probably even the majority) of the access time is caused by wire delays. This is a physical limitation which can only get worse with increasing cache sizes. Only process shrinking (for instance, going from 60nm for Merom to 45nm for Penryn in Intel‚Äôs lineup) can improve those numbers. Áâá‰∏ä L2 cache ÁöÑÁì∂È¢àÂú®wire delay‰∏äÔºåÂè™ÊúâÁº©Â∞èÂ∞∫ÂØ∏ÊâçËÉΩÊîπÂñÑÔºåÊØîÂ¶Ç‰ªé 60nm Â∑•Ëâ∫ÂèòÊàê 45nm Â∑•Ëâ∫„ÄÇ</p>
<h1 id="CPU-Cache-Implementation-Details"><a href="#CPU-Cache-Implementation-Details" class="headerlink" title="CPU Cache Implementation Details"></a>CPU Cache Implementation Details</h1><h2 id="Associativity"><a href="#Associativity" class="headerlink" title="Associativity"></a>Associativity</h2><ul>
<li>Fully Associative CacheÔºö<br>Êï∞ÊçÆ A ÂèØÂ≠òÊîæÂú® cache ÁöÑ‰ªªÊÑè‰ΩçÁΩÆ„ÄÇ ËÆæËÆ°Â§çÊùÇÔºåÁâπÂà´ÂΩì cache size ÂæàÂ§ßÊó∂ÔºåÁ°¨‰ª∂ÊàêÊú¨ÈùûÂ∏∏‰πãÈ´ò„ÄÇ<br>It would be possible to implement a cache where each cache line can hold a copy of any memory location.</li>
</ul>
<p><img src="Selection_005.png" alt="Figure3.5"> <img src="fully.png" alt=""><br>To access a cache line the processor core would have to compare the tags of each and every cache line with the tag for the requested address. The tag would be comprised of the entire part of the address which is not the offset into the cache line (that means, S is zero).<br>Given a <code>4MB cache with 64B cache lines</code>the cache would have <code>65,536 entries</code>. To achieve adequate performance the cache logic would have to be able to pick from all these entries the one matching a given tag in just a few cycles.<br>Fully associative caches are practical for small caches (for instance, the TLB caches on some Intel processors are fully associative) but those caches are small, really small. We are talking about a few dozen entries at most.</p>
<ul>
<li>Direct-Mapped Cache<br>Êï∞ÊçÆ A Âú® cache ÁöÑÂ≠òÊîæ‰ΩçÁΩÆÂè™ÊúâÂõ∫ÂÆö‰∏ÄÂ§Ñ„ÄÇ‰ªéËÆæËÆ°ÁªìÊûÑÁúãÔºåÊï∞ÊçÆÊâÄÂú®cache lineÔºåÁõ¥Êé•Áî± Set ÂÜ≥ÂÆöÔºåËøôÊ†∑ÂØπÂ∫îÁöÑTagÂ∞±Âè™ËÉΩÊîæÁΩÆÂú®SetÊâÄÂÜ≥ÂÆöÁöÑ‰ΩçÁΩÆÔºàÊã•ÊúâÁõ∏ÂêåSetÁöÑdataÂè™ËÉΩÊîæÁΩÆÂú®Áõ∏ÂêåÁöÑ‰ΩçÁΩÆÔºâ„ÄÇËÄå‰∏çËÉΩÂ¶Ç Fully ÈÇ£Ê†∑ÊîæÂú®‰ªªÊÑècache line„ÄÇËøôÊòØÁî±ËÆæËÆ°ÁªìÊûÑÂÜ≥ÂÆöÁöÑ„ÄÇÁõ¥Êé•ÂêéÊûúÂ∞±ÊòØÂΩì program ‰ΩøÁî®ÁöÑ memory Âπ∂‰∏ç evenly ÂàÜÂ∏ÉÊó∂ÂÄôÔºåÊüê‰∫õ cache line ‰ºöË¢´ËøáÂ∫¶‰ΩøÁî®ÁöÑÂêåÊó∂ÔºåÂè¶‰∏Ä‰∫õÂèØËÉΩ‰∏ÄÁõ¥Á©∫ÁùÄÔºåÊâÄ‰ª•ÂÆπÊòì‰∫ßÁîüÁ¢∞ÊíûÔºåÊúÄÁªàÈôç‰Ωé cache ÁöÑÂëΩ‰∏≠ÁéáÔºåÂΩ±ÂìçÊÄßËÉΩ„ÄÇ</li>
</ul>
<p><img src="Selection_006.png" alt=""> <img src="direct.png" alt=""></p>
<p>It requires exactly one comparator, one multiplexer (two in this diagram where tag and data are separated, but this is not a hard requirement on the design), and some logic to select only valid cache line content).<br>The number of transistors in a simple multiplexer grows with O(log N), where N is the number of cache lines.<br>This is tolerable but might get slow, in which case speed can be increased by spending more real estate on transistors in the multiplexers to parallelize some of the work and to increase the speed.</p>
<p>It has a <code>drawback</code>: it only works well if the addresses used by the program are evenly distributed with respect to the bits used for the direct mapping. If they are not, and this is usually the case, some cache entries are heavily used and therefore repeated evicted while others are hardly used at all or remain empty.</p>
<ul>
<li>N-Way Set-Associative Cache:<br>Êï∞ÊçÆ A Âú® cache ÁöÑÂ≠òÊîæ‰ΩçÁΩÆÂèØ‰ª•Êúâ N Â§Ñ„ÄÇÂêåÊ†∑ÁöÑSetÂèØ‰ª•ÂêåÊó∂ÊîæÂ§ö‰∏™TagÁöÑdataÔºåÁî±NÂÜ≥ÂÆö„ÄÇ</li>
</ul>
<p><img src="Selection_007.png" alt=""> <img src="set_associative.png" alt=""></p>
<p>ÁªìÊûÑÂõæ‰∏≠ÔºåÂêå‰∏ÄSetÂØπÂ∫îÂõæ‰∏≠Âêå‰∏ÄÂàóÔºåÂπ∂‰∏îÊ≠§ÁªìÊûÑÂõæÊòØ4 way ÁöÑÔºàwayÊòØË°åÔºâ„ÄÇÊàëPCÁöÑcacheÈÖçÁΩÆÔºåL2 cache 256K, 8-way Set-associative, 512‰∏™setÔºåcache line 64B„ÄÇÊØè‰∏™ÊñπÂùóÂØπÂ∫î cache Line Â§ßÂ∞è 64ÔºåÊâÄ‰ª•ÊÄª cache Â§ßÂ∞èÊòØ row<em>col</em>size_of_one_cell = 8ÔºàwayÔºâ √ó 512ÔºàSet sizeÔºâ√ó 64B = 256KB„ÄÇÁ¨¶ÂêàÊàëÁöÑÈÖçÁΩÆÂèÇÊï∞„ÄÇËøôÊ†∑ÁöÑËØùÔºåÁî± Set Âíå Offset ÁªÑÊàêÁöÑ (9+6) 15bit ÔºåÂÜ≥ÂÆö‰∫Ü Âú∞ÂùÄ‰ºöÊØèÈöî $2^15$ÔºåÂç≥32768 Byte Êï∞ÊçÆÔºåÂ∞±ËêΩÂú®cache ÁöÑÂêå‰∏Ä‰∏™ set ‰∏≠„ÄÇÂΩì‰∏Ä‰∏™ Set Ë¢´ÈÄâ‰∏≠ÔºåÈÇ£‰πà N-way ÊåáÂêëÁöÑ N ‰∏™ cache line address ÈúÄË¶ÅÂêåÊó∂Ë¢´ÊØîËæÉÔºå‰ª•Á°ÆÂÆödata ÊòØÂê¶Âú® cache ‰∏≠„ÄÇ<br>A set-associative cache combines the good features of the full associative and direct-mapped caches to largely avoid the weaknesses of those designs.cd<br>The tag and data storage are divided into sets, one of which is selected by the address of a cache line. This is similar to the direct-mapped cache. But <code>instead of only having one element for each set value in the cache, a small number of values is cached for the same set value.</code> The tags for all the set members are compared in parallel, which is similarr to the functioning of the fully associative cache.</p>
<p>Today processors are using associativity levels of up to 24 for L2 caches or higher. L1 caches usually get by with 8 sets.<br>we can use <code>sudo dmidecode -t cache</code> cmd to see configuration of cache.</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">Handle <span class="number">0x0004</span>, DMI type <span class="number">7</span>, <span class="number">19</span> bytes</span><br><span class="line">Cache Information</span><br><span class="line">	Socket Designation: L2-Cache</span><br><span class="line">	Configuration: Enabled, Not Socketed, Level <span class="number">2</span></span><br><span class="line">	Operational Mode: Write Through</span><br><span class="line">	Location: Internal</span><br><span class="line">	Installed Size: <span class="number">256</span> kB</span><br><span class="line">	Maximum Size: <span class="number">256</span> kB</span><br><span class="line">	Supported SRAM Types:</span><br><span class="line">		Unknown</span><br><span class="line">	Installed SRAM Type: Unknown</span><br><span class="line">	Speed: Unknown</span><br><span class="line">	Error Correction Type: Multi-<span class="built_in">bit</span> ECC</span><br><span class="line">	System Type: Unified</span><br><span class="line">	Associativity: <span class="number">8</span>-way Set-associative</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>cache <code>ÂëΩ‰∏≠Áéá</code>Ôºö</p>
<p><img src="Selection_008.png" alt=""><br>we can see that associativity can indeed help to reduce the number of cache misses significantly.<br>In general, increasing the associativity of a cache <code>above 8 seems to have little effects</code> for a single-threaded workload. With the introduction of <code>hyper-threaded</code> processors where the first level cache is shared and multi-core processors which use a shared L2 cache the situation changes. Now you basically have two programs hitting on the same cache which causes the associativity in practice to be halved (or quartered for quad-core processors). So it can be expected that, with increasing numbers of cores, the associativity of the shared caches should grow. Once this is not possible anymore (16-way set associativity is already hard) processor designers have to start using shared L3 caches and beyond, while L2 caches are potentially shared by a subset of the cores.</p>
<h2 id="Measurements-of-Cache-Effects"><a href="#Measurements-of-Cache-Effects" class="headerlink" title="Measurements of Cache Effects"></a>Measurements of Cache Effects</h2><p>‰ΩøÁî®‰∏Ä‰∏™ÈìæË°®Êù•ÊµãËØï Cache ÂΩ±Âìç„ÄÇ</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">l</span> &#123;</span></span><br><span class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">l</span> *<span class="title">n</span>;</span></span><br><span class="line">   <span class="keyword">long</span> <span class="keyword">int</span> pad[NPAD];</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>
<p>Â¶ÇÊûú NPAD = 7„ÄÇÂú® 32bit Êú∫Âô®‰∏äÔºåÊØè‰∏™ element Â§ßÂ∞è 32byteÔºåÂú® 64bit Êú∫Âô®‰∏äÔºåelement Â§ßÂ∞è 64byte„ÄÇ</p>
<h3 id="Single-Threaded-Sequential-Access"><a href="#Single-Threaded-Sequential-Access" class="headerlink" title="Single Threaded Sequential Access"></a>Single Threaded Sequential Access</h3><p>ÊµãËØïÁéØÂ¢ÉÔºö64bitÊú∫Âô®Ôºå16KB L1dÔºå1MB L2<br>Á∫µËΩ¥ÊòØ CPU Cycle„ÄÇY‚Äìaxis shows the average number of CPU cycles it takes to process one element;</p>
<p><img src="Selection_010.png" alt=""><br>ÂèØ‰ª•ÁúãÂà∞Âõæ‰∏äÊúâ‰∏â‰∏™ÊÆµÔºö</p>
<ul>
<li>Up to a working set size of $ 2^{14}$ bytes. ÔºàL1dÂΩ±ÂìçÔºâ</li>
<li>From $2^{15}$ bytes to $2^{20}$ bytes.ÔºàL2ÂΩ±ÂìçÔºâ</li>
<li>From $2^{21}$ bytes and up.</li>
</ul>
<p>We do not see sharp edges in the transition from one level to the other because the caches are used by other parts of the system as well and so the cache is not exclusively available for the program data. Specifically the L2 cache is a unified cache and also used for the instructions.<br>Á¨¨‰∫åÊÆµÔºåÂΩìL1dÁöÑÂ§ßÂ∞è‰∏çË∂≥Â§ü hold all data ÁöÑÊó∂ÂÄôÔºåÈúÄË¶Å L2 Â≠òÂÇ®„ÄÇ‰ΩÜÊòØ‰ªé‰πãÂâçÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞ L2 ÁöÑ access time ÈúÄË¶ÅÁ∫¶ 14 cycleÔºåËøôÈáåÂç¥Âè™ÈúÄË¶Å 9 cycle Â∑¶Âè≥„ÄÇËøôÊòØÂõ†‰∏∫ CPU Êúâ‰∏Ä‰∏™ <code>prefetch</code> ÁöÑÊìç‰ΩúÔºåÂç≥ÂΩìÂºÄÂßã‰ΩøÁî®‰∏Ä‰∏™Êñ∞ÁöÑ cache line ÁöÑÊó∂ÂÄôÔºåÂÆÉÂ∑≤ÁªèË¢´ cache ‰∏ÄÈÉ®ÂàÜ‰∫Ü„ÄÇ<br>ËÄå prefetch ÁöÑ‰ΩúÁî®ÔºåÂú® working set Ë∂ÖËøá L2 Â§ßÂ∞èÁöÑÊó∂ÂÄôÔºåÂ∞§ÂÖ∂ÁúãÂæóËßÅ„ÄÇ‰πãÂâçËØ¥ËøáÔºåmemory access ÈúÄË¶Å 200+ cycleÔºåÂè™ÊúâÂú®ÊúâÊïàÁöÑ prefetching‰∏ãÔºåÊâçÂèØËÉΩÁª¥ÊåÅ‰Ωè 9 cycle ÁöÑ access time„ÄÇ</p>
<p>Âú®Á¨¨‰∏âÊÆµ‰∏≠ÔºåprefetchËµ∑Âà∞‰∫ÜÈùûÂ∏∏Â•ΩÁöÑ‰ΩúÁî®„ÄÇÂ∞Ü‰πãÂâçÊâÄËØ¥ÁöÑ main memory access time ‰ªé 200+ ÈôçÂà∞‰∫Ü 9„ÄÇ</p>
<p><em>‰∏ãÈù¢ÁúãÂêåÊ†∑working setÊµãËØï‰∏ãÔºå‰∏çÂêåÁöÑ element Â§ßÂ∞èÂØπÊó∂Èó¥ÂΩ±Âìç</em>Ôºö</p>
<p><img src="Selection_011.png" alt=""><br>element size Ë∂äÂ§ßÔºàNPADË∂äÂ§ßÔºâÔºåËØ¥Êòé working set ÁöÑ element ‰∏™Êï∞Ë∂äÂ∞ë„ÄÇÂêåÊó∂ÊÑèÂë≥ÁùÄÔºåÊØè‰∏™ element ‰πãÈó¥ÁöÑ distance ÂèòÂ§ß‰∫Ü„ÄÇÂú®‰∏äÈù¢ÁöÑÂõõ‰∏™ÊµãËØïÁéØÂ¢É‰∏ãÔºådistance ÊòØ 0, 56, 120, 248 byte„ÄÇÔºàNPAD√ó8Ôºâ</p>
<p>‰ªé‰∏äÈù¢Âõæ‰∏≠Ôºå‰ªçÁÑ∂ÂèØ‰ª•ÁúãÂà∞ cache ÂØπ access time ÁöÑÂΩ±ÂìçÔºå‰ªçÁÑ∂ÂèØ‰ª•ÁúãÂà∞Ë¢´ÂàÜÊàê‰∏âÊÆµ„ÄÇÂè™‰∏çËøáÈöèÁùÄ distance Â¢ûÂä†Ôºåaccess time ÁöÑÂ∞∫Â∫¶Â¢ûÈïøÁöÑË∂äÊù•Ë∂äÂø´„ÄÇ</p>
<p>Âú®Á¨¨‰∫åÊÆµ‰∏≠Ôºàworking set size Â∞è‰∫é L2 sizeÔºâÔºåÂèØ‰ª•ÁúãÂà∞ L2 ÁöÑ access time Â∑≤ÁªèÂú® 28 Â∑¶Âè≥‰∫Ü„ÄÇËØ¥Êòé CPU ÁöÑ prefetch (from L2 into L1d) Ê≤°ÊúâËµ∑Âà∞‰ΩúÁî®„ÄÇÂΩì NPAD=7ÔºåÂç≥‰∏Ä‰∏™Êï∞ÊçÆ 64BÔºåÊØèËØª‰∏Ä‰∏™Êï∞ÊçÆÔºåÂ∞±Ë¶Å load ‰∏Ä‰∏™Êñ∞ÁöÑ cache lineÔºõËÄå NPAD=0Ôºå‰∏Ä‰∏™Êï∞ÊçÆ4BÔºå‰∏Ä‰∏™ cache line ÂèØ‰ª•Â≠ò 8 ‰∏™Êï∞ÊçÆÔºåÈÇ£‰πà loop Âæ™ÁéØ 8 Ê¨°‰ª•ÂêéÔºåÊâçÈúÄ load ‰∏ã‰∏Ä‰∏™ cache lineÔºåÊâÄ‰ª• prefetch logic ÂèØ‰ª• load ‰∏ÄÈÉ®ÂàÜ elementÔºàNPAD=0Êó∂Ôºâ„ÄÇÂõ†‰∏∫prefetch ‰∏çËÉΩ load Êï¥‰∏™ next cache lineÔºåÊâÄ‰ª•Âú® element ËøáÂ§ßÁöÑÊó∂ÂÄôÔºåL2 Âà∞ L1d ÁöÑ prefetch ‰∏çÂÜçËµ∑‰ΩúÁî®„ÄÇ ÊØèÊ¨°ÈÉΩÈúÄË¶Å‰ªéL2‰∏≠ load Êï∞ÊçÆ„ÄÇ</p>
<p>Á¨¨‰∏âÊÆµ‰∏≠Ôºåworking set Ë∂ÖËøá‰∫ÜL2 capacityÔºåprefetch Êõ¥Ëµ∑‰∏ç‰∫Ü‰ΩúÁî®„ÄÇ</p>
<p>Âè¶Â§ñ‰∏Ä‰∏™ÂØºËá¥ access time slowdown ÁöÑÂéüÂõ†ÊòØTLB cache ÁöÑmisses„ÄÇThe TLB cache is quite small since it has to be extremely fast. If more pages are accessed repeatedly than the TLB cache has entries for the translation from virtual to physical address has to be constantly repeated. This is a very costly operation. With larger element sizes the cost of a TLB lookup is amortized over fewer elements. That means the total number of TLB entries which have to be computed per list element is higher. ÂΩì element size ËøáÂ§ßÔºåÈÇ£‰πà ÊØèÊ¨° TLB Êü•ÊâæËé∑ÂæóÁöÑ element ‰∏™Êï∞Â∞±Â∞ë‰∫ÜÔºåÊÑèÂë≥ÁùÄÈó¥ÈöîÊõ¥Â∞ëÁöÑÂÖÉÁ¥†ÔºåÂ∞±Ë¶ÅËøõË°å‰∏ÄÊ¨° Êñ∞ÁöÑpage table Êü•Êâæ‰ª•Êõ¥Êñ∞ TLB cacheÔºå‰ªéËÄå <code>ËÄóÊó∂/element</code> Â§ßÂπÖÂ∫¶Â¢ûÂä†„ÄÇ</p>
<ul>
<li>‰∏ãÈù¢ËßÇÂØü TLB ÂØπ access time ÁöÑÂΩ±ÂìçÔºö*</li>
</ul>
<ul>
<li><p>use NPAD=7 for elements which occupy one entire cache line</p>
</li>
<li><p>place each list element on a separate page. The rest of each page is left untouched and we do not count it in the total for the working set size</p>
<p>The consequence is that, for the first measurement, each list iteration requires a new cache line and, for every 64 elements, a new page. For the second measurement each iteration requires loading a new cache line which is on a new page.<br>Á¨¨‰∏Ä‰∏™ÂÆûÈ™åÔºåÊØèÊ¨° iteration a new element Â∞±Ë¶Å fetch ‰∏Ä‰∏™ new cache lineÔºåÊØè 64 ‰∏™ fetch ‰∏Ä‰∏™Êñ∞ page„ÄÇ<br>Á¨¨‰∫å‰∏™ÂÆûÈ™åÔºåÊØèÊ¨° iteration a new element Â∞±Ë¶Å fetch ‰∏Ä‰∏™ new cache lineÔºåÊØè 1   ‰∏™ fetch ‰∏Ä‰∏™Êñ∞ page„ÄÇ</p>
</li>
</ul>
<p><img src="Selection_012.png" alt=""><br>We see the distinct steps showing the sizes of the L1d and L2 caches. The second curve looks radically different. The important feature is the huge spike starting when the working set size reaches $2^{13}$ bytes. This is when the TLB cache overflows. With an element size of 64 bytes we can compute that the TLB cache has 64 entriesÔºà$2^{13}$ÂºÄÂßãÊ∫¢Âá∫ÔºåËØ¥Êòé$2^{12}$Ê≠£Â•ΩÂ°´Êª° TLBÔºåÈÇ£‰πà$2^{12}$ byte Êï∞ÊçÆÔºåÊÄªÂÖ±Êúâ 64byte ÁöÑ element 64 ‰∏™ÔºåÂõ†‰∏∫ËøôÈáåÁöÑÊµãËØïÊù°‰ª∂‰∏ãÔºåÊØè‰∏™ element ÈÉΩ‰ºöËØ∑Ê±Ç‰∏Ä‰∏™Êñ∞ÁöÑpageÔºåÊâÄ‰ª• TLB ÁöÑentries number ÊòØ 64Ôºâ. There are no page faults affecting the cost since the program locks the memory to prevent it from being swapped out.</p>
<p><em>‰∏ãÈù¢ËßÇÂØü prefetch ÁöÑÂΩ±Âìç</em></p>
<p><img src="Selection_013.png" alt=""></p>
<ul>
<li>The element width is in all cases 16 bytes. The first line is the now familiar list walk which serves as a baseline.</li>
<li>The second line, labeled ‚ÄúInc‚Äù, simply increments the pad[0] member of the current element before going on to the next. ÔºàÂ∞ÜÂΩìÂâçpad[0] Â¢ûÂä†1Ôºâ</li>
<li>The third line, labeled ‚ÄúAddnext0‚Äù, takes the pad[0] list element of the next element and adds it to the pad[0] member of the current list element ÔºàÂ∞Ü‰∏ã‰∏Ä‰∏™ element ÁöÑ pad[0] Âä†Âà∞ÂΩìÂâçÁöÑ pad[0] ‰∏äÔºâ<br>The na¬®ƒ±ve assumption would be that the ‚ÄúAddnext0‚Äù test runs slower because it has more work to do. Before advancing to the next list element a value from that element has to be loaded. This is why it is surprising to see that this test actually runs, for some working set sizes, faster than the ‚ÄúInc‚Äù test. The explanation for this is that the load from the next list element is basically a forced prefetch. Whenever the program advances to the next list element we know for sure that element is already in the L1d cache. As a result we see that the ‚ÄúAddnext0‚Äù performs as well as the simple ‚ÄúFollow‚Äù test <code>as long as the working set size fits into the L2 cache</code>. Ôºà<code>‰∏∫‰ªÄ‰πàÁ¨¨‰∫åÊÆµÂú®L2 cache ÁöÑÊó∂ÂÄôÔºåAddnext0‰ºöÊØî inc Âø´Âë¢</code>Ôºâ</li>
</ul>
<p>The ‚ÄúAddnext0‚Äù test runs out of L2 faster than the ‚ÄúInc‚Äù test, though. It needs more data loaded from main memory. This is why the ‚ÄúAddnext0‚Äù test reaches the 28 cycles level for a working set size of 2 21 bytes. The 28 cycles level is <code>twice</code> as high as the 14 cycles level the ‚ÄúFollow‚Äù test reaches. This is easy to explain, too. Since the other two tests modify memory an L2 cache eviction to make room for new cache lines cannot simply discard the data. Instead <code>it has to be written to memory</code>ÔºàÊâÄ‰ª•Â∞±‰ºöÊúâËØªÂÜôÔºåËøô‰∏§Ê¨°memory accessÔºåÊâÄ‰ª•Êó∂Èó¥ÊòØ‰∏§ÂÄçÔºâ. This means the available bandwidth on the FSB is cut in half, hence doubling the time it takes to transfer the data from main memory to L2.</p>
<p>to be continue‚Ä¶</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://lwn.net/Articles/252125/" target="_blank" rel="noopener">CPU caches</a></p>
]]></content>
      <categories>
        <category>OS</category>
      </categories>
      <tags>
        <tag>memory</tag>
      </tags>
  </entry>
  <entry>
    <title>„ÄêTP„Äë19 Paging:Faster Translations</title>
    <url>/blog/Paging/</url>
    <content><![CDATA[<p>TLB stands for translation-lookaside buffer.<br>A TLB is part of the chip‚Äôs memory-management unit (<code>MMU</code>), and is simply a <code>hardware cache</code> of popular virtual-to-physical address translations.; thus, a better name would be an <code>address-translation cache</code></p>
<p>Upon each virtual memory reference, the hardware first checks the TLB to see if the desired translation is held therein; if so, the translation is performed (quickly) without having to consult the page table (which has all translations). Because of their tremendous performance impact, TLBs in a real sense make virtual memory possible. Êúâ‰∫Ü TLBÔºåÂú®ËÆøÈóÆ memory ÁöÑÊó∂ÂÄôÔºåÂ¶ÇÊûú desired translation Âú® TLBÔºåÂàôÁõ¥Êé• translationÔºåËÄå‰∏çÁî®ÁªèËøá page table ÁöÑËΩ¨‰πâ„ÄÇ</p>
<h1 id="TLB-Basic-Algorithm"><a href="#TLB-Basic-Algorithm" class="headerlink" title="TLB Basic Algorithm"></a>TLB Basic Algorithm</h1><p>ÂÅáËÆæÔºö</p>
<ol>
<li>linear page table</li>
<li>a hardware-managed TLB<a id="more"></a>
<img src="Selection_001.png" alt=""><br>The algorithm the hardware follows works like this: first, extract the virtual page number (<code>VPN</code>) from the virtual address (Line 1 in Figure 19.1), and check if the TLB holds the translation for this VPN (Line 2). If it does, we have a TLB hit, which means the TLB holds the translation. Success! We can now extract the page frame number (PFN) from the relevant TLB entry, concatenate that onto the offset from the original virtual address, and form the desired physical address (PA), and access memory (Lines 5‚Äì7), assuming protection checks do not fail (Line 4).</li>
</ol>
<p>If the CPU does not find the translation in the TLB (a <code>TLB miss</code>), we have some more work to do.</p>
<h1 id="Example-Accessing-An-Array"><a href="#Example-Accessing-An-Array" class="headerlink" title="Example: Accessing An Array"></a>Example: Accessing An Array</h1><p><img src="Selection_002.png" alt=""><br>assume we have an array of 10 4-byte integers in memory, starting at virtual address 100. Assume further that we have a small 8-bit virtual address space, with 16-byte pages; thus, a virtual address breaks down into a 4-bit VPN (there are 16 virtual pages) and a 4-bit offset (there are 16 bytes on each of those pages).</p>
<p>As you can see, the array‚Äôs first entry (a[0]) begins on (VPN=06, offset=04); only three 4-byte integers fit onto that page. The array continues onto the next page (VPN=07), where the next four entries (a[3] ‚Ä¶ a[6]) are found. Finally, the last three entries of the 10-entry array (a[7] ‚Ä¶ a[9]) are located on the next page of the address space (VPN=08).</p>
<p>Now let‚Äôs consider a simple loop:</p>
<p><img src="Selection_003.png" alt=""><br> The elements of the array are packed tightly into pages (i.e., they are close to one another in space), and thus only the first access to an element on a page yields a TLB miss.</p>
<p>CISC computers use hardware-managed TLB<br>RISC computers use software-managed TLB</p>
<h1 id="TLB-Contents-What‚Äôs-In-There"><a href="#TLB-Contents-What‚Äôs-In-There" class="headerlink" title="TLB Contents: What‚Äôs In There?"></a>TLB Contents: What‚Äôs In There?</h1><p>A TLB entry might look like this:<br>$$VPN | PFN | other bits$$</p>
<p>The TLB is known as a <code>fully-associative cache</code>). The hardware <code>searches</code> the entries in <code>parallel</code> to see if there is a match</p>
<h1 id="TLB-Issue-Context-Switches"><a href="#TLB-Issue-Context-Switches" class="headerlink" title="TLB Issue: Context Switches"></a>TLB Issue: Context Switches</h1><p>With TLBs, some new issues arise when switching between processes (and hence address spaces).</p>
<p>The TLB contains virtual-to-physical translations that are only valid for the currently running process; these translations are not meaningful for other processes. As a result, when switching from one process to another, the hardware or OS (or both) must be careful to ensure that the about-to-be-run process does not accidentally use translations from some previously run process.</p>
<p>Assuming two process run in CPU and the TLB will be like following:</p>
<p><img src="Selection_005.png" alt=""><br>In the TLB above, we clearly have a problem: VPN 10 translates to either PFN 100 (P1) or PFN 170 (P2), but the hardware can‚Äôt distinguish which entry is meant for which process.</p>
<ul>
<li>One approach is to simply flush the TLB on context switches, thus emptying it before running the next process.<br>However, there is a cost: each time a process runs, it must incur TLB misses as it touches its data and code pages. If the OS switches between processes frequently, this cost may be high</li>
<li>To reduce this overhead, some systems add hardware support to enable sharing of the TLB across context switches. In particular, some hardware systems provide an<code>address space identifier (ASID)</code> field in the TLB.</li>
</ul>
<p><img src="Selection_004.png" alt=""><br>Thus, with address-space identifiers, the TLB can hold translations from different processes at the same time without any confusion.</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="http://pages.cs.wisc.edu/~remzi/OSTEP/vm-tlbs.pdf" target="_blank" rel="noopener">Translation Lookaside Buffers</a></p>
]]></content>
      <categories>
        <category>OS</category>
      </categories>
      <tags>
        <tag>memory</tag>
      </tags>
  </entry>
  <entry>
    <title>„ÄêTP„Äë18 Introduction to Paging</title>
    <url>/blog/intro-to-paging/</url>
    <content><![CDATA[<p>Â∞Ü memory ÂàÜÂâ≤Êàê fixed-sized ÂùóÔºåËøôÂ∞±Âè´ <code>paging</code></p>
<p>We divide address space into fixed-sized units, each of which we call a <code>page</code>. Correspondingly, we view physical memory as an array of fixed-sized slots called <code>page frames</code>.</p>
<h1 id="A-Simple-Example-And-Overview"><a href="#A-Simple-Example-And-Overview" class="headerlink" title="A Simple Example And Overview"></a>A Simple Example And Overview</h1><p>OS may find free spaces from a <code>free list</code> to your program, and there will be a mapping relationship between physical address and virtual address.</p>
<p><img src="Selection_001.png" alt=""><br>To record where each virtual page of the address space is placed in physical memory, the operating system usually keeps a <code>per-process</code> data structure known as a <code>page table</code>.</p>
<a id="more"></a>
<p>The major role of the page table is to store <code>address translations</code> for each of the virtual pages of the address space.</p>
<p>It is important to remember that this page table is a per-process data structure (most page table structures we discuss are per-process structures; an exception we‚Äôll touch on is the <code>inverted page table</code>).</p>
<p><code>page table entry (PTE)</code></p>
<p><img src="Selection_002.png" alt=""></p>
<ul>
<li>A <code>valid bit</code> is common to indicate whether the particular translation is valid</li>
<li><code>protection bits</code>, indicating whether the page could be read from, written to, or executed from</li>
<li>A <code>present bit</code> indicates whether this page is in physical memory or on disk (i.e., it has been swapped out). We will understand this machinery further when we study how to swap parts of the address space to disk to support address spaces that are larger than physical memory; swapping allows the OS to free up physical memory by moving rarely-used pages to disk.</li>
<li>A <code>dirty</code> bit is also common, indicating whether the page has been modified since it was brought into memory</li>
<li>A <code>reference</code> bit (a.k.a. <code>accessed bit</code>) is sometimes used to track whether a page has been accessed, and is useful in determining which pages are popular and thus should be kept in memory; such knowledge is critical during page replacement<h1 id="Paging-can-be-slow"><a href="#Paging-can-be-slow" class="headerlink" title="Paging can be slow"></a>Paging can be slow</h1></li>
</ul>
<p><img src="Selection_003.png" alt=""><br>For every memory reference (whether an instruction fetch or an explicit load or store), <code>paging</code> requires us to <code>perform one extra memory reference</code> in order to first fetch the translation from the page table. That is a lot of work! Extra memory references are costly, and in this case will likely slow down the process by a factor of two or more.</p>
<p>Áúã‰∏ãÈù¢‰∏ÄÊÆµ‰ª£Á†ÅÔºö</p>
<p><img src="Selection_006.png" alt=""><br>Ê±áÁºñÂêéÁöÑÔºö</p>
<p><img src="Selection_005.png" alt=""><br>%edi holds the base address of the array, whereas %eax holds the array index (i);</p>
<p><img src="Selection_004.png" alt=""><br>When it runs, each instruction fetch will generate two memory references:</p>
<ul>
<li>one to the page table to find the physical frame that the instruction resides within</li>
<li>one to the instruction itself to fetch it to the CPU for processing</li>
<li>there is one explicit memory reference in the form of the mov instruction; this adds another page table access first (to translate the array virtual address to the correct physical one) and then the array access itself.</li>
</ul>
<p>ÂõæËß£Ôºö</p>
<ol>
<li>assume we have a linear (array-based) page table and that it is located at physical address 1KB (1024).</li>
<li>the page size is 1KB, virtual address 1024 resides on the second page of the virtual address space (VPN=1, as VPN=0 is the first page). Let‚Äôs assume this virtual page maps to physical frame 4 (VPN 1 ‚Üí PFN 4).</li>
<li>array itself. Its size is 4000 bytes (1000 integers), and we assume that it resides at virtual addresses 40000 through 44000</li>
<li>Let‚Äôs assume these virtual-to-physical mappings for the example: (VPN 39 ‚Üí PFN 7), (VPN 40 ‚Üí PFN 8), (VPN 41 ‚Üí PFN 9), (VPN 42 ‚Üí PFN 10)</li>
</ol>
<p>there are 10 memory accesses per loop, which includes four instruction fetches, one explicit update of memory, and five page table accesses to translate those four fetches and one explicit update.</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="http://pages.cs.wisc.edu/~remzi/OSTEP/vm-paging.pdf" target="_blank" rel="noopener">Introduction to Paging</a></p>
]]></content>
      <categories>
        <category>OS</category>
      </categories>
      <tags>
        <tag>memory</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker is not VM</title>
    <url>/blog/dock-not-vm/</url>
    <content><![CDATA[<p>I spend a good portion of my time at Docker talking to community members with varying degrees of familiarity with Docker and I sense a common theme: people‚Äôs natural response when first working with Docker is to try and frame it in terms of virtual machines. I can‚Äôt count the number of times I have heard Docker containers described as ‚Äúlightweight VMs‚Äù.</p>
<p>I get it because I did the exact same thing when I first started working with Docker. It‚Äôs easy to connect those dots as both technologies share some characteristics. Both are designed to provide an isolated environment in which to run an application. Additionally, in both cases that environment is represented as a binary artifact that can be moved between hosts. There may be other similarities, but to me these are the two biggies.</p>
<a id="more"></a>
<p>The key is that the underlying architecture is fundamentally different between the two. The analogy I use (because if you know me, you know I love analogies) is comparing houses (VMs) to apartment buildings (containers).</p>
<p>Houses (the VMs) are fully self-contained and offer protection from unwanted guests. They also each possess their own infrastructure ‚Äì plumbing, heating, electrical, etc. Furthermore, in the vast majority of cases houses are all going to have at a minimum a bedroom, living area, bathroom, and kitchen. I‚Äôve yet to ever find a ‚Äústudio house‚Äù ‚Äì even if I buy the smallest house I may end up buying more than I need because that‚Äôs just how houses are built.  (for the pedantic out there, yes I‚Äôm ignoring the new trend in micro houses because they break my analogy)</p>
<p>Apartments (the containers) also offer protection from unwanted guests, but they are built around shared infrastructure. The apartment building (Docker Host) shares plumbing, heating, electrical, etc. Additionally apartments are offered in all kinds of different sizes ‚Äì studio to multi-bedroom penthouse. You‚Äôre only renting exactly what you need. Finally, just like houses, apartments have front doors that lock to keep out unwanted guests.</p>
<p>With containers, you share the underlying resources of the Docker host and you build an image that is exactly what you need to run your application. You start with the basics and you add what you need. VMs are built in the opposite direction. You are going to start with a full operating system and, depending on your application, might be strip out the things you don‚Äôt want.</p>
<p>I‚Äôm sure many of you are saying ‚Äúyeah, we get that. They‚Äôre different‚Äù. But even as we say this, we still try and adapt our current thoughts and processes around VMs and apply them to containers.</p>
<ul>
<li>‚ÄúHow do I backup a container?‚Äù</li>
<li>‚ÄúWhat‚Äôs my patch management strategy for my running containers?‚Äù</li>
<li>‚ÄúWhere does the application server run?‚Äù</li>
</ul>
<p>To me the light bulb moment came when I realized that Docker is not a virtualization technology, it‚Äôs an application delivery technology. In a VM-centered world, the unit of abstraction is a monolithic VM that stores not only application code, but often its stateful data. A VM takes everything that used to sit on a physical server and just packs it into a single binary so it can be moved around.  But it is still the same thing.  With containers the abstraction is the application; or more accurately a service that helps to make up the application.</p>
<p>With containers, typically many services (each represented as a single container) comprise an application. Applications are now able to be deconstructed into much smaller components which fundamentally changes the way they are managed in production.</p>
<p>So, how do you backup your container, you don‚Äôt. Your data doesn‚Äôt live in the container, it lives in a named volume that is shared between 1-N containers that you define. You backup the data volume, and forget about the container. Optimally your containers are completely stateless and immutable.</p>
<p>Certainly patches will still be part of your world, but they aren‚Äôt applied to running containers. In reality if you patched a running container, and then spun up new ones based on an unpatched image, you‚Äôre gonna have a bad time. Ideally you would update your Docker image, stop your running containers, and fire up new ones. Because a container can be spun up in a fraction off a second, it‚Äôs just much cheaper to go this route.</p>
<p>Your application server translates into a service run inside of a container. Certainly there may be cases where your microservices-based application will need to connect to a non-containerized service, but for the most part standalone servers where you execute your code give way to one or more containers that provide the same functionality with much less overhead (and offer up much better horizontal scaling).</p>
<p>‚ÄúBut, VMs have traditionally been about lift and shift. What do I do with my existing apps?‚Äù</p>
<p>I often have people ask me how to run huge monolithic apps in a container. There are many valid strategies for migrating to a microservices architecture that start with moving an existing monolithic application from a VM into a container but that should be thought of as the first step on a journey, not an end goal.</p>
<p>As you consider how your organization can leverage Docker, try and move away from a VM-focused mindset and realize that Docker is way more than just ‚Äúa lightweight VM.‚Äù It‚Äôs an application-centric way to  deliver high-performing, scalable applications on the infrastructure of your choosing.</p>
<p>Check out these resources to start learning more about Docker and containers:</p>
<ul>
<li><a href="https://docker.wistia.com/medias/fqwm0x9tgz" target="_blank" rel="noopener">Watch an Intro to Docker webinar</a></li>
<li><a href="https://hub.docker.com/enterprise/trial/" target="_blank" rel="noopener">Sign up for a free 30 day trial</a></li>
<li><a href="http://www.docker.com/sites/default/files/caaSwhitepaper_V6_0.pdf" target="_blank" rel="noopener">Read the Containers as a Service white paper</a></li>
</ul>
<h1 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h1><p><a href="https://blog.docker.com/2016/03/containers-are-not-vms/" target="_blank" rel="noopener">CONTAINERS ARE NOT VMS</a></p>
]]></content>
      <categories>
        <category>Technology</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>„ÄêWEP„ÄëCommodity Hardware Today</title>
    <url>/blog/commodity-hardware-today/</url>
    <content><![CDATA[<h1 id="Commodity-Hardware-today"><a href="#Commodity-Hardware-today" class="headerlink" title="Commodity Hardware today"></a>Commodity Hardware today</h1><p>Over the years personal computers and smaller servers standardized on a chipset with two parts: the <code>Northbridge</code> and <code>Southbridge</code>.</p>
<p><img src="Selection_001.png" alt="Figure 2.1"></p>
<p>A couple of bottlenecks are immediately apparent in this design</p>
<p>RAM bandwidth ‰∫âÊä¢ (DMA ÂÖÅËÆ∏ device Áõ¥Êé•‰ªé RAM ÈáåËØªÂÜôÊï∞ÊçÆÔºå‰ΩÜÊòØÈÉΩË¶ÅÈÄöËøá NorthbridgeÔºåËøôÊ†∑Â∞± CPU ÈÄöËøá Northbridge ËÆøÈóÆ RAM ÁöÑ bandwidthÂÜ≤Á™Å)</p>
<blockquote>
<p>In the earliest days of the PC, all communication with devices on either bridge had to pass through the CPU, negatively impacting overall system performance. To work around this problem some devices became capable of direct memory access (DMA). DMA allows devices, with the help of the Northbridge, to store and receive data in RAM directly without the intervention of the CPU (and its inherent performance cost). Today all high-performance devices attached to any of the buses can utilize DMA. While this greatly reduces the workload on the CPU, it also creates contention for the bandwidth of the Northbridge as DMA requests compete with RAM access from the CPUs.</p>
</blockquote>
<a id="more"></a>
<p>Âõ†‰∏∫ÊúâÈôêÁöÑ NorthbandwidthÔºåÊâÄ‰ª•ÈúÄË¶Å schedule memory access in ways that minimize delays.</p>
<p>On some more expensive systems, the Northbridge does not actually contain the memory controller. Instead the Northbridge can be connected to a number of external memory controllers ÔºàÂ§ñÊé• memory controllerÔºâ</p>
<p><img src="Selection_002.png" alt="Figure 2.2"></p>
<p>Pros:</p>
<ol>
<li>more than one memory bus, so the bandwitdth increases</li>
<li>support memory</li>
</ol>
<p>Concurrent memory access patterns reduce delays by simultaneously accessing different memory banks. This is especially true when multiple processors are directly connected to the Northbridge. For such a design, the primary limitation is the internal bandwidth of the Northbridge.</p>
<p>Èô§‰∫Ü‰∏äËø∞ÊèêÂçá memory bandwidth ÁöÑÂäûÊ≥ïÔºåËøòÊúâ‰∏ÄÁßçÔºåÂ∞±ÊòØÂ∞Ü memory controller ÂµåÂÖ•Âà∞ CPUÔºåÂπ∂Â∞Ü memory attached Âà∞ CPU ‰∏ä</p>
<p><img src="Selection_003.png" alt="Figure 2.3"></p>
<p>AMDÁöÑ Opteron processor Â∞±ÊòØËøôÊ†∑ÔºåÂè¶Â§ñ Intel ÊîØÊåÅÁöÑ Common System Interface (CSI) Nehalem processor ‰πüÊòØÂ∑Æ‰∏çÂ§öÁöÑÂéüÁêÜ„ÄÇ(NUMA - Non-Uniform Memory Architecture)</p>
<p>Cons:</p>
<ol>
<li>RAM ‰∏çÂÜç uniform, ‰ªé CPU1ËÆøÈóÆ CPU2 ÁöÑRAMÔºå‰ºöË¶ÅÊ±Ç‰∏ÄÊ¨° CPU ÁöÑ interconnectÔºåÂ¶ÇÊûúÊòØ CPU1 ËÆøÈóÆ CPU4ÔºåÂàô‰ºöË¶ÅÊ±Ç 2Ê¨° interconnects</li>
</ol>
<h1 id="RAM-Type"><a href="#RAM-Type" class="headerlink" title="RAM Type"></a>RAM Type</h1><h2 id="Static-RAM"><a href="#Static-RAM" class="headerlink" title="Static RAM"></a>Static RAM</h2><p><img src="Selection_004.png" alt="Figure 2.4"></p>
<p>The core of this cell is formed by the four transistors $M1$ to $M4$ which form two cross-coupled inverters. They have two stable states, representing 0 and 1 respectively. The state is stable as long as power on $Vdd$ is available.</p>
<p>the cell state is stable, <code>no refresh cycles are needed</code></p>
<h2 id="Dynamic-RAM"><a href="#Dynamic-RAM" class="headerlink" title="Dynamic RAM"></a>Dynamic RAM</h2><p><img src="Selection_005.png" alt="Figure 2.5"></p>
<p>To read the state of the cell the access line $AL$ is raised; this either causes a current to flow on the data line $DL$ or not, depending on the charge in the capacitor.<br>To write to the cell the data line$DL$ is appropriately set and then $AL$ is raised for a time long enough to charge or drain the capacitor.</p>
<p>Cons:</p>
<ul>
<li><code>Leakage problem</code><br>The use of a capacitor means that reading the cell discharges the capacitor. The procedure cannot be repeated indefinitely, <code>the capacitor must be recharged at some point</code>. Capacity of the capacitor is low, it only takes a short time for the capacity to dissipate.<br>This leakage is why a DRAM cell must be constantly refreshed. For most DRAM chips these days this refresh must happen every 64ms. During the refresh cycle no access to the memory is possible since a refresh is simply a memory read operation where the result is discarded. For some workloads this overhead might stall up to 50% of the memory accesses</li>
<li>information read is not directly usable. A sense amplifier is used to distinguish between 0 and 1</li>
<li>A third problem is that reading a cell causes the charge of the capacitor to be depleted. This means every read operation must be followed by an operation to recharge the capacitor. It does mean, though, the reading memory content <code>requires</code> additional energy and, <code>more importantly, time</code>.</li>
<li>A fourth problem is that charging and draining a capacitor is not instantaneous.</li>
</ul>
<p><img src="equation_001.png" alt=""></p>
<p><img src="Selection_006.png" alt="Figure 2.6"></p>
<p>Unlike the <code>static RAM</code> case where the output is immediately available when the word access line is raised, it will always take a bit of time until the capacitor discharges sufficiently. This delay severely limits how fast DRAM can be.</p>
<p>The speed can vary from only slightly slower than the CPU core to one or two orders of magnitude slower. SRAM ÁöÑÊÄßËÉΩÂ∑ÆÂºÇÂæàÂ§ßÔºåÂèØËÉΩÂè™ÊØî CPU core ÊÖ¢‰∏ÄÁÇπÔºåÊàñËÄÖÊÖ¢ 1-2 ‰∏™Êï∞ÈáèÁ∫ß</p>
<h1 id="DRAM-Access-Technical-Details"><a href="#DRAM-Access-Technical-Details" class="headerlink" title="DRAM Access Technical Details"></a>DRAM Access Technical Details</h1><p><code>Synchronous DRAM</code> (SDRAM) and its successors Double Data Rate DRAM (<code>DDR</code>)</p>
<blockquote>
<p>Synchronous DRAM, as the name suggests, works relative to a time source. The memory controller provides a clock, the frequency of which determines the speed of the Front Side Bus (FSB) ‚Äì the memory controller interface used by the DRAM chips. As of this writing, frequencies of 800MHz, 1,066MHz, or even 1,333MHz are available with higher frequencies (1,600MHz) being announced for the next generation. This does not mean the frequency used on the bus is actually this high. Instead, today‚Äôs buses are double- or quad-pumped, meaning that data is transported two or four times per cycle. Higher numbers sell so the manufacturers like to advertise a quad-pumped 200MHz bus as an ‚Äúeffective‚Äù 800MHz bus</p>
</blockquote>
<p>For SDRAM today each data transfer consists of 64 bits ‚Äì 8 bytes. The transfer rate of the FSB is therefore 8 bytes multiplied by the effective bus frequency (6.4GB/s for the quad-pumped 200MHz bus).</p>
<h2 id="Read-Access-Protocol"><a href="#Read-Access-Protocol" class="headerlink" title="Read Access Protocol"></a>Read Access Protocol</h2><p><img src="Selection_008.png" alt="Figure 2.8"><br>bus clock, RAS and CAS signals, and the address and data buses.</p>
<blockquote>
<p>A read cycle <em>begins with</em> the memory controller making the row address available on the address bus and lowering the RAS signal. All signals are read on the rising edge of the clock (CLK) so it does not matter if the signal is not completely square as long as it is stable at the time it is read. <em>Setting the row address</em> causes the RAM chip to start latching the addressed row.<br>The CAS signal can be sent after tRCD (RAS-to-CAS Delay) clock cycles. The column address is then transmitted by making it available on the address bus and lowering the CAS line.</p>
</blockquote>
<p>With all this preparation to get to the data it would be wasteful to only transfer one data word. This is why DRAM modules allow the memory controller to specify how much data is to be transmitted. Often the choice is between 2, 4, or 8 words. This allows <code>filling entire lines in the caches</code>(<code>cache line</code>) without a new RAS/CAS sequence</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://lwn.net/Articles/250967/#TOC" target="_blank" rel="noopener">Commodity Hardware Today</a></p>
]]></content>
      <categories>
        <category>OS</category>
      </categories>
      <tags>
        <tag>memory</tag>
      </tags>
  </entry>
  <entry>
    <title>„ÄêTP„Äë15 Address Translation</title>
    <url>/blog/Address-Translation/</url>
    <content><![CDATA[<p>a general mechanism: <code>limited direct execution (LDE)</code>:<br>the idea is simple, for the most part, let program run directly on hardware.</p>
<p>let‚Äôs see one example</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="number">128</span>: movl <span class="number">0x0</span>(%ebx), %eax     ;load <span class="number">0</span>+ebx into eax</span><br><span class="line"><span class="number">132</span>: addl $<span class="number">0x03</span>, %eax             ;add <span class="number">3</span> to eax <span class="keyword">register</span></span><br><span class="line"><span class="number">135</span>: movl %eax, <span class="number">0x0</span>(%ebx)     ;store eax back to mem</span><br></pre></td></tr></table></figure>
<p>When these instructions run, from the perspective of the process, the following memory accesses take place.</p>
<ul>
<li>Fetch instruction at address 128</li>
<li>Execute this instruction (load from address 15 KB)</li>
<li>Fetch instruction at address 132</li>
<li>Execute this instruction (no memory reference)</li>
<li>Fetch the instruction at address 135</li>
<li>Execute this instruction (store to address 15 KB)<a id="more"></a>

</li>
</ul>
<p><img src="Selection_001.png" alt=""></p>
<p>how can we relocate this process in memory in a way that is <code>transparent</code> to the process? How can we provide the illusion of a virtual address space starting at 0, when in reality the address space is located at some other physical address?</p>
<p>An example of what physical memory might look like once this process‚Äôs address space has been placed in memory is found in Figure</p>
<p><img src="Selection_002.png" alt=""></p>
<p>the OS using the first slot of physical memory for itself, and that it has relocated the process from the example above into the slot starting at physical memory address 32 KB. The other two slots are free (16 KB-32 KB and 48 KB-64 KB).</p>
<h1 id="Dynamic-Hardware-based-Relocation"><a href="#Dynamic-Hardware-based-Relocation" class="headerlink" title="Dynamic (Hardware-based) Relocation"></a>Dynamic (Hardware-based) Relocation</h1><p>we‚Äôll need two hardware registers within each CPU: one is called the <code>base register</code>, and the other the <code>bounds</code> (sometimes called a limitregister). This base-and-bounds pair is going to allow us to place the address space anywhere we‚Äôd like in physical memory, and do so while ensuring that the process can only access its own address space.</p>
<p>Each memory reference generated by the process is a<code>virtual address</code>; the hardware in turn adds the contents of the base register to this address and the result is a physical address that can be issued to the memory system</p>
<p>Transforming a virtual address into a physical address is exactly the technique we refer to as <code>address translation</code>; that is, the hardware takes a virtual address the process thinks it is referencing and transforms it into a physical address which is where the data actually resides. Because this relocation of the address happens at runtime, and because we can move address spaces even after the process has started running, the technique is often referred to as<code>dynamic relocation.</code></p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="http://pages.cs.wisc.edu/~remzi/OSTEP/vm-mechanism.pdf" target="_blank" rel="noopener">Address Translation</a></p>
]]></content>
      <categories>
        <category>OS</category>
      </categories>
      <tags>
        <tag>memory</tag>
      </tags>
  </entry>
  <entry>
    <title>„ÄêTP„Äë13 The Abstraction Address Spaces</title>
    <url>/blog/Address-space/</url>
    <content><![CDATA[<h1 id="Early-Systems"><a href="#Early-Systems" class="headerlink" title="Early Systems"></a>Early Systems</h1><p>Early machines didn‚Äôt provide much of an abstraction to users.</p>
<p><img src="Selection_001.png" alt=""></p>
<p>The OS was a set of routines (a library, really) that sat in memory (starting at physical address 0 in this example), and there would be one running program (a process) that currently sat in physical memory (starting at physical address 64k in this example) and used the rest of memory.</p>
<h1 id="Multiprogramming-and-Time-Sharing"><a href="#Multiprogramming-and-Time-Sharing" class="headerlink" title="Multiprogramming and Time Sharing"></a>Multiprogramming and Time Sharing</h1><p>After a time, because machines were expensive, people began to share machines more effectively. Thus the era of <code>multiprogramming</code> was born [DV66], in which multiple processes were ready to run at a given time, and the OS would switch between them, for example when one decided to perform an I/O. Doing so increased the effective utilization of the CPU. Such increases in efficiency were particularly important in those days where each machine cost hundreds of thousands or even millions of dollars.</p>
<p>Soon enough, however, people began demanding more of machines, and the era of <code>time sharing</code> was born.</p>
<a id="more"></a>
<p><img src="Selection_002.png" alt=""></p>
<p>In the diagram, there are three processes (A, B, and C) and each of them have a small part of the 512KB physical memory carved out for them. Assuming a single CPU, the OS chooses to run one of the processes (say A), while the others (B and C) sit in the ready queue waiting to run.</p>
<h1 id="The-Address-Space"><a href="#The-Address-Space" class="headerlink" title="The Address Space"></a>The Address Space</h1><p>In particular, allowing multiple programs to reside concurrently in memory makes<code>protection</code>an important issue.</p>
<p>OS create a easy to use abstraction of physical memory: <code>address space</code></p>
<p><code>code</code> live in memory<br><code>stack</code> is used to keep track and pass parameters, return value to and from rountines<br><code>heap</code> is used for dynamically-allocated</p>
<p>Process A in tries to perform a load at address 0 (which we will call a <code>virtual address</code>), somehow the OS, in tandem with some hardware support, will have to make sure the load doesn‚Äôt actually go to physical address 0 but rather to physical address 320KB„ÄÇ</p>
<h1 id="Goals"><a href="#Goals" class="headerlink" title="Goals"></a>Goals</h1><p><code>Transparency:</code> make program not aware of the fact that the memory is virtualized<br>‚ÄòEfficiency‚Äô: time and space, rely on hardware support, including features such as <code>TLBs</code><br><code>Protection</code>: protect process from one another. So we could deliver property of isolation among processes.</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="http://pages.cs.wisc.edu/~remzi/OSTEP/vm-intro.pdf" target="_blank" rel="noopener">Address Spaces</a></p>
]]></content>
      <categories>
        <category>OS</category>
      </categories>
      <tags>
        <tag>memory</tag>
      </tags>
  </entry>
  <entry>
    <title>„ÄêTP„Äë43 Log-structured File System</title>
    <url>/blog/LFS/</url>
    <content><![CDATA[<h1 id="Background"><a href="#Background" class="headerlink" title="Background:"></a>Background:</h1><ul>
<li>System merories are growing</li>
<li>There is a large gap between random I/O performance and sequential I/O performance</li>
<li>Existing file systems perform poorly on many common workloads</li>
<li>File systems are not RAID-aware</li>
</ul>
<p>LFS</p>
<ol>
<li>first buffer all updates (inlcuding metadata)  in an in memory <code>segment</code>,</li>
<li>when segment is full, it is written to disk in one long, sequential transfer to an unused part of disk</li>
</ol>
<p>LFS never overwrite existing data, but rather always writes segments to free locations. Because segments are large, the disk is used efficiently, and performance of the file system approaches its zenith.</p>
<a id="more"></a>
<h1 id="Writing-To-Disk-Sequentially"><a href="#Writing-To-Disk-Sequentially" class="headerlink" title="Writing To Disk Sequentially"></a>Writing To Disk Sequentially</h1><p>Imagine we are writing a data block D to a file. Writing the data block to disk might result in the following on-disk layout, with D written at disk address A0:</p>
<p><img src="Selection_001.png" alt=""><br>it is not only data that gets written to disk; there is also other metadata that needs to be updated. In this case, let‚Äôs also write the inode (I) of the file to disk, and have it point to the data block D. When written to disk, the data block and inode would look something like this (note that the inode looks as big as the data block, which generally isn‚Äôt the case; in most systems, data blocks are 4 KB in size, whereas an inode is much smaller, around 128 bytes):</p>
<p>This basic idea, of simply <code>writing all updates</code> (such as data blocks, inodes, etc.) to the disk sequentially, sits at the heart of LFS.</p>
<p>‰øùËØÅÈ°∫Â∫èÂÜô‰∏çË∂≥Â§ü‰øùËØÅ throughputÔºåÂõ†‰∏∫ÂØπ‰∫é HDDÔºåÂ¶ÇÊûúÊØèÊ¨°ÂÜôÁöÑÊï∞ÊçÆÂùó‰πãÈó¥Èó¥ÈöîËøáÈïøÔºåÁ£ÅÁõòÂ∑≤ÁªèËΩ¨ËøáÂ§¥‰∫ÜÔºåÂ∞±ÂøÖÈ°ªÁ≠âÂæÖ‰∏ã‰∏ÄÊ¨°ÁªèËøáÊó∂ÂÄô„ÄÇÊâÄ‰ª•‰∏∫‰∫Ü‰øùËØÅHDDÁöÑ throughputÔºåÂøÖÈ°ª , you must issue <code>a large number of contiguous writes</code> (or <code>one large write</code>) to the drive in order to achieve good write performance.</p>
<p><code>write buffering</code> Â∫îËøêËÄåÁîü„ÄÇ</p>
<p>LFS buffer all updates and when reach to limit, write the whole <code>segment</code> to disk at once.</p>
<p>Here is an example, in which LFS buffers two sets of updates into a small segment; actual segments are larger (a few MB). The first update is of four block writes to file <code>j</code>; the second is one block being added to file <code>k</code>. LFS then commits the entire segment of seven blocks to disk at once. The resulting on-disk layout of these blocks is as follows:</p>
<p><img src="Selection_002.png" alt=""></p>
<h1 id="How-Much-To-Buffer"><a href="#How-Much-To-Buffer" class="headerlink" title="How Much To Buffer?"></a>How Much To Buffer?</h1><ul>
<li>assume that positioning before each write takes roughly <code>Tposition</code> seconds</li>
<li>disk transfer rate is <code>Rpeak</code> MB/s</li>
</ul>
<p>let‚Äôs assume we are writing out <code>D</code> MB. The time to write out this chunk of data (<code>Twrite</code>) is the positioning time <code>Tposition</code> plus the time to transfer D.</p>
<p><img src="Selection_003.png" alt=""><br>effective rate of writing :</p>
<p><img src="Selection_004.png" alt=""><br>we want the effective rate to be some fraction F of the peak rate, where 0 &lt; F &lt; 1.<br>In mathematical form, this means we want Reffective = F √ó Rpeak.</p>
<p><img src="Selection_005.png" alt=""><br>with a disk with a positioning time of 10 milliseconds and peak transfer rate of 100 MB/s; assume we want an effective bandwidth of 90% of peak (F = 0.9). In this case, D = 0.9 0.1 √ó 100 MB/s √ó 0.01 seconds = 9 MB</p>
<h1 id="Problem-Finding-Inodes"><a href="#Problem-Finding-Inodes" class="headerlink" title="Problem: Finding Inodes"></a>Problem: Finding Inodes</h1><p>We‚Äôve managed to scatter the inodes all throughout the disk! Worse, we never overwrite in place, and thus the latest version of an inode (i.e., the one we want) keeps moving.</p>
<h1 id="Solution-Through-Indirection-The-Inode-Map"><a href="#Solution-Through-Indirection-The-Inode-Map" class="headerlink" title="Solution Through Indirection: The Inode Map"></a>Solution Through Indirection: The Inode Map</h1><p> LFS introduced a level of indirection between inode numbers and the inodes through a data structure called the <code>inode map</code> (imap).<br>The imap is a structure that takes an inode number as input and produces the disk address of the most recent version of the inode. Thus, you can imagine it would often be implemented as a simple array, with 4 bytes (a disk pointer) per entry. Any time an inode is written to disk, the imap is updated with its new location.<br>ÊÄªÁªìÂ∞±ÊòØÊúâ‰∏™ inode map ÁªìÊûÑÂ≠òÂÇ®‰∫ÜÊúÄÊñ∞ÁöÑ inode ‰ø°ÊÅØÔºåÂπ∂Èöè‰πãÊõ¥Êñ∞„ÄÇ</p>
<p>ÈóÆÈ¢òÊòØÔºåinode map Â≠òÂú®Âì™ÂÑøÔºåÂ¶ÇÊûúÂ≠òÂú®‰∏Ä‰∏™ fixed ÁöÑ‰ΩçÁΩÆÔºåÈÇ£‰πàÈöè‰πãËÄåÊù•ÁöÑÈóÆÈ¢òÂ∞±ÊòØÔºåÊØèÊ¨°Êõ¥Êñ∞Êñá‰ª∂ÔºåÂ∞±ÈúÄË¶ÅÈáçÊñ∞ seek Âà∞ inode map ‰ΩçÁΩÆÂπ∂Êõ¥Êñ∞ÔºåËøôÊ†∑Â∞±Âíå FFS Ê≤°ÊúâÂå∫Âà´‰∫ÜÔºàÊõ¥Êñ∞Êñá‰ª∂‰ª•ÂêéÊõ¥Êñ∞inode Âíå metadataÔºâ„ÄÇ</p>
<p>LFS places chunks of the inode map right next to where it is writing all of the other new information. Thus, when appending a data block to a file k, LFS actually writes the new data block, its inode, and a piece of the inode map all together onto the disk, as follows:</p>
<p><img src="Selection_006.png" alt=""><br>In this picture, the piece of the imap array stored in the block marked imap tells LFS that the inode k is at disk address A1; this inode, in turn, tells LFS that its data block D is at address A0.</p>
<h1 id="Completing-The-Solution-The-Checkpoint-Region"><a href="#Completing-The-Solution-The-Checkpoint-Region" class="headerlink" title="Completing The Solution: The Checkpoint Region"></a>Completing The Solution: The Checkpoint Region</h1><p> LFS has a fixed place on disk, known as <code>checkpoint region</code> <code>(CR)</code>, checkpioint region contains pointers to the latest pieces of the inode map, so  the inode map pieces can be found by reading the CR first. And the CR is only updated periodically, thus performance is not ill-affected.</p>
<h1 id="Reading-A-File-From-Disk-A-Recap"><a href="#Reading-A-File-From-Disk-A-Recap" class="headerlink" title="Reading A File From Disk: A Recap"></a>Reading A File From Disk: A Recap</h1><p>Assuming there is nothing in memory.</p>
<ol>
<li>read checkpoint region to get the entire inode map and cache it in memory</li>
<li>when given an inode number of a file, LFS looks up the inode-number to inode-disk-address mapping in the imap, read the latest version of the inode.</li>
<li>after get the inode, read a block like the typical UNIX like system<br>ÈÄöÂ∏∏ÊÉÖÂÜµÔºåinode map ÈÉΩÊòØË¢´cache Âú®ÂÜÖÂ≠ò‰∏≠ÁöÑÔºåÊâÄ‰ª• LFS ËØªÊñá‰ª∂ÁöÑÂîØ‰∏ÄÈ¢ùÂ§ñÊìç‰ΩúÔºåÂ∞±ÊòØ‰ªé inode map ‰∏≠ËØªÂèñÂà∞ ÊúÄÊñ∞ inode ÁöÑ address„ÄÇ</li>
</ol>
<h1 id="What-About-Directories"><a href="#What-About-Directories" class="headerlink" title="What About Directories?"></a>What About Directories?</h1><p>creating a file foo in a directory would lead to the following new structures on disk:</p>
<p><img src="Selection_007.png" alt=""></p>
<p>There is one other serious problem in LFS that the inode map solves, known as the <code>recursive update problem</code>.(Â∞±ÊòØ‰∏ÄÊ¨°Êñá‰ª∂Êõ¥Êñ∞ÔºåÂºïËµ∑ÂÖ∂ÁõÆÂΩï inode Êõ¥Êñ∞ÔºåÂºïÂèëÊõ¥‰∏äÂ±ÇÁöÑÁõÆÂΩïÊõ¥Êñ∞ÔºåÁõ¥Âà∞ / ÁõÆÂΩï)<br>Specifically, whenever an inode is updated, its location on disk changes. If we hadn‚Äôt been careful, this would have also entailed an update to the directory that points to this file, which then would have mandated a change to the parent of that directory, and so on, all the way up the file system tree.</p>
<p>LFS cleverly avoids this problem with the inode map. Even though the location of an inode may change, the change is never reflected in the directory itself; rather, the imap structure is updated while the directory holds the same name-to-inumber mapping. Thus, through indirection, LFS avoids the recursive update problem.</p>
<h1 id="A-New-Problem-Garbage-Collection"><a href="#A-New-Problem-Garbage-Collection" class="headerlink" title="A New Problem: Garbage Collection"></a>A New Problem: Garbage Collection</h1><p>LFS leaves old versions of file structures scattered throughout the disk. We (rather unceremoniously) call these old versions<code>garbage.</code><br>, LFS instead keeps only the latest live version of a file; thus (in the background), LFS must periodically find these old dead versions of file data, inodes, and other structures, and <code>clean</code> them; cleaning should thus make blocks on disk free again for use in a subsequent writes. Note that the process of cleaning is a form of <code>garbage collection</code>, a technique that arises in programming languages that automatically free unused memory for programs.</p>
<p>Â¶ÇÊûú LFS Âè™ÊòØÁÆÄÂçïÁöÑÂ∞Ü old version block Âà†Èô§ÔºåÈÇ£‰πàÂ∞±‰ºöÂΩ¢ÊàêÂæàÂ§öÈõ∂ÊòüÁöÑ free spaceÔºåÂØºËá¥‰ª•ÂêéÂèØËÉΩÊ≤°ÊúâÊï¥ÂùóÁöÑ block ÂèØ‰ª•ÂÜôÂÖ•„ÄÇ</p>
<p>Instead, the LFS cleaner works on a segment-by-segment basis, thus clearing up large chunks of space for subsequent writing. The basic cleaning process works as follows:</p>
<blockquote>
<p>Periodically, the LFS cleaner reads in a number of old (partially-used) segments, determines which blocks are live within these segments, and then write out a new set of segments with just the live blocks within them, freeing up the old ones for writing</p>
</blockquote>
<p>Here arouse two problems:</p>
<ol>
<li>how can LFS tell which blocks within a segment are live, and which are dead?</li>
<li>how often should the cleaner run, and which segments should it pick to clean?</li>
</ol>
<h1 id="Determining-Block-Liveness"><a href="#Determining-Block-Liveness" class="headerlink" title="Determining Block Liveness"></a>Determining Block Liveness</h1><p>There is a <code>segment summary block</code>  at the head of the segment,  includes, for each data block D, its inode number (which file it belongs to) and its offset (which block of the file this is).</p>
<ol>
<li>For a block D located on disk at address A, look in the segment summary block and find its <code>inode number N</code> and <code>offset T</code>.</li>
<li>look in the imap to find where N lives and read N from disk (perhaps it is already in memory, which is even better)</li>
<li>using the <code>offset T</code>, look in the inode (or some indirect block) to see where the inode thinks the Tth block of this file is on disk.</li>
</ol>
<p>If it points exactly to disk address A, LFS can conclude that the block D is live. If it points anywhere else, LFS can conclude that D is not in use (i.e., it is dead) and thus know that this version is no longer needed.</p>
<p><img src="Selection_008.png" alt=""></p>
<p>‰πüÂèØ‰ª•Âú®imapÈáåÈù¢Â≠òÂÇ®ÊúÄÊñ∞Êï∞ÊçÆÁöÑ version numberÔºåÁÑ∂ÂêéÂíå segment summary block ÈáåÈù¢ÁöÑ version number ÂØπÊØîÔºåÂ¶ÇÊûú‰∏ÄËá¥Âàô liveÔºå‰∏ç‰∏ÄËá¥ÂàôÊòØ garbageÔºåÂáèÂ∞ë‰∏ÄÊ¨°ËØªÂèñ„ÄÇ</p>
<h1 id="Which-Blocks-To-Clean-And-When"><a href="#Which-Blocks-To-Clean-And-When" class="headerlink" title="Which Blocks To Clean, And When?"></a>Which Blocks To Clean, And When?</h1><p>an approach which tries to segregate hot and cold segments.Ôºö</p>
<p>A hot segment is one in which the contents are being frequently over-written; thus, for such a segment, the best policy is to wait a long time before cleaning it, as more and more blocks are getting over-written (in new segments) and thus being freed for use. A cold segment, in contrast, may have a few dead blocks but the rest of its contents are relatively stable. Thus, the authors conclude that one should clean cold segments sooner and hot segments later</p>
<h1 id="Crash-Recovery-And-The-Log"><a href="#Crash-Recovery-And-The-Log" class="headerlink" title="Crash Recovery And The Log"></a>Crash Recovery And The Log</h1><p>crash in writing to a segment, writing to the CR:</p>
<ol>
<li>Âõ†‰∏∫‰ºöÂë®ÊúüÊÄßÁöÑÊõ¥Êñ∞ CRÔºåÂ¶ÇÊûúÊüêÊ¨°‰∏ÄÊó¶crashÔºå‰∏ãÊ¨°ÊÅ¢Â§çÁöÑÂ∞±ÊòØÊÅ¢Â§çËÄÅÁöÑ versionÔºå‰ΩÜÊòØÊúÄÊñ∞ÁöÑÊï∞ÊçÆ‰ºö‰∏¢Â§±„ÄÇ‰∏∫‰∫ÜÂ∞ΩÂèØËÉΩÂ§öÊÅ¢Â§çÊï∞ÊçÆÔºå‰ΩøÁî® <code>roll forward</code> ÊäÄÊúØÔºåÈ¶ñÂÖàÊ†πÊçÆ CR ÊâæÂà∞‰∏ä‰∏™ÊúâÊïàÁöÑ version Â§ÑÔºåÁÑ∂ÂêéÂæÄÂêéÊâ´Êèè‰∏Ä‰∏™ segmentÔºåÁúãÊòØÂê¶Êúâ valid Êï∞ÊçÆÂú®ÈáåÈù¢ÔºåÁÑ∂ÂêéÊÅ¢Â§ç„ÄÇ</li>
<li>Êúâ‰∏§‰∏™ CRÔºåÂú®Êõ¥Êñ∞CR ÁöÑ Êó∂ÂÄôÔºåÂÖàÂú®CR ÁöÑheaderÊï∞ÊçÆ‰∏≠ÂÜôÂÖ•‰∏Ä‰∏™ timestampÔºåÁÑ∂ÂêéÊé•ÁùÄÂÜô bodyÔºåÁÑ∂ÂêéÂÜô last block with timestampÔºåÂ¶ÇÊûú‰∏§‰∏™ timestamp ‰∏çÂåπÈÖçÔºåÂàô‰∏¢ÂºÉÔºõÊØèÊ¨°ÈÉΩÈÄâÂèñÊúâÊïàÁöÑÔºåÂπ∂‰∏îÊó∂Èó¥Êà≥ÊúÄËøëÁöÑÈÇ£‰∏™ CR ÊÅ¢Â§ç</li>
</ol>
<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p>WAFL, ZFS, btrfs,ÈÉΩÊòØ LFS</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="http://pages.cs.wisc.edu/~remzi/OSTEP/file-lfs.pdf" target="_blank" rel="noopener">Log-structured File System (LFS)</a></p>
]]></content>
      <categories>
        <category>OS</category>
      </categories>
      <tags>
        <tag>storage</tag>
      </tags>
  </entry>
  <entry>
    <title>„ÄêTP„Äë42 FSCK-and-journaling</title>
    <url>/blog/FSCK-and-journaling/</url>
    <content><![CDATA[<p>old approach: <code>fsck</code>(file system checker)<br>new approach: <code>journaling</code>(also known as <code>write-ahead-logging</code>)</p>
<h1 id="A-Detailed-Example"><a href="#A-Detailed-Example" class="headerlink" title="A Detailed Example"></a>A Detailed Example</h1><p><img src="Selection_001.png" alt=""><br>If you look at the structures in the picture, you can see that a single inode is allocated (<code>inode number 2</code>), which is marked in the <code>inode bitmap</code>, and a single allocated data block (<code>data block 4</code>), also marked in the <code>data bitmap</code>. The inode is denoted <code>I[v1]</code>,</p>
<p>let‚Äôs see the simple inode inside:</p>
<a id="more"></a>
<p><img src="Selection_002.png" alt=""><br>In this simplified inode,</p>
<ul>
<li>the size of the file is 1 (it has one block allocated),</li>
<li>the first direct pointer points to block 4 (the first data block of the file, Da)</li>
<li>all three other direct pointers are set to null (indicating that they are not used)</li>
</ul>
<p>When we append to the file, we are adding a new data block to it, and update on-disk structures.</p>
<p><img src="Selection_003.png" alt=""></p>
<p><img src="Selection_004.png" alt=""><br>we must update three blocks to do this update.</p>
<ul>
<li>Data bitmap</li>
<li>Inodes</li>
<li>Data Blocks</li>
</ul>
<p>when user issues a write() system call, usually it will cache them in the main memory first for some time, then to the disk. If a crash happens and will interfere with these updates to the disk.</p>
<h1 id="Crash-Scenarios"><a href="#Crash-Scenarios" class="headerlink" title="Crash Scenarios"></a>Crash Scenarios</h1><p>Three outcomes when crash:</p>
<ul>
<li>Just the data block (Db) is written to disk.(no a bit deal)</li>
<li>Just the updated inode (I[v2]) is written to disk.(it could cause new problem: file-system inconsistency. The on-disk bitmap is telling us that data block 5 has not been allocated, but the inode is saying that it has. This disagreement in the file system data structures is an inconsistency in the data structures of the file system;)</li>
<li>Just the updated Data bitmap (B[v2]) is written to disk.(this cause a space leak, as block 5 would never be used by the file system)</li>
<li>‚Ä¶</li>
</ul>
<h1 id="Solution-1-The-File-System-Checker"><a href="#Solution-1-The-File-System-Checker" class="headerlink" title="Solution #1: The File System Checker"></a>Solution #1: The File System Checker</h1><p>fsck is too slow:<br>scanning the entire disk to find all the allocated blocks and read the entire directory tree may take many minutes or hours. Performance of fsck, as disks grew in capacity and RAIDs grew in popularity, became prohibitive.</p>
<p>This situation is akin to dropping your keys on the floor in your bedroom, and then commencing a search-the-entire-house-for-keys recovery algorithm, starting in the basement and working your way through every room. It works but is wasteful.</p>
<h1 id="Solution-2-Journaling-or-Write-Ahead-Logging"><a href="#Solution-2-Journaling-or-Write-Ahead-Logging" class="headerlink" title="Solution #2: Journaling (or Write-Ahead Logging)"></a>Solution #2: Journaling (or Write-Ahead Logging)</h1><p>Let‚Äôs see EXT3.</p>
<p>Most of the on-disk structures are identical to Linux ext2(disk is divided into block groups). The new key structure is the <code>journal</code> itself.<br>ext2 file system looks like:</p>
<p><img src="Selection_005.png" alt=""><br>Assuming the journal is palced within the same file system image (though sometimes it is placed on a separate device, or as a file within the file system), an ext3 file system with a journal looks like this:</p>
<p><img src="Selection_006.png" alt=""></p>
<h1 id="Data-Journaling"><a href="#Data-Journaling" class="headerlink" title="Data Journaling"></a>Data Journaling</h1><p>Let‚Äôs look at a simple example to understand how data journaling works.<br>Say we have our canonical update again, where we wish to write the inode (I[v2]), bitmap (B[v2]), and data block (Db) to disk again. Before writing them to their final disk locations, we are now first going to write them to the log (a.k.a. journal). This is what this will look like in the log:</p>
<p><img src="Selection_007.png" alt=""><br>You can see we have written five blocks here. The transaction begin (<code>TxB</code>) tells us about this update, including information about the pending update to the file system), as well as some kind of <code>transaction identifier (TID)</code>. The middle three blocks just contain the exact contents of the blocks themselves; this is known as <code>physical logging</code> as we are putting the exact physical contents of the update in the journal (an alternate idea, <code>logical logging</code>, puts a more compact logical representation of the update in the journal, e.g., ‚Äúthis update wishes to append data block Db to file X‚Äù, which is a little more complex but can save space in the log and perhaps improve performance). The final block (<code>TxE</code>) is a marker of the end of this transaction, and will also contain the TID.</p>
<p>Once this transaction is safely on disk, we are ready to overwrite the old structures in the file system; this process is called <code>checkpointing</code>. Thus, to <code>checkpoint</code> the file system (i.e., bring it up to date with the pending update in the journal), we issue the writes I[v2], B[v2], and Db to their disk locations as seen above; if these writes complete successfully, we have successfully checkpointed the file system and are basically done.</p>
<p>So the steps of operation:</p>
<ul>
<li>Journal write:</li>
<li>Checkpoint: Â∞±ÊòØÂ∞Ü journal ÈáåÈù¢ÁöÑdiskÊõ¥Êñ∞‰ø°ÊÅØÔºåÂÜôÂà∞ÂéüÊú¨ÁöÑ‰ΩçÁΩÆ‰∏≠</li>
</ul>
<p>Best way is to issue all the five block at once. However, when the changing data is big, OS may reorder the write sequence, it may write TxB, I[v2], B[v2], and TxE and only later write Db. Unfortunately, if the disk loses power between (1) and (2), this is what ends up on disk:</p>
<p><img src="Selection_008.png" alt=""></p>
<p>FS can not know if the fourth block is wrong. so in recovery, it can cause problem, even worse if the data in there belongs to superblock, which could render the FS unmountable.</p>
<blockquote>
<p>ASIDE: FORCING WRITES TO DISK To enforce ordering between two disk writes, modern file systems have to take a few extra precautions. In olden times, forcing ordering between two writes, A and B, was easy: just issue the write of A to the disk, wait for the disk to interrupt the OS when the write is complete, and then issue the write of B. Things got slightly more complex due to the increased use of write caches within disks. With write buffering enabled (sometimes called <code>immediate reporting</code>), a disk will inform the OS the write is complete when it simply has been placed in the disk‚Äôs memory cache, and has not yet reached disk. If the OS then issues a subsequent write, it is not guaranteed to reach the disk after previous writes; thus ordering between writes is not preserved. One solution is to disable <code>write buffering</code>. However, more modern systems take extra precautions and issue explicit write barriers; such a barrier, when it completes, guarantees that all writes issued before the barrier will reach disk before any writes issued after the barrier. All of this machinery requires a great deal of trust in the correct operation of the disk. Unfortunately, recent research shows that <strong>some disk manufacturers, in an effort to deliver ‚Äúhigher performing‚Äù disks, explicitly ignore write-barrier requests</strong>, thus making the disks seemingly run faster but at the risk of incorrect operation [C+13, R+11]. As Kahan said, the fast almost always beats out the slow, even if the fast is wrong.</p>
</blockquote>
<p>To avoid this problem, the file system issues the transactional write in two steps.</p>
<ul>
<li>it writes all blocks except the TxE block to the journal, issuing these writes all at once</li>
</ul>
<p><img src="Selection_009.png" alt=""></p>
<ul>
<li>When those writes complete(There will be a flush() CMD before TxE), the file system issues the write of the TxE block, thus leaving the journal in this final, safe state:</li>
</ul>
<p><img src="Selection_010.png" alt=""></p>
<p>So the final process is:</p>
<ul>
<li><code>Journal write</code>: write the first 4 chunks</li>
<li><code>Journal commit</code>: wait 1st complete and write TxE to the log <code>( This could cause inefficience when transfer data)</code></li>
<li><code>Checkpoint</code>: Write contents of the update to their final on-disk locations</li>
</ul>
<blockquote>
<p>to solve the efficiency problem, we could inlcude a <code>checksum</code> in TxB and TxE, then we could write the entire transaction at once, without any wait. During recovery, if the file system sees a mismatch in the computed checksum versus the stored checksum, then it can discard the update in journal.</p>
</blockquote>
<h1 id="Making-The-Log-Finite"><a href="#Making-The-Log-Finite" class="headerlink" title="Making The Log Finite"></a>Making The Log Finite</h1><ul>
<li>FS buffers updates in memory for some time(few seconds);</li>
<li>when write to the disk, first write to journal</li>
<li>after transaction complete, FS checkpoint those blocks to final location on disk</li>
</ul>
<p>Log has finite size and in order to continue log new write, FS treat the log as a circular data structure, namely <code>circular log.</code></p>
<p>Once a checkpoint success, FS should free the space. FS could simply mark the oldest and newest no-checkpointed transaction in a <code>journal superblock</code>.</p>
<p><img src="Selection_011.png" alt=""><br>In the journal superblock (not to be confused with the main file system superblock), the journaling system records enough information to know which transactions have not yet been checkpointed, and thus reduces recovery time as well as enables re-use of the log in a circular fashion. And thus we add another step to our basic protocol:</p>
<ol>
<li>Journal write:</li>
<li>Jornal commit:</li>
<li>Checkpoint:</li>
<li><code>Free</code>: mark the transaction free in the journal by updating the journal superblock.(ÊÑèÊÄùÂ∞±ÊòØÊ†áËÆ∞Ëøô‰∏™Êõ¥Êñ∞Â∑≤ÁªèÁªìÊùüÔºåÂèØ‰ª•Ë¢´Â§çÂÜôÔºâ</li>
</ol>
<p>However, all the process discussed above indicated that we will <code>write data twice</code>Ôºàbecause we store all the new data in journal log)</p>
<h1 id="Metadata-Journaling"><a href="#Metadata-Journaling" class="headerlink" title="Metadata Journaling"></a>Metadata Journaling</h1><p>all the discussion above is called <code>data journaling</code>(as in linux ext3). A simple form of journaling is called <code>orderd journaling</code>( <code>metadata journaling</code> ).</p>
<p><img src="Selection_012.png" alt=""><br>The data block Db, previously written to the log, would instead be written to the file system proper, avoiding the extra write; given that most I/O traffic to the disk is data, not writing data twice substantially reduces the I/O load of journaling.</p>
<p>Then when should we write data blocks to disk?</p>
<p>ext3 do like this:</p>
<ol>
<li>Data write: write data to final location; wait for completion(optional)</li>
<li>Journal metadata write</li>
<li>Journal commit:Write the transaction commit block (containing TxE) to the log; wait for the write to complete; the transaction (including data) is now committed. Âú®Ëøô‰∏ÄÊ≠•ÂÆåÊàêÂêåÊó∂ÔºåÂøÖÈ°ª‰øùËØÅdata‰πüË¢´‰º†ËæìÁªìÊùü„ÄÇÔºàÈÇ£Â¶ÇÊûú‰ΩøÁî®checksumÁöÑËØùÔºåÊÄé‰πà‰øùËØÅjournalokÊó∂ÂÄôÔºådata‰πüËÇØÂÆöokÂë¢ÔºüÂ¶ÇÊûúmetadata journal Ê≤°ÊúâÈóÆÈ¢òÔºådataËøòÂú®transactionÔºåËøôÊó∂ÂÄôcrash‰∫ÜÔºåÈÇ£recoveryÂ≤Ç‰∏çÊòØÈîôÁöÑÔºüÔºâ</li>
<li>Checkpoint commit:</li>
<li>Free<br>Ôºàthis is ordered journaling, ext3 also provide <code>unordered modes</code>, which data can be written at any time)</li>
</ol>
<h1 id="Solution-3-Other-Approaches"><a href="#Solution-3-Other-Approaches" class="headerlink" title="Solution #3: Other Approaches"></a>Solution #3: Other Approaches</h1><ul>
<li><p>Soft Updates</p>
<blockquote>
<p>This approach carefully orders all writes to the file system to ensure that the on-disk structures are never left in an inconsistent state. For example, by writing a pointed-to data block to disk before the inode that points to it, we can ensure that the inode never points to garbage; similar rules can be derived for all the structures of the file system</p>
</blockquote>
</li>
<li><p>copy-on-write(COW) like FS ZFS</p>
<blockquote>
<p>This technique never overwrites files or directories in place; rather, it places new updates to previously unused locations on disk. After a number of updates are completed, COW file systems flip the root structure of the file system to include pointers to the newly updated structures. Doing so makes keeping the file system consistent straightforward</p>
</blockquote>
</li>
</ul>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="http://pages.cs.wisc.edu/~remzi/OSTEP/file-journaling.pdf" target="_blank" rel="noopener">FSCK and Journaling</a></p>
]]></content>
      <categories>
        <category>OS</category>
      </categories>
      <tags>
        <tag>storage</tag>
      </tags>
  </entry>
  <entry>
    <title>„ÄêTP„Äë41 Fast File System (FFS)</title>
    <url>/blog/fast-file-system/</url>
    <content><![CDATA[<p>Old Unix file system: Simple and block size is small( 512B )</p>
<p><img src="Selection_001.png" alt="1"><br>Problems: Performance terrible. Because old system treats disk like a random-access memory. delivering 2% overall disk bandwith:<br>    * data spread all over the place, expensive positioning cose (data block could be very far away from its inode)<br>    * file system getting fragmented<br><img src="Selection_002.png" alt="2"></p>
<p>E gets spread across the disk, and as a result, when accessing E, you don‚Äôt get peak (sequential) performance from the disk. Rather, you first read E1 and E2, then seek, then read E3 and E4. This fragmentation problem happened all the time in the old UNIX file system, and it hurt performance.</p>
<p>small block size cause transferring data from disk inefficient.</p>
<a id="more"></a>
<h1 id="Fast-File-system-FFS-from-Berkeley-group"><a href="#Fast-File-system-FFS-from-Berkeley-group" class="headerlink" title="Fast File system(FFS) from Berkeley group"></a>Fast File system(FFS) from Berkeley group</h1><p>let file system be ‚Äúdisk aware‚Äù. Keep the same api (open(), read(), write(), close()) but changing internal implementation.</p>
<p>Organize block into block group. cylinder groups Â∞±ÊòØËøûÁª≠ÁöÑÊü±Èù¢ÁªÑÂêà„ÄÇ<br><img src="Selection_003.png" alt="3"><br><img src="Selection_004.png" alt="4"></p>
<p>In order to use groups to store files. File system includes all the structures you might expect a file system within each group.<br><img src="Selection_005.png" alt="5"><br>S: superblock.<br>ib: inode bitmap<br>db: data bitmap</p>
<h1 id="Policies-How-To-Allocate-Files-and-Directories"><a href="#Policies-How-To-Allocate-Files-and-Directories" class="headerlink" title="Policies: How To Allocate Files and Directories"></a>Policies: How To Allocate Files and Directories</h1><p>basic mantra: keep related stuff together, keep unrelated stuff far apart.</p>
<p>related data in same block group.</p>
<ol>
<li>data blocks of a file in the same group to avoid long seeks</li>
<li>put files belong to same directory in the same cylinder group</li>
</ol>
<p>see an example:</p>
<ul>
<li>assuem there are only 10 inodes and 10 data blocks in each group</li>
<li>the three directories (the root directory /, /a, and /b) and</li>
<li>four files (/a/c, /a/d, /a/e, /b/f) are placed within them per the FFS policies</li>
<li>Assume the regular files are each two blocks in size, and that the directories have just a single block of data</li>
<li>we use the obvious symbols for each file or directory (i.e., / for the root directory, a for /a, f for /b/f, and so forth)<br><img src="Selection_006.png" alt="6"><br>FFS policy‚Äôs two positive things:</li>
<li>data blocks of each file are near file‚Äôs inode</li>
<li>files in the same directory are near one another</li>
</ul>
<h1 id="The-Large-File-Exception"><a href="#The-Large-File-Exception" class="headerlink" title="The Large-File Exception"></a>The Large-File Exception</h1><p>for large file, FFS does not save them all in one group, because it prevents subsequent ‚Äúrelated‚Äù file from being placed within this block group, and may hurt file-access locality.</p>
<p>So instead of saving file like this:<br><img src="Selection_007.png" alt="7"><br>actually saving like this:<br><img src="Selection_008.png" alt="8"></p>
<p>increase chunk size can improve disk performance. because it can reduce the seek time(change to different group).</p>
<p>Assuming</p>
<ul>
<li>average positioning time for disk is 10ms</li>
<li>disk transfer data at 40MB/s<br>if we want to spend half our time seeking between chunks and half our time transferring data(achieve 50% of peak disk performance), then we need to spend 10ms transferring data for every 10ms positioning.<br>So the question becomes: how big does a chunk have to be in order to spend 10 ms in transfer?<br>  the answer is 40M/s*10ms = 400KB ÔºàÂõ†‰∏∫ÊØèÊ¨°peakÈÉΩË¶ÅËÄóË¥π10msÔºåÊâÄ‰ª•50%ÊïàÁéáÂ∞±ÊòØËøòÊúâ10msÁî®Êù•‰º†ËæìÔºåÈÇ£‰πà‰∏Ä‰∏™chunkËá≥Â∞ëÊª°Ë∂≥Ëøô‰∏™Ë¶ÅÊ±ÇÔºåÊâç‰ºö‰∏çÁî®ÂÜçÊ¨°ËøõË°åseekÔºâ</li>
</ul>
<p>if we want to achieve 90% of peak bandwith:<br>    the answer is 40M/s*90ms = 3.6MB ÔºàÂõ†‰∏∫ÊØèÊ¨°peakÈÉΩË¶ÅËÄóË¥π10msÔºåÊâÄ‰ª•90%ÊïàÁéáÂ∞±ÊòØËøòÊúâ90msÁî®Êù•‰º†ËæìÔºåÈÇ£‰πà‰∏Ä‰∏™chunkËá≥Â∞ëÊª°Ë∂≥Ëøô‰∏™Ë¶ÅÊ±ÇÔºåÊâç‰ºö‰∏çÁî®ÂÜçÊ¨°ËøõË°åseekÔºâ</p>
<p>FFS did not use this type of calculation in order to spread large files across groups. based on the structure of the inode itself:</p>
<ul>
<li>The first twelve direct blocks were placed in the same group as the inode;</li>
<li>each subsequent indirect block, and all the blocks it pointed to, was placed in a different group</li>
</ul>
<p>With a block size of 4KB, and 32-bit disk addresses, this strategy implies that every 1024 blocks of the file (4MB) were placed in separate groups</p>
<h1 id="A-Few-Other-Things-About-FFS"><a href="#A-Few-Other-Things-About-FFS" class="headerlink" title="A Few Other Things About FFS"></a>A Few Other Things About FFS</h1><p>If use 4KB block, when many files are 2KB, then it will waste half of disk size, causing internal fragmentation.</p>
<p>The solution is FFS introduce <code>sub-blocks</code>, which is 512-byte little blocks that file system could allocate to files. So for the 2KB small files, then it wil occupy 4 sub-blocks and not waste the entire 4KB block. As file grew, the FS will continue allocating 512-byte sub-blocks to it untill it accuire a full 4KB of data. At this point, FFS will find a 4KB block, copy the sub-blocks into it, and free the sub-blocks for future use.</p>
<p><strong>But again, this will waste time for seeking 512byte subblocks</strong>. The FFS modifying the libc library and buffer write and then issue 4KB chunks to the file system.</p>
<p>Before the SCSI and other modern device interface, at the time, disks were much less sophisticated and required the host CPU to control their operation in a more hands-on way. A problem arose in FFS when a file was placed on consecutive sectors of the disk.<br><img src="Selection_009.png" alt="9"><br> imagine this is the overlook of a disk, number indicates different blocks.</p>
<p>In particular, the problem arose during sequential reads. FFS would first issue a read to block 0; by the time the read was complete, and FFS issued a read to block 1, it was too late: block 1 had rotated under the head and now the read to block 1 would incur a full rotation. (ÁÆÄËÄåË®Ä‰πãÔºåÂ∞±ÊòØÂèëÂá∫ËØªblock0ÂëΩ‰ª§ÔºåÂàöÂèëËØªÂèñblock1ÂëΩ‰ª§Ôºåblock1Â∑≤ÁªèË¢´Ë∑≥Ëøá‰∫ÜÔºåÊâÄ‰ª•ÈúÄË¶ÅÁ≠âdiskÂÜçËΩ¨‰∏ÄÂúàÔºâ</p>
<p><img src="Selection_010.png" alt="10"><br> FFS could use this layout to solve rotation problem.</p>
<p>FFS was smart enough to figure out for a particular disk, how many blocks it should skip in doing layout in order to avoid the extra rotations. This technique was called <code>parameterization</code>. (ËøôÊó∂ÂÄô‰Ω†‰ºöÊúâÁñëÈóÆÔºåËøôÊ†∑ÁöÑËØùÂ∞±Âè™ËÉΩËææÂà∞50%ÁöÑthroughput)</p>
<p>Modern disk, in order to solve this problem, internally read the entire track in and buffer it in an internal disk cache( <code>track buffer</code>). Then<br> on subsequent reads to the track, the disk will just return the desired data from its cache.(Âà©Áî®disk cache Ëß£ÂÜ≥ throughput ÈóÆÈ¢ò)</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="http://pages.cs.wisc.edu/~remzi/OSTEP/file-ffs.pdf" target="_blank" rel="noopener">Fast File System (FFS)</a></p>
]]></content>
      <categories>
        <category>OS</category>
      </categories>
      <tags>
        <tag>storage</tag>
      </tags>
  </entry>
  <entry>
    <title>LevelDb ËØ¶Ëß£</title>
    <url>/blog/leveldb-intro/</url>
    <content><![CDATA[<p>ËØ¥Ëµ∑LevelDb‰πüËÆ∏ÊÇ®‰∏çÊ∏ÖÊ•öÔºå‰ΩÜÊòØÂ¶ÇÊûú‰Ωú‰∏∫ITÂ∑•Á®ãÂ∏àÔºå‰∏çÁü•ÈÅì‰∏ãÈù¢‰∏§‰ΩçÂ§ßÁ•ûÁ∫ßÂà´ÁöÑÂ∑•Á®ãÂ∏àÔºåÈÇ£ÊÇ®ÁöÑÈ¢ÜÂØº‰º∞ËÆ°‰ºöHold‰∏ç‰Ωè‰∫ÜÔºöJeff DeanÂíåSanjay Ghemawat„ÄÇËøô‰∏§‰ΩçÊòØGoogleÂÖ¨Âè∏ÈáçÈáèÁ∫ßÁöÑÂ∑•Á®ãÂ∏àÔºå‰∏∫Êï∞ÁîöÂ∞ëÁöÑGoogle Fellow‰πã‰∫å„ÄÇ</p>
<p>Jeff DeanÂÖ∂‰∫∫Ôºö<a href="http://research.google.com/people/jeff/index.htmlÔºåGoogleÂ§ßËßÑÊ®°ÂàÜÂ∏ÉÂºèÂπ≥Âè∞BigtableÂíåMapReduce‰∏ªË¶ÅËÆæËÆ°ÂíåÂÆûÁé∞ËÄÖ„ÄÇ" target="_blank" rel="noopener">http://research.google.com/people/jeff/index.htmlÔºåGoogleÂ§ßËßÑÊ®°ÂàÜÂ∏ÉÂºèÂπ≥Âè∞BigtableÂíåMapReduce‰∏ªË¶ÅËÆæËÆ°ÂíåÂÆûÁé∞ËÄÖ„ÄÇ</a></p>
<p>Sanjay GhemawatÂÖ∂‰∫∫Ôºö<a href="http://research.google.com/people/sanjay/index.htmlÔºåGoogleÂ§ßËßÑÊ®°ÂàÜÂ∏ÉÂºèÂπ≥Âè∞GFSÔºåBigtableÂíåMapReduce‰∏ªË¶ÅËÆæËÆ°ÂíåÂÆûÁé∞Â∑•Á®ãÂ∏à„ÄÇ" target="_blank" rel="noopener">http://research.google.com/people/sanjay/index.htmlÔºåGoogleÂ§ßËßÑÊ®°ÂàÜÂ∏ÉÂºèÂπ≥Âè∞GFSÔºåBigtableÂíåMapReduce‰∏ªË¶ÅËÆæËÆ°ÂíåÂÆûÁé∞Â∑•Á®ãÂ∏à„ÄÇ</a></p>
<p>LevelDbÂ∞±ÊòØËøô‰∏§‰ΩçÂ§ßÁ•ûÁ∫ßÂà´ÁöÑÂ∑•Á®ãÂ∏àÂèëËµ∑ÁöÑÂºÄÊ∫êÈ°πÁõÆÔºåÁÆÄËÄåË®Ä‰πãÔºåLevelDbÊòØËÉΩÂ§üÂ§ÑÁêÜÂçÅ‰∫øÁ∫ßÂà´ËßÑÊ®°Key-ValueÂûãÊï∞ÊçÆÊåÅ‰πÖÊÄßÂ≠òÂÇ®ÁöÑC++ Á®ãÂ∫èÂ∫ì„ÄÇÊ≠£ÂÉè‰∏äÈù¢‰ªãÁªçÁöÑÔºåËøô‰∫å‰ΩçÊòØBigtableÁöÑËÆæËÆ°ÂíåÂÆûÁé∞ËÄÖÔºåÂ¶ÇÊûú‰∫ÜËß£BigtableÁöÑËØùÔºåÂ∫îËØ•Áü•ÈÅìÂú®Ëøô‰∏™ÂΩ±ÂìçÊ∑±ËøúÁöÑÂàÜÂ∏ÉÂºèÂ≠òÂÇ®Á≥ªÁªü‰∏≠Êúâ‰∏§‰∏™Ê†∏ÂøÉÁöÑÈÉ®ÂàÜÔºö<code>Master Server</code>Âíå<code>Tablet Server</code>„ÄÇÂÖ∂‰∏≠Master ServerÂÅö‰∏Ä‰∫õÁÆ°ÁêÜÊï∞ÊçÆÁöÑÂ≠òÂÇ®‰ª•ÂèäÂàÜÂ∏ÉÂºèË∞ÉÂ∫¶Â∑•‰ΩúÔºåÂÆûÈôÖÁöÑÂàÜÂ∏ÉÂºèÊï∞ÊçÆÂ≠òÂÇ®‰ª•ÂèäËØªÂÜôÊìç‰ΩúÊòØÁî±Tablet ServerÂÆåÊàêÁöÑÔºåËÄåLevelDbÂàôÂèØ‰ª•ÁêÜËß£‰∏∫‰∏Ä‰∏™ÁÆÄÂåñÁâàÁöÑTablet Server„ÄÇ</p>
<a id="more"></a>
<p>LevelDbÊúâÂ¶Ç‰∏ã‰∏Ä‰∫õÁâπÁÇπÔºö</p>
<ul>
<li>È¶ñÂÖàÔºåLevelDbÊòØ‰∏Ä‰∏™ÊåÅ‰πÖÂåñÂ≠òÂÇ®ÁöÑKVÁ≥ªÁªüÔºåÂíåRedisËøôÁßçÂÜÖÂ≠òÂûãÁöÑKVÁ≥ªÁªü‰∏çÂêåÔºåLevelDb‰∏ç‰ºöÂÉèRedis‰∏ÄÊ†∑ÁãÇÂêÉÂÜÖÂ≠òÔºåËÄåÊòØÂ∞ÜÂ§ßÈÉ®ÂàÜÊï∞ÊçÆÂ≠òÂÇ®Âà∞Á£ÅÁõò‰∏ä„ÄÇ</li>
<li>ÂÖ∂Ê¨°ÔºåLevleDbÂú®Â≠òÂÇ®Êï∞ÊçÆÊó∂ÔºåÊòØÊ†πÊçÆËÆ∞ÂΩïÁöÑkeyÂÄºÊúâÂ∫èÂ≠òÂÇ®ÁöÑÔºåÂ∞±ÊòØËØ¥Áõ∏ÈÇªÁöÑkeyÂÄºÂú®Â≠òÂÇ®Êñá‰ª∂‰∏≠ÊòØ‰æùÊ¨°È°∫Â∫èÂ≠òÂÇ®ÁöÑÔºåËÄåÂ∫îÁî®ÂèØ‰ª•Ëá™ÂÆö‰πâkeyÂ§ßÂ∞èÊØîËæÉÂáΩÊï∞ÔºåLevleDb‰ºöÊåâÁÖßÁî®Êà∑ÂÆö‰πâÁöÑÊØîËæÉÂáΩÊï∞‰æùÂ∫èÂ≠òÂÇ®Ëøô‰∫õËÆ∞ÂΩï„ÄÇ</li>
<li>ÂÜçÊ¨°ÔºåÂÉèÂ§ßÂ§öÊï∞KVÁ≥ªÁªü‰∏ÄÊ†∑ÔºåLevelDbÁöÑÊìç‰ΩúÊé•Âè£ÂæàÁÆÄÂçïÔºåÂü∫Êú¨Êìç‰ΩúÂåÖÊã¨ÂÜôËÆ∞ÂΩïÔºåËØªËÆ∞ÂΩï‰ª•ÂèäÂà†Èô§ËÆ∞ÂΩï„ÄÇ‰πüÊîØÊåÅÈíàÂØπÂ§öÊù°Êìç‰ΩúÁöÑÂéüÂ≠êÊâπÈáèÊìç‰Ωú„ÄÇ</li>
<li>Âè¶Â§ñÔºåLevelDbÊîØÊåÅÊï∞ÊçÆÂø´ÁÖßÔºàsnapshotÔºâÂäüËÉΩÔºå‰ΩøÂæóËØªÂèñÊìç‰Ωú‰∏çÂèóÂÜôÊìç‰ΩúÂΩ±ÂìçÔºåÂèØ‰ª•Âú®ËØªÊìç‰ΩúËøáÁ®ã‰∏≠ÂßãÁªàÁúãÂà∞‰∏ÄËá¥ÁöÑÊï∞ÊçÆ„ÄÇ</li>
</ul>
<p>Èô§Ê≠§Â§ñÔºåLevelDbËøòÊîØÊåÅÊï∞ÊçÆÂéãÁº©Á≠âÊìç‰ΩúÔºåËøôÂØπ‰∫éÂáèÂ∞èÂ≠òÂÇ®Á©∫Èó¥‰ª•ÂèäÂ¢ûÂø´IOÊïàÁéáÈÉΩÊúâÁõ¥Êé•ÁöÑÂ∏ÆÂä©„ÄÇ</p>
<p>LevelDbÊÄßËÉΩÈùûÂ∏∏Á™ÅÂá∫ÔºåÂÆòÊñπÁΩëÁ´ôÊä•ÈÅìÂÖ∂ÈöèÊú∫ÂÜôÊÄßËÉΩËææÂà∞40‰∏áÊù°ËÆ∞ÂΩïÊØèÁßíÔºåËÄåÈöèÊú∫ËØªÊÄßËÉΩËææÂà∞6‰∏áÊù°ËÆ∞ÂΩïÊØèÁßí„ÄÇÊÄª‰ΩìÊù•ËØ¥ÔºåLevelDbÁöÑÂÜôÊìç‰ΩúË¶ÅÂ§ßÂ§ßÂø´‰∫éËØªÊìç‰ΩúÔºåËÄåÈ°∫Â∫èËØªÂÜôÊìç‰ΩúÂàôÂ§ßÂ§ßÂø´‰∫éÈöèÊú∫ËØªÂÜôÊìç‰Ωú„ÄÇËá≥‰∫é‰∏∫‰ΩïÊòØËøôÊ†∑ÔºåÁúã‰∫ÜÊàë‰ª¨ÂêéÁª≠Êé®Âá∫ÁöÑLevelDbÊó•Áü•ÂΩïÔºå‰º∞ËÆ°ÊÇ®‰ºö‰∫ÜËß£ÂÖ∂ÂÜÖÂú®ÂéüÂõ†„ÄÇ</p>
<h1 id="Êï¥‰ΩìÊû∂ÊûÑ"><a href="#Êï¥‰ΩìÊû∂ÊûÑ" class="headerlink" title="Êï¥‰ΩìÊû∂ÊûÑ"></a>Êï¥‰ΩìÊû∂ÊûÑ</h1><p>LevelDbÊú¨Ë¥®‰∏äÊòØ‰∏ÄÂ•óÂ≠òÂÇ®Á≥ªÁªü‰ª•ÂèäÂú®ËøôÂ•óÂ≠òÂÇ®Á≥ªÁªü‰∏äÊèê‰æõÁöÑ‰∏Ä‰∫õÊìç‰ΩúÊé•Âè£„ÄÇ‰∏∫‰∫Ü‰æø‰∫éÁêÜËß£Êï¥‰∏™Á≥ªÁªüÂèäÂÖ∂Â§ÑÁêÜÊµÅÁ®ãÔºåÊàë‰ª¨ÂèØ‰ª•‰ªé‰∏§‰∏™‰∏çÂêåÁöÑËßíÂ∫¶Êù•ÁúãÂæÖLevleDbÔºö<code>ÈùôÊÄÅËßíÂ∫¶</code>Âíå<code>Âä®ÊÄÅËßíÂ∫¶</code>„ÄÇ</p>
<p>‰ªéÈùôÊÄÅËßíÂ∫¶ÔºåÂèØ‰ª•ÂÅáÊÉ≥Êï¥‰∏™Á≥ªÁªüÊ≠£Âú®ËøêË°åËøáÁ®ã‰∏≠Ôºà‰∏çÊñ≠ÊèíÂÖ•Âà†Èô§ËØªÂèñÊï∞ÊçÆÔºâÔºåÊ≠§Êó∂Êàë‰ª¨ÁªôLevelDbÁÖßÁõ∏Ôºå‰ªéÁÖßÁâáÂèØ‰ª•ÁúãÂà∞‰πãÂâçÁ≥ªÁªüÁöÑÊï∞ÊçÆÂú®ÂÜÖÂ≠òÂíåÁ£ÅÁõò‰∏≠ÊòØÂ¶Ç‰ΩïÂàÜÂ∏ÉÁöÑÔºåÂ§Ñ‰∫é‰ªÄ‰πàÁä∂ÊÄÅÁ≠âÔºõ<br>‰ªéÂä®ÊÄÅÁöÑËßíÂ∫¶Ôºå‰∏ªË¶ÅÊòØ‰∫ÜËß£Á≥ªÁªüÊòØÂ¶Ç‰ΩïÂÜôÂÖ•‰∏ÄÊù°ËÆ∞ÂΩïÔºåËØªÂá∫‰∏ÄÊù°ËÆ∞ÂΩïÔºåÂà†Èô§‰∏ÄÊù°ËÆ∞ÂΩïÁöÑÔºåÂêåÊó∂‰πüÂåÖÊã¨Èô§‰∫ÜËøô‰∫õÊé•Âè£Êìç‰ΩúÂ§ñÁöÑÂÜÖÈÉ®Êìç‰ΩúÊØîÂ¶ÇcompactionÔºåÁ≥ªÁªüËøêË°åÊó∂Â¥©Ê∫ÉÂêéÂ¶Ç‰ΩïÊÅ¢Â§çÁ≥ªÁªüÁ≠âÁ≠âÊñπÈù¢„ÄÇ</p>
<p> Êú¨ËäÇÊâÄËÆ≤ÁöÑÊï¥‰ΩìÊû∂ÊûÑ‰∏ªË¶Å‰ªéÈùôÊÄÅËßíÂ∫¶Êù•ÊèèËø∞Ôºå‰πãÂêéÊé•‰∏ãÊù•ÁöÑÂá†ËäÇÂÜÖÂÆπ‰ºöËØ¶Ëø∞ÈùôÊÄÅÁªìÊûÑÊ∂âÂèäÂà∞ÁöÑÊñá‰ª∂ÊàñËÄÖÂÜÖÂ≠òÊï∞ÊçÆÁªìÊûÑÔºåLevelDbÊó•Áü•ÂΩïÂêéÂçäÈÉ®ÂàÜ‰∏ªË¶Å‰ªãÁªçÂä®ÊÄÅËßÜËßí‰∏ãÁöÑLevelDbÔºåÂ∞±ÊòØËØ¥Êï¥‰∏™Á≥ªÁªüÊòØÊÄé‰πàËøêËΩ¨Ëµ∑Êù•ÁöÑ„ÄÇ</p>
<p>LevelDb‰Ωú‰∏∫Â≠òÂÇ®Á≥ªÁªüÔºåÊï∞ÊçÆËÆ∞ÂΩïÁöÑÂ≠òÂÇ®‰ªãË¥®ÂåÖÊã¨ÂÜÖÂ≠ò‰ª•ÂèäÁ£ÅÁõòÊñá‰ª∂ÔºåÂ¶ÇÊûúÂÉè‰∏äÈù¢ËØ¥ÁöÑÔºåÂΩìLevelDbËøêË°å‰∫Ü‰∏ÄÊÆµÊó∂Èó¥ÔºåÊ≠§Êó∂Êàë‰ª¨ÁªôLevelDbËøõË°åÈÄèËßÜÊãçÁÖßÔºåÈÇ£‰πàÊÇ®‰ºöÁúãÂà∞Â¶Ç‰∏ã‰∏ÄÁï™ÊôØË±°Ôºö</p>
<p><img src="LevelDb1.png" alt="LevelDb1"></p>
<p>‰ªéÂõæ‰∏≠ÂèØ‰ª•ÁúãÂá∫ÔºåÊûÑÊàêLevelDbÈùôÊÄÅÁªìÊûÑÁöÑÂåÖÊã¨ÂÖ≠‰∏™‰∏ªË¶ÅÈÉ®ÂàÜÔºöÂÜÖÂ≠ò‰∏≠ÁöÑ<code>MemTable</code>Âíå<code>Immutable MemTable</code>‰ª•ÂèäÁ£ÅÁõò‰∏äÁöÑÂá†Áßç‰∏ªË¶ÅÊñá‰ª∂Ôºö<code>CurrentÊñá‰ª∂</code>Ôºå<code>ManifestÊñá‰ª∂</code>Ôºå<code>logÊñá‰ª∂</code>‰ª•Âèä<code>SSTableÊñá‰ª∂</code>„ÄÇÂΩìÁÑ∂ÔºåLevelDbÈô§‰∫ÜËøôÂÖ≠‰∏™‰∏ªË¶ÅÈÉ®ÂàÜËøòÊúâ‰∏Ä‰∫õËæÖÂä©ÁöÑÊñá‰ª∂Ôºå‰ΩÜÊòØ‰ª•‰∏äÂÖ≠‰∏™Êñá‰ª∂ÂíåÊï∞ÊçÆÁªìÊûÑÊòØLevelDbÁöÑ‰∏ª‰ΩìÊûÑÊàêÂÖÉÁ¥†„ÄÇ</p>
<p>LevelDbÁöÑLogÊñá‰ª∂ÂíåMemtable‰∏éBigtableËÆ∫Êñá‰∏≠‰ªãÁªçÁöÑÊòØ‰∏ÄËá¥ÁöÑÔºåÂΩìÂ∫îÁî®ÂÜôÂÖ•‰∏ÄÊù°Key:ValueËÆ∞ÂΩïÁöÑÊó∂ÂÄôÔºåLevelDb‰ºöÂÖàÂæÄlogÊñá‰ª∂ÈáåÂÜôÂÖ•ÔºåÊàêÂäüÂêéÂ∞ÜËÆ∞ÂΩïÊèíËøõMemtable‰∏≠ÔºåËøôÊ†∑Âü∫Êú¨Â∞±ÁÆóÂÆåÊàê‰∫ÜÂÜôÂÖ•Êìç‰ΩúÔºåÂõ†‰∏∫‰∏ÄÊ¨°ÂÜôÂÖ•Êìç‰ΩúÂè™Ê∂âÂèä‰∏ÄÊ¨°Á£ÅÁõòÈ°∫Â∫èÂÜôÂíå‰∏ÄÊ¨°ÂÜÖÂ≠òÂÜôÂÖ•ÔºåÊâÄ‰ª•ËøôÊòØ‰∏∫‰ΩïËØ¥LevelDbÂÜôÂÖ•ÈÄüÂ∫¶ÊûÅÂø´ÁöÑ‰∏ªË¶ÅÂéüÂõ†„ÄÇ</p>
<p>LogÊñá‰ª∂Âú®Á≥ªÁªü‰∏≠ÁöÑ‰ΩúÁî®‰∏ªË¶ÅÊòØÁî®‰∫éÁ≥ªÁªüÂ¥©Ê∫ÉÊÅ¢Â§çËÄå‰∏ç‰∏¢Â§±Êï∞ÊçÆÔºåÂÅáÂ¶ÇÊ≤°ÊúâLogÊñá‰ª∂ÔºåÂõ†‰∏∫ÂÜôÂÖ•ÁöÑËÆ∞ÂΩïÂàöÂºÄÂßãÊòØ‰øùÂ≠òÂú®ÂÜÖÂ≠ò‰∏≠ÁöÑÔºåÊ≠§Êó∂Â¶ÇÊûúÁ≥ªÁªüÂ¥©Ê∫ÉÔºåÂÜÖÂ≠ò‰∏≠ÁöÑÊï∞ÊçÆËøòÊ≤°ÊúâÊù•ÂæóÂèäDumpÂà∞Á£ÅÁõòÔºåÊâÄ‰ª•‰ºö‰∏¢Â§±Êï∞ÊçÆÔºàRedisÂ∞±Â≠òÂú®Ëøô‰∏™ÈóÆÈ¢òÔºâ„ÄÇ‰∏∫‰∫ÜÈÅøÂÖçËøôÁßçÊÉÖÂÜµÔºåLevelDbÂú®ÂÜôÂÖ•ÂÜÖÂ≠òÂâçÂÖàÂ∞ÜÊìç‰ΩúËÆ∞ÂΩïÂà∞LogÊñá‰ª∂‰∏≠ÔºåÁÑ∂ÂêéÂÜçËÆ∞ÂÖ•ÂÜÖÂ≠ò‰∏≠ÔºåËøôÊ†∑Âç≥‰ΩøÁ≥ªÁªüÂ¥©Ê∫ÉÔºå‰πüÂèØ‰ª•‰ªéLogÊñá‰ª∂‰∏≠ÊÅ¢Â§çÂÜÖÂ≠ò‰∏≠ÁöÑMemtableÔºå‰∏ç‰ºöÈÄ†ÊàêÊï∞ÊçÆÁöÑ‰∏¢Â§±„ÄÇ</p>
<p>ÂΩìMemtableÊèíÂÖ•ÁöÑÊï∞ÊçÆÂç†Áî®ÂÜÖÂ≠òÂà∞‰∫Ü‰∏Ä‰∏™ÁïåÈôêÂêéÔºåÈúÄË¶ÅÂ∞ÜÂÜÖÂ≠òÁöÑËÆ∞ÂΩïÂØºÂá∫Âà∞Â§ñÂ≠òÊñá‰ª∂‰∏≠ÔºåLevleDb‰ºöÁîüÊàêÊñ∞ÁöÑLogÊñá‰ª∂ÂíåMemtableÔºåÂéüÂÖàÁöÑMemtableÂ∞±Êàê‰∏∫Immutable MemtableÔºåÈ°æÂêçÊÄù‰πâÔºåÂ∞±ÊòØËØ¥Ëøô‰∏™MemtableÁöÑÂÜÖÂÆπÊòØ‰∏çÂèØÊõ¥ÊîπÁöÑÔºåÂè™ËÉΩËØª‰∏çËÉΩÂÜôÂÖ•ÊàñËÄÖÂà†Èô§„ÄÇÊñ∞Âà∞Êù•ÁöÑÊï∞ÊçÆË¢´ËÆ∞ÂÖ•Êñ∞ÁöÑLogÊñá‰ª∂ÂíåMemtableÔºåLevelDbÂêéÂè∞Ë∞ÉÂ∫¶‰ºöÂ∞ÜImmutable MemtableÁöÑÊï∞ÊçÆÂØºÂá∫Âà∞Á£ÅÁõòÔºåÂΩ¢Êàê‰∏Ä‰∏™Êñ∞ÁöÑSSTableÊñá‰ª∂„ÄÇSSTableÂ∞±ÊòØÁî±ÂÜÖÂ≠ò‰∏≠ÁöÑÊï∞ÊçÆ‰∏çÊñ≠ÂØºÂá∫Âπ∂ËøõË°åCompactionÊìç‰ΩúÂêéÂΩ¢ÊàêÁöÑÔºåËÄå‰∏îSSTableÁöÑÊâÄÊúâÊñá‰ª∂ÊòØ‰∏ÄÁßçÂ±ÇÁ∫ßÁªìÊûÑÔºåÁ¨¨‰∏ÄÂ±Ç‰∏∫Level 0ÔºåÁ¨¨‰∫åÂ±Ç‰∏∫Level 1Ôºå‰æùÊ¨°Á±ªÊé®ÔºåÂ±ÇÁ∫ßÈÄêÊ∏êÂ¢ûÈ´òÔºåËøô‰πüÊòØ‰∏∫‰ΩïÁß∞‰πã‰∏∫LevelDbÁöÑÂéüÂõ†„ÄÇ</p>
<p>SSTable‰∏≠ÁöÑÊñá‰ª∂ÊòØKeyÊúâÂ∫èÁöÑÔºåÂ∞±ÊòØËØ¥Âú®Êñá‰ª∂‰∏≠Â∞èkeyËÆ∞ÂΩïÊéíÂú®Â§ßKeyËÆ∞ÂΩï‰πãÂâçÔºåÂêÑ‰∏™LevelÁöÑSSTableÈÉΩÊòØÂ¶ÇÊ≠§Ôºå‰ΩÜÊòØËøôÈáåÈúÄË¶ÅÊ≥®ÊÑèÁöÑ‰∏ÄÁÇπÊòØÔºö<code>Level 0</code>ÁöÑSSTableÊñá‰ª∂ÔºàÂêéÁºÄ‰∏∫.sstÔºâÂíåÂÖ∂ÂÆÉLevelÁöÑÊñá‰ª∂Áõ∏ÊØîÊúâ<code>ÁâπÊÆäÊÄß</code>ÔºöËøô‰∏™Â±ÇÁ∫ßÂÜÖÁöÑ.sstÊñá‰ª∂Ôºå‰∏§‰∏™Êñá‰ª∂<code>ÂèØËÉΩÂ≠òÂú®keyÈáçÂè†</code>ÔºåÊØîÂ¶ÇÊúâ‰∏§‰∏™level 0ÁöÑsstÊñá‰ª∂ÔºåÊñá‰ª∂AÂíåÊñá‰ª∂BÔºåÊñá‰ª∂AÁöÑkeyËåÉÂõ¥ÊòØÔºö{barÔºå car}ÔºåÊñá‰ª∂BÁöÑKeyËåÉÂõ¥ÊòØ{blueÔºåsamecity}ÔºåÈÇ£‰πàÂæàÂèØËÉΩ‰∏§‰∏™Êñá‰ª∂ÈÉΩÂ≠òÂú®key=‚Äùblood‚ÄùÁöÑËÆ∞ÂΩï„ÄÇÂØπ‰∫éÂÖ∂ÂÆÉLevelÁöÑSSTableÊñá‰ª∂Êù•ËØ¥ÔºåÂàô‰∏ç‰ºöÂá∫Áé∞Âêå‰∏ÄÂ±ÇÁ∫ßÂÜÖ.sstÊñá‰ª∂ÁöÑkeyÈáçÂè†Áé∞Ë±°ÔºåÂ∞±ÊòØËØ¥Level L‰∏≠‰ªªÊÑè‰∏§‰∏™.sstÊñá‰ª∂ÔºåÈÇ£‰πàÂèØ‰ª•‰øùËØÅÂÆÉ‰ª¨ÁöÑkeyÂÄºÊòØ‰∏ç‰ºöÈáçÂè†ÁöÑ„ÄÇËøôÁÇπÈúÄË¶ÅÁâπÂà´Ê≥®ÊÑèÔºåÂêéÈù¢ÊÇ®‰ºöÁúãÂà∞ÂæàÂ§öÊìç‰ΩúÁöÑÂ∑ÆÂºÇÈÉΩÊòØÁî±‰∫éËøô‰∏™ÂéüÂõ†ÈÄ†ÊàêÁöÑ„ÄÇ</p>
<p>SSTable‰∏≠ÁöÑÊüê‰∏™Êñá‰ª∂Â±û‰∫éÁâπÂÆöÂ±ÇÁ∫ßÔºåËÄå‰∏îÂÖ∂Â≠òÂÇ®ÁöÑËÆ∞ÂΩïÊòØkeyÊúâÂ∫èÁöÑÔºåÈÇ£‰πàÂøÖÁÑ∂ÊúâÊñá‰ª∂‰∏≠ÁöÑÊúÄÂ∞èkeyÂíåÊúÄÂ§ßkeyÔºåËøôÊòØÈùûÂ∏∏ÈáçË¶ÅÁöÑ‰ø°ÊÅØÔºåLevelDbÂ∫îËØ•ËÆ∞‰∏ãËøô‰∫õ‰ø°ÊÅØ„ÄÇManifestÂ∞±ÊòØÂπ≤Ëøô‰∏™ÁöÑÔºåÂÆÉËÆ∞ËΩΩ‰∫ÜSSTableÂêÑ‰∏™Êñá‰ª∂ÁöÑÁÆ°ÁêÜ‰ø°ÊÅØÔºåÊØîÂ¶ÇÂ±û‰∫éÂì™‰∏™LevelÔºåÊñá‰ª∂ÂêçÁß∞Âè´Âï•ÔºåÊúÄÂ∞èkeyÂíåÊúÄÂ§ßkeyÂêÑËá™ÊòØÂ§öÂ∞ë„ÄÇ‰∏ãÂõæÊòØManifestÊâÄÂ≠òÂÇ®ÂÜÖÂÆπÁöÑÁ§∫ÊÑèÔºö</p>
<p><img src="LevelDb2.png" alt="LevelDb2"></p>
<p>Âõæ‰∏≠Âè™ÊòæÁ§∫‰∫Ü‰∏§‰∏™Êñá‰ª∂Ôºàmanifest‰ºöËÆ∞ËΩΩÊâÄÊúâSSTableÊñá‰ª∂ÁöÑËøô‰∫õ‰ø°ÊÅØÔºâÔºåÂç≥Level 0ÁöÑtest.sst1Âíåtest.sst2Êñá‰ª∂ÔºåÂêåÊó∂ËÆ∞ËΩΩ‰∫ÜËøô‰∫õÊñá‰ª∂ÂêÑËá™ÂØπÂ∫îÁöÑkeyËåÉÂõ¥ÔºåÊØîÂ¶Çtest.sstt1ÁöÑkeyËåÉÂõ¥ÊòØ‚Äúan‚ÄùÂà∞ ‚Äúbanana‚ÄùÔºåËÄåÊñá‰ª∂test.sst2ÁöÑkeyËåÉÂõ¥ÊòØ‚Äúbaby‚ÄùÂà∞‚Äúsamecity‚ÄùÔºåÂèØ‰ª•ÁúãÂá∫‰∏§ËÄÖÁöÑkeyËåÉÂõ¥ÊòØÊúâÈáçÂè†ÁöÑ„ÄÇ</p>
<p>CurrentÊñá‰ª∂ÊòØÂπ≤‰ªÄ‰πàÁöÑÂë¢ÔºüËøô‰∏™Êñá‰ª∂ÁöÑÂÜÖÂÆπÂè™Êúâ‰∏Ä‰∏™‰ø°ÊÅØÔºåÂ∞±ÊòØËÆ∞ËΩΩÂΩìÂâçÁöÑmanifestÊñá‰ª∂Âêç„ÄÇÂõ†‰∏∫Âú®LevleDbÁöÑËøêË°åËøáÁ®ã‰∏≠ÔºåÈöèÁùÄCompactionÁöÑËøõË°åÔºåSSTableÊñá‰ª∂‰ºöÂèëÁîüÂèòÂåñÔºå‰ºöÊúâÊñ∞ÁöÑÊñá‰ª∂‰∫ßÁîüÔºåËÄÅÁöÑÊñá‰ª∂Ë¢´Â∫üÂºÉÔºåManifest‰πü‰ºöË∑üÁùÄÂèçÊò†ËøôÁßçÂèòÂåñÔºåÊ≠§Êó∂ÂæÄÂæÄ‰ºöÊñ∞ÁîüÊàêManifestÊñá‰ª∂Êù•ËÆ∞ËΩΩËøôÁßçÂèòÂåñÔºåËÄåCurrentÂàôÁî®Êù•ÊåáÂá∫Âì™‰∏™ManifestÊñá‰ª∂ÊâçÊòØÊàë‰ª¨ÂÖ≥ÂøÉÁöÑÈÇ£‰∏™ManifestÊñá‰ª∂„ÄÇ</p>
<p>‰ª•‰∏ä‰ªãÁªçÁöÑÂÜÖÂÆπÂ∞±ÊûÑÊàê‰∫ÜLevelDbÁöÑÊï¥‰ΩìÈùôÊÄÅÁªìÊûÑÔºåÂú®LevelDbÊó•Áü•ÂΩïÊé•‰∏ãÊù•ÁöÑÂÜÖÂÆπ‰∏≠ÔºåÊàë‰ª¨‰ºöÈ¶ñÂÖà‰ªãÁªçÈáçË¶ÅÊñá‰ª∂ÊàñËÄÖÂÜÖÂ≠òÊï∞ÊçÆÁöÑÂÖ∑‰ΩìÊï∞ÊçÆÂ∏ÉÂ±Ä‰∏éÁªìÊûÑ„ÄÇ</p>
<h1 id="LogÊñá‰ª∂"><a href="#LogÊñá‰ª∂" class="headerlink" title="LogÊñá‰ª∂"></a>LogÊñá‰ª∂</h1><p>‰∏äËäÇÂÜÖÂÆπËÆ≤Âà∞logÊñá‰ª∂Âú®LevelDb‰∏≠ÁöÑ‰∏ªË¶Å‰ΩúÁî®ÊòØÁ≥ªÁªüÊïÖÈöúÊÅ¢Â§çÊó∂ÔºåËÉΩÂ§ü‰øùËØÅ‰∏ç‰ºö‰∏¢Â§±Êï∞ÊçÆ„ÄÇÂõ†‰∏∫Âú®Â∞ÜËÆ∞ÂΩïÂÜôÂÖ•ÂÜÖÂ≠òÁöÑMemtable‰πãÂâçÔºå‰ºöÂÖàÂÜôÂÖ•LogÊñá‰ª∂ÔºåËøôÊ†∑Âç≥‰ΩøÁ≥ªÁªüÂèëÁîüÊïÖÈöúÔºåMemtable‰∏≠ÁöÑÊï∞ÊçÆÊ≤°ÊúâÊù•ÂæóÂèäDumpÂà∞Á£ÅÁõòÁöÑSSTableÊñá‰ª∂ÔºåLevelDB‰πüÂèØ‰ª•Ê†πÊçÆlogÊñá‰ª∂ÊÅ¢Â§çÂÜÖÂ≠òÁöÑMemtableÊï∞ÊçÆÁªìÊûÑÂÜÖÂÆπÔºå‰∏ç‰ºöÈÄ†ÊàêÁ≥ªÁªü‰∏¢Â§±Êï∞ÊçÆÔºåÂú®ËøôÁÇπ‰∏äLevelDbÂíåBigtableÊòØ‰∏ÄËá¥ÁöÑ„ÄÇ</p>
<p>‰∏ãÈù¢Êàë‰ª¨Â∏¶Â§ßÂÆ∂ÁúãÁúãlogÊñá‰ª∂ÁöÑÂÖ∑‰ΩìÁâ©ÁêÜÂíåÈÄªËæëÂ∏ÉÂ±ÄÊòØÊÄéÊ†∑ÁöÑÔºåLevelDbÂØπ‰∫é‰∏Ä‰∏™logÊñá‰ª∂Ôºå‰ºöÊääÂÆÉÂàáÂâ≤Êàê‰ª•32K‰∏∫Âçï‰ΩçÁöÑÁâ©ÁêÜBlockÔºåÊØèÊ¨°ËØªÂèñÁöÑÂçï‰Ωç‰ª•‰∏Ä‰∏™Block‰Ωú‰∏∫Âü∫Êú¨ËØªÂèñÂçï‰ΩçÔºå‰∏ãÂõæÂ±ïÁ§∫ÁöÑlogÊñá‰ª∂Áî±3‰∏™BlockÊûÑÊàêÔºåÊâÄ‰ª•‰ªéÁâ©ÁêÜÂ∏ÉÂ±ÄÊù•ËÆ≤Ôºå‰∏Ä‰∏™logÊñá‰ª∂Â∞±ÊòØÁî±ËøûÁª≠ÁöÑ32KÂ§ßÂ∞èBlockÊûÑÊàêÁöÑ„ÄÇ</p>
<p><img src="LevelDb3.png" alt="LevelDb3"></p>
<p>Âú®Â∫îÁî®ÁöÑËßÜÈáéÈáåÊòØÁúã‰∏çÂà∞Ëøô‰∫õBlockÁöÑÔºåÂ∫îÁî®ÁúãÂà∞ÁöÑÊòØ‰∏ÄÁ≥ªÂàóÁöÑKey:ValueÂØπÔºåÂú®LevelDbÂÜÖÈÉ®Ôºå‰ºöÂ∞Ü‰∏Ä‰∏™Key:ValueÂØπÁúãÂÅö‰∏ÄÊù°ËÆ∞ÂΩïÁöÑÊï∞ÊçÆÔºåÂè¶Â§ñÂú®Ëøô‰∏™Êï∞ÊçÆÂâçÂ¢ûÂä†‰∏Ä‰∏™ËÆ∞ÂΩïÂ§¥ÔºåÁî®Êù•ËÆ∞ËΩΩ‰∏Ä‰∫õÁÆ°ÁêÜ‰ø°ÊÅØÔºå‰ª•Êñπ‰æøÂÜÖÈÉ®Â§ÑÁêÜÔºå‰∏ãÂõæÊòæÁ§∫‰∫Ü‰∏Ä‰∏™ËÆ∞ÂΩïÂú®LevelDbÂÜÖÈÉ®ÊòØÂ¶Ç‰ΩïË°®Á§∫ÁöÑ„ÄÇ<br><img src="LevelDb4.png" alt="LevelDb4"></p>
<p>ËÆ∞ÂΩïÂ§¥ÂåÖÂê´‰∏â‰∏™Â≠óÊÆµÔºå<code>ChechSum</code>ÊòØÂØπ‚ÄúÁ±ªÂûã‚ÄùÂíå‚ÄúÊï∞ÊçÆ‚ÄùÂ≠óÊÆµÁöÑÊ†°È™åÁ†ÅÔºå‰∏∫‰∫ÜÈÅøÂÖçÂ§ÑÁêÜ‰∏çÂÆåÊï¥ÊàñËÄÖÊòØË¢´Á†¥ÂùèÁöÑÊï∞ÊçÆÔºåÂΩìLevelDbËØªÂèñËÆ∞ÂΩïÊï∞ÊçÆÊó∂ÂÄô‰ºöÂØπÊï∞ÊçÆËøõË°åÊ†°È™åÔºåÂ¶ÇÊûúÂèëÁé∞ÂíåÂ≠òÂÇ®ÁöÑCheckSumÁõ∏ÂêåÔºåËØ¥ÊòéÊï∞ÊçÆÂÆåÊï¥Êó†Á†¥ÂùèÔºåÂèØ‰ª•ÁªßÁª≠ÂêéÁª≠ÊµÅÁ®ã„ÄÇ‚ÄúËÆ∞ÂΩïÈïøÂ∫¶‚ÄùËÆ∞ËΩΩ‰∫ÜÊï∞ÊçÆÁöÑÂ§ßÂ∞èÔºå‚ÄúÊï∞ÊçÆ‚ÄùÂàôÊòØ‰∏äÈù¢ËÆ≤ÁöÑKey:ValueÊï∞ÂÄºÂØπÔºå‚ÄúÁ±ªÂûã‚ÄùÂ≠óÊÆµÂàôÊåáÂá∫‰∫ÜÊØèÊù°ËÆ∞ÂΩïÁöÑÈÄªËæëÁªìÊûÑÂíålogÊñá‰ª∂Áâ©ÁêÜÂàÜÂùóÁªìÊûÑ‰πãÈó¥ÁöÑÂÖ≥Á≥ªÔºåÂÖ∑‰ΩìËÄåË®ÄÔºå‰∏ªË¶ÅÊúâ‰ª•‰∏ãÂõõÁßçÁ±ªÂûãÔºöFULL/FIRST/MIDDLE/LAST„ÄÇ</p>
<p>Â¶ÇÊûúËÆ∞ÂΩïÁ±ªÂûãÊòØFULLÔºå‰ª£Ë°®‰∫ÜÂΩìÂâçËÆ∞ÂΩïÂÜÖÂÆπÂÆåÊï¥Âú∞Â≠òÂÇ®Âú®‰∏Ä‰∏™Áâ©ÁêÜBlockÈáåÔºåÊ≤°ÊúâË¢´‰∏çÂêåÁöÑÁâ©ÁêÜBlockÂàáÂâ≤ÂºÄÔºõÂ¶ÇÊûúËÆ∞ÂΩïË¢´Áõ∏ÈÇªÁöÑÁâ©ÁêÜBlockÂàáÂâ≤ÂºÄÔºåÂàôÁ±ªÂûã‰ºöÊòØÂÖ∂‰ªñ‰∏âÁßçÁ±ªÂûã‰∏≠ÁöÑ‰∏ÄÁßç„ÄÇÊàë‰ª¨‰ª•‰πãÂâçÂõæ‰∏≠ÊâÄÁ§∫ÁöÑ‰æãÂ≠êÊù•ÂÖ∑‰ΩìËØ¥Êòé„ÄÇ</p>
<p>ÂÅáËÆæÁõÆÂâçÂ≠òÂú®‰∏âÊù°ËÆ∞ÂΩïÔºåRecord AÔºåRecord BÂíåRecord CÔºåÂÖ∂‰∏≠Record AÂ§ßÂ∞è‰∏∫10KÔºåRecord B Â§ßÂ∞è‰∏∫80KÔºåRecord CÂ§ßÂ∞è‰∏∫12KÔºåÈÇ£‰πàÂÖ∂Âú®logÊñá‰ª∂‰∏≠ÁöÑÈÄªËæëÂ∏ÉÂ±Ä‰ºöÂ¶ÇÂõæ3.1ÊâÄÁ§∫„ÄÇRecord AÊòØÂõæ‰∏≠ËìùËâ≤Âå∫ÂüüÊâÄÁ§∫ÔºåÂõ†‰∏∫Â§ßÂ∞è‰∏∫10K&lt;32KÔºåËÉΩÂ§üÊîæÂú®‰∏Ä‰∏™Áâ©ÁêÜBlock‰∏≠ÔºåÊâÄ‰ª•ÂÖ∂Á±ªÂûã‰∏∫FULLÔºõRecord B Â§ßÂ∞è‰∏∫80KÔºåËÄåBlock 1Âõ†‰∏∫ÊîæÂÖ•‰∫ÜRecord AÔºåÊâÄ‰ª•ËøòÂâ©‰∏ã22KÔºå‰∏çË∂≥‰ª•Êîæ‰∏ãRecord BÔºåÊâÄ‰ª•Âú®Block 1ÁöÑÂâ©‰ΩôÈÉ®ÂàÜÊîæÂÖ•Record BÁöÑÂºÄÂ§¥‰∏ÄÈÉ®ÂàÜÔºåÁ±ªÂûãÊ†áËØÜ‰∏∫FIRSTÔºå‰ª£Ë°®‰∫ÜÊòØ‰∏Ä‰∏™ËÆ∞ÂΩïÁöÑËµ∑ÂßãÈÉ®ÂàÜÔºõRecord BËøòÊúâ58KÊ≤°ÊúâÂ≠òÂÇ®ÔºåËøô‰∫õÂè™ËÉΩ‰æùÊ¨°ÊîæÂú®ÂêéÁª≠ÁöÑÁâ©ÁêÜBlockÈáåÈù¢ÔºåÂõ†‰∏∫Block 2Â§ßÂ∞èÂè™Êúâ32KÔºå‰ªçÁÑ∂Êîæ‰∏ç‰∏ãRecord BÁöÑÂâ©‰ΩôÈÉ®ÂàÜÔºåÊâÄ‰ª•Block 2ÂÖ®ÈÉ®Áî®Êù•ÊîæRecord BÔºå‰∏îÊ†áËØÜÁ±ªÂûã‰∏∫MIDDLEÔºåÊÑèÊÄùÊòØËøôÊòØRecord B‰∏≠Èó¥‰∏ÄÊÆµÊï∞ÊçÆÔºõRecord BÂâ©‰∏ãÁöÑÈÉ®ÂàÜÂèØ‰ª•ÂÆåÂÖ®ÊîæÂú®Block 3‰∏≠ÔºåÁ±ªÂûãÊ†áËØÜ‰∏∫LASTÔºå‰ª£Ë°®‰∫ÜËøôÊòØRecord BÁöÑÊú´Â∞æÊï∞ÊçÆÔºõÂõæ‰∏≠ÈªÑËâ≤ÁöÑRecord CÂõ†‰∏∫Â§ßÂ∞è‰∏∫12KÔºåBlock 3Ââ©‰∏ãÁöÑÁ©∫Èó¥Ë∂≥‰ª•ÂÖ®ÈÉ®Êîæ‰∏ãÂÆÉÔºåÊâÄ‰ª•ÂÖ∂Á±ªÂûãÊ†áËØÜ‰∏∫FULL„ÄÇ</p>
<p>‰ªéËøô‰∏™Â∞è‰æãÂ≠êÂèØ‰ª•ÁúãÂá∫ÈÄªËæëËÆ∞ÂΩïÂíåÁâ©ÁêÜBlock‰πãÈó¥ÁöÑÂÖ≥Á≥ªÔºåLevelDb‰∏ÄÊ¨°Áâ©ÁêÜËØªÂèñ‰∏∫‰∏Ä‰∏™BlockÔºåÁÑ∂ÂêéÊ†πÊçÆÁ±ªÂûãÊÉÖÂÜµÊãºÊé•Âá∫ÈÄªËæëËÆ∞ÂΩïÔºå‰æõÂêéÁª≠ÊµÅÁ®ãÂ§ÑÁêÜ„ÄÇ</p>
<h1 id="SSTableÊñá‰ª∂"><a href="#SSTableÊñá‰ª∂" class="headerlink" title="SSTableÊñá‰ª∂"></a>SSTableÊñá‰ª∂</h1><p>SSTableÊòØBigtable‰∏≠Ëá≥ÂÖ≥ÈáçË¶ÅÁöÑ‰∏ÄÂùóÔºåÂØπ‰∫éLevelDbÊù•ËØ¥‰πüÊòØÂ¶ÇÊ≠§ÔºåÂØπLevelDbÁöÑSSTableÂÆûÁé∞ÁªÜËäÇÁöÑ‰∫ÜËß£‰πüÊúâÂä©‰∫é‰∫ÜËß£Bigtable‰∏≠‰∏Ä‰∫õÂÆûÁé∞ÁªÜËäÇ„ÄÇ</p>
<p>Êú¨ËäÇÂÜÖÂÆπ‰∏ªË¶ÅËÆ≤Ëø∞SSTableÁöÑÈùôÊÄÅÂ∏ÉÂ±ÄÁªìÊûÑÔºåÊàë‰ª¨ÊõæÂú®‚ÄúLevelDbÊó•Áü•ÂΩï‰πã‰∫åÔºöÊï¥‰ΩìÊû∂ÊûÑ‚Äù‰∏≠ËØ¥ËøáÔºåSSTableÊñá‰ª∂ÂΩ¢Êàê‰∫Ü‰∏çÂêåLevelÁöÑÂ±ÇÁ∫ßÁªìÊûÑÔºåËá≥‰∫éËøô‰∏™Â±ÇÁ∫ßÁªìÊûÑÊòØÂ¶Ç‰ΩïÂΩ¢ÊàêÁöÑÊàë‰ª¨ÊîæÂú®ÂêéÈù¢Compaction‰∏ÄËäÇÁªÜËØ¥„ÄÇÊú¨ËäÇ‰∏ªË¶Å‰ªãÁªçSSTableÊüê‰∏™Êñá‰ª∂ÁöÑÁâ©ÁêÜÂ∏ÉÂ±ÄÂíåÈÄªËæëÂ∏ÉÂ±ÄÁªìÊûÑÔºåËøôÂØπ‰∫ÜËß£LevelDbÁöÑËøêË°åËøáÁ®ãÂæàÊúâÂ∏ÆÂä©„ÄÇ</p>
<p>LevelDb‰∏çÂêåÂ±ÇÁ∫ßÊúâÂæàÂ§öSSTableÊñá‰ª∂Ôºà‰ª•ÂêéÁºÄ.sst‰∏∫ÁâπÂæÅÔºâÔºåÊâÄÊúâ.sstÊñá‰ª∂ÂÜÖÈÉ®Â∏ÉÂ±ÄÈÉΩÊòØ‰∏ÄÊ†∑ÁöÑ„ÄÇ‰∏äËäÇ‰ªãÁªçLogÊñá‰ª∂ÊòØÁâ©ÁêÜÂàÜÂùóÁöÑÔºåSSTable‰πü‰∏ÄÊ†∑‰ºöÂ∞ÜÊñá‰ª∂ÂàíÂàÜ‰∏∫Âõ∫ÂÆöÂ§ßÂ∞èÁöÑÁâ©ÁêÜÂ≠òÂÇ®ÂùóÔºå‰ΩÜÊòØ‰∏§ËÄÖÈÄªËæëÂ∏ÉÂ±ÄÂ§ß‰∏çÁõ∏ÂêåÔºåÊ†πÊú¨ÂéüÂõ†ÊòØÔºöLogÊñá‰ª∂‰∏≠ÁöÑËÆ∞ÂΩïÊòØKeyÊó†Â∫èÁöÑÔºåÂç≥ÂÖàÂêéËÆ∞ÂΩïÁöÑkeyÂ§ßÂ∞èÊ≤°ÊúâÊòéÁ°ÆÂ§ßÂ∞èÂÖ≥Á≥ªÔºåËÄå.sstÊñá‰ª∂ÂÜÖÈÉ®ÂàôÊòØÊ†πÊçÆËÆ∞ÂΩïÁöÑKeyÁî±Â∞èÂà∞Â§ßÊéíÂàóÁöÑÔºå‰ªé‰∏ãÈù¢‰ªãÁªçÁöÑSSTableÂ∏ÉÂ±ÄÂèØ‰ª•‰Ωì‰ºöÂà∞KeyÊúâÂ∫èÊòØ‰∏∫‰ΩïÂ¶ÇÊ≠§ËÆæËÆ°.sstÊñá‰ª∂ÁªìÊûÑÁöÑÂÖ≥ÈîÆ„ÄÇ</p>
<p><img src="LevelDb5.png" alt="LevelDb5"></p>
<p>‰∏äÂõæÂ±ïÁ§∫‰∫Ü‰∏Ä‰∏™.sstÊñá‰ª∂ÁöÑÁâ©ÁêÜÂàíÂàÜÁªìÊûÑÔºåÂêåLogÊñá‰ª∂‰∏ÄÊ†∑Ôºå‰πüÊòØÂàíÂàÜ‰∏∫Âõ∫ÂÆöÂ§ßÂ∞èÁöÑÂ≠òÂÇ®ÂùóÔºåÊØè‰∏™BlockÂàÜ‰∏∫‰∏â‰∏™ÈÉ®ÂàÜÔºåÈªÑËâ≤ÈÉ®ÂàÜÊòØ<code>Êï∞ÊçÆÂ≠òÂÇ®Âå∫</code>Ôºå ËìùËâ≤ÁöÑTypeÂå∫Áî®‰∫éÊ†áËØÜÊï∞ÊçÆÂ≠òÂÇ®Âå∫ÊòØÂê¶ÈááÁî®‰∫ÜÊï∞ÊçÆÂéãÁº©ÁÆóÊ≥ïÔºàSnappyÂéãÁº©ÊàñËÄÖÊó†ÂéãÁº©‰∏§ÁßçÔºâÔºåCRCÈÉ®ÂàÜÂàôÊòØÊï∞ÊçÆÊ†°È™åÁ†ÅÔºåÁî®‰∫éÂà§Âà´Êï∞ÊçÆÊòØÂê¶Âú®ÁîüÊàêÂíå‰º†Ëæì‰∏≠Âá∫Èîô„ÄÇ</p>
<p>‰ª•‰∏äÊòØ.sstÁöÑÁâ©ÁêÜÂ∏ÉÂ±ÄÔºå‰∏ãÈù¢‰ªãÁªç.sstÊñá‰ª∂ÁöÑÈÄªËæëÂ∏ÉÂ±ÄÔºåÊâÄË∞ìÈÄªËæëÂ∏ÉÂ±ÄÔºåÂ∞±ÊòØËØ¥Â∞ΩÁÆ°Â§ßÂÆ∂ÈÉΩÊòØÁâ©ÁêÜÂùóÔºå‰ΩÜÊòØÊØè‰∏ÄÂùóÂ≠òÂÇ®‰ªÄ‰πàÂÜÖÂÆπÔºåÂÜÖÈÉ®ÂèàÊúâ‰ªÄ‰πàÁªìÊûÑÁ≠â„ÄÇ‰∏ãÈù¢Â±ïÁ§∫‰∫Ü.sstÊñá‰ª∂ÁöÑÂÜÖÈÉ®ÈÄªËæëËß£Èáä„ÄÇ</p>
<p><img src="LevelDb6.png" alt="LevelDb6"><br>Âõæ4.2 ÈÄªËæëÂ∏ÉÂ±Ä</p>
<p>‰ªé‰∏äÂõæÂèØ‰ª•ÁúãÂá∫Ôºå‰ªéÂ§ßÁöÑÊñπÈù¢ÔºåÂèØ‰ª•Â∞Ü.sstÊñá‰ª∂ÂàíÂàÜ‰∏∫<code>Êï∞ÊçÆÂ≠òÂÇ®Âå∫</code>Âíå<code>Êï∞ÊçÆÁÆ°ÁêÜÂå∫</code>ÔºåÊï∞ÊçÆÂ≠òÂÇ®Âå∫Â≠òÊîæÂÆûÈôÖÁöÑKey:ValueÊï∞ÊçÆÔºåÊï∞ÊçÆÁÆ°ÁêÜÂå∫ÂàôÊèê‰æõ‰∏Ä‰∫õÁ¥¢ÂºïÊåáÈíàÁ≠âÁÆ°ÁêÜÊï∞ÊçÆÔºåÁõÆÁöÑÊòØÊõ¥Âø´ÈÄü‰æøÊç∑ÁöÑÊü•ÊâæÁõ∏Â∫îÁöÑËÆ∞ÂΩï„ÄÇ‰∏§‰∏™Âå∫ÂüüÈÉΩÊòØÂú®‰∏äËø∞ÁöÑÂàÜÂùóÂü∫Á°Ä‰∏äÁöÑÔºåÂ∞±ÊòØËØ¥Êñá‰ª∂ÁöÑÂâçÈù¢Ëã•Âπ≤ÂùóÂÆûÈôÖÂ≠òÂÇ®KVÊï∞ÊçÆÔºåÂêéÈù¢Êï∞ÊçÆÁÆ°ÁêÜÂå∫Â≠òÂÇ®ÁÆ°ÁêÜÊï∞ÊçÆ„ÄÇÁÆ°ÁêÜÊï∞ÊçÆÂèàÂàÜ‰∏∫ÂõõÁßç‰∏çÂêåÁ±ªÂûãÔºö</p>
<ul>
<li>Meta Block</li>
<li>MetaBlock Á¥¢Âºï</li>
<li>Index BlockÊï∞ÊçÆÁ¥¢ÂºïÂùó</li>
<li>FooterÊñá‰ª∂Â∞æÈÉ®Âùó</li>
</ul>
<p>LevelDb 1.2ÁâàÂØπ‰∫éMeta BlockÂ∞öÊó†ÂÆûÈôÖ‰ΩøÁî®ÔºåÂè™ÊòØ‰øùÁïô‰∫Ü‰∏Ä‰∏™Êé•Âè£Ôºå‰º∞ËÆ°‰ºöÂú®ÂêéÁª≠ÁâàÊú¨‰∏≠Âä†ÂÖ•ÂÜÖÂÆπÔºå‰∏ãÈù¢Êàë‰ª¨ÁúãÁúãÊï∞ÊçÆÁ¥¢ÂºïÂå∫ÂíåÊñá‰ª∂Â∞æÈÉ®FooterÁöÑÂÜÖÈÉ®ÁªìÊûÑ„ÄÇ</p>
<p><img src="LevelDb7.png" alt="LevelDb7"><br>Âõæ4.3 Êï∞ÊçÆÁ¥¢Âºï</p>
<p>‰∏äÂõæÊòØÊï∞ÊçÆÁ¥¢ÂºïÁöÑÂÜÖÈÉ®ÁªìÊûÑÁ§∫ÊÑèÂõæ„ÄÇÂÜçÊ¨°Âº∫Ë∞É‰∏Ä‰∏ãÔºåData BlockÂÜÖÁöÑKVËÆ∞ÂΩïÊòØÊåâÁÖßKeyÁî±Â∞èÂà∞Â§ßÊéíÂàóÁöÑÔºåÊï∞ÊçÆÁ¥¢ÂºïÂå∫ÁöÑÊØèÊù°ËÆ∞ÂΩïÊòØÂØπÊüê‰∏™Data BlockÂª∫Á´ãÁöÑÁ¥¢Âºï‰ø°ÊÅØÔºåÊØèÊù°Á¥¢Âºï‰ø°ÊÅØÂåÖÂê´‰∏â‰∏™ÂÜÖÂÆπÔºå‰ª•Êï∞ÊçÆÂùóiÁöÑÁ¥¢Âºï<code>Index i</code>Êù•ËØ¥Ôºö</p>
<ul>
<li>Á∫¢Ëâ≤ÈÉ®ÂàÜÁöÑÁ¨¨‰∏Ä‰∏™Â≠óÊÆµËÆ∞ËΩΩÂ§ß‰∫éÁ≠â‰∫éÊï∞ÊçÆÂùói‰∏≠ÊúÄÂ§ßÁöÑKeyÂÄºÁöÑÈÇ£‰∏™Key;</li>
<li>Á¨¨‰∫å‰∏™Â≠óÊÆµÊåáÂá∫Êï∞ÊçÆÂùóiÂú®.sstÊñá‰ª∂‰∏≠ÁöÑËµ∑Âßã‰ΩçÁΩÆ;</li>
<li>Á¨¨‰∏â‰∏™Â≠óÊÆµÊåáÂá∫Data Block iÁöÑÂ§ßÂ∞èÔºàÊúâÊó∂ÂÄôÊòØÊúâÊï∞ÊçÆÂéãÁº©ÁöÑÔºâ„ÄÇ</li>
</ul>
<p>ÂêéÈù¢‰∏§‰∏™Â≠óÊÆµÂ•ΩÁêÜËß£ÔºåÊòØÁî®‰∫éÂÆö‰ΩçÊï∞ÊçÆÂùóÂú®Êñá‰ª∂‰∏≠ÁöÑ‰ΩçÁΩÆÁöÑÔºåÁ¨¨‰∏Ä‰∏™Â≠óÊÆµÈúÄË¶ÅËØ¶ÁªÜËß£Èáä‰∏Ä‰∏ãÔºåÂú®Á¥¢ÂºïÈáå‰øùÂ≠òÁöÑËøô‰∏™KeyÂÄºÊú™ÂøÖ‰∏ÄÂÆöÊòØÊüêÊù°ËÆ∞ÂΩïÁöÑKeyÔºå‰ª•‰∏äÂõæÁöÑ‰æãÂ≠êÊù•ËØ¥ÔºåÂÅáËÆæÊï∞ÊçÆÂùói ÁöÑÊúÄÂ∞èKey=‚Äúsamecity‚ÄùÔºåÊúÄÂ§ßKey=‚Äúthe best‚Äù;Êï∞ÊçÆÂùói+1ÁöÑÊúÄÂ∞èKey=‚Äúthe fox‚ÄùÔºåÊúÄÂ§ßKey=‚Äúzoo‚ÄùÔºåÈÇ£‰πàÂØπ‰∫éÊï∞ÊçÆÂùóiÁöÑÁ¥¢ÂºïIndex iÊù•ËØ¥ÔºåÂÖ∂Á¨¨‰∏Ä‰∏™Â≠óÊÆµËÆ∞ËΩΩÂ§ß‰∫éÁ≠â‰∫éÊï∞ÊçÆÂùóiÁöÑÊúÄÂ§ßKey(‚Äúthe best‚Äù)ÂêåÊó∂Ë¶ÅÂ∞è‰∫éÊï∞ÊçÆÂùói+1ÁöÑÊúÄÂ∞èKey(‚Äúthe fox‚Äù)ÔºåÊâÄ‰ª•‰æãÂ≠ê‰∏≠Index iÁöÑÁ¨¨‰∏Ä‰∏™Â≠óÊÆµÊòØÔºö‚Äúthe c‚ÄùÔºåËøô‰∏™ÊòØÊª°Ë∂≥Ë¶ÅÊ±ÇÁöÑÔºõËÄåIndex i+1ÁöÑÁ¨¨‰∏Ä‰∏™Â≠óÊÆµÂàôÊòØ‚Äúzoo‚ÄùÔºåÂç≥Êï∞ÊçÆÂùói+1ÁöÑÊúÄÂ§ßKey„ÄÇ</p>
<p>Êñá‰ª∂Êú´Â∞æFooterÂùóÁöÑÂÜÖÈÉ®ÁªìÊûÑËßÅ‰∏ãÂõæÔºåmetaindex_handleÊåáÂá∫‰∫Ümetaindex blockÁöÑËµ∑Âßã‰ΩçÁΩÆÂíåÂ§ßÂ∞èÔºõinex_handleÊåáÂá∫‰∫Üindex BlockÁöÑËµ∑ÂßãÂú∞ÂùÄÂíåÂ§ßÂ∞èÔºõËøô‰∏§‰∏™Â≠óÊÆµÂèØ‰ª•ÁêÜËß£‰∏∫Á¥¢ÂºïÁöÑÁ¥¢ÂºïÔºåÊòØ‰∏∫‰∫ÜÊ≠£Á°ÆËØªÂá∫Á¥¢ÂºïÂÄºËÄåËÆæÁ´ãÁöÑÔºåÂêéÈù¢Ë∑üÁùÄ‰∏Ä‰∏™Â°´ÂÖÖÂå∫ÂíåÈ≠îÊï∞„ÄÇ</p>
<p><img src="LevelDb8.png" alt="LevelDb8"><br>Âõæ4.4 Footer</p>
<p>‰∏äÈù¢‰∏ªË¶Å‰ªãÁªçÁöÑÊòØÊï∞ÊçÆÁÆ°ÁêÜÂå∫ÁöÑÂÜÖÈÉ®ÁªìÊûÑÔºå‰∏ãÈù¢Êàë‰ª¨ÁúãÁúãÊï∞ÊçÆÂå∫ÁöÑ‰∏Ä‰∏™BlockÁöÑÊï∞ÊçÆÈÉ®ÂàÜÂÜÖÈÉ®ÊòØÂ¶Ç‰ΩïÂ∏ÉÂ±ÄÁöÑÔºàÂõæ4.1‰∏≠ÁöÑhÈªÑËâ≤ÈÉ®ÂàÜÔºâÔºåÂõæ4.5ÊòØÂÖ∂ÂÜÖÈÉ®Â∏ÉÂ±ÄÁ§∫ÊÑèÂõæ„ÄÇ</p>
<p><img src="LevelDb9.png" alt="LevelDb9"><br>Âõæ4.5 Êï∞ÊçÆBlockÂÜÖÈÉ®ÁªìÊûÑ</p>
<p>‰ªéÂõæ‰∏≠ÂèØ‰ª•ÁúãÂá∫ÔºåÂÖ∂ÂÜÖÈÉ®‰πüÂàÜ‰∏∫‰∏§‰∏™ÈÉ®ÂàÜÔºåÂâçÈù¢ÊòØ‰∏Ä‰∏™‰∏™KVËÆ∞ÂΩïÔºåÂÖ∂È°∫Â∫èÊòØÊ†πÊçÆKeyÂÄºÁî±Â∞èÂà∞Â§ßÊéíÂàóÁöÑÔºåÂú®BlockÂ∞æÈÉ®ÂàôÊòØ‰∏Ä‰∫õ‚ÄúÈáçÂêØÁÇπ‚ÄùÔºàRestart PointÔºâ,ÂÖ∂ÂÆûÊòØ‰∏Ä‰∫õÊåáÈíàÔºåÊåáÂá∫BlockÂÜÖÂÆπ‰∏≠ÁöÑ‰∏Ä‰∫õËÆ∞ÂΩï‰ΩçÁΩÆ„ÄÇ</p>
<p>‚ÄúÈáçÂêØÁÇπ‚ÄùÊòØÂπ≤‰ªÄ‰πàÁöÑÂë¢ÔºüÊàë‰ª¨‰∏ÄÂÜçÂº∫Ë∞ÉÔºåBlockÂÜÖÂÆπÈáåÁöÑKVËÆ∞ÂΩïÊòØÊåâÁÖßKeyÂ§ßÂ∞èÊúâÂ∫èÁöÑÔºåËøôÊ†∑ÁöÑËØùÔºåÁõ∏ÈÇªÁöÑ‰∏§Êù°ËÆ∞ÂΩïÂæàÂèØËÉΩKeyÈÉ®ÂàÜÂ≠òÂú®ÈáçÂè†ÔºåÊØîÂ¶Çkey i=‚Äúthe Car‚ÄùÔºåKey i+1=‚Äúthe color‚Äù,ÈÇ£‰πà‰∏§ËÄÖÂ≠òÂú®ÈáçÂè†ÈÉ®ÂàÜ‚Äúthe c‚ÄùÔºå‰∏∫‰∫ÜÂáèÂ∞ëKeyÁöÑÂ≠òÂÇ®ÈáèÔºåKey i+1ÂèØ‰ª•Âè™Â≠òÂÇ®Âíå‰∏ä‰∏ÄÊù°Key‰∏çÂêåÁöÑÈÉ®ÂàÜ‚Äúolor‚ÄùÔºå‰∏§ËÄÖÁöÑÂÖ±ÂêåÈÉ®ÂàÜ‰ªéKey i‰∏≠ÂèØ‰ª•Ëé∑Âæó„ÄÇËÆ∞ÂΩïÁöÑKeyÂú®BlockÂÜÖÂÆπÈÉ®ÂàÜÂ∞±ÊòØËøô‰πàÂ≠òÂÇ®ÁöÑÔºå‰∏ªË¶ÅÁõÆÁöÑÊòØÂáèÂ∞ëÂ≠òÂÇ®ÂºÄÈîÄ„ÄÇ‚ÄúÈáçÂêØÁÇπ‚ÄùÁöÑÊÑèÊÄùÊòØÔºöÂú®ËøôÊù°ËÆ∞ÂΩïÂºÄÂßãÔºå‰∏çÂÜçÈááÂèñÂè™ËÆ∞ËΩΩ‰∏çÂêåÁöÑKeyÈÉ®ÂàÜÔºåËÄåÊòØÈáçÊñ∞ËÆ∞ÂΩïÊâÄÊúâÁöÑKeyÂÄºÔºåÂÅáËÆæKey i+1ÊòØ‰∏Ä‰∏™ÈáçÂêØÁÇπÔºåÈÇ£‰πàKeyÈáåÈù¢‰ºöÂÆåÊï¥Â≠òÂÇ®‚Äúthe color‚ÄùÔºåËÄå‰∏çÊòØÈááÁî®ÁÆÄÁï•ÁöÑ‚Äúolor‚ÄùÊñπÂºè„ÄÇBlockÂ∞æÈÉ®Â∞±ÊòØÊåáÂá∫Âì™‰∫õËÆ∞ÂΩïÊòØËøô‰∫õÈáçÂêØÁÇπÁöÑ„ÄÇ</p>
<p><img src="LevelDb10.png" alt="LevelDb10"><br> Âõæ4.6 ËÆ∞ÂΩïÊ†ºÂºè</p>
<p>Âú®BlockÂÜÖÂÆπÂå∫ÔºåÊØè‰∏™KVËÆ∞ÂΩïÁöÑÂÜÖÈÉ®ÁªìÊûÑÊòØÊÄéÊ†∑ÁöÑÔºüÂõæ4.6ÁªôÂá∫‰∫ÜÂÖ∂ËØ¶ÁªÜÁªìÊûÑÔºåÊØè‰∏™ËÆ∞ÂΩïÂåÖÂê´5‰∏™Â≠óÊÆµÔºökeyÂÖ±‰∫´ÈïøÂ∫¶ÔºåÊØîÂ¶Ç‰∏äÈù¢ÁöÑ‚Äúolor‚ÄùËÆ∞ÂΩïÔºå ÂÖ∂keyÂíå‰∏ä‰∏ÄÊù°ËÆ∞ÂΩïÂÖ±‰∫´ÁöÑKeyÈÉ®ÂàÜÈïøÂ∫¶ÊòØ‚Äúthe c‚ÄùÁöÑÈïøÂ∫¶ÔºåÂç≥5ÔºõkeyÈùûÂÖ±‰∫´ÈïøÂ∫¶ÔºåÂØπ‰∫é‚Äúolor‚ÄùÊù•ËØ¥ÔºåÊòØ4ÔºõvalueÈïøÂ∫¶ÊåáÂá∫Key:Value‰∏≠ValueÁöÑÈïøÂ∫¶ÔºåÂú®ÂêéÈù¢ÁöÑValueÂÜÖÂÆπÂ≠óÊÆµ‰∏≠Â≠òÂÇ®ÂÆûÈôÖÁöÑValueÂÄºÔºõËÄåkeyÈùûÂÖ±‰∫´ÂÜÖÂÆπÂàôÂÆûÈôÖÂ≠òÂÇ®‚Äúolor‚ÄùËøô‰∏™KeyÂ≠óÁ¨¶‰∏≤„ÄÇ</p>
<p>‰∏äÈù¢ËÆ≤ÁöÑËøô‰∫õÂ∞±ÊòØ.sstÊñá‰ª∂ÁöÑÂÖ®ÈÉ®ÂÜÖÈÉ®Â••Áßò„ÄÇ</p>
<h1 id="MemTableËØ¶Ëß£"><a href="#MemTableËØ¶Ëß£" class="headerlink" title="MemTableËØ¶Ëß£"></a>MemTableËØ¶Ëß£</h1><p>LevelDbÊó•Áü•ÂΩïÂâçËø∞Â∞èËäÇÂ§ßËá¥ËÆ≤Ëø∞‰∫ÜÁ£ÅÁõòÊñá‰ª∂Áõ∏ÂÖ≥ÁöÑÈáçË¶ÅÈùôÊÄÅÁªìÊûÑÔºåÊú¨Â∞èËäÇËÆ≤Ëø∞ÂÜÖÂ≠ò‰∏≠ÁöÑÊï∞ÊçÆÁªìÊûÑMemtableÔºåMemtableÂú®Êï¥‰∏™‰ΩìÁ≥ª‰∏≠ÁöÑÈáçË¶ÅÂú∞‰Ωç‰πü‰∏çË®ÄËÄåÂñª„ÄÇÊÄª‰ΩìËÄåË®ÄÔºåÊâÄÊúâKVÊï∞ÊçÆÈÉΩÊòØÂ≠òÂÇ®Âú®MemtableÔºåImmutable MemtableÂíåSSTable‰∏≠ÁöÑÔºåImmutable Memtable‰ªéÁªìÊûÑ‰∏äËÆ≤ÂíåMemtableÊòØÂÆåÂÖ®‰∏ÄÊ†∑ÁöÑÔºåÂå∫Âà´‰ªÖ‰ªÖÂú®‰∫éÂÖ∂ÊòØÂè™ËØªÁöÑÔºå‰∏çÂÖÅËÆ∏ÂÜôÂÖ•Êìç‰ΩúÔºåËÄåMemtableÂàôÊòØÂÖÅËÆ∏ÂÜôÂÖ•ÂíåËØªÂèñÁöÑ„ÄÇÂΩìMemtableÂÜôÂÖ•ÁöÑÊï∞ÊçÆÂç†Áî®ÂÜÖÂ≠òÂà∞ËææÊåáÂÆöÊï∞ÈáèÔºåÂàôËá™Âä®ËΩ¨Êç¢‰∏∫Immutable MemtableÔºåÁ≠âÂæÖDumpÂà∞Á£ÅÁõò‰∏≠ÔºåÁ≥ªÁªü‰ºöËá™Âä®ÁîüÊàêÊñ∞ÁöÑMemtable‰æõÂÜôÊìç‰ΩúÂÜôÂÖ•Êñ∞Êï∞ÊçÆÔºåÁêÜËß£‰∫ÜMemtableÔºåÈÇ£‰πàImmutable MemtableËá™ÁÑ∂‰∏çÂú®ËØù‰∏ã„ÄÇ</p>
<p>LevelDbÁöÑMemTableÊèê‰æõ‰∫ÜÂ∞ÜKVÊï∞ÊçÆÂÜôÂÖ•ÔºåÂà†Èô§‰ª•ÂèäËØªÂèñKVËÆ∞ÂΩïÁöÑÊìç‰ΩúÊé•Âè£Ôºå‰ΩÜÊòØ‰∫ãÂÆû‰∏äMemtableÂπ∂‰∏çÂ≠òÂú®ÁúüÊ≠£ÁöÑÂà†Èô§Êìç‰Ωú,Âà†Èô§Êüê‰∏™KeyÁöÑValueÂú®MemtableÂÜÖÊòØ‰Ωú‰∏∫ÊèíÂÖ•‰∏ÄÊù°ËÆ∞ÂΩïÂÆûÊñΩÁöÑÔºå‰ΩÜÊòØ‰ºöÊâì‰∏ä‰∏Ä‰∏™KeyÁöÑÂà†Èô§Ê†áËÆ∞ÔºåÁúüÊ≠£ÁöÑÂà†Èô§Êìç‰ΩúÊòØLazyÁöÑÔºå‰ºöÂú®‰ª•ÂêéÁöÑCompactionËøáÁ®ã‰∏≠ÂéªÊéâËøô‰∏™KV„ÄÇ</p>
<p>ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåLevelDbÁöÑMemtable‰∏≠KVÂØπÊòØÊ†πÊçÆKeyÂ§ßÂ∞èÊúâÂ∫èÂ≠òÂÇ®ÁöÑÔºåÂú®Á≥ªÁªüÊèíÂÖ•Êñ∞ÁöÑKVÊó∂ÔºåLevelDbË¶ÅÊääËøô‰∏™KVÊèíÂà∞ÂêàÈÄÇÁöÑ‰ΩçÁΩÆ‰∏ä‰ª•‰øùÊåÅËøôÁßçKeyÊúâÂ∫èÊÄß„ÄÇÂÖ∂ÂÆûÔºåLevelDbÁöÑMemtableÁ±ªÂè™ÊòØ‰∏Ä‰∏™Êé•Âè£Á±ªÔºåÁúüÊ≠£ÁöÑÊìç‰ΩúÊòØÈÄöËøáËÉåÂêéÁöÑSkipListÊù•ÂÅöÁöÑÔºåÂåÖÊã¨ÊèíÂÖ•Êìç‰ΩúÂíåËØªÂèñÊìç‰ΩúÁ≠âÔºåÊâÄ‰ª•MemtableÁöÑÊ†∏ÂøÉÊï∞ÊçÆÁªìÊûÑÊòØ‰∏Ä‰∏™SkipList„ÄÇ</p>
<p>SkipListÊòØÁî±William PughÂèëÊòé„ÄÇ‰ªñÂú®Communications of the ACM June 1990, 33(6) 668-676 ÂèëË°®‰∫ÜSkip lists: a probabilistic alternative to balanced treesÔºåÂú®ËØ•ËÆ∫Êñá‰∏≠ËØ¶ÁªÜËß£Èáä‰∫ÜSkipListÁöÑÊï∞ÊçÆÁªìÊûÑÂíåÊèíÂÖ•Âà†Èô§Êìç‰Ωú„ÄÇ</p>
<p>SkipListÊòØÂπ≥Ë°°Ê†ëÁöÑ‰∏ÄÁßçÊõø‰ª£Êï∞ÊçÆÁªìÊûÑÔºå‰ΩÜÊòØÂíåÁ∫¢ÈªëÊ†ë‰∏çÁõ∏ÂêåÁöÑÊòØÔºåSkipListÂØπ‰∫éÊ†ëÁöÑÂπ≥Ë°°ÁöÑÂÆûÁé∞ÊòØÂü∫‰∫é‰∏ÄÁßçÈöèÊú∫ÂåñÁöÑÁÆóÊ≥ïÁöÑÔºåËøôÊ†∑‰πüÂ∞±ÊòØËØ¥SkipListÁöÑÊèíÂÖ•ÂíåÂà†Èô§ÁöÑÂ∑•‰ΩúÊòØÊØîËæÉÁÆÄÂçïÁöÑ„ÄÇ</p>
<p>ÂÖ≥‰∫éSkipListÁöÑËØ¶ÁªÜ‰ªãÁªçÂèØ‰ª•ÂèÇËÄÉËøôÁØáÊñáÁ´†Ôºö<a href="http://www.cnblogs.com/xuqiang/archive/2011/05/22/2053516.htmlÔºåËÆ≤Ëø∞ÁöÑÂæàÊ∏ÖÊ•öÔºåLevelDbÁöÑSkipListÂü∫Êú¨‰∏äÊòØ‰∏Ä‰∏™ÂÖ∑‰ΩìÂÆûÁé∞ÔºåÂπ∂Êó†ÁâπÊÆä‰πãÂ§Ñ„ÄÇ" target="_blank" rel="noopener">http://www.cnblogs.com/xuqiang/archive/2011/05/22/2053516.htmlÔºåËÆ≤Ëø∞ÁöÑÂæàÊ∏ÖÊ•öÔºåLevelDbÁöÑSkipListÂü∫Êú¨‰∏äÊòØ‰∏Ä‰∏™ÂÖ∑‰ΩìÂÆûÁé∞ÔºåÂπ∂Êó†ÁâπÊÆä‰πãÂ§Ñ„ÄÇ</a></p>
<p>SkipList‰∏ç‰ªÖÊòØÁª¥Êä§ÊúâÂ∫èÊï∞ÊçÆÁöÑ‰∏Ä‰∏™ÁÆÄÂçïÂÆûÁé∞ÔºåËÄå‰∏îÁõ∏ÊØîËæÉÂπ≥Ë°°Ê†ëÊù•ËØ¥ÔºåÂú®ÊèíÂÖ•Êï∞ÊçÆÁöÑÊó∂ÂÄôÂèØ‰ª•ÈÅøÂÖçÈ¢ëÁπÅÁöÑÊ†ëËäÇÁÇπË∞ÉÊï¥Êìç‰ΩúÔºåÊâÄ‰ª•ÂÜôÂÖ•ÊïàÁéáÊòØÂæàÈ´òÁöÑÔºåLevelDbÊï¥‰ΩìËÄåË®ÄÊòØ‰∏™È´òÂÜôÂÖ•Á≥ªÁªüÔºåSkipListÂú®ÂÖ∂‰∏≠Â∫îËØ•‰πüËµ∑Âà∞‰∫ÜÂæàÈáçË¶ÅÁöÑ‰ΩúÁî®„ÄÇRedis‰∏∫‰∫ÜÂä†Âø´ÊèíÂÖ•Êìç‰ΩúÔºå‰πü‰ΩøÁî®‰∫ÜSkipListÊù•‰Ωú‰∏∫ÂÜÖÈÉ®ÂÆûÁé∞Êï∞ÊçÆÁªìÊûÑ„ÄÇ</p>
<h1 id="ÂÜôÂÖ•‰∏éÂà†Èô§ËÆ∞ÂΩï"><a href="#ÂÜôÂÖ•‰∏éÂà†Èô§ËÆ∞ÂΩï" class="headerlink" title="ÂÜôÂÖ•‰∏éÂà†Èô§ËÆ∞ÂΩï"></a>ÂÜôÂÖ•‰∏éÂà†Èô§ËÆ∞ÂΩï</h1><p>Âú®‰πãÂâçÁöÑ‰∫îËäÇLevelDbÊó•Áü•ÂΩï‰∏≠ÔºåÊàë‰ª¨‰ªãÁªç‰∫ÜLevelDbÁöÑ‰∏Ä‰∫õÈùôÊÄÅÊñá‰ª∂ÂèäÂÖ∂ËØ¶ÁªÜÂ∏ÉÂ±ÄÔºå‰ªéÊú¨ËäÇÂºÄÂßãÔºåÊàë‰ª¨ÁúãÁúãLevelDbÁöÑ‰∏Ä‰∫õÂä®ÊÄÅÊìç‰ΩúÔºåÊØîÂ¶ÇËØªÂÜôËÆ∞ÂΩïÔºåCompactionÔºåÈîôËØØÊÅ¢Â§çÁ≠âÊìç‰Ωú„ÄÇ</p>
<p>Êú¨ËäÇ‰ªãÁªçlevelDbÁöÑËÆ∞ÂΩïÊõ¥Êñ∞Êìç‰ΩúÔºåÂç≥ÊèíÂÖ•‰∏ÄÊù°KVËÆ∞ÂΩïÊàñËÄÖÂà†Èô§‰∏ÄÊù°KVËÆ∞ÂΩï„ÄÇlevelDbÁöÑÊõ¥Êñ∞Êìç‰ΩúÈÄüÂ∫¶ÊòØÈùûÂ∏∏Âø´ÁöÑÔºåÊ∫ê‰∫éÂÖ∂ÂÜÖÈÉ®Êú∫Âà∂ÂÜ≥ÂÆö‰∫ÜËøôÁßçÊõ¥Êñ∞Êìç‰ΩúÁöÑÁÆÄÂçïÊÄß„ÄÇ</p>
<p><img src="LevelDb11.png" alt="LevelDb11"><br>Âõæ6.1 LevelDbÂÜôÂÖ•ËÆ∞ÂΩï</p>
<p>Âõæ6.1ÊòØlevelDbÂ¶Ç‰ΩïÊõ¥Êñ∞KVÊï∞ÊçÆÁöÑÁ§∫ÊÑèÂõæÔºå‰ªéÂõæ‰∏≠ÂèØ‰ª•ÁúãÂá∫ÔºåÂØπ‰∫é‰∏Ä‰∏™ÊèíÂÖ•Êìç‰ΩúPut(Key,Value)Êù•ËØ¥ÔºåÂÆåÊàêÊèíÂÖ•Êìç‰ΩúÂåÖÂê´‰∏§‰∏™ÂÖ∑‰ΩìÊ≠•È™§ÔºöÈ¶ñÂÖàÊòØÂ∞ÜËøôÊù°KVËÆ∞ÂΩï‰ª•È°∫Â∫èÂÜôÁöÑÊñπÂºèËøΩÂä†Âà∞‰πãÂâç‰ªãÁªçËøáÁöÑlogÊñá‰ª∂Êú´Â∞æÔºåÂõ†‰∏∫Â∞ΩÁÆ°ËøôÊòØ‰∏Ä‰∏™Á£ÅÁõòËØªÂÜôÊìç‰ΩúÔºå‰ΩÜÊòØÊñá‰ª∂ÁöÑÈ°∫Â∫èËøΩÂä†ÂÜôÂÖ•ÊïàÁéáÊòØÂæàÈ´òÁöÑÔºåÊâÄ‰ª•Âπ∂‰∏ç‰ºöÂØºËá¥ÂÜôÂÖ•ÈÄüÂ∫¶ÁöÑÈôç‰ΩéÔºõÁ¨¨‰∫å‰∏™Ê≠•È™§ÊòØ:Â¶ÇÊûúÂÜôÂÖ•logÊñá‰ª∂ÊàêÂäüÔºåÈÇ£‰πàÂ∞ÜËøôÊù°KVËÆ∞ÂΩïÊèíÂÖ•ÂÜÖÂ≠ò‰∏≠ÁöÑMemtable‰∏≠ÔºåÂâçÈù¢‰ªãÁªçËøáÔºåMemtableÂè™ÊòØ‰∏ÄÂ±ÇÂ∞ÅË£ÖÔºåÂÖ∂ÂÜÖÈÉ®ÂÖ∂ÂÆûÊòØ‰∏Ä‰∏™KeyÊúâÂ∫èÁöÑSkipListÂàóË°®ÔºåÊèíÂÖ•‰∏ÄÊù°Êñ∞ËÆ∞ÂΩïÁöÑËøáÁ®ã‰πüÂæàÁÆÄÂçïÔºåÂç≥ÂÖàÊü•ÊâæÂêàÈÄÇÁöÑÊèíÂÖ•‰ΩçÁΩÆÔºåÁÑ∂Âêé‰øÆÊîπÁõ∏Â∫îÁöÑÈìæÊé•ÊåáÈíàÂ∞ÜÊñ∞ËÆ∞ÂΩïÊèíÂÖ•Âç≥ÂèØ„ÄÇÂÆåÊàêËøô‰∏ÄÊ≠•ÔºåÂÜôÂÖ•ËÆ∞ÂΩïÂ∞±ÁÆóÂÆåÊàê‰∫ÜÔºåÊâÄ‰ª•‰∏Ä‰∏™ÊèíÂÖ•ËÆ∞ÂΩïÊìç‰ΩúÊ∂âÂèä‰∏ÄÊ¨°Á£ÅÁõòÊñá‰ª∂ËøΩÂä†ÂÜôÂíåÂÜÖÂ≠òSkipListÊèíÂÖ•Êìç‰ΩúÔºåËøôÊòØ‰∏∫‰ΩïlevelDbÂÜôÂÖ•ÈÄüÂ∫¶Â¶ÇÊ≠§È´òÊïàÁöÑÊ†πÊú¨ÂéüÂõ†„ÄÇ</p>
<p>‰ªé‰∏äÈù¢ÁöÑ‰ªãÁªçËøáÁ®ã‰∏≠‰πüÂèØ‰ª•ÁúãÂá∫ÔºölogÊñá‰ª∂ÂÜÖÊòØkeyÊó†Â∫èÁöÑÔºåËÄåMemtable‰∏≠ÊòØkeyÊúâÂ∫èÁöÑ„ÄÇÈÇ£‰πàÂ¶ÇÊûúÊòØÂà†Èô§‰∏ÄÊù°KVËÆ∞ÂΩïÂë¢ÔºüÂØπ‰∫élevelDbÊù•ËØ¥ÔºåÂπ∂‰∏çÂ≠òÂú®Á´ãÂç≥Âà†Èô§ÁöÑÊìç‰ΩúÔºåËÄåÊòØ‰∏éÊèíÂÖ•Êìç‰ΩúÁõ∏ÂêåÁöÑÔºåÂå∫Âà´ÊòØÔºåÊèíÂÖ•Êìç‰ΩúÊèíÂÖ•ÁöÑÊòØKey:Value ÂÄºÔºåËÄåÂà†Èô§Êìç‰ΩúÊèíÂÖ•ÁöÑÊòØ‚ÄúKey:Âà†Èô§Ê†áËÆ∞‚ÄùÔºåÂπ∂‰∏çÁúüÊ≠£ÂéªÂà†Èô§ËÆ∞ÂΩïÔºåËÄåÊòØÂêéÂè∞CompactionÁöÑÊó∂ÂÄôÊâçÂéªÂÅöÁúüÊ≠£ÁöÑÂà†Èô§Êìç‰Ωú„ÄÇ</p>
<p>levelDbÁöÑÂÜôÂÖ•Êìç‰ΩúÂ∞±ÊòØÂ¶ÇÊ≠§ÁÆÄÂçï„ÄÇÁúüÊ≠£ÁöÑÈ∫ªÁÉ¶Âú®ÂêéÈù¢Â∞ÜË¶Å‰ªãÁªçÁöÑËØªÂèñÊìç‰Ωú‰∏≠„ÄÇ  </p>
<h1 id="ËØªÂèñËÆ∞ÂΩï"><a href="#ËØªÂèñËÆ∞ÂΩï" class="headerlink" title="ËØªÂèñËÆ∞ÂΩï"></a>ËØªÂèñËÆ∞ÂΩï</h1><p>LevelDbÊòØÈíàÂØπÂ§ßËßÑÊ®°Key/ValueÊï∞ÊçÆÁöÑÂçïÊú∫Â≠òÂÇ®Â∫ìÔºå‰ªéÂ∫îÁî®ÁöÑËßíÂ∫¶Êù•ÁúãÔºåLevelDbÂ∞±ÊòØ‰∏Ä‰∏™Â≠òÂÇ®Â∑•ÂÖ∑„ÄÇËÄå‰Ωú‰∏∫Áß∞ËÅåÁöÑÂ≠òÂÇ®Â∑•ÂÖ∑ÔºåÂ∏∏ËßÅÁöÑË∞ÉÁî®Êé•Âè£Êó†ÈùûÊòØÊñ∞Â¢ûKVÔºåÂà†Èô§KVÔºåËØªÂèñKVÔºåÊõ¥Êñ∞KeyÂØπÂ∫îÁöÑValueÂÄºËøô‰πàÂá†ÁßçÊìç‰Ωú„ÄÇLevelDbÁöÑÊé•Âè£Ê≤°ÊúâÁõ¥Êé•ÊîØÊåÅÊõ¥Êñ∞Êìç‰ΩúÁöÑÊé•Âè£ÔºåÂ¶ÇÊûúÈúÄË¶ÅÊõ¥Êñ∞Êüê‰∏™KeyÁöÑValue,‰Ω†ÂèØ‰ª•ÈÄâÊã©Áõ¥Êé•ÁîüÁåõÂú∞ÊèíÂÖ•Êñ∞ÁöÑKVÔºå‰øùÊåÅKeyÁõ∏ÂêåÔºåËøôÊ†∑Á≥ªÁªüÂÜÖÁöÑkeyÂØπÂ∫îÁöÑvalueÂ∞±‰ºöË¢´Êõ¥Êñ∞ÔºõÊàñËÄÖ‰Ω†ÂèØ‰ª•ÂÖàÂà†Èô§ÊóßÁöÑKVÔºå ‰πãÂêéÂÜçÊèíÂÖ•Êñ∞ÁöÑKVÔºåËøôÊ†∑ÊØîËæÉÂßîÂ©âÂú∞ÂÆåÊàêKVÁöÑÊõ¥Êñ∞Êìç‰Ωú„ÄÇ</p>
<p>ÂÅáËÆæÂ∫îÁî®Êèê‰∫§‰∏Ä‰∏™KeyÂÄºÔºå‰∏ãÈù¢Êàë‰ª¨ÁúãÁúãLevelDbÊòØÂ¶Ç‰Ωï‰ªéÂ≠òÂÇ®ÁöÑÊï∞ÊçÆ‰∏≠ËØªÂá∫ÂÖ∂ÂØπÂ∫îÁöÑValueÂÄºÁöÑ„ÄÇÂõæ7-1ÊòØLevelDbËØªÂèñËøáÁ®ãÁöÑÊï¥‰ΩìÁ§∫ÊÑèÂõæ„ÄÇ</p>
<p><img src="LevelDb12.png" alt="LevelDb12"><br>Âõæ7-1 LevelDbËØªÂèñËÆ∞ÂΩïÊµÅÁ®ã</p>
<p>LevelDbÈ¶ñÂÖà‰ºöÂéªÊü•ÁúãÂÜÖÂ≠ò‰∏≠ÁöÑMemtableÔºåÂ¶ÇÊûúMemtable‰∏≠ÂåÖÂê´keyÂèäÂÖ∂ÂØπÂ∫îÁöÑvalueÔºåÂàôËøîÂõûvalueÂÄºÂç≥ÂèØÔºõÂ¶ÇÊûúÂú®MemtableÊ≤°ÊúâËØªÂà∞keyÔºåÂàôÊé•‰∏ãÊù•Âà∞ÂêåÊ†∑Â§Ñ‰∫éÂÜÖÂ≠ò‰∏≠ÁöÑImmutable Memtable‰∏≠ÂéªËØªÂèñÔºåÁ±ª‰ººÂú∞ÔºåÂ¶ÇÊûúËØªÂà∞Â∞±ËøîÂõûÔºåËã•ÊòØÊ≤°ÊúâËØªÂà∞,ÈÇ£‰πàÂè™ËÉΩ‰∏áËà¨Êó†Â•à‰∏ã‰ªéÁ£ÅÁõò‰∏≠ÁöÑÂ§ßÈáèSSTableÊñá‰ª∂‰∏≠Êü•Êâæ„ÄÇÂõ†‰∏∫SSTableÊï∞ÈáèËæÉÂ§öÔºåËÄå‰∏îÂàÜÊàêÂ§ö‰∏™LevelÔºåÊâÄ‰ª•Âú®SSTable‰∏≠ËØªÊï∞ÊçÆÊòØÁõ∏ÂΩìËúøËúíÊõ≤ÊäòÁöÑ‰∏ÄÊÆµÊóÖÁ®ã„ÄÇÊÄªÁöÑËØªÂèñÂéüÂàôÊòØËøôÊ†∑ÁöÑÔºöÈ¶ñÂÖà‰ªéÂ±û‰∫élevel 0ÁöÑÊñá‰ª∂‰∏≠Êü•ÊâæÔºåÂ¶ÇÊûúÊâæÂà∞ÂàôËøîÂõûÂØπÂ∫îÁöÑvalueÂÄºÔºåÂ¶ÇÊûúÊ≤°ÊúâÊâæÂà∞ÈÇ£‰πàÂà∞level 1‰∏≠ÁöÑÊñá‰ª∂‰∏≠ÂéªÊâæÔºåÂ¶ÇÊ≠§Âæ™ÁéØÂæÄÂ§çÔºåÁõ¥Âà∞Âú®ÊüêÂ±ÇSSTableÊñá‰ª∂‰∏≠ÊâæÂà∞Ëøô‰∏™keyÂØπÂ∫îÁöÑvalue‰∏∫Ê≠¢ÔºàÊàñËÄÖÊü•Âà∞ÊúÄÈ´òlevelÔºåÊü•ÊâæÂ§±Ë¥•ÔºåËØ¥ÊòéÊï¥‰∏™Á≥ªÁªü‰∏≠‰∏çÂ≠òÂú®Ëøô‰∏™Key)„ÄÇ</p>
<p>ÈÇ£‰πà‰∏∫‰ªÄ‰πàÊòØ‰ªéMemtableÂà∞Immutable MemtableÔºåÂÜç‰ªéImmutable MemtableÂà∞Êñá‰ª∂ÔºåËÄåÊñá‰ª∂‰∏≠‰∏∫‰ΩïÊòØ‰ªé‰ΩélevelÂà∞È´òlevelËøô‰πà‰∏Ä‰∏™Êü•ËØ¢Ë∑ØÂæÑÂë¢ÔºüÈÅìÁêÜ‰ΩïÂú®Ôºü‰πãÊâÄ‰ª•ÈÄâÊã©Ëøô‰πà‰∏™Êü•ËØ¢Ë∑ØÂæÑÔºåÊòØÂõ†‰∏∫‰ªé‰ø°ÊÅØÁöÑÊõ¥Êñ∞Êó∂Èó¥Êù•ËØ¥ÔºåÂæàÊòéÊòæMemtableÂ≠òÂÇ®ÁöÑÊòØÊúÄÊñ∞È≤úÁöÑKVÂØπÔºõImmutable Memtable‰∏≠Â≠òÂÇ®ÁöÑKVÊï∞ÊçÆÂØπÁöÑÊñ∞È≤úÁ®ãÂ∫¶Ê¨°‰πãÔºõËÄåÊâÄÊúâSSTableÊñá‰ª∂‰∏≠ÁöÑKVÊï∞ÊçÆÊñ∞È≤úÁ®ãÂ∫¶‰∏ÄÂÆö‰∏çÂ¶ÇÂÜÖÂ≠ò‰∏≠ÁöÑMemtableÂíåImmutable MemtableÁöÑ„ÄÇÂØπ‰∫éSSTableÊñá‰ª∂Êù•ËØ¥ÔºåÂ¶ÇÊûúÂêåÊó∂Âú®level LÂíåLevel L+1ÊâæÂà∞Âêå‰∏Ä‰∏™keyÔºålevel LÁöÑ‰ø°ÊÅØ‰∏ÄÂÆöÊØîlevel L+1ÁöÑË¶ÅÊñ∞„ÄÇ‰πüÂ∞±ÊòØËØ¥Ôºå‰∏äÈù¢ÂàóÂá∫ÁöÑÊü•ÊâæË∑ØÂæÑÂ∞±ÊòØÊåâÁÖßÊï∞ÊçÆÊñ∞È≤úÁ®ãÂ∫¶ÊéíÂàóÂá∫Êù•ÁöÑÔºåË∂äÊñ∞È≤úÁöÑË∂äÂÖàÊü•Êâæ„ÄÇ</p>
<p>‰∏∫Âï•Ë¶Å‰ºòÂÖàÊü•ÊâæÊñ∞È≤úÁöÑÊï∞ÊçÆÂë¢ÔºüËøô‰∏™ÈÅìÁêÜ‰∏çË®ÄËÄåÂñªÔºå‰∏æ‰∏™‰æãÂ≠ê„ÄÇÊØîÂ¶ÇÊàë‰ª¨ÂÖàÂæÄlevelDbÈáåÈù¢ÊèíÂÖ•‰∏ÄÊù°Êï∞ÊçÆ {key=‚Äù<a href="http://www.samecity.com&quot;" target="_blank" rel="noopener">www.samecity.com&quot;</a>  value=‚ÄùÊàë‰ª¨‚Äù},Ëøá‰∫ÜÂá†Â§©ÔºåsamecityÁΩëÁ´ôÊîπÂêç‰∏∫Ôºö69ÂêåÂüéÔºåÊ≠§Êó∂Êàë‰ª¨ÊèíÂÖ•Êï∞ÊçÆ{key=‚Äù<a href="http://www.samecity.com&quot;" target="_blank" rel="noopener">www.samecity.com&quot;</a>  value=‚Äù69ÂêåÂüé‚Äù}ÔºåÂêåÊ†∑ÁöÑkey,‰∏çÂêåÁöÑvalueÔºõÈÄªËæë‰∏äÁêÜËß£Â•ΩÂÉèlevelDb‰∏≠Âè™Êúâ‰∏Ä‰∏™Â≠òÂÇ®ËÆ∞ÂΩïÔºåÂç≥Á¨¨‰∫å‰∏™ËÆ∞ÂΩïÔºå‰ΩÜÊòØÂú®levelDb‰∏≠ÂæàÂèØËÉΩÂ≠òÂú®‰∏§Êù°ËÆ∞ÂΩïÔºåÂç≥‰∏äÈù¢ÁöÑ‰∏§‰∏™ËÆ∞ÂΩïÈÉΩÂú®levelDb‰∏≠Â≠òÂÇ®‰∫ÜÔºåÊ≠§Êó∂Â¶ÇÊûúÁî®Êà∑Êü•ËØ¢key=‚Äù<a href="http://www.samecity.com&quot;,Êàë‰ª¨ÂΩìÁÑ∂Â∏åÊúõÊâæÂà∞ÊúÄÊñ∞ÁöÑÊõ¥Êñ∞ËÆ∞ÂΩïÔºå‰πüÂ∞±ÊòØÁ¨¨‰∫å‰∏™ËÆ∞ÂΩïËøîÂõûÔºåËøôÂ∞±ÊòØ‰∏∫‰ΩïË¶Å‰ºòÂÖàÊü•ÊâæÊñ∞È≤úÊï∞ÊçÆÁöÑÂéüÂõ†„ÄÇ" target="_blank" rel="noopener">www.samecity.com&quot;,Êàë‰ª¨ÂΩìÁÑ∂Â∏åÊúõÊâæÂà∞ÊúÄÊñ∞ÁöÑÊõ¥Êñ∞ËÆ∞ÂΩïÔºå‰πüÂ∞±ÊòØÁ¨¨‰∫å‰∏™ËÆ∞ÂΩïËøîÂõûÔºåËøôÂ∞±ÊòØ‰∏∫‰ΩïË¶Å‰ºòÂÖàÊü•ÊâæÊñ∞È≤úÊï∞ÊçÆÁöÑÂéüÂõ†„ÄÇ</a></p>
<p>ÂâçÊñáÊúâËÆ≤ÔºöÂØπ‰∫éSSTableÊñá‰ª∂Êù•ËØ¥ÔºåÂ¶ÇÊûúÂêåÊó∂Âú®level LÂíåLevel L+1ÊâæÂà∞Âêå‰∏Ä‰∏™keyÔºålevel LÁöÑ‰ø°ÊÅØ‰∏ÄÂÆöÊØîlevel L+1ÁöÑË¶ÅÊñ∞„ÄÇËøôÊòØ‰∏Ä‰∏™ÁªìËÆ∫ÔºåÁêÜËÆ∫‰∏äÈúÄË¶Å‰∏Ä‰∏™ËØÅÊòéËøáÁ®ãÔºåÂê¶Âàô‰ºöÊãõËá¥Â¶Ç‰∏ãÁöÑÈóÆÈ¢òÔºö‰∏∫Á•ûÈ©¨Âë¢Ôºü‰ªéÈÅìÁêÜ‰∏äËÆ≤Âë¢ÔºåÂæàÊòéÁôΩÔºöÂõ†‰∏∫Level L+1ÁöÑÊï∞ÊçÆ‰∏çÊòØ‰ªéÁü≥Â§¥ÁºùÈáåËπ¶Âá∫Êù•ÁöÑÔºå‰πü‰∏çÊòØÂÅöÊ¢¶Ê¢¶Âà∞ÁöÑÔºåÈÇ£ÂÆÉÊòØ‰ªéÂì™ÈáåÊù•ÁöÑÔºüLevel L+1ÁöÑÊï∞ÊçÆÊòØ‰ªéLevel L ÁªèËøáCompactionÂêéÂæóÂà∞ÁöÑÔºàÂ¶ÇÊûúÊÇ®‰∏çÁü•ÈÅì‰ªÄ‰πàÊòØCompactionÔºåÈÇ£‰πà‚Ä¶‚Ä¶..‰πüËÆ∏‰ª•Âêé‰ºöÁü•ÈÅìÁöÑÔºâÔºå‰πüÂ∞±ÊòØËØ¥ÔºåÊÇ®ÁúãÂà∞ÁöÑÁé∞Âú®ÁöÑLevel L+1Â±ÇÁöÑSSTableÊï∞ÊçÆÊòØ‰ªéÂéüÊù•ÁöÑLevel L‰∏≠Êù•ÁöÑÔºåÁé∞Âú®ÁöÑLevel LÊØîÂéüÊù•ÁöÑLevel LÊï∞ÊçÆË¶ÅÊñ∞È≤úÔºåÊâÄ‰ª•ÂèØËØÅÔºåÁé∞Âú®ÁöÑLevel LÊØîÁé∞Âú®ÁöÑLevel L+1ÁöÑÊï∞ÊçÆË¶ÅÊñ∞È≤ú„ÄÇ</p>
<p>SSTableÊñá‰ª∂ÂæàÂ§öÔºåÂ¶Ç‰ΩïÂø´ÈÄüÂú∞ÊâæÂà∞keyÂØπÂ∫îÁöÑvalueÂÄºÔºüÂú®LevelDb‰∏≠Ôºålevel 0‰∏ÄÁõ¥ÈÉΩÁà±ÊêûÁâπÊÆäÂåñÔºåÂú®level 0ÂíåÂÖ∂ÂÆÉlevel‰∏≠Êü•ÊâæÊüê‰∏™keyÁöÑËøáÁ®ãÊòØ‰∏ç‰∏ÄÊ†∑ÁöÑ„ÄÇÂõ†‰∏∫level 0‰∏ãÁöÑ‰∏çÂêåÊñá‰ª∂ÂèØËÉΩkeyÁöÑËåÉÂõ¥ÊúâÈáçÂè†ÔºåÊüê‰∏™Ë¶ÅÊü•ËØ¢ÁöÑkeyÊúâÂèØËÉΩÂ§ö‰∏™Êñá‰ª∂ÈÉΩÂåÖÂê´ÔºåËøôÊ†∑ÁöÑËØùLevelDbÁöÑÁ≠ñÁï•ÊòØÂÖàÊâæÂá∫level 0‰∏≠Âì™‰∫õÊñá‰ª∂ÂåÖÂê´Ëøô‰∏™keyÔºàmanifestÊñá‰ª∂‰∏≠ËÆ∞ËΩΩ‰∫ÜlevelÂíåÂØπÂ∫îÁöÑÊñá‰ª∂ÂèäÊñá‰ª∂ÈáåkeyÁöÑËåÉÂõ¥‰ø°ÊÅØÔºåLevelDbÂú®ÂÜÖÂ≠ò‰∏≠‰øùÁïôËøôÁßçÊò†Â∞ÑË°®ÔºâÔºå ‰πãÂêéÊåâÁÖßÊñá‰ª∂ÁöÑÊñ∞È≤úÁ®ãÂ∫¶ÊéíÂ∫èÔºåÊñ∞ÁöÑÊñá‰ª∂ÊéíÂú®ÂâçÈù¢Ôºå‰πãÂêé‰æùÊ¨°Êü•ÊâæÔºåËØªÂá∫keyÂØπÂ∫îÁöÑvalue„ÄÇËÄåÂ¶ÇÊûúÊòØÈùûlevel 0ÁöÑËØùÔºåÂõ†‰∏∫Ëøô‰∏™levelÁöÑÊñá‰ª∂‰πãÈó¥keyÊòØ‰∏çÈáçÂè†ÁöÑÔºåÊâÄ‰ª•Âè™‰ªé‰∏Ä‰∏™Êñá‰ª∂Â∞±ÂèØ‰ª•ÊâæÂà∞keyÂØπÂ∫îÁöÑvalue„ÄÇ</p>
<p>ÊúÄÂêé‰∏Ä‰∏™ÈóÆÈ¢ò,Â¶ÇÊûúÁªôÂÆö‰∏Ä‰∏™Ë¶ÅÊü•ËØ¢ÁöÑkeyÂíåÊüê‰∏™key rangeÂåÖÂê´Ëøô‰∏™keyÁöÑSSTableÊñá‰ª∂ÔºåÈÇ£‰πàlevelDbÊòØÂ¶Ç‰ΩïËøõË°åÂÖ∑‰ΩìÊü•ÊâæËøáÁ®ãÁöÑÂë¢ÔºülevelDb‰∏ÄËà¨‰ºöÂÖàÂú®ÂÜÖÂ≠ò‰∏≠ÁöÑCache‰∏≠Êü•ÊâæÊòØÂê¶ÂåÖÂê´Ëøô‰∏™Êñá‰ª∂ÁöÑÁºìÂ≠òËÆ∞ÂΩïÔºåÂ¶ÇÊûúÂåÖÂê´ÔºåÂàô‰ªéÁºìÂ≠ò‰∏≠ËØªÂèñÔºõÂ¶ÇÊûú‰∏çÂåÖÂê´ÔºåÂàôÊâìÂºÄSSTableÊñá‰ª∂ÔºåÂêåÊó∂Â∞ÜËøô‰∏™Êñá‰ª∂ÁöÑÁ¥¢ÂºïÈÉ®ÂàÜÂä†ËΩΩÂà∞ÂÜÖÂ≠ò‰∏≠Âπ∂ÊîæÂÖ•Cache‰∏≠„ÄÇ ËøôÊ†∑CacheÈáåÈù¢Â∞±Êúâ‰∫ÜËøô‰∏™SSTableÁöÑÁºìÂ≠òÈ°πÔºå‰ΩÜÊòØÂè™ÊúâÁ¥¢ÂºïÈÉ®ÂàÜÂú®ÂÜÖÂ≠ò‰∏≠Ôºå‰πãÂêélevelDbÊ†πÊçÆÁ¥¢ÂºïÂèØ‰ª•ÂÆö‰ΩçÂà∞Âì™‰∏™ÂÜÖÂÆπBlock‰ºöÂåÖÂê´ËøôÊù°keyÔºå‰ªéÊñá‰ª∂‰∏≠ËØªÂá∫Ëøô‰∏™BlockÁöÑÂÜÖÂÆπÔºåÂú®Ê†πÊçÆËÆ∞ÂΩï‰∏Ä‰∏ÄÊØîËæÉÔºåÂ¶ÇÊûúÊâæÂà∞ÂàôËøîÂõûÁªìÊûúÔºåÂ¶ÇÊûúÊ≤°ÊúâÊâæÂà∞ÔºåÈÇ£‰πàËØ¥ÊòéËøô‰∏™levelÁöÑSSTableÊñá‰ª∂Âπ∂‰∏çÂåÖÂê´Ëøô‰∏™keyÔºåÊâÄ‰ª•Âà∞‰∏ã‰∏ÄÁ∫ßÂà´ÁöÑSSTable‰∏≠ÂéªÊü•Êâæ„ÄÇ</p>
<p>‰ªé‰πãÂâç‰ªãÁªçÁöÑLevelDbÁöÑÂÜôÊìç‰ΩúÂíåËøôÈáå‰ªãÁªçÁöÑËØªÊìç‰ΩúÂèØ‰ª•ÁúãÂá∫ÔºåÁõ∏ÂØπÂÜôÊìç‰ΩúÔºåËØªÊìç‰ΩúÂ§ÑÁêÜËµ∑Êù•Ë¶ÅÂ§çÊùÇÂæàÂ§öÔºåÊâÄ‰ª•ÂÜôÁöÑÈÄüÂ∫¶ÂøÖÁÑ∂Ë¶ÅËøúËøúÈ´ò‰∫éËØªÊï∞ÊçÆÁöÑÈÄüÂ∫¶Ôºå‰πüÂ∞±ÊòØËØ¥ÔºåLevelDbÊØîËæÉÈÄÇÂêàÂÜôÊìç‰ΩúÂ§ö‰∫éËØªÊìç‰ΩúÁöÑÂ∫îÁî®Âú∫Âêà„ÄÇËÄåÂ¶ÇÊûúÂ∫îÁî®ÊòØÂæàÂ§öËØªÊìç‰ΩúÁ±ªÂûãÁöÑÔºåÈÇ£‰πàÈ°∫Â∫èËØªÂèñÊïàÁéá‰ºöÊØîËæÉÈ´òÔºåÂõ†‰∏∫ËøôÊ†∑Â§ßÈÉ®ÂàÜÂÜÖÂÆπÈÉΩ‰ºöÂú®ÁºìÂ≠ò‰∏≠ÊâæÂà∞ÔºåÂ∞ΩÂèØËÉΩÈÅøÂÖçÂ§ßÈáèÁöÑÈöèÊú∫ËØªÂèñÊìç‰Ωú„ÄÇ</p>
<h1 id="CompactionÊìç‰Ωú"><a href="#CompactionÊìç‰Ωú" class="headerlink" title="CompactionÊìç‰Ωú"></a>CompactionÊìç‰Ωú</h1><p>ÂâçÊñáÊúâËø∞ÔºåÂØπ‰∫éLevelDbÊù•ËØ¥ÔºåÂÜôÂÖ•ËÆ∞ÂΩïÊìç‰ΩúÂæàÁÆÄÂçïÔºåÂà†Èô§ËÆ∞ÂΩï‰ªÖ‰ªÖÂÜôÂÖ•‰∏Ä‰∏™Âà†Èô§Ê†áËÆ∞Â∞±ÁÆóÂÆå‰∫ãÔºå‰ΩÜÊòØËØªÂèñËÆ∞ÂΩïÊØîËæÉÂ§çÊùÇÔºåÈúÄË¶ÅÂú®ÂÜÖÂ≠ò‰ª•ÂèäÂêÑ‰∏™Â±ÇÁ∫ßÊñá‰ª∂‰∏≠‰æùÁÖßÊñ∞È≤úÁ®ãÂ∫¶‰æùÊ¨°Êü•ÊâæÔºå‰ª£‰ª∑ÂæàÈ´ò„ÄÇ‰∏∫‰∫ÜÂä†Âø´ËØªÂèñÈÄüÂ∫¶ÔºålevelDbÈááÂèñ‰∫ÜcompactionÁöÑÊñπÂºèÊù•ÂØπÂ∑≤ÊúâÁöÑËÆ∞ÂΩïËøõË°åÊï¥ÁêÜÂéãÁº©ÔºåÈÄöËøáËøôÁßçÊñπÂºèÔºåÊù•Âà†Èô§Êéâ‰∏Ä‰∫õ‰∏çÂÜçÊúâÊïàÁöÑKVÊï∞ÊçÆÔºåÂáèÂ∞èÊï∞ÊçÆËßÑÊ®°ÔºåÂáèÂ∞ëÊñá‰ª∂Êï∞ÈáèÁ≠â„ÄÇ</p>
<p>levelDbÁöÑcompactionÊú∫Âà∂ÂíåËøáÁ®ã‰∏éBigtableÊâÄËÆ≤Ëø∞ÁöÑÊòØÂü∫Êú¨‰∏ÄËá¥ÁöÑÔºåBigtable‰∏≠ËÆ≤Âà∞‰∏âÁßçÁ±ªÂûãÁöÑcompaction: minor ÔºåmajorÂíåfull„ÄÇÊâÄË∞ìminor CompactionÔºåÂ∞±ÊòØÊäämemtable‰∏≠ÁöÑÊï∞ÊçÆÂØºÂá∫Âà∞SSTableÊñá‰ª∂‰∏≠Ôºõmajor compactionÂ∞±ÊòØÂêàÂπ∂‰∏çÂêåÂ±ÇÁ∫ßÁöÑSSTableÊñá‰ª∂ÔºåËÄåfull compactionÂ∞±ÊòØÂ∞ÜÊâÄÊúâSSTableËøõË°åÂêàÂπ∂„ÄÇ</p>
<p>LevelDbÂåÖÂê´ÂÖ∂‰∏≠‰∏§ÁßçÔºå<code>minor</code>Âíå<code>major</code>„ÄÇ</p>
<p>Êàë‰ª¨Â∞Ü‰∏∫Â§ßÂÆ∂ËØ¶ÁªÜÂèôËø∞ÂÖ∂Êú∫ÁêÜ„ÄÇ</p>
<p>ÂÖàÊù•ÁúãÁúã<code>minor Compaction</code>ÁöÑËøáÁ®ã„ÄÇMinor compaction ÁöÑÁõÆÁöÑÊòØÂΩìÂÜÖÂ≠ò‰∏≠ÁöÑmemtableÂ§ßÂ∞èÂà∞‰∫Ü‰∏ÄÂÆöÂÄºÊó∂ÔºåÂ∞ÜÂÜÖÂÆπ‰øùÂ≠òÂà∞Á£ÅÁõòÊñá‰ª∂‰∏≠ÔºåÂõæ8.1ÊòØÂÖ∂Êú∫ÁêÜÁ§∫ÊÑèÂõæ„ÄÇ</p>
<p><img src="LevelDb13.png" alt="LevelDb13"><br>Âõæ8.1 minor compaction</p>
<p>‰ªé8.1ÂèØ‰ª•ÁúãÂá∫ÔºåÂΩìmemtableÊï∞ÈáèÂà∞‰∫Ü‰∏ÄÂÆöÁ®ãÂ∫¶‰ºöËΩ¨Êç¢‰∏∫immutable memtableÔºåÊ≠§Êó∂‰∏çËÉΩÂæÄÂÖ∂‰∏≠ÂÜôÂÖ•ËÆ∞ÂΩïÔºåÂè™ËÉΩ‰ªé‰∏≠ËØªÂèñKVÂÜÖÂÆπ„ÄÇ‰πãÂâç‰ªãÁªçËøáÔºåimmutable memtableÂÖ∂ÂÆûÊòØ‰∏Ä‰∏™Â§öÂ±ÇÁ∫ßÈòüÂàóSkipListÔºåÂÖ∂‰∏≠ÁöÑËÆ∞ÂΩïÊòØÊ†πÊçÆkeyÊúâÂ∫èÊéíÂàóÁöÑ„ÄÇÊâÄ‰ª•Ëøô‰∏™minor compactionÂÆûÁé∞Ëµ∑Êù•‰πüÂæàÁÆÄÂçïÔºåÂ∞±ÊòØÊåâÁÖßimmutable memtable‰∏≠ËÆ∞ÂΩïÁî±Â∞èÂà∞Â§ßÈÅçÂéÜÔºåÂπ∂‰æùÊ¨°ÂÜôÂÖ•‰∏Ä‰∏™level 0 ÁöÑÊñ∞Âª∫SSTableÊñá‰ª∂‰∏≠ÔºåÂÜôÂÆåÂêéÂª∫Á´ãÊñá‰ª∂ÁöÑindex Êï∞ÊçÆÔºåËøôÊ†∑Â∞±ÂÆåÊàê‰∫Ü‰∏ÄÊ¨°minor compaction„ÄÇ‰ªéÂõæ‰∏≠‰πüÂèØ‰ª•ÁúãÂá∫ÔºåÂØπ‰∫éË¢´Âà†Èô§ÁöÑËÆ∞ÂΩïÔºåÂú®minor compactionËøáÁ®ã‰∏≠Âπ∂‰∏çÁúüÊ≠£Âà†Èô§Ëøô‰∏™ËÆ∞ÂΩïÔºåÂéüÂõ†‰πüÂæàÁÆÄÂçïÔºåËøôÈáåÂè™Áü•ÈÅìË¶ÅÂà†ÊéâkeyËÆ∞ÂΩïÔºå‰ΩÜÊòØËøô‰∏™KVÊï∞ÊçÆÂú®Âì™Èáå?ÈÇ£ÈúÄË¶ÅÂ§çÊùÇÁöÑÊü•ÊâæÔºåÊâÄ‰ª•Âú®minor compactionÁöÑÊó∂ÂÄôÂπ∂‰∏çÂÅöÂà†Èô§ÔºåÂè™ÊòØÂ∞ÜËøô‰∏™key‰Ωú‰∏∫‰∏Ä‰∏™ËÆ∞ÂΩïÂÜôÂÖ•Êñá‰ª∂‰∏≠ÔºåËá≥‰∫éÁúüÊ≠£ÁöÑÂà†Èô§Êìç‰ΩúÔºåÂú®‰ª•ÂêéÊõ¥È´òÂ±ÇÁ∫ßÁöÑcompaction‰∏≠‰ºöÂéªÂÅö„ÄÇ</p>
<p>ÂΩìÊüê‰∏™level‰∏ãÁöÑSSTableÊñá‰ª∂Êï∞ÁõÆË∂ÖËøá‰∏ÄÂÆöËÆæÁΩÆÂÄºÂêéÔºålevelDb‰ºö‰ªéËøô‰∏™levelÁöÑSSTable‰∏≠ÈÄâÊã©‰∏Ä‰∏™Êñá‰ª∂Ôºàlevel&gt;0ÔºâÔºåÂ∞ÜÂÖ∂ÂíåÈ´ò‰∏ÄÂ±ÇÁ∫ßÁöÑlevel+1ÁöÑSSTableÊñá‰ª∂ÂêàÂπ∂ÔºåËøôÂ∞±ÊòØmajor compaction„ÄÇ</p>
<p>Êàë‰ª¨Áü•ÈÅìÂú®Â§ß‰∫é0ÁöÑÂ±ÇÁ∫ß‰∏≠ÔºåÊØè‰∏™SSTableÊñá‰ª∂ÂÜÖÁöÑKeyÈÉΩÊòØÁî±Â∞èÂà∞Â§ßÊúâÂ∫èÂ≠òÂÇ®ÁöÑÔºåËÄå‰∏î‰∏çÂêåÊñá‰ª∂‰πãÈó¥ÁöÑkeyËåÉÂõ¥ÔºàÊñá‰ª∂ÂÜÖÊúÄÂ∞èkeyÂíåÊúÄÂ§ßkey‰πãÈó¥Ôºâ‰∏ç‰ºöÊúâ‰ªª‰ΩïÈáçÂè†„ÄÇLevel 0ÁöÑSSTableÊñá‰ª∂Êúâ‰∫õÁâπÊÆäÔºåÂ∞ΩÁÆ°ÊØè‰∏™Êñá‰ª∂‰πüÊòØÊ†πÊçÆKeyÁî±Â∞èÂà∞Â§ßÊéíÂàóÔºå‰ΩÜÊòØÂõ†‰∏∫level 0ÁöÑÊñá‰ª∂ÊòØÈÄöËøáminor compactionÁõ¥Êé•ÁîüÊàêÁöÑÔºåÊâÄ‰ª•‰ªªÊÑè‰∏§‰∏™level 0‰∏ãÁöÑ‰∏§‰∏™sstableÊñá‰ª∂ÂèØËÉΩÂÜçkeyËåÉÂõ¥‰∏äÊúâÈáçÂè†„ÄÇÊâÄ‰ª•Âú®ÂÅömajor compactionÁöÑÊó∂ÂÄôÔºåÂØπ‰∫éÂ§ß‰∫élevel 0ÁöÑÂ±ÇÁ∫ßÔºåÈÄâÊã©ÂÖ∂‰∏≠‰∏Ä‰∏™Êñá‰ª∂Â∞±Ë°åÔºå‰ΩÜÊòØÂØπ‰∫élevel 0Êù•ËØ¥ÔºåÊåáÂÆöÊüê‰∏™Êñá‰ª∂ÂêéÔºåÊú¨level‰∏≠ÂæàÂèØËÉΩÊúâÂÖ∂‰ªñSSTableÊñá‰ª∂ÁöÑkeyËåÉÂõ¥ÂíåËøô‰∏™Êñá‰ª∂ÊúâÈáçÂè†ÔºåËøôÁßçÊÉÖÂÜµ‰∏ãÔºåË¶ÅÊâæÂá∫ÊâÄÊúâÊúâÈáçÂè†ÁöÑÊñá‰ª∂Âíålevel 1ÁöÑÊñá‰ª∂ËøõË°åÂêàÂπ∂ÔºåÂç≥level 0Âú®ËøõË°åÊñá‰ª∂ÈÄâÊã©ÁöÑÊó∂ÂÄôÔºåÂèØËÉΩ‰ºöÊúâÂ§ö‰∏™Êñá‰ª∂ÂèÇ‰∏émajor compaction„ÄÇ</p>
<p>levelDbÂú®ÈÄâÂÆöÊüê‰∏™levelËøõË°åcompactionÂêéÔºåËøòË¶ÅÈÄâÊã©ÊòØÂÖ∑‰ΩìÂì™‰∏™Êñá‰ª∂Ë¶ÅËøõË°åcompactionÔºålevelDbÂú®ËøôÈáåÊúâ‰∏™Â∞èÊäÄÂ∑ßÔºå Â∞±ÊòØËØ¥ËΩÆÊµÅÊù•ÔºåÊØîÂ¶ÇËøôÊ¨°ÊòØÊñá‰ª∂AËøõË°åcompactionÔºåÈÇ£‰πà‰∏ãÊ¨°Â∞±ÊòØÂú®key range‰∏äÁ¥ßÊå®ÁùÄÊñá‰ª∂AÁöÑÊñá‰ª∂BËøõË°åcompactionÔºåËøôÊ†∑ÊØè‰∏™Êñá‰ª∂ÈÉΩ‰ºöÊúâÊú∫‰ºöËΩÆÊµÅÂíåÈ´òÂ±ÇÁöÑlevel Êñá‰ª∂ËøõË°åÂêàÂπ∂„ÄÇ</p>
<p>Â¶ÇÊûúÈÄâÂ•Ω‰∫Ülevel LÁöÑÊñá‰ª∂AÂíålevel L+1Â±ÇÁöÑÊñá‰ª∂ËøõË°åÂêàÂπ∂ÔºåÈÇ£‰πàÈóÆÈ¢òÂèàÊù•‰∫ÜÔºåÂ∫îËØ•ÈÄâÊã©level L+1Âì™‰∫õÊñá‰ª∂ËøõË°åÂêàÂπ∂ÔºülevelDbÈÄâÊã©L+1Â±Ç‰∏≠ÂíåÊñá‰ª∂AÂú®key range‰∏äÊúâÈáçÂè†ÁöÑÊâÄÊúâÊñá‰ª∂Êù•ÂíåÊñá‰ª∂AËøõË°åÂêàÂπ∂„ÄÇ</p>
<p>‰πüÂ∞±ÊòØËØ¥ÔºåÈÄâÂÆö‰∫Ülevel LÁöÑÊñá‰ª∂A,‰πãÂêéÂú®level L+1‰∏≠ÊâæÂà∞‰∫ÜÊâÄÊúâÈúÄË¶ÅÂêàÂπ∂ÁöÑÊñá‰ª∂B,C,D‚Ä¶..Á≠âÁ≠â„ÄÇÂâ©‰∏ãÁöÑÈóÆÈ¢òÂ∞±ÊòØÂÖ∑‰ΩìÊòØÂ¶Ç‰ΩïËøõË°åmajor ÂêàÂπ∂ÁöÑÔºüÂ∞±ÊòØËØ¥ÁªôÂÆö‰∫Ü‰∏ÄÁ≥ªÂàóÊñá‰ª∂ÔºåÊØè‰∏™Êñá‰ª∂ÂÜÖÈÉ®ÊòØkeyÊúâÂ∫èÁöÑÔºåÂ¶Ç‰ΩïÂØπËøô‰∫õÊñá‰ª∂ËøõË°åÂêàÂπ∂Ôºå‰ΩøÂæóÊñ∞ÁîüÊàêÁöÑÊñá‰ª∂‰ªçÁÑ∂KeyÊúâÂ∫èÔºåÂêåÊó∂ÊäõÊéâÂì™‰∫õ‰∏çÂÜçÊúâ‰ª∑ÂÄºÁöÑKV Êï∞ÊçÆ„ÄÇ</p>
<p>Âõæ8.2ËØ¥Êòé‰∫ÜËøô‰∏ÄËøáÁ®ã„ÄÇ</p>
<p><img src="LevelDb14.png" alt="LevelDb14"><br>Âõæ8.2 SSTable Compaction</p>
<p>Major compactionÁöÑËøáÁ®ãÂ¶Ç‰∏ãÔºöÂØπÂ§ö‰∏™Êñá‰ª∂ÈááÁî®Â§öË∑ØÂΩíÂπ∂ÊéíÂ∫èÁöÑÊñπÂºèÔºå‰æùÊ¨°ÊâæÂá∫ÂÖ∂‰∏≠ÊúÄÂ∞èÁöÑKeyËÆ∞ÂΩïÔºå‰πüÂ∞±ÊòØÂØπÂ§ö‰∏™Êñá‰ª∂‰∏≠ÁöÑÊâÄÊúâËÆ∞ÂΩïÈáçÊñ∞ËøõË°åÊéíÂ∫è„ÄÇ‰πãÂêéÈááÂèñ‰∏ÄÂÆöÁöÑÊ†áÂáÜÂà§Êñ≠Ëøô‰∏™KeyÊòØÂê¶ËøòÈúÄË¶Å‰øùÂ≠òÔºåÂ¶ÇÊûúÂà§Êñ≠Ê≤°Êúâ‰øùÂ≠ò‰ª∑ÂÄºÔºåÈÇ£‰πàÁõ¥Êé•ÊäõÊéâÔºåÂ¶ÇÊûúËßâÂæóËøòÈúÄË¶ÅÁªßÁª≠‰øùÂ≠òÔºåÈÇ£‰πàÂ∞±Â∞ÜÂÖ∂ÂÜôÂÖ•level L+1Â±Ç‰∏≠Êñ∞ÁîüÊàêÁöÑ‰∏Ä‰∏™SSTableÊñá‰ª∂‰∏≠„ÄÇÂ∞±ËøôÊ†∑ÂØπKVÊï∞ÊçÆ‰∏Ä‰∏ÄÂ§ÑÁêÜÔºåÂΩ¢Êàê‰∫Ü‰∏ÄÁ≥ªÂàóÊñ∞ÁöÑL+1Â±ÇÊï∞ÊçÆÊñá‰ª∂Ôºå‰πãÂâçÁöÑLÂ±ÇÊñá‰ª∂ÂíåL+1Â±ÇÂèÇ‰∏écompaction ÁöÑÊñá‰ª∂Êï∞ÊçÆÊ≠§Êó∂Â∑≤ÁªèÊ≤°ÊúâÊÑè‰πâ‰∫ÜÔºåÊâÄ‰ª•ÂÖ®ÈÉ®Âà†Èô§„ÄÇËøôÊ†∑Â∞±ÂÆåÊàê‰∫ÜLÂ±ÇÂíåL+1Â±ÇÊñá‰ª∂ËÆ∞ÂΩïÁöÑÂêàÂπ∂ËøáÁ®ã„ÄÇ</p>
<p>ÈÇ£‰πàÂú®major compactionËøáÁ®ã‰∏≠ÔºåÂà§Êñ≠‰∏Ä‰∏™KVËÆ∞ÂΩïÊòØÂê¶ÊäõÂºÉÁöÑÊ†áÂáÜÊòØ‰ªÄ‰πàÂë¢ÔºüÂÖ∂‰∏≠‰∏Ä‰∏™Ê†áÂáÜÊòØ:ÂØπ‰∫éÊüê‰∏™keyÊù•ËØ¥ÔºåÂ¶ÇÊûúÂú®Â∞è‰∫éLÂ±Ç‰∏≠Â≠òÂú®Ëøô‰∏™KeyÔºåÈÇ£‰πàËøô‰∏™KVÂú®major compactionËøáÁ®ã‰∏≠ÂèØ‰ª•ÊäõÊéâ„ÄÇÂõ†‰∏∫Êàë‰ª¨ÂâçÈù¢ÂàÜÊûêËøáÔºåÂØπ‰∫éÂ±ÇÁ∫ß‰Ωé‰∫éLÁöÑÊñá‰ª∂‰∏≠Â¶ÇÊûúÂ≠òÂú®Âêå‰∏ÄKeyÁöÑËÆ∞ÂΩïÔºåÈÇ£‰πàËØ¥ÊòéÂØπ‰∫éKeyÊù•ËØ¥ÔºåÊúâÊõ¥Êñ∞È≤úÁöÑValueÂ≠òÂú®ÔºåÈÇ£‰πàËøáÂéªÁöÑValueÂ∞±Á≠â‰∫éÊ≤°ÊúâÊÑè‰πâ‰∫ÜÔºåÊâÄ‰ª•ÂèØ‰ª•Âà†Èô§„ÄÇ</p>
<h1 id="levelDb‰∏≠ÁöÑCache"><a href="#levelDb‰∏≠ÁöÑCache" class="headerlink" title="levelDb‰∏≠ÁöÑCache"></a>levelDb‰∏≠ÁöÑCache</h1><p>‰π¶Êé•ÂâçÊñáÔºåÂâçÈù¢ËÆ≤ËøáÂØπ‰∫élevelDbÊù•ËØ¥ÔºåËØªÂèñÊìç‰ΩúÂ¶ÇÊûúÊ≤°ÊúâÂú®ÂÜÖÂ≠òÁöÑmemtable‰∏≠ÊâæÂà∞ËÆ∞ÂΩïÔºåË¶ÅÂ§öÊ¨°ËøõË°åÁ£ÅÁõòËÆøÈóÆÊìç‰Ωú„ÄÇÂÅáËÆæÊúÄ‰ºòÊÉÖÂÜµÔºåÂç≥Á¨¨‰∏ÄÊ¨°Â∞±Âú®level 0‰∏≠ÊúÄÊñ∞ÁöÑÊñá‰ª∂‰∏≠ÊâæÂà∞‰∫ÜËøô‰∏™keyÔºåÈÇ£‰πà‰πüÈúÄË¶ÅËØªÂèñ2Ê¨°Á£ÅÁõòÔºå‰∏ÄÊ¨°ÊòØÂ∞ÜSSTableÁöÑÊñá‰ª∂‰∏≠ÁöÑindexÈÉ®ÂàÜËØªÂÖ•ÂÜÖÂ≠òÔºåËøôÊ†∑Ê†πÊçÆËøô‰∏™indexÂèØ‰ª•Á°ÆÂÆökeyÊòØÂú®Âì™‰∏™block‰∏≠Â≠òÂÇ®ÔºõÁ¨¨‰∫åÊ¨°ÊòØËØªÂÖ•Ëøô‰∏™blockÁöÑÂÜÖÂÆπÔºåÁÑ∂ÂêéÂú®ÂÜÖÂ≠ò‰∏≠Êü•ÊâækeyÂØπÂ∫îÁöÑvalue„ÄÇ</p>
<p>levelDb‰∏≠ÂºïÂÖ•‰∫Ü‰∏§‰∏™‰∏çÂêåÁöÑCache:Table CacheÂíåBlock Cache„ÄÇÂÖ∂‰∏≠Block CacheÊòØÈÖçÁΩÆÂèØÈÄâÁöÑÔºåÂç≥Âú®ÈÖçÁΩÆÊñá‰ª∂‰∏≠ÊåáÂÆöÊòØÂê¶ÊâìÂºÄËøô‰∏™ÂäüËÉΩ„ÄÇ</p>
<p><img src="LevelDb15.png" alt="LevelDb15"><br>Âõæ9.1 table cache</p>
<p>Âõæ9.1ÊòØtable cacheÁöÑÁªìÊûÑ„ÄÇÂú®Cache‰∏≠ÔºåkeyÂÄºÊòØSSTableÁöÑÊñá‰ª∂ÂêçÁß∞ÔºåValueÈÉ®ÂàÜÂåÖÂê´‰∏§ÈÉ®ÂàÜÔºå‰∏Ä‰∏™ÊòØÊåáÂêëÁ£ÅÁõòÊâìÂºÄÁöÑSSTableÊñá‰ª∂ÁöÑÊñá‰ª∂ÊåáÈíàÔºåËøôÊòØ‰∏∫‰∫ÜÊñπ‰æøËØªÂèñÂÜÖÂÆπÔºõÂè¶Â§ñ‰∏Ä‰∏™ÊòØÊåáÂêëÂÜÖÂ≠ò‰∏≠Ëøô‰∏™SSTableÊñá‰ª∂ÂØπÂ∫îÁöÑTableÁªìÊûÑÊåáÈíàÔºåtableÁªìÊûÑÂú®ÂÜÖÂ≠ò‰∏≠Ôºå‰øùÂ≠ò‰∫ÜSSTableÁöÑindexÂÜÖÂÆπ‰ª•ÂèäÁî®Êù•ÊåáÁ§∫block cacheÁî®ÁöÑcache_id ,ÂΩìÁÑ∂Èô§Ê≠§Â§ñËøòÊúâÂÖ∂ÂÆÉ‰∏Ä‰∫õÂÜÖÂÆπ„ÄÇ</p>
<p>ÊØîÂ¶ÇÂú®get(key)ËØªÂèñÊìç‰Ωú‰∏≠ÔºåÂ¶ÇÊûúlevelDbÁ°ÆÂÆö‰∫ÜkeyÂú®Êüê‰∏™level‰∏ãÊüê‰∏™Êñá‰ª∂AÁöÑkey rangeËåÉÂõ¥ÂÜÖÔºåÈÇ£‰πàÈúÄË¶ÅÂà§Êñ≠ÊòØ‰∏çÊòØÊñá‰ª∂AÁúüÁöÑÂåÖÂê´Ëøô‰∏™KV„ÄÇÊ≠§Êó∂ÔºålevelDb‰ºöÈ¶ñÂÖàÊü•ÊâæTable CacheÔºåÁúãËøô‰∏™Êñá‰ª∂ÊòØÂê¶Âú®ÁºìÂ≠òÈáåÔºåÂ¶ÇÊûúÊâæÂà∞‰∫ÜÔºåÈÇ£‰πàÊ†πÊçÆindexÈÉ®ÂàÜÂ∞±ÂèØ‰ª•Êü•ÊâæÊòØÂì™‰∏™blockÂåÖÂê´Ëøô‰∏™key„ÄÇÂ¶ÇÊûúÊ≤°ÊúâÂú®ÁºìÂ≠ò‰∏≠ÊâæÂà∞Êñá‰ª∂ÔºåÈÇ£‰πàÊâìÂºÄSSTableÊñá‰ª∂ÔºåÂ∞ÜÂÖ∂indexÈÉ®ÂàÜËØªÂÖ•ÂÜÖÂ≠òÔºåÁÑ∂ÂêéÊèíÂÖ•CacheÈáåÈù¢ÔºåÂéªindexÈáåÈù¢ÂÆö‰ΩçÂì™‰∏™blockÂåÖÂê´Ëøô‰∏™Key „ÄÇÂ¶ÇÊûúÁ°ÆÂÆö‰∫ÜÊñá‰ª∂Âì™‰∏™blockÂåÖÂê´Ëøô‰∏™keyÔºåÈÇ£‰πàÈúÄË¶ÅËØªÂÖ•blockÂÜÖÂÆπÔºåËøôÊòØÁ¨¨‰∫åÊ¨°ËØªÂèñ„ÄÇ</p>
<p><img src="LevelDb16.png" alt="LevelDb16"><br>Âõæ9.2 block cache</p>
<p>Block CacheÊòØ‰∏∫‰∫ÜÂä†Âø´Ëøô‰∏™ËøáÁ®ãÁöÑÔºåÂõæ9.2ÊòØÂÖ∂ÁªìÊûÑÁ§∫ÊÑèÂõæ„ÄÇÂÖ∂‰∏≠ÁöÑkeyÊòØÊñá‰ª∂ÁöÑcache_idÂä†‰∏äËøô‰∏™blockÂú®Êñá‰ª∂‰∏≠ÁöÑËµ∑Âßã‰ΩçÁΩÆblock_offset„ÄÇËÄåvalueÂàôÊòØËøô‰∏™BlockÁöÑÂÜÖÂÆπ„ÄÇ</p>
<p>Â¶ÇÊûúlevelDbÂèëÁé∞Ëøô‰∏™blockÂú®block cache‰∏≠ÔºåÈÇ£‰πàÂèØ‰ª•ÈÅøÂÖçËØªÂèñÊï∞ÊçÆÔºåÁõ¥Êé•Âú®cacheÈáåÁöÑblockÂÜÖÂÆπÈáåÈù¢Êü•ÊâækeyÁöÑvalueÂ∞±Ë°åÔºåÂ¶ÇÊûúÊ≤°ÊâæÂà∞Âë¢ÔºüÈÇ£‰πàËØªÂÖ•blockÂÜÖÂÆπÂπ∂ÊääÂÆÉÊèíÂÖ•block cache‰∏≠„ÄÇlevelDbÂ∞±ÊòØËøôÊ†∑ÈÄöËøá‰∏§‰∏™cacheÊù•Âä†Âø´ËØªÂèñÈÄüÂ∫¶ÁöÑ„ÄÇ‰ªéËøôÈáåÂèØ‰ª•ÁúãÂá∫ÔºåÂ¶ÇÊûúËØªÂèñÁöÑÊï∞ÊçÆÂ±ÄÈÉ®ÊÄßÊØîËæÉÂ•ΩÔºå‰πüÂ∞±ÊòØËØ¥Ë¶ÅËØªÁöÑÊï∞ÊçÆÂ§ßÈÉ®ÂàÜÂú®cacheÈáåÈù¢ÈÉΩËÉΩËØªÂà∞ÔºåÈÇ£‰πàËØªÂèñÊïàÁéáÂ∫îËØ•ËøòÊòØÂæàÈ´òÁöÑÔºåËÄåÂ¶ÇÊûúÊòØÂØπkeyËøõË°åÈ°∫Â∫èËØªÂèñÊïàÁéá‰πüÂ∫îËØ•‰∏çÈîôÔºåÂõ†‰∏∫‰∏ÄÊ¨°ËØªÂÖ•ÂêéÂèØ‰ª•Â§öÊ¨°Ë¢´Â§çÁî®„ÄÇ‰ΩÜÊòØÂ¶ÇÊûúÊòØÈöèÊú∫ËØªÂèñÔºåÊÇ®ÂèØ‰ª•Êé®Êñ≠‰∏ãÂÖ∂ÊïàÁéáÂ¶Ç‰Ωï„ÄÇ</p>
<h1 id="Version„ÄÅVersionEdit„ÄÅVersionSet"><a href="#Version„ÄÅVersionEdit„ÄÅVersionSet" class="headerlink" title="Version„ÄÅVersionEdit„ÄÅVersionSet"></a>Version„ÄÅVersionEdit„ÄÅVersionSet</h1><p>Version ‰øùÂ≠ò‰∫ÜÂΩìÂâçÁ£ÅÁõò‰ª•ÂèäÂÜÖÂ≠ò‰∏≠ÊâÄÊúâÁöÑÊñá‰ª∂‰ø°ÊÅØÔºå‰∏ÄËà¨Âè™Êúâ‰∏Ä‰∏™VersionÂè´ÂÅö‚Äùcurrent‚Äù versionÔºàÂΩìÂâçÁâàÊú¨Ôºâ„ÄÇLeveldbËøò‰øùÂ≠ò‰∫Ü‰∏ÄÁ≥ªÂàóÁöÑÂéÜÂè≤ÁâàÊú¨ÔºåËøô‰∫õÂéÜÂè≤ÁâàÊú¨Êúâ‰ªÄ‰πà‰ΩúÁî®Âë¢Ôºü</p>
<p>ÂΩì‰∏Ä‰∏™IteratorÂàõÂª∫ÂêéÔºåIteratorÂ∞±ÂºïÁî®Âà∞‰∫Ücurrent version(ÂΩìÂâçÁâàÊú¨)ÔºåÂè™Ë¶ÅËøô‰∏™Iterator‰∏çË¢´deleteÈÇ£‰πàË¢´IteratorÂºïÁî®ÁöÑÁâàÊú¨Â∞±‰ºö‰∏ÄÁõ¥Â≠òÊ¥ª„ÄÇËøôÂ∞±ÊÑèÂë≥ÁùÄÂΩì‰Ω†Áî®ÂÆå‰∏Ä‰∏™IteratorÂêéÔºåÈúÄË¶ÅÂèäÊó∂Âà†Èô§ÂÆÉ„ÄÇ</p>
<p>ÂΩì‰∏ÄÊ¨°CompactionÁªìÊùüÂêéÔºà‰ºöÁîüÊàêÊñ∞ÁöÑÊñá‰ª∂ÔºåÂêàÂπ∂ÂâçÁöÑÊñá‰ª∂ÈúÄË¶ÅÂà†Èô§ÔºâÔºåLeveldb‰ºöÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑÁâàÊú¨‰Ωú‰∏∫ÂΩìÂâçÁâàÊú¨ÔºåÂéüÂÖàÁöÑÂΩìÂâçÁâàÊú¨Â∞±‰ºöÂèò‰∏∫ÂéÜÂè≤ÁâàÊú¨„ÄÇ</p>
<p>VersionSet ÊòØÊâÄÊúâVersionÁöÑÈõÜÂêàÔºåÁÆ°ÁêÜÁùÄÊâÄÊúâÂ≠òÊ¥ªÁöÑVersion„ÄÇ</p>
<p>VersionEdit Ë°®Á§∫Version‰πãÈó¥ÁöÑÂèòÂåñÔºåÁõ∏ÂΩì‰∫édelta Â¢ûÈáèÔºåË°®Á§∫ÊúâÂ¢ûÂä†‰∫ÜÂ§öÂ∞ëÊñá‰ª∂ÔºåÂà†Èô§‰∫ÜÊñá‰ª∂„ÄÇ‰∏ãÂõæË°®Á§∫‰ªñ‰ª¨‰πãÈó¥ÁöÑÂÖ≥Á≥ª„ÄÇ</p>
<p>Version0 +VersionEdit‚Äì&gt;Version1</p>
<p>VersionEdit‰ºö‰øùÂ≠òÂà∞MANIFESTÊñá‰ª∂‰∏≠ÔºåÂΩìÂÅöÊï∞ÊçÆÊÅ¢Â§çÊó∂Â∞±‰ºö‰ªéMANIFESTÊñá‰ª∂‰∏≠ËØªÂá∫Êù•ÈáçÂª∫Êï∞ÊçÆ„ÄÇ</p>
<p>leveldbÁöÑËøôÁßçÁâàÊú¨ÁöÑÊéßÂà∂ÔºåËÆ©ÊàëÊÉ≥Âà∞‰∫ÜÂèåbufferÂàáÊç¢ÔºåÂèåbufferÂàáÊç¢Êù•Ëá™‰∫éÂõæÂΩ¢Â≠¶‰∏≠ÔºåÁî®‰∫éËß£ÂÜ≥Â±èÂπïÁªòÂà∂Êó∂ÁöÑÈó™Â±èÈóÆÈ¢òÔºåÂú®ÊúçÂä°Âô®ÁºñÁ®ã‰∏≠‰πüÊúâÁî®Â§Ñ„ÄÇ</p>
<p>ÊØîÂ¶ÇÊàë‰ª¨ÁöÑÊúçÂä°Âô®‰∏äÊúâ‰∏Ä‰∏™Â≠óÂÖ∏Â∫ìÔºåÊØèÂ§©Êàë‰ª¨ÈúÄË¶ÅÊõ¥Êñ∞Ëøô‰∏™Â≠óÂÖ∏Â∫ìÔºåÊàë‰ª¨ÂèØ‰ª•Êñ∞ÂºÄ‰∏Ä‰∏™bufferÔºåÂ∞ÜÊñ∞ÁöÑÂ≠óÂÖ∏Â∫ìÂä†ËΩΩÂà∞Ëøô‰∏™Êñ∞buffer‰∏≠ÔºåÁ≠âÂà∞Âä†ËΩΩÂÆåÊØïÔºåÂ∞ÜÂ≠óÂÖ∏ÁöÑÊåáÈíàÊåáÂêëÊñ∞ÁöÑÂ≠óÂÖ∏Â∫ì„ÄÇ</p>
<p>leveldbÁöÑversionÁÆ°ÁêÜÂíåÂèåbufferÂàáÊç¢Á±ª‰ººÔºå‰ΩÜÊòØÂ¶ÇÊûúÂéüversionË¢´Êüê‰∏™iteratorÂºïÁî®ÔºåÈÇ£‰πàËøô‰∏™version‰ºö‰∏ÄÁõ¥‰øùÊåÅÔºåÁõ¥Âà∞Ê≤°ÊúâË¢´‰ªª‰Ωï‰∏Ä‰∏™iteratorÂºïÁî®ÔºåÊ≠§Êó∂Â∞±ÂèØ‰ª•Âà†Èô§Ëøô‰∏™version„ÄÇ</p>
<h1 id="ÂèÇËÄÉ"><a href="#ÂèÇËÄÉ" class="headerlink" title="ÂèÇËÄÉ"></a>ÂèÇËÄÉ</h1><p><a href="http://www.cnblogs.com/haippy/archive/2011/12/04/2276064.html" target="_blank" rel="noopener">Leveldb ÂÆûÁé∞ÂéüÁêÜ</a></p>
]]></content>
      <categories>
        <category>Technology</category>
      </categories>
      <tags>
        <tag>storage</tag>
      </tags>
  </entry>
  <entry>
    <title>How the append-only btree work</title>
    <url>/blog/how-the-append-only-btree-work/</url>
    <content><![CDATA[<p>ÂéüÊñáÔºö<a href="http://www.bzero.se/ldapd/btree.html" target="_blank" rel="noopener">http://www.bzero.se/ldapd/btree.html</a></p>
<p>ËØ• tree ‰πüË¢´Áß∞‰∏∫ Copy-On-Write Tree<br>ËÄÉËôë‰∏ãÂõæÁöÑËøô‰∏™3Â±Ç b tree.<br><img src="http://www.bzero.se/ldapd/how-the-btree-works.png" alt="3levelbtree"><br>ËØ•Ê†ëÁî±‰∏§Â±ÇÁöÑ branch pageÔºàroot ‰πüÊòØ‰∏Ä‰∏™ branch pageÔºâÂíå 5 ‰∏™ leaf page ÁªÑÊàê„ÄÇkey Âíå data ÈÉΩÂ≠òÂÇ®Âú® leaf page ÈáåÈù¢„ÄÇ</p>
<a id="more"></a>
<p>ËøôÈáåÔºåleaf chainingÔºàÂè∂ËäÇÁÇπ‰πãÈó¥ÁöÑÊåáÈíàËøûÊé•ÔºâÂπ∂Ê≤°ÊúâË¢´ÊîØÊåÅÔºå‰πüÂ∞±ÊòØÂè∂Â≠êËäÇÁÇπ‰πãÈó¥ÁöÑÈ°∫Â∫è access ÁâπÊÄß‰∏çË¢´ÊîØÊåÅÔºàÂç≥Ê≤°ÊúâÊåáÈíà‰ªé‰∏Ä‰∏™ leaf ÊåáÂêë‰∏ã‰∏Ä‰∏™ leafÔºâÔºåËøôÊòØÂõ†‰∏∫ËØ•ÁâπÊÄßÁöÑÂÆûÁé∞Ôºå‰ºöË¶ÅÊ±ÇÊØèÊ¨° update ÈÉΩÂéª rewrite Êï¥‰∏™ tree„ÄÇ</p>
<p>ËØ• tree ÁöÑ page Âú® database Êñá‰ª∂‰∏≠ÔºåË¢´È°∫Â∫èÂ≠òÂÇ®ÁùÄ„ÄÇÊ∑ªÂä† page numbers ‰πüÂè™ÊòØÊÑèÂë≥ÁùÄÂ¢ûÂä† file ÁöÑ offsetÔºàÁ±ª‰ºº‰∫éÁªôvectorÊï∞ÁªÑÂêéÈù¢Ê∑ªÂä†‰∏Ä‰∏™‰ΩçÁΩÆ‰∏ÄÊ†∑Ôºâ„ÄÇ</p>
<p>meta page ÔºüÂåÖÊã¨Ôºö</p>
<ul>
<li>‰∏Ä‰∏™ÊåáÂêë root page ÁöÑÊåáÈíà</li>
<li>‰∏Ä‰∏™ SHA1 hash</li>
<li>‰∏Ä‰∏™ÈùôÊÄÅËÆ°Êï∞Âô®ÔºàÂÖ®Â±ÄËÆ°Êï∞Âô®ÔºâÔºü</li>
</ul>
<p>ÂΩì‰∏Ä‰∏™ file Ë¢´ÊâìÂºÄÔºåÂÆÉÂ∞Ü‰ºöË¢´‰ªéÂ∞æÈÉ®ÁöÑ page ÂºÄÂßãÊâ´ÊèèÔºåÁõ¥Âà∞ÊâæÂà∞‰∏Ä‰∏™ÊúâÊïàÁöÑ meta pageÔºå‰ªéËÄåÊ†πÊçÆ‰∏äËø∞ÁöÑÊåáÈíàÔºåÊâæÂà∞ root page„ÄÇ</p>
<p><img src="http://www.bzero.se/ldapd/sequential-page-view.png" alt="sequential-page-view"></p>
<p>ÊØîÂ¶ÇÁé∞Âú®Ë¶ÅÊõ¥Êñ∞ leaf page 8 ‰∏äÁöÑÂÄºÔºå‰∏çÂêå‰∫éÁõ¥Êé•Âú®ËØ• page ‰∏äËøõË°åÊõ¥ÊîπË¶ÜÂÜôÔºåËøôÈáå‰ºöÁõ¥Êé•‰∫ßÁîü‰∏Ä‰∏™ÂÖ∑Êúâ new value ÁöÑ pageÔºåÂπ∂ append Âà∞ file Â∞æÈÉ®„ÄÇÂ¶Ç‰∏ãÂõæ‰∏≠ÁöÑ page 12„ÄÇ</p>
<p><img src="http://www.bzero.se/ldapd/updated-btree.png" alt="updated-btree"></p>
<p>Âõ†‰∏∫ÂéüÊú¨‰Ωú‰∏∫ leaf page 8 ÁöÑ‰ΩçÁΩÆÔºå‰øÆÊîπÂà∞‰∫Ü page 12ÔºåÂÆÉÁöÑÊØè‰∏™ parent page ÈÉΩÈúÄË¶ÅÊõ¥Êñ∞ÂØπÂ∫îÁöÑÊåáÈíà„ÄÇ</p>
<p>leaf 7 Ê≤°ÊúâË¢´ÂΩ±Âìç„ÄÇËÄå branch 6 ‰Ωú‰∏∫Ë¢´‰øÆÊîπ leaf ÁöÑ parentÔºåÂÖ∂ÊåáÈíàÂÄºË¢´ÂΩ±Âìç‰∫ÜÔºåÊâÄ‰ª•‰∏Ä‰∏™Êñ∞ÁöÑ page Ë¢´ÂàõÂª∫Âá∫Êù• ‚Äì branch page 11ÔºåÂêåÊó∂‰∏Ä‰∏™Êñ∞ÁöÑ root ‰πüË¢´ÂàõÂª∫Âá∫Êù• ‚Äì root 13ÔºåÊõ¥Êñ∞ÂêéÁöÑ tree Â¶Ç‰∏äÂõæÊâÄÁ§∫„ÄÇ</p>
<p>ËøôÊ†∑Ôºå‰ªª‰ΩïÊã•Êúâ root page 9 ÁöÑÁî®Êà∑Ôºå‰ªçÁÑ∂ËÉΩÂ§üË∑üË∏™Âà∞Ê≤°ÊúâË¢´‰øÆÊîπ‰πãÂâçÁöÑÂÄº„ÄÇËøôÂ∞±ÊòØ database Ëá™Â∑±ÁöÑ‰∏Ä‰∏™ snapshot„ÄÇ</p>
<p>Âú®ËØ• database file ‰∏≠ÔºåÊñ∞ page Âè™ÊòØ‰∏çÊñ≠ÁöÑË¢´ append Âà∞ file Â∞æÈÉ®ÔºåÂ∑≤ÁªèÂÜôÂÖ•ÂÄºÁöÑ page Âπ∂‰∏ç‰ºöË¢´ÂΩ±Âìç„ÄÇ</p>
<p>‰øÆÊîπ‰∏ÄÊ¨°Êï∞ÊçÆÂêéÔºåÂΩìÊØè‰∏™Áõ∏ÂÖ≥ÁöÑ page ÈÉΩË¢´Êõ¥Êñ∞ÂÆåÊØïÔºåÂ∞±‰ºö‰∫ßÁîü‰∏Ä‰∏™Êñ∞ÁöÑ meta pageÔºåÊåáÂêëÊñ∞ÁöÑ root pageÔºåÂ¶Ç‰∏ãÂõæÔºö</p>
<p><img src="http://www.bzero.se/ldapd/flattened-btree-page-structure.png" alt="flattened-btree-page-structure"></p>
<p>‰ªéÁªìÊûú‰∏äÁúãÔºåÂØπ‰∏Ä‰∏™pageÁöÑ‰øÆÊîπÔºà‰øÆÊîπ leaf page 8ÔºâÔºå‰ºöÂØºËá¥ 4 ‰∏™Êñ∞ page Ë¢´ append Âà∞ file Â∞æÈÉ®„ÄÇËøôÂú®‰∏ÄÂÆöÁ®ãÂ∫¶‰∏äÊµ™Ë¥π‰∫ÜÁ£ÅÁõòÁ©∫Èó¥Ôºå‰ΩÜÊòØËøôÊ†∑È°∫Â∫èÂÜôÊìç‰ΩúÔºåËÉΩÂ§üÈùûÂ∏∏Â§ßÁöÑÊèêÂçáÈöèÂç≥ÂÜôÊÄßËÉΩ„ÄÇÂπ∂‰∏îËøôÈáåÂπ∂‰∏çÈúÄË¶ÅÂÜçËÆ∞ÂΩï transaction logÔºåÁî®‰∫éÊï∞ÊçÆÊÅ¢Â§çÔºåËØ• database file Êú¨Ë∫´ÔºåÂ∞±ÊòØ‰∏Ä‰∏™ transaction log„ÄÇ</p>
]]></content>
      <categories>
        <category>Technology</category>
      </categories>
      <tags>
        <tag>storage</tag>
      </tags>
  </entry>
  <entry>
    <title>inodeÁõ∏ÂÖ≥ÂëΩ‰ª§</title>
    <url>/blog/inode-command/</url>
    <content><![CDATA[<p>‚Äã<img src="inode1.png" alt="inode1"><br><code>touch</code>ÔºöÊñ∞Âª∫Êñá‰ª∂<br><code>ls -i</code>ÔºöÊòæÁ§∫Êñá‰ª∂ÁöÑinode<br><code>stat filename</code>ÔºöÊòæÁ§∫Êñá‰ª∂ÁöÑÊâÄÊúâÁä∂ÊÄÅ‰ø°ÊÅØÔºåÂåÖÊã¨Â§ßÂ∞èÔºåinode idÔºålink Êï∞ÁõÆÔºåÂàõÂª∫Êó∂Èó¥Ôºå‰øÆÊîπÊó∂Èó¥Á≠â<br><code>ln file1 filelink1</code>ÔºöÁªôfile1ÂàõÂª∫‰∏Ä‰∏™ÂêçÂ≠óÂè´ÂÅöfilelink1ÁöÑÈìæÊé•ÔºåÂÖ∑ÊúâÁõ∏ÂêåÁöÑ inode id<br><img src="1503226895173.png" alt="inodeid"><br>Â¶ÇÊûúÊúâ‰∏Ä‰∏™Êñá‰ª∂ÂêçÂæàÂ•áÊÄ™ÔºåÊó†Ê≥ï‰ΩøÁî®Ê≠£Â∏∏ÁöÑ rm ÂëΩ‰ª§Âà†Èô§ÔºåÊØîÂ¶ÇÔºö‚Äúab*<br>ÈÇ£‰πàÂèØ‰ª•‰ΩøÁî® <code>find . -inum xxxx -delete</code> ÂëΩ‰ª§Âà†Èô§<br><img src="findcmd.png" alt="findcmd"><br><code>df -i</code>ÔºöÊü•ÁúãinodeËµÑÊ∫êÁöÑ‰ΩøÁî®ÊÉÖÂÜµ<br><img src="dfi.png" alt="dfi"><br>ÂèØ‰ª•Ê∏ÖÊ•öÁúãÂà∞inodeÁöÑÊúÄÂ§ß‰ΩøÁî®Êï∞ÁõÆ„ÄÇ</p>
<a id="more"></a>
<p>‰πüÂèØ‰ª•‰ΩøÁî® find ÂëΩ‰ª§ÊâæÂá∫Êñá‰ª∂ÊâÄÂú®ÁõÆÂΩï<br><img src="dir.png" alt="dir"></p>
]]></content>
      <categories>
        <category>Technology</category>
      </categories>
      <tags>
        <tag>storage</tag>
        <tag>linux-cmd</tag>
      </tags>
  </entry>
  <entry>
    <title>Á¨¨‰∫åÁ´†-IOÂ§ßÊ≥ï</title>
    <url>/blog/talking-storage-chapter2/</url>
    <content><![CDATA[<h1 id="IOÂ§ßÊ≥ï"><a href="#IOÂ§ßÊ≥ï" class="headerlink" title="IOÂ§ßÊ≥ï"></a>IOÂ§ßÊ≥ï</h1><h2 id="PCI"><a href="#PCI" class="headerlink" title="PCI"></a>PCI</h2><p>PCIÊòØPeripheral Component Interconnect(Â§ñËÆæÈÉ®‰ª∂‰∫íËøûÊ†áÂáÜ)„ÄÇÂÖ∂ËøûÊé•Âú®<code>ÂçóÊ°•</code>‰∏ä„ÄÇ<br><code>ÂåóÊ°•</code>ËøûÊé•Á≥ªÁªüÂÜÖÂ≠òÔºåCPU‰ª•ÂèäÈ´òÈÄüÊÄªÁ∫øÔºàex. PCIEÔºâ„ÄÇ<br>PCIÁöÑ<code>Âú∞ÂùÄÊÄªÁ∫ø</code>Âíå<code>Êï∞ÊçÆÊÄªÁ∫ø</code>ÊòØ<code>Êó∂ÂàÜÂ§çÁî®</code>ÔºàTime Division MultiplexingÔºåTDMÔºâÔºåÂç≥ÈááÁî®Âêå‰∏ÄÁâ©ÁêÜËøûÊé•ÁöÑ‰∏çÂêåÊó∂ÊÆµÊù•‰º†Ëæì‰∏çÂêåÁöÑ‰ø°Âè∑„ÄÇ</p>
<p>Êï∞ÊçÆ‰º†ËæìÊó∂ÔºåÂàÜ‰∏∫‰º†ËæìÁöÑÂèëËµ∑ËÄÖÔºàMasterÔºâÂíåÊï∞ÊçÆÁöÑÊé•ÂèóËÄÖÔºàSlaveÔºâÔºåÂêå‰∏ÄÊó∂ÂàªÂè™Êúâ‰∏ÄÂØπËÆæÂ§áÂèØ‰ª•‰º†ËæìÊï∞ÊçÆ„ÄÇ</p>
<h3 id="‰∏≠Êñ≠ÂÖ±‰∫´"><a href="#‰∏≠Êñ≠ÂÖ±‰∫´" class="headerlink" title="‰∏≠Êñ≠ÂÖ±‰∫´"></a>‰∏≠Êñ≠ÂÖ±‰∫´</h3><p>Á°¨‰ª∂‰∏äÔºåÈááÁî®<code>ÁîµÂπ≥Ëß¶Âèë</code>ÔºàPCIÊùøÂç°ËÆæÂ§áÁî®‰∏âÊûÅÁÆ°Êãâ‰Ωé‰ø°Âè∑Ôºâ<br>ËΩØ‰ª∂‰∏äÔºåÈááÁî®<code>‰∏≠Êñ≠Èìæ</code>ÔºàÂ¶ÇÊûúÂ§ö‰∏™ÊùøÂç°ÂÖ±‰∫´‰∏Ä‰∏™‰∏≠Êñ≠ÔºåÈÇ£‰πà‰∏Ä‰∏™‰∏≠Êñ≠Â§ÑÁêÜÂáΩÊï∞ÁªìÊùü‰ºöÊåáÂêë‰∏ã‰∏Ä‰∏™Â§ÑÁêÜÂáΩÊï∞ÔºåÂèëÁîü‰∏≠Êñ≠Êó∂ÂÄôÔºåÈÄê‰∏™Ê£ÄÊü•ÔºåÊòØÂàôÂ§ÑÁêÜÔºå‰∏çÊòØÂàôË∑≥ËøáÔºâ</p>
<a id="more"></a>
<h2 id="Êï∞ÊçÆÈÄö‰ø°"><a href="#Êï∞ÊçÆÈÄö‰ø°" class="headerlink" title="Êï∞ÊçÆÈÄö‰ø°"></a>Êï∞ÊçÆÈÄö‰ø°</h2><p>CPUÂêëÂ≠òÂÇ®ÊâÄÂú®ÁöÑÂú∞ÂùÄÔºàÊØîÂ¶Ç0x0AÔºâÂèëÈÄÅÂëΩ‰ª§„ÄÇ</p>
<ul>
<li>ÂèëÈÄÅËØªÔºà/ÂÜôÔºâÂëΩ‰ª§</li>
<li>ÊåáÊòéLBAÔºàÁ°¨ÁõòÈÄªËæëÂå∫ÂùóÔºâ</li>
<li>ÊåáÊòéËØªÂèñÁöÑÂÜÖÂÆπÂà∞Âì™‰∏ÄÊÆµÂÜÖÂ≠ò„ÄÇ</li>
</ul>
<ol>
<li>Á¨¨‰∏ÄÊù°Êåá‰ª§ÊåáÂÆö‰∫ÜËØªÊó∂ÈÖçÁΩÆÔºöÂÆåÊàêÊòØÂê¶Ëß¶Âèë‰∏≠Êñ≠ÔºåÊòØÂê¶ÂêØÁî®Á£ÅÁõòÁºìÂ≠ò„ÄÇ„ÄÇ„ÄÇ</li>
<li>Á¨¨‰∫åÊù°Êåá‰ª§ËøõË°åÁ£ÅÁõòÁöÑ<code>ÈÄªËæëÂå∫Âùó</code>Âà∞<code>ÂÆûÈôÖÂå∫Âùó</code>Êü•ÊâæÔºåËΩ¨Âà∞ËØ•ÊâáÂå∫ÔºåËØªÂèñÊï∞ÊçÆ</li>
<li>Á¨¨‰∏âÊù°Êåá‰ª§ÔºåÂú®Êï∞ÊçÆËØªÂá∫‰ª•ÂêéÔºå‰ºöËøõÂÖ• DMA Êìç‰ΩúÔºå‰∏çÈúÄË¶Å CPU Êé•ÂÖ•ÔºåËØªÂèñÁªìÊùüÔºåCPU‰ªéÂÜÖÂ≠òËØªÂèñÊï∞ÊçÆÔºåÂπ∂ËøõË°åËÆ°ÁÆó„ÄÇ</li>
</ol>
]]></content>
      <categories>
        <category>Technology</category>
      </categories>
      <tags>
        <tag>storage</tag>
        <tag>Â§ßËØùÂ≠òÂÇ®</tag>
      </tags>
  </entry>
  <entry>
    <title>ËÆ°ÁÆóÂõæÂΩ¢Â≠¶‰∏≠ÁöÑÂæÆÁßØÂàÜ-ÂèçÂêë‰º†Êí≠ÁÆóÊ≥ï</title>
    <url>/blog/Calculus-on-Computational-Graphs/</url>
    <content><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Backpropagation is the key algorithm that makes training deep models computationally tractable. For modern neural networks, it can make training with gradient descent as much as ten million times faster, relative to a naive implementation. That‚Äôs the difference between a model taking a week to train and taking 200,000 years.</p>
<p>Beyond its use in deep learning, backpropagation is a powerful computational tool in many other areas, ranging from weather forecasting to analyzing numerical stability ‚Äì it just goes by different names. In fact, the algorithm has been reinvented at least dozens of times in different fields (see <a href="http://www.math.uiuc.edu/documenta/vol-ismp/52_griewank-andreas-b.pdf" target="_blank" rel="noopener">Griewank (2010)</a>). The general, application independent, name is ‚Äúreverse-mode differentiation.‚Äù</p>
<a id="more"></a>
<p>Fundamentally, it‚Äôs a technique for calculating derivatives quickly. And it‚Äôs an essential trick to have in your bag, not only in deep learning, but in a wide variety of numerical computing situations.</p>
<h1 id="Computational-Graphs"><a href="#Computational-Graphs" class="headerlink" title="Computational Graphs"></a>Computational Graphs</h1><p>Computational graphs are a nice way to think about mathematical expressions. For example, consider the expression <code>e=(a+b)*(b+1)</code>. There are three operations: two additions and one multiplication. To help us talk about this, let‚Äôs introduce two intermediary variables, <code>c</code> and <code>d</code> so that every function‚Äôs output has a variable. We now have:</p>
<p>$$c=a+b$$</p>
<p>$$d=b+1$$</p>
<p>$$e=c*d$$</p>
<p>To create a computational graph, we make each of these operations, along with the input variables, into nodes. When one node‚Äôs value is the input to another node, an arrow goes from one to another.<br><img src="http://colah.github.io/posts/2015-08-Backprop/img/tree-def.png" alt="pic1"></p>
<p>These sorts of graphs come up all the time in computer science, especially in talking about functional programs. They are very closely related to the notions of dependency graphs and call graphs. They‚Äôre also the core abstraction behind the popular deep learning framework Theano.</p>
<p>We can evaluate the expression by setting the input variables to certain values and computing nodes up through the graph. For example, let‚Äôs set <code>a=2</code> and <code>b=1</code>:<br><img src="http://colah.github.io/posts/2015-08-Backprop/img/tree-eval.png" alt="pic2"></p>
<p>The expression evaluates to <code>6</code>.</p>
<h1 id="Derivatives-on-Computational-Graphs"><a href="#Derivatives-on-Computational-Graphs" class="headerlink" title="Derivatives on Computational Graphs"></a>Derivatives on Computational Graphs</h1><p>If one wants to understand derivatives in a computational graph, the key is to understand derivatives on the edges. If <code>a</code> directly affects <code>c</code>, then we want to know how it affects <code>c</code>. If <code>a</code> changes a little bit, how does <code>c</code> change? We call this the partial derivative of <code>c</code> with respect to <code>a</code>.</p>
<p>To evaluate the partial derivatives in this graph, we need the sum rule and the product rule:</p>
<p>$$\frac{\partial}{\partial a}(a+b) = \frac{\partial a}{\partial a} + \frac{\partial b}{\partial a} = 1$$</p>
<p>$$\frac{\partial}{\partial u}uv = u\frac{\partial v}{\partial u} + v\frac{\partial u}{\partial u} = v$$</p>
<p>Below, the graph has the derivative on each edge labeled.<br><img src="http://colah.github.io/posts/2015-08-Backprop/img/tree-eval-derivs.png" alt="pic3"></p>
<p>What if we want to understand how nodes that aren‚Äôt directly connected affect each other? Let‚Äôs consider how <code>e</code> is affected by <code>a</code>. If we change <code>a</code> at a speed of 1, <code>c</code> also changes at a speed of <code>1</code>. In turn, <code>c</code> changing at a speed of <code>1</code> causes <code>e</code> to change at a speed of <code>2</code>. So <code>e</code> changes at a rate of <code>1‚àó2</code> with respect to <code>a</code>.</p>
<p>The general rule is to sum over all possible paths from one node to the other, multiplying the derivatives on each edge of the path together. For example, to get the derivative of ee with respect to <code>b</code> we get:</p>
<p>$$\frac{\partial e}{\partial b}= 1<em>2 + 1</em>3$$</p>
<p>This accounts for how b affects e through c and also how it affects it through d.</p>
<p>This general ‚Äúsum over paths‚Äù rule is just a different way of thinking about the multivariate chain rule.</p>
<h1 id="Factoring-Paths"><a href="#Factoring-Paths" class="headerlink" title="Factoring Paths"></a>Factoring Paths</h1><p>The problem with just ‚Äúsumming over the paths‚Äù is that it‚Äôs very easy to get a combinatorial explosion in the number of possible paths.</p>
<p><img src="http://colah.github.io/posts/2015-08-Backprop/img/chain-def-greek.png" alt="pic4"></p>
<p>In the above diagram, there are three paths from <code>X</code> to <code>Y</code>, and a further three paths from <code>Y</code> to <code>Z</code>. If we want to get the derivative $\frac{\partial Z}{\partial X}$ by summing over all paths, we need to sum over <code>3‚àó3=9</code> paths:</p>
<p>$$\frac{\partial Z}{\partial X} = \alpha\delta + \alpha\epsilon + \alpha\zeta + \beta\delta + \beta\epsilon + \beta\zeta + \gamma\delta + \gamma\epsilon + \gamma\zeta$$</p>
<p>The above only has nine paths, but it would be easy to have the number of paths to grow exponentially as the graph becomes more complicated.</p>
<p>Instead of just naively summing over the paths, it would be much better to factor them:</p>
<p>$$\frac{\partial Z}{\partial X} = (\alpha + \beta + \gamma)(\delta + \epsilon + \zeta)$$</p>
<p>This is where ‚Äúforward-mode differentiation‚Äù and ‚Äúreverse-mode differentiation‚Äù come in. They‚Äôre algorithms for efficiently computing the sum by factoring the paths. Instead of summing over all of the paths explicitly, they compute the same sum more efficiently by merging paths back together at every node. In fact, both algorithms touch each edge exactly once!</p>
<p>Forward-mode differentiation starts at an input to the graph and moves towards the end. At every node, it sums all the paths feeding in. Each of those paths represents one way in which the input affects that node. By adding them up, we get the total way in which the node is affected by the input, it‚Äôs derivative.</p>
<p><img src="http://colah.github.io/posts/2015-08-Backprop/img/chain-forward-greek.png" alt="pic5"></p>
<p>Though you probably didn‚Äôt think of it in terms of graphs, forward-mode differentiation is very similar to what you implicitly learned to do if you took an introduction to calculus class.</p>
<p>Reverse-mode differentiation, on the other hand, starts at an output of the graph and moves towards the beginning. At each node, it merges all paths which originated at that node.</p>
<p><img src="http://colah.github.io/posts/2015-08-Backprop/img/chain-backward-greek.png" alt="pic6"></p>
<p>Forward-mode differentiation tracks how one input affects every node. Reverse-mode differentiation tracks how every node affects one output. That is, forward-mode differentiation applies the operator $\frac{\partial}{\partial X}$ to every node, while reverse mode differentiation applies the operator $\frac{\partial Z}{\partial}$ to every node</p>
<h1 id="Computational-Victories"><a href="#Computational-Victories" class="headerlink" title="Computational Victories"></a>Computational Victories</h1><p>At this point, you might wonder why anyone would care about reverse-mode differentiation. It looks like a strange way of doing the same thing as the forward-mode. Is there some advantage?</p>
<p>Let‚Äôs consider our original example again:</p>
<p><img src="http://colah.github.io/posts/2015-08-Backprop/img/tree-eval-derivs.png" alt="pic7"></p>
<p>We can use forward-mode differentiation from <code>b</code> up. This gives us the derivative of every node with respect to <code>b</code>.</p>
<p><img src="http://colah.github.io/posts/2015-08-Backprop/img/tree-forwradmode.png" alt="pic8"></p>
<p>We‚Äôve computed $\frac{\partial e}{\partial b}$, the derivative of our output with respect to one of our inputs.</p>
<p>What if we do reverse-mode differentiation from $e$ down? This gives us the derivative of $e$ with respect to every node:</p>
<p><img src="http://colah.github.io/posts/2015-08-Backprop/img/tree-backprop.png" alt="pic9"></p>
<p>When I say that reverse-mode differentiation gives us the derivative of e with respect to every node, I really do mean every node. We get both $\frac{\partial e}{\partial a}$ and $\frac{\partial e}{\partial b}$, the derivatives of $e$ with respect to both inputs. Forward-mode differentiation gave us the derivative of our output with respect to a single input, but reverse-mode differentiation gives us all of them.</p>
<p>For this graph, that‚Äôs only a factor of two speed up, but imagine a function with a million inputs and one output. Forward-mode differentiation would require us to go through the graph a million times to get the derivatives. Reverse-mode differentiation can get them all in one fell swoop! A speed up of a factor of a million is pretty nice!</p>
<p>When training neural networks, we think of the cost (a value describing how bad a neural network performs) as a function of the parameters (numbers describing how the network behaves). We want to calculate the derivatives of the cost with respect to all the parameters, for use in gradient descent. Now, there‚Äôs often millions, or even tens of millions of parameters in a neural network. So, reverse-mode differentiation, called backpropagation in the context of neural networks, gives us a massive speed up!</p>
<p>(Are there any cases where forward-mode differentiation makes more sense? Yes, there are! Where the reverse-mode gives the derivatives of one output with respect to all inputs, the forward-mode gives us the derivatives of all outputs with respect to one input. If one has a function with lots of outputs, forward-mode differentiation can be much, much, much faster.)</p>
<h1 id="Isn‚Äôt-This-Trivial"><a href="#Isn‚Äôt-This-Trivial" class="headerlink" title="Isn‚Äôt This Trivial?"></a>Isn‚Äôt This Trivial?</h1><p>When I first understood what backpropagation was, my reaction was: ‚ÄúOh, that‚Äôs just the chain rule! How did it take us so long to figure out?‚Äù I‚Äôm not the only one who‚Äôs had that reaction. It‚Äôs true that if you ask ‚Äúis there a smart way to calculate derivatives in feedforward neural networks?‚Äù the answer isn‚Äôt that difficult.</p>
<p>But I think it was much more difficult than it might seem. You see, at the time backpropagation was invented, people weren‚Äôt very focused on the feedforward neural networks that we study. It also wasn‚Äôt obvious that derivatives were the right way to train them. Those are only obvious once you realize you can quickly calculate derivatives. There was a circular dependency.</p>
<p>Worse, it would be very easy to write off any piece of the circular dependency as impossible on casual thought. Training neural networks with derivatives? Surely you‚Äôd just get stuck in local minima. And obviously it would be expensive to compute all those derivatives. It‚Äôs only because we know this approach works that we don‚Äôt immediately start listing reasons it‚Äôs likely not to.</p>
<p>That‚Äôs the benefit of hindsight. Once you‚Äôve framed the question, the hardest work is already done.</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Derivatives are cheaper than you think. That‚Äôs the main lesson to take away from this post. In fact, they‚Äôre unintuitively cheap, and us silly humans have had to repeatedly rediscover this fact. That‚Äôs an important thing to understand in deep learning. It‚Äôs also a really useful thing to know in other fields, and only more so if it isn‚Äôt common knowledge.</p>
<p>Are there other lessons? I think there are.</p>
<p>Backpropagation is also a useful lens for understanding how derivatives flow through a model. This can be extremely helpful in reasoning about why some models are difficult to optimize. The classic example of this is the problem of vanishing gradients in recurrent neural networks.</p>
<p>Finally, I claim there is a broad algorithmic lesson to take away from these techniques. Backpropagation and forward-mode differentiation use a powerful pair of tricks (linearization and dynamic programming) to compute derivatives more efficiently than one might think possible. If you really understand these techniques, you can use them to efficiently calculate several other interesting expressions involving derivatives. We‚Äôll explore this in a later blog post.</p>
<p>This post gives a very abstract treatment of backpropagation. I strongly recommend reading Michael Nielsen‚Äôs chapter on it for an excellent discussion, more concretely focused on neural networks.</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="http://colah.github.io/posts/2015-08-Backprop/" target="_blank" rel="noopener">Calculus on Computational Graphs: Backpropagation</a></p>
]]></content>
      <categories>
        <category>Technology</category>
      </categories>
      <tags>
        <tag>machine-learning</tag>
      </tags>
  </entry>
  <entry>
    <title>ÊûÑÂª∫tensorflowÂºÄÂèëÁéØÂ¢É</title>
    <url>/blog/Install-tensorflow-devEnv/</url>
    <content><![CDATA[<p>Á¨îËÄÖ‰ΩøÁî®ÁöÑÊòØwindows 10 Á≥ªÁªü„ÄÇ‰∏ãÈù¢‰ºö‰ΩøÁî®dockerÊù•ÂÆâË£Ö tensorflow„ÄÇ</p>
<h1 id="ÂÆâË£Ö-docker"><a href="#ÂÆâË£Ö-docker" class="headerlink" title="ÂÆâË£Ö docker"></a>ÂÆâË£Ö docker</h1><p>ÂØπ‰∫éwindow‰∏ãdocker ÁöÑÂÆâË£ÖÔºåÁõ¥Êé•ËøõÂÖ•ÂÆòÁΩë <a href="https://www.docker.com/docker-windows" target="_blank" rel="noopener">https://www.docker.com/docker-windows</a> ‰∏ãËΩΩÂÆâË£ÖÂåÖ„ÄÇÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºådocker for windows ÊîØÊåÅÁöÑÊòØ <code>64bit</code> Êìç‰ΩúÁ≥ªÁªü„ÄÇÊâÄ‰ª• <code>32bit</code> ÁöÑÁ≥ªÁªüÁöÑÁéØÂ¢ÉÔºåÊöÇÊó∂ËøôÁßçÊñπÂºèËøò‰∏çÊîØÊåÅ„ÄÇ</p>
<h1 id="ÂÆâË£Ö-tensorflow"><a href="#ÂÆâË£Ö-tensorflow" class="headerlink" title="ÂÆâË£Ö tensorflow"></a>ÂÆâË£Ö tensorflow</h1><p>‰ΩøÁî®ÂëΩ‰ª§</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">run</span> -it -p <span class="number">8888</span>:<span class="number">8888</span> gcr.io/tensorflow/tensorflow</span><br></pre></td></tr></table></figure>
<p>Â∞±‰ºöËá™Âä®‰ªé <a href="http://gcr.io" target="_blank" rel="noopener">http://gcr.io</a> ‰∏äÔºå‰∏ãËΩΩ <code>tensorflow</code> ÁöÑÈïúÂÉèÂπ∂ËøêË°åÔºåÁ≠âÂæÖ‰∏ãËΩΩÂÆâË£ÖÁªìÊùüÔºåÁõ¥Êé•Âú®ÊµèËßàÂô®‰∏≠ËæìÂÖ• <code>localhost:8888</code> ËøõË°åËÆøÈóÆ„ÄÇ<br><img src="/img/post/201704/ff1427c2-3dbf-4f54-84c4-ac5a3a5f823d.png" alt="tensorflow"></p>
<a id="more"></a>
<p>Â∞±‰ºöËøõÂÖ• <a href="https://jupyter.org/" target="_blank" rel="noopener"><code>Jupyter Notebook</code></a> Â∫îÁî®„ÄÇJupter Notebook ÊòØ‰∏Ä‰∏™ÂºÄÊ∫êÁöÑ web Â∫îÁî®ÔºåÊòØ‰∏ÄÊ¨æ‰∫§‰∫íÂºèÁöÑÁ¨îËÆ∞„ÄÇÂÆÉÂèØ‰ª•Âú®Á∫øËøêË°åËæìÂÖ•ÁöÑ‰ª£Á†ÅÔºåÂπ∂ÂÆûÊó∂ÊòæÁ§∫ÁªìÊûú„ÄÇÊâÄ‰ª•Êàë‰ª¨ÂèØ‰ª•Âú® Jupter Notebook ‰∏≠ÔºåÁºñÂÜôÊàë‰ª¨ÁöÑ tensorflow ‰ª£Á†ÅÔºåÂêåÊó∂ÂèØ‰ª•Áõ¥Êé•ÁúãÂà∞‰ª£Á†ÅËøêË°åÁªìÊûú„ÄÇ</p>
<h1 id="‰ª£Á†ÅÁºñÂÜô"><a href="#‰ª£Á†ÅÁºñÂÜô" class="headerlink" title="‰ª£Á†ÅÁºñÂÜô"></a>‰ª£Á†ÅÁºñÂÜô</h1><p>ËøôÈáåÊàë‰ª¨Â∞ùËØï‰øÆÊîπ‰æãÁ®ã <code>1_hello_tensorflow_ipynb</code> ÁöÑ‰ª£Á†ÅÔºåÂπ∂Áî®Âø´Êç∑ÈîÆ <code>ctrl+Enter</code> Êü•Áúã‰ª£Á†ÅËøêË°åÁªìÊûú„ÄÇ<br><img src="/img/post/201704/71d000d8-57c3-4678-866e-ff0d56fda55b.png" alt="Âéü‰ª£Á†Å"></p>
<p>Êàë‰ª¨ËøôÈáåÂ∞ùËØï‰øÆÊîπ <code>input2</code> ÁöÑÂêëÈáè‰∏∫ <code>[2, 2, 4]</code> ÔºåÂπ∂‰ΩøÁî®Âø´Êç∑ÈîÆ <code>ctrl+Enter</code> Êü•Áúã‰∫åËÄÖÁõ∏Âä†ÁöÑÁªìÊûúÔºö<br><img src="/img/post/201704/bc16f459-722e-426e-8aa3-6429e0a369da.png" alt="‰øÆÊîπÂêé"></p>
<p> ÂèØ‰ª•ÁúãÂà∞ <code>input1</code> Âíå <code>input2</code> Áõ∏Âä†ÁöÑÁªìÊûúÂ∑≤ÁªèÂèòÊàê‰∫Ü <code>[3, 3, 3, 5]</code> „ÄÇ</p>
<h1 id="ÂèÇËÄÉ"><a href="#ÂèÇËÄÉ" class="headerlink" title="ÂèÇËÄÉ"></a>ÂèÇËÄÉ</h1><ul>
<li><a href="https://jupyter.org/" target="_blank" rel="noopener">Jupter Notebook</a></li>
<li><a href="http://www.tuicool.com/articles/a6JRr2Y" target="_blank" rel="noopener">Jupyter Notebook Âø´ÈÄüÂÖ•Èó®</a></li>
</ul>
]]></content>
      <categories>
        <category>Technology</category>
      </categories>
      <tags>
        <tag>machine-learning</tag>
        <tag>tensorflow</tag>
      </tags>
  </entry>
  <entry>
    <title>Jekyll‰ΩøÁî®ÊÄªÁªì</title>
    <url>/blog/jekyll-using/</url>
    <content><![CDATA[<h1 id="ÂÖ®Â±ÄÂèòÈáè"><a href="#ÂÖ®Â±ÄÂèòÈáè" class="headerlink" title="ÂÖ®Â±ÄÂèòÈáè"></a>ÂÖ®Â±ÄÂèòÈáè</h1><h2 id="categories"><a href="#categories" class="headerlink" title="categories"></a>categories</h2><p>ÂΩìÊñáÁ´†ËÆæÁΩÆ‰∫Ü categories Â±ûÊÄß‰ª•ÂêéÔºåËÆøÈóÆËØ•ÊñáÁ´†Êó∂ÂÄôÂ∞±‰ºöÂΩíÂÖ•ÂØπÂ∫îÁöÑ url Ë∑ØÂæÑ„ÄÇ<br>ÊØîÂ¶ÇËÆæÁΩÆ‰∫ÜÔºö<code>categories: [&#39;Life&#39;]</code>ÔºåÈÇ£‰πàËÆøÈóÆËØ•ÊñáÁ´†ÁöÑÊó∂ÂÄôÔºåURLË∑ØÂæÑÂ∞±ÊòØ <a href="http://webname/`Life`/" target="_blank" rel="noopener">http://webname/`Life`/</a>‚Ä¶<br>ÊØîÂ¶ÇËÆæÁΩÆ‰∫ÜÔºö<code>categories: [&#39;Life&#39;, &#39;eassy&#39;]</code>ÔºåÈÇ£‰πàËÆøÈóÆËØ•ÊñáÁ´†ÁöÑÊó∂ÂÄôÔºåURLË∑ØÂæÑÂ∞±ÊòØ <a href="http://webname/`Life`/`essay`/" target="_blank" rel="noopener">http://webname/`Life`/`essay`/</a>‚Ä¶<br>Âõ†‰∏∫ <code>ÔΩõ%</code> ‰ºöË¢´ jekyll Ëß£ÊûêÊàêÂÜÖÈÉ®ËØ≠Ê≥ïÔºåÊâÄ‰ª•Áî®‰∏≠ÊñáÂ≠óÁ¨¶ <code>ÔΩõ</code> ÊõøÊç¢‰∫Ü Ëã±ÊñáÂ≠óÁ¨¶ <code>{</code> „ÄÇ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ÔΩõ% for category in site.categories %ÔΩù</span><br><span class="line"></span><br><span class="line">ÔΩõÔΩõ category [0] ÔΩùÔΩù ÊòØ category name</span><br><span class="line">ÔΩõÔΩõ category [1] ÔΩùÔΩù ÂåÖÂê´ category  ‰∏ãÁöÑ posts</span><br><span class="line"></span><br><span class="line">ÔΩõ\% endfor %ÔΩù</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="tags"><a href="#tags" class="headerlink" title="tags"></a>tags</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ÔΩõ\% for tag in site.tags %ÔΩù</span><br><span class="line"></span><br><span class="line">ÔΩõÔΩõ tag[0] ÔΩùÔΩùÊòØ tag name</span><br><span class="line">ÔΩõÔΩõ tag[1] ÔΩùÔΩùÂåÖÂê´ tag ‰∏ãÁöÑ posts</span><br><span class="line"></span><br><span class="line">ÔΩõ% endfor %ÔΩù</span><br></pre></td></tr></table></figure>
<h1 id="ËøáÊª§Âô®‰ΩøÁî®"><a href="#ËøáÊª§Âô®‰ΩøÁî®" class="headerlink" title="ËøáÊª§Âô®‰ΩøÁî®"></a>ËøáÊª§Âô®‰ΩøÁî®</h1><h2 id="ÁîüÊàê‰∫åÁ∫ßÁõÆÂΩï"><a href="#ÁîüÊàê‰∫åÁ∫ßÁõÆÂΩï" class="headerlink" title="ÁîüÊàê‰∫åÁ∫ßÁõÆÂΩï"></a>ÁîüÊàê‰∫åÁ∫ßÁõÆÂΩï</h2><p>categories‰Ωú‰∏∫‰∏ÄÁ∫ßÁõÆÂΩï<br>tags‰Ωú‰∏∫‰∫åÁ∫ßÁõÆÂΩï</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ÔΩõ% for category in site.categories %ÔΩù    </span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">    ÔΩõÔΩõ category[0] ÔΩùÔΩù (ÔΩõÔΩõ category[1].sizeÔΩùÔΩù)</span><br><span class="line">        &lt;li&gt;        </span><br><span class="line">        ÔΩõ% for tag in site.tags %ÔΩù</span><br><span class="line">            ÔΩõ% assign blogPosts = site.posts | where: &apos;categories&apos;,  category[0] | where: &apos;tags&apos;, tag[0]%ÔΩù // ËøôÈáå‰ΩøÁî® where filter Êù•ÊâæÂà∞Â±û‰∫éÂΩìÂâçcategory‰∏ãÁöÑ Â±û‰∫étag[0] ÁöÑÊâÄÊúâÊñáÁ´†„ÄÇ</span><br><span class="line">            ÔΩõ% if blogPosts.size != 0 %ÔΩù</span><br><span class="line">                ÔΩõÔΩõ tag[0] ÔΩùÔΩù ÔΩõÔΩõ blogPosts.sizeÔΩùÔΩù</span><br><span class="line">            ÔΩõ% endif %ÔΩù</span><br><span class="line">        ÔΩõ% endfor %ÔΩù       </span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">ÔΩõ% endfor %ÔΩù</span><br></pre></td></tr></table></figure>
<p>ÊúÄÂêéÁîüÊàêÁöÑÊïàÊûúÂ¶ÇÂõæÔºö</p>
<p><img src="/img/post/20170408/db593a7f-0d24-4e0f-a1ec-58ec7a399ee4.png" alt="ÊïàÊûúÂõæ"></p>
<h1 id="‰∏Ä‰∫õÈóÆÈ¢ò"><a href="#‰∏Ä‰∫õÈóÆÈ¢ò" class="headerlink" title="‰∏Ä‰∫õÈóÆÈ¢ò"></a>‰∏Ä‰∫õÈóÆÈ¢ò</h1><h2 id="jekyll-ÁîüÊàêÊñáÁ´†ËøáÊÖ¢"><a href="#jekyll-ÁîüÊàêÊñáÁ´†ËøáÊÖ¢" class="headerlink" title="jekyll ÁîüÊàêÊñáÁ´†ËøáÊÖ¢"></a>jekyll ÁîüÊàêÊñáÁ´†ËøáÊÖ¢</h2><p>Âú®ÊüêÂ§©ÁöÑÊüêÂàªÔºåÁ™ÅÁÑ∂ÂèëÁé∞ËøõË°å‰∏ÄÊ¨°ÂæÆÂ∞èÁöÑpostÊñáÁ´†‰øÆÊîπÔºåjekyll serve ‚Äìwatch ÂëΩ‰ª§‰∏ãÔºåregeneration ÈúÄË¶ÅËÄóË¥π 20s Â§öÔºå‰ª•ÂæÄÈÉΩÊòØ 1-2s Â∞±ÁªìÊùü‰∫Ü„ÄÇÂèçÂ§çÂÆö‰ΩçÔºåÂèëÁé∞ÊòØÊñáÁ´†ÁöÑ title ‰∏≠ÂÜô‰∫Ü‰∏Ä‰∏™ ‚ÄúC++‚ÄùÔºåËÄåÂ∞ÜÂÖ∂Êîπ‰∏∫ ‚ÄúCpp‚Äù‰ª•ÂêéÂ∞±Â•Ω‰∫Ü„ÄÇËôΩÁÑ∂‰∏çÁü•ÈÅì‰∏∫‰ªÄ‰πàÔºå‰ΩÜÊòØÈóÆÈ¢òËøòÊòØËß£ÂÜ≥‰∫Ü„ÄÇÁåúÊµã‰πüËÆ∏ÊòØÂõ†‰∏∫ <code>+</code> Ë¢´jekyll Ëß£ÊûêÊó∂ÂÄôÂá∫‰∫ÜÈóÆÈ¢ò„ÄÇ</p>
<h1 id="ÂèÇËÄÉ"><a href="#ÂèÇËÄÉ" class="headerlink" title="ÂèÇËÄÉ"></a>ÂèÇËÄÉ</h1><p><a href="http://stackoverflow.com/questions/27583597/categories-in-jekyll" target="_blank" rel="noopener">Categories in Jekyll</a></p>
]]></content>
      <categories>
        <category>Technology</category>
      </categories>
      <tags>
        <tag>ÂâçÁ´ØÂºÄÂèë</tag>
        <tag>Êü•ÈòÖ</tag>
      </tags>
  </entry>
  <entry>
    <title>Google Cpp Style Guide - Naming</title>
    <url>/blog/Google-Cpp-Style-Guide-Naming/</url>
    <content><![CDATA[<h1 id="ÈÄöÁî®ÂëΩÂêçËßÑÂàô"><a href="#ÈÄöÁî®ÂëΩÂêçËßÑÂàô" class="headerlink" title="ÈÄöÁî®ÂëΩÂêçËßÑÂàô"></a>ÈÄöÁî®ÂëΩÂêçËßÑÂàô</h1><p>ÂáΩÊï∞ÂëΩÂêçÔºåÂèòÈáèÂëΩÂêçÔºåÊñá‰ª∂ÂëΩÂêçË¶ÅÊúâÊèèËø∞ÊÄßÔºõÂ∞ëÁî®Áº©ÂÜô„ÄÇ</p>
<p>Â∞ΩÂèØËÉΩÁªôÊúâÊèèËø∞ÊÄßÁöÑÂëΩÂêçÔºåÂà´ÂøÉÁñºÁ©∫Èó¥ÔºåÊØïÁ´üËÆ©‰ª£Á†ÅÊòì‰∫éÊñ∞ËØªËÄÖÁêÜËß£ÂæàÈáçË¶Å„ÄÇ‰∏çË¶ÅÁî®Âè™ÊúâÈ°πÁõÆÂºÄÂèëËÄÖËÉΩÁêÜËß£ÁöÑÁº©ÂÜôÔºå‰πü‰∏çË¶ÅÈÄöËøáÁ†çÊéâÂá†‰∏™Â≠óÊØçÊù•Áº©ÂÜôÂçïËØç</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> price_count_reader;  <span class="comment">// Êó†Áº©ÂÜô</span></span><br><span class="line"><span class="keyword">int</span> num_errors;  <span class="comment">// ‚Äúnum‚Äù Êú¨Êù•Â∞±ÂæàÂ∏∏ËßÅ</span></span><br><span class="line"><span class="keyword">int</span> num_dns_connections; <span class="comment">// ‰∫∫‰∫∫ÈÉΩÁü•ÈÅì ‚ÄúDNS‚Äù ÊòØÂï•</span></span><br></pre></td></tr></table></figure>
<p><code>‰∏çË¶ÅÂÉè‰∏ãÈù¢ËøôÊ†∑ÂÜôÔºö</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> n;                     <span class="comment">// Ëé´ÂêçÂÖ∂Â¶ô„ÄÇ</span></span><br><span class="line"><span class="keyword">int</span> nerr;                  <span class="comment">// ÊÄ™Áº©ÂÜô„ÄÇ</span></span><br><span class="line"><span class="keyword">int</span> n_comp_conns;          <span class="comment">// ÊÄ™Áº©ÂÜô„ÄÇ</span></span><br><span class="line"><span class="keyword">int</span> wgc_connections;       <span class="comment">// Âè™ÊúâË¥µÂõ¢ÈòüÁü•ÈÅìÊòØÂï•ÊÑèÊÄù„ÄÇ</span></span><br><span class="line"><span class="keyword">int</span> pc_reader;             <span class="comment">// "pc" ÊúâÂ§™Â§öÂèØËÉΩÁöÑËß£Èáä‰∫Ü„ÄÇ</span></span><br><span class="line"><span class="keyword">int</span> cstmr_id;              <span class="comment">// ÊúâÂà†ÂáèËã•Âπ≤Â≠óÊØç„ÄÇ</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h1 id="Êñá‰ª∂ÂëΩÂêç"><a href="#Êñá‰ª∂ÂëΩÂêç" class="headerlink" title="Êñá‰ª∂ÂëΩÂêç"></a>Êñá‰ª∂ÂëΩÂêç</h1><p>Êñá‰ª∂ÂêçË¶ÅÂÖ®ÈÉ®Â∞èÂÜô, ÂèØ‰ª•ÂåÖÂê´‰∏ãÂàíÁ∫ø (<code>_</code>) ÊàñËøûÂ≠óÁ¨¶ (<code>-</code>). ÊåâÈ°πÁõÆÁ∫¶ÂÆöÊù•. Â¶ÇÊûúÂπ∂Ê≤°ÊúâÈ°πÁõÆÁ∫¶ÂÆöÔºå‚Äù_‚Äù Êõ¥Â•Ω„ÄÇ</p>
<p>ÂèØÊé•ÂèóÁöÑÊñá‰ª∂ÂëΩÂêç:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">* my_useful_class.cc</span><br><span class="line">* my-useful-class.cc</span><br><span class="line">* myusefulclass.cc</span><br><span class="line">* muusefulclass_test.cc // ``_unittest`` Âíå ``_regtest`` Â∑≤ÂºÉÁî®„ÄÇ</span><br></pre></td></tr></table></figure>

<p>C++ Êñá‰ª∂Ë¶Å‰ª• <code>.cc</code> ÁªìÂ∞æ, Â§¥Êñá‰ª∂‰ª• <code>.h</code> ÁªìÂ∞æ. ‰∏ìÈó®ÊèíÂÖ•ÊñáÊú¨ÁöÑÊñá‰ª∂Âàô‰ª• <code>.inc</code> ÁªìÂ∞æÔºåÂèÇËßÅ <code>1.1. Self-contained</code> Â§¥Êñá‰ª∂„ÄÇ</p>
<p>‰∏çË¶Å‰ΩøÁî®Â∑≤ÁªèÂ≠òÂú®‰∫é <code>/usr/include</code> ‰∏ãÁöÑÊñá‰ª∂Âêç (Yang.Y Ê≥®: Âç≥ÁºñËØëÂô®ÊêúÁ¥¢Á≥ªÁªüÂ§¥Êñá‰ª∂ÁöÑË∑ØÂæÑ), Â¶Ç <code>db.h</code>.</p>
<p>ÈÄöÂ∏∏Â∫îÂ∞ΩÈáèËÆ©Êñá‰ª∂ÂêçÊõ¥Âä†ÊòéÁ°Æ. <code>http_server_logs.h</code> Â∞±ÊØî <code>logs.h</code> Ë¶ÅÂ•Ω. ÂÆö‰πâÁ±ªÊó∂Êñá‰ª∂Âêç‰∏ÄËà¨ÊàêÂØπÂá∫Áé∞, Â¶Ç <code>foo_bar.h</code> Âíå <code>foo_bar.cc</code>, ÂØπÂ∫î‰∫éÁ±ª <code>FooBar</code>.</p>
<p>ÂÜÖËÅîÂáΩÊï∞ÂøÖÈ°ªÊîæÂú® <code>.h</code> Êñá‰ª∂‰∏≠. Â¶ÇÊûúÂÜÖËÅîÂáΩÊï∞ÊØîËæÉÁü≠, Â∞±Áõ¥Êé•ÊîæÂú® <code>.h</code> ‰∏≠.</p>
<h1 id="Á±ªÂûãÂëΩÂêç"><a href="#Á±ªÂûãÂëΩÂêç" class="headerlink" title="Á±ªÂûãÂëΩÂêç"></a>Á±ªÂûãÂëΩÂêç</h1><p>Á±ªÂûãÂêçÁß∞ÁöÑÊØè‰∏™ÂçïËØçÈ¶ñÂ≠óÊØçÂùáÂ§ßÂÜô, ‰∏çÂåÖÂê´‰∏ãÂàíÁ∫ø: <code>MyExcitingClass</code>, <code>MyExcitingEnum</code>.</p>
<p>ÊâÄÊúâÁ±ªÂûãÂëΩÂêç ‚Äî‚Äî Á±ª, ÁªìÊûÑ‰Ωì, Á±ªÂûãÂÆö‰πâ (<code>typedef</code>), Êûö‰∏æ ‚Äî‚Äî Âùá‰ΩøÁî®Áõ∏ÂêåÁ∫¶ÂÆö. ‰æãÂ¶Ç:</p>
<h1 id="ÂèòÈáèÂëΩÂêç"><a href="#ÂèòÈáèÂëΩÂêç" class="headerlink" title="ÂèòÈáèÂëΩÂêç"></a>ÂèòÈáèÂëΩÂêç</h1><p>ÂèòÈáèÂêç‰∏ÄÂæãÂ∞èÂÜô, ÂçïËØç‰πãÈó¥Áî®‰∏ãÂàíÁ∫øËøûÊé•. Á±ªÁöÑÊàêÂëòÂèòÈáè‰ª•‰∏ãÂàíÁ∫øÁªìÂ∞æ, ‰ΩÜÁªìÊûÑ‰ΩìÁöÑÂ∞±‰∏çÁî®ÔºåÂ¶Ç:: <code>a_local_variable</code>, <code>a_struct_data_member</code>, <code>a_class_data_member_</code>.</p>
<p><strong>ÊôÆÈÄöÂèòÈáèÂëΩÂêç:</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">string</span> table_name;  <span class="comment">// ÂèØ - Áî®‰∏ãÂàíÁ∫ø„ÄÇ</span></span><br><span class="line"><span class="built_in">string</span> tablename;   <span class="comment">// ÂèØ - ÂÖ®Â∞èÂÜô„ÄÇ</span></span><br></pre></td></tr></table></figure>
<p><code>‰ΩÜÊòØ‰∏çË¶ÅËøôÊ†∑ÂÜôÔºö</code></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">string</span> tableName;   <span class="comment">// Â∑Æ - Ê∑∑ÂêàÂ§ßÂ∞èÂÜô„ÄÇ</span></span><br></pre></td></tr></table></figure>

<p><strong>Á±ªÊï∞ÊçÆÊàêÂëòÔºö</strong></p>
<p>‰∏çÁÆ°ÊòØÈùôÊÄÅÁöÑËøòÊòØÈùûÈùôÊÄÅÁöÑÔºåÁ±ªÊï∞ÊçÆÊàêÂëòÈÉΩÂèØ‰ª•ÂíåÊôÆÈÄöÂèòÈáè‰∏ÄÊ†∑, ‰ΩÜË¶ÅÊé•‰∏ãÂàíÁ∫ø„ÄÇ</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TableInfo</span> &#123;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  <span class="built_in">string</span> table_name_;  <span class="comment">// ÂèØ - Â∞æÂêéÂä†‰∏ãÂàíÁ∫ø„ÄÇ</span></span><br><span class="line">  <span class="built_in">string</span> tablename_;   <span class="comment">// ÂèØ„ÄÇ</span></span><br><span class="line">  <span class="keyword">static</span> Pool&lt;TableInfo&gt;* pool_;  <span class="comment">// ÂèØ„ÄÇ</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>ÁªìÊûÑ‰ΩìÂèòÈáè:</strong><br>‰∏çÁÆ°ÊòØÈùôÊÄÅÁöÑËøòÊòØÈùûÈùôÊÄÅÁöÑÔºåÁªìÊûÑ‰ΩìÊï∞ÊçÆÊàêÂëòÈÉΩÂèØ‰ª•ÂíåÊôÆÈÄöÂèòÈáè‰∏ÄÊ†∑, ‰∏çÁî®ÂÉèÁ±ªÈÇ£Ê†∑Êé•‰∏ãÂàíÁ∫ø:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">UrlTableProperties</span> &#123;</span></span><br><span class="line">    <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">int</span> num_entries;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ÁªìÊûÑ‰Ωì‰∏éÁ±ªÁöÑËÆ®ËÆ∫ÂèÇËÄÉ <code>ÁªìÊûÑ‰Ωì vs. Á±ª</code> ‰∏ÄËäÇ.</p>
<p><strong>ÂÖ®Â±ÄÂèòÈáè:</strong></p>
<p>ÂØπÂÖ®Â±ÄÂèòÈáèÊ≤°ÊúâÁâπÂà´Ë¶ÅÊ±Ç, Â∞ëÁî®Â∞±Â•Ω, ‰ΩÜÂ¶ÇÊûú‰Ω†Ë¶ÅÁî®, ÂèØ‰ª•Áî® <code>g_</code> ÊàñÂÖ∂ÂÆÉÊ†áÂøó‰Ωú‰∏∫ÂâçÁºÄ, ‰ª•‰æøÊõ¥Â•ΩÁöÑÂå∫ÂàÜÂ±ÄÈÉ®ÂèòÈáè.</p>
<h1 id="Â∏∏ÈáèÂëΩÂêç"><a href="#Â∏∏ÈáèÂëΩÂêç" class="headerlink" title="Â∏∏ÈáèÂëΩÂêç"></a>Â∏∏ÈáèÂëΩÂêç</h1><p>Âú®ÂÖ®Â±ÄÊàñÁ±ªÈáåÁöÑÂ∏∏ÈáèÂêçÁß∞ÂâçÂä† <code>k</code>: kDaysInAWeek. ‰∏îÈô§ÂéªÂºÄÂ§¥ÁöÑ <code>k</code> ‰πãÂ§ñÊØè‰∏™ÂçïËØçÂºÄÂ§¥Â≠óÊØçÂùáÂ§ßÂÜô„ÄÇ</p>
<p>ÊâÄÊúâÁºñËØëÊó∂Â∏∏Èáè, Êó†ËÆ∫ÊòØÂ±ÄÈÉ®ÁöÑ, ÂÖ®Â±ÄÁöÑËøòÊòØÁ±ª‰∏≠ÁöÑ, ÂíåÂÖ∂‰ªñÂèòÈáèÁ®çÂæÆÂå∫Âà´‰∏Ä‰∏ã. <code>k</code> ÂêéÊé•Â§ßÂÜôÂ≠óÊØçÂºÄÂ§¥ÁöÑÂçïËØç:</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> kDaysInAWeek = <span class="number">7</span>;</span><br></pre></td></tr></table></figure>

<p>ËøôËßÑÂàôÈÄÇÁî®‰∫éÁºñËØëÊó∂ÁöÑÂ±ÄÈÉ®‰ΩúÁî®ÂüüÂ∏∏ÈáèÔºå‰∏çËøáË¶ÅÊåâÂèòÈáèËßÑÂàôÊù•ÂëΩÂêç‰πüÂèØ‰ª•„ÄÇ</p>
<h1 id="ÂáΩÊï∞ÂëΩÂêç"><a href="#ÂáΩÊï∞ÂëΩÂêç" class="headerlink" title="ÂáΩÊï∞ÂëΩÂêç"></a>ÂáΩÊï∞ÂëΩÂêç</h1><p>Â∏∏ËßÑÂáΩÊï∞‰ΩøÁî®Â§ßÂ∞èÂÜôÊ∑∑Âêà, ÂèñÂÄºÂíåËÆæÂÄºÂáΩÊï∞ÂàôË¶ÅÊ±Ç‰∏éÂèòÈáèÂêçÂåπÈÖç: <code>MyExcitingFunction()</code>, <code>MyExcitingMethod()</code>, <code>my_exciting_member_variable()</code>, <code>set_my_exciting_member_variable()</code>.</p>
<p><strong>Â∏∏ËßÑÂáΩÊï∞:</strong></p>
<p>ÂáΩÊï∞ÂêçÁöÑÊØè‰∏™ÂçïËØçÈ¶ñÂ≠óÊØçÂ§ßÂÜô, Ê≤°Êúâ‰∏ãÂàíÁ∫ø„ÄÇ</p>
<p>Â¶ÇÊûúÊÇ®ÁöÑÊüêÂáΩÊï∞Âá∫ÈîôÊó∂Â∞±Ë¶ÅÁõ¥Êé• crash, ÈÇ£‰πàÂ∞±Âú®ÂáΩÊï∞ÂêçÂä†‰∏ä OrDie. ‰ΩÜËøôÂáΩÊï∞Êú¨Ë∫´ÂøÖÈ°ªÈõÜÊàêÂú®‰∫ßÂìÅ‰ª£Á†ÅÈáåÔºå‰∏îÂπ≥Êó∂‰πüÂèØËÉΩ‰ºöÂá∫Èîô„ÄÇ</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">AddTableEntry()</span><br><span class="line">DeleteUrl()</span><br><span class="line">OpenFileOrDie()</span><br></pre></td></tr></table></figure>

<p><strong>ÂèñÂÄºÂíåËÆæÂÄºÂáΩÊï∞:</strong></p>
<p>ÂèñÂÄºÔºàAccessorsÔºâÂíåËÆæÂÄºÔºàMutatorsÔºâÂáΩÊï∞Ë¶Å‰∏éÂ≠òÂèñÁöÑÂèòÈáèÂêçÂåπÈÖç. ËøôÂÑøÊëòÂΩï‰∏Ä‰∏™Á±ª, <code>num_entries_</code> ÊòØËØ•Á±ªÁöÑÂÆû‰æãÂèòÈáè:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        ...</span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">num_entries</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> num_entries_; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">set_num_entries</span><span class="params">(<span class="keyword">int</span> num_entries)</span> </span>&#123; num_entries_ = num_entries; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="keyword">int</span> num_entries_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ÂÖ∂ÂÆÉÈùûÂ∏∏Áü≠Â∞èÁöÑÂÜÖËÅîÂáΩÊï∞Âêç‰πüÂèØ‰ª•Áî®Â∞èÂÜôÂ≠óÊØç, ‰æãÂ¶Ç. Â¶ÇÊûú‰Ω†Âú®Âæ™ÁéØ‰∏≠Ë∞ÉÁî®ËøôÊ†∑ÁöÑÂáΩÊï∞ÁîöËá≥ÈÉΩ‰∏çÁî®ÁºìÂ≠òÂÖ∂ËøîÂõûÂÄº, Â∞èÂÜôÂëΩÂêçÂ∞±ÂèØ‰ª•Êé•Âèó.</p>
<h1 id="ÂêçÂ≠óÁ©∫Èó¥ÂëΩÂêç"><a href="#ÂêçÂ≠óÁ©∫Èó¥ÂëΩÂêç" class="headerlink" title="ÂêçÂ≠óÁ©∫Èó¥ÂëΩÂêç"></a>ÂêçÂ≠óÁ©∫Èó¥ÂëΩÂêç</h1><p>ÂêçÂ≠óÁ©∫Èó¥Áî®Â∞èÂÜôÂ≠óÊØçÂëΩÂêç, Âπ∂Âü∫‰∫éÈ°πÁõÆÂêçÁß∞ÂíåÁõÆÂΩïÁªìÊûÑ: <code>google_awesome_project</code>.</p>
<p>ÂÖ≥‰∫éÂêçÂ≠óÁ©∫Èó¥ÁöÑËÆ®ËÆ∫ÂíåÂ¶Ç‰ΩïÂëΩÂêç, ÂèÇËÄÉ <code>ÂêçÂ≠óÁ©∫Èó¥</code> ‰∏ÄËäÇ.</p>
<h1 id="Êûö‰∏æÂëΩÂêç"><a href="#Êûö‰∏æÂëΩÂêç" class="headerlink" title="Êûö‰∏æÂëΩÂêç"></a>Êûö‰∏æÂëΩÂêç</h1><p>Êûö‰∏æÁöÑÂëΩÂêçÂ∫îÂΩìÂíå Â∏∏Èáè Êàñ ÂÆè ‰∏ÄËá¥: <code>kEnumName</code> ÊàñÊòØ <code>ENUM_NAME</code>.</p>
<p>ÂçïÁã¨ÁöÑÊûö‰∏æÂÄºÂ∫îËØ•‰ºòÂÖàÈááÁî® Â∏∏Èáè ÁöÑÂëΩÂêçÊñπÂºè. ‰ΩÜ ÂÆè ÊñπÂºèÁöÑÂëΩÂêç‰πüÂèØ‰ª•Êé•Âèó. Êûö‰∏æÂêç <code>UrlTableErrors</code> (‰ª•Âèä <code>AlternateUrlTableErrors</code>) ÊòØÁ±ªÂûã, ÊâÄ‰ª•Ë¶ÅÁî®Â§ßÂ∞èÂÜôÊ∑∑ÂêàÁöÑÊñπÂºè.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> UrlTableErrors &#123;</span><br><span class="line">    kOK = <span class="number">0</span>,</span><br><span class="line">    kErrorOutOfMemory,</span><br><span class="line">    kErrorMalformedInput,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">enum</span> AlternateUrlTableErrors &#123;</span><br><span class="line">    OK = <span class="number">0</span>,</span><br><span class="line">    OUT_OF_MEMORY = <span class="number">1</span>,</span><br><span class="line">    MALFORMED_INPUT = <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>2009 Âπ¥ 1 Êúà‰πãÂâç, Êàë‰ª¨‰∏ÄÁõ¥Âª∫ËÆÆÈááÁî® ÂÆè ÁöÑÊñπÂºèÂëΩÂêçÊûö‰∏æÂÄº. Áî±‰∫éÊûö‰∏æÂÄºÂíåÂÆè‰πãÈó¥ÁöÑÂëΩÂêçÂÜ≤Á™Å, Áõ¥Êé•ÂØºËá¥‰∫ÜÂæàÂ§öÈóÆÈ¢ò. Áî±Ê≠§, ËøôÈáåÊîπ‰∏∫‰ºòÂÖàÈÄâÊã©Â∏∏ÈáèÈ£éÊ†ºÁöÑÂëΩÂêçÊñπÂºè. Êñ∞‰ª£Á†ÅÂ∫îËØ•Â∞ΩÂèØËÉΩ‰ºòÂÖà‰ΩøÁî®Â∏∏ÈáèÈ£éÊ†º. ‰ΩÜÊòØËÄÅ‰ª£Á†ÅÊ≤°ÂøÖË¶ÅÂàáÊç¢Âà∞Â∏∏ÈáèÈ£éÊ†º, Èô§ÈùûÂÆèÈ£éÊ†ºÁ°ÆÂÆû‰ºö‰∫ßÁîüÁºñËØëÊúüÈóÆÈ¢ò.</p>
<h1 id="ÂÆèÂëΩÂêç"><a href="#ÂÆèÂëΩÂêç" class="headerlink" title="ÂÆèÂëΩÂêç"></a>ÂÆèÂëΩÂêç</h1><p>‰Ω†Âπ∂‰∏çÊâìÁÆó ‰ΩøÁî®ÂÆè, ÂØπÂêß? Â¶ÇÊûú‰Ω†‰∏ÄÂÆöË¶ÅÁî®, ÂÉèËøôÊ†∑ÂëΩÂêç: <code>MY_MACRO_THAT_SCARES_SMALL_CHILDREN</code>.</p>
<p>ÂèÇËÄÉ È¢ÑÂ§ÑÁêÜÂÆè; ÈÄöÂ∏∏ ‰∏çÂ∫îËØ• ‰ΩøÁî®ÂÆè. Â¶ÇÊûú‰∏çÂæó‰∏çÁî®, ÂÖ∂ÂëΩÂêçÂÉèÊûö‰∏æÂëΩÂêç‰∏ÄÊ†∑ÂÖ®ÈÉ®Â§ßÂÜô, ‰ΩøÁî®‰∏ãÂàíÁ∫ø:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#define ROUND(x) ...</span><br><span class="line">#define PI_ROUNDED 3.0</span><br></pre></td></tr></table></figure>

<h1 id="ÂèÇËÄÉ"><a href="#ÂèÇËÄÉ" class="headerlink" title="ÂèÇËÄÉ"></a>ÂèÇËÄÉ</h1><ul>
<li>BannerÂõæËΩ¨Ëá™<a href="http://blog.csdn.net/voidccc/article/details/37599203" target="_blank" rel="noopener">‰∏ÄÂº†ÂõæÊÄªÁªìGoogle C++ÁºñÁ®ãËßÑËåÉ</a></li>
<li>ËΩ¨ËΩΩËá™<a href="http://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/naming/" target="_blank" rel="noopener">GoogleÂºÄÊ∫êÈ£éÊ†ºÈ°πÁõÆÊåáÂçó</a></li>
<li>Ëã±ÊñáÂéüÊñá:<a href="https://google.github.io/styleguide/cppguide.html#Naming" target="_blank" rel="noopener">Google C++ Style Guide</a></li>
</ul>
]]></content>
      <categories>
        <category>Technology</category>
      </categories>
      <tags>
        <tag>Cpp</tag>
        <tag>Êü•ÈòÖ</tag>
      </tags>
  </entry>
  <entry>
    <title>MarkdownÂü∫Êú¨ËØ≠Ê≥ï</title>
    <url>/blog/markdown-syntax/</url>
    <content><![CDATA[<h1 id="Ê¶ÇËø∞"><a href="#Ê¶ÇËø∞" class="headerlink" title="Ê¶ÇËø∞"></a>Ê¶ÇËø∞</h1><p>ËΩ¨ËΩΩ‰∫é: <a href="https://github.com/riku/Markdown-Syntax-CN/blob/master/syntax.md#precode" target="_blank" rel="noopener">Markdown ËØ≠Ê≥ïËØ¥Êòé (ÁÆÄ‰Ωì‰∏≠ÊñáÁâà)</a></p>
<h2 id="ÂÆóÊó®"><a href="#ÂÆóÊó®" class="headerlink" title="ÂÆóÊó®"></a>ÂÆóÊó®</h2><p>Markdown ÁöÑÁõÆÊ†áÊòØÂÆûÁé∞„ÄåÊòìËØªÊòìÂÜô„Äç„ÄÇ</p>
<p>ÂèØËØªÊÄßÔºåÊó†ËÆ∫Â¶Ç‰ΩïÔºåÈÉΩÊòØÊúÄÈáçË¶ÅÁöÑ„ÄÇ‰∏Ä‰ªΩ‰ΩøÁî® Markdown Ê†ºÂºèÊí∞ÂÜôÁöÑÊñá‰ª∂Â∫îËØ•ÂèØ‰ª•Áõ¥Êé•‰ª•Á∫ØÊñáÊú¨ÂèëÂ∏ÉÔºåÂπ∂‰∏îÁúãËµ∑Êù•‰∏ç‰ºöÂÉèÊòØÁî±ËÆ∏Â§öÊ†áÁ≠æÊàñÊòØÊ†ºÂºèÊåá‰ª§ÊâÄÊûÑÊàê„ÄÇMarkdown ËØ≠Ê≥ïÂèóÂà∞‰∏Ä‰∫õÊó¢Êúâ text-to-HTML Ê†ºÂºèÁöÑÂΩ±ÂìçÔºåÂåÖÊã¨ [Setext] <a href="http://docutils.sourceforge.net/mirror/setext.html" target="_blank" rel="noopener">1</a>„ÄÅ[atx] <a href="http://www.aaronsw.com/2002/atx/" target="_blank" rel="noopener">2</a>„ÄÅ[Textile] <a href="http://textism.com/tools/textile/" target="_blank" rel="noopener">3</a>„ÄÅ[reStructuredText] <a href="http://docutils.sourceforge.net/rst.html" target="_blank" rel="noopener">4</a>„ÄÅ[Grutatext] <a href="http://www.triptico.com/software/grutatxt.html" target="_blank" rel="noopener">5</a> Âíå [EtText] <a href="http://ettext.taint.org/doc/" target="_blank" rel="noopener">6</a>ÔºåËÄåÊúÄÂ§ßÁÅµÊÑüÊù•Ê∫êÂÖ∂ÂÆûÊòØÁ∫ØÊñáÊú¨ÁîµÂ≠êÈÇÆ‰ª∂ÁöÑÊ†ºÂºè„ÄÇ</p>
<a id="more"></a>
<p>ÊÄª‰πãÔºå Markdown ÁöÑËØ≠Ê≥ïÂÖ®Áî±‰∏Ä‰∫õÁ¨¶Âè∑ÊâÄÁªÑÊàêÔºåËøô‰∫õÁ¨¶Âè∑ÁªèËøáÁ≤æÊåëÁªÜÈÄâÔºåÂÖ∂‰ΩúÁî®‰∏ÄÁõÆ‰∫ÜÁÑ∂„ÄÇÊØîÂ¶ÇÔºöÂú®ÊñáÂ≠ó‰∏§ÊóÅÂä†‰∏äÊòüÂè∑ÔºåÁúãËµ∑Êù•Â∞±ÂÉè*Âº∫Ë∞É*„ÄÇMarkdown ÁöÑÂàóË°®ÁúãËµ∑Êù•ÔºåÂóØÔºåÂ∞±ÊòØÂàóË°®„ÄÇMarkdown ÁöÑÂå∫ÂùóÂºïÁî®ÁúãËµ∑Êù•Â∞±ÁúüÁöÑÂÉèÊòØÂºïÁî®‰∏ÄÊÆµÊñáÂ≠óÔºåÂ∞±ÂÉè‰Ω†ÊõæÂú®ÁîµÂ≠êÈÇÆ‰ª∂‰∏≠ËßÅËøáÁöÑÈÇ£Ê†∑„ÄÇ</p>
<h2 id="ÂÖºÂÆπ-HTML"><a href="#ÂÖºÂÆπ-HTML" class="headerlink" title="ÂÖºÂÆπ HTML"></a>ÂÖºÂÆπ HTML</h2><p>Markdown ËØ≠Ê≥ïÁöÑÁõÆÊ†áÊòØÔºöÊàê‰∏∫‰∏ÄÁßçÈÄÇÁî®‰∫éÁΩëÁªúÁöÑ<em>‰π¶ÂÜô</em>ËØ≠Ë®Ä„ÄÇ</p>
<p>Markdown ‰∏çÊòØÊÉ≥Ë¶ÅÂèñ‰ª£ HTMLÔºåÁîöËá≥‰πüÊ≤°ÊúâË¶ÅÂíåÂÆÉÁõ∏ËøëÔºåÂÆÉÁöÑËØ≠Ê≥ïÁßçÁ±ªÂæàÂ∞ëÔºåÂè™ÂØπÂ∫î HTML Ê†áËÆ∞ÁöÑ‰∏ÄÂ∞èÈÉ®ÂàÜ„ÄÇMarkdown ÁöÑÊûÑÊÉ≥<em>‰∏çÊòØ</em>Ë¶Å‰ΩøÂæó HTML ÊñáÊ°£Êõ¥ÂÆπÊòì‰π¶ÂÜô„ÄÇÂú®ÊàëÁúãÊù•Ôºå HTML Â∑≤ÁªèÂæàÂÆπÊòìÂÜô‰∫Ü„ÄÇMarkdown ÁöÑÁêÜÂøµÊòØÔºåËÉΩËÆ©ÊñáÊ°£Êõ¥ÂÆπÊòìËØª„ÄÅÂÜôÂíåÈöèÊÑèÊîπ„ÄÇHTML ÊòØ‰∏ÄÁßç<em>ÂèëÂ∏É</em>ÁöÑÊ†ºÂºèÔºåMarkdown ÊòØ‰∏ÄÁßç<em>‰π¶ÂÜô</em>ÁöÑÊ†ºÂºè„ÄÇÂ∞±ËøôÊ†∑ÔºåMarkdown ÁöÑÊ†ºÂºèËØ≠Ê≥ïÂè™Ê∂µÁõñÁ∫ØÊñáÊú¨ÂèØ‰ª•Ê∂µÁõñÁöÑËåÉÂõ¥„ÄÇ</p>
<p>‰∏çÂú® Markdown Ê∂µÁõñËåÉÂõ¥‰πãÂÜÖÁöÑÊ†áÁ≠æÔºåÈÉΩÂèØ‰ª•Áõ¥Êé•Âú®ÊñáÊ°£ÈáåÈù¢Áî® HTML Êí∞ÂÜô„ÄÇ‰∏çÈúÄË¶ÅÈ¢ùÂ§ñÊ†áÊ≥®ËøôÊòØ HTML ÊàñÊòØ MarkdownÔºõÂè™Ë¶ÅÁõ¥Êé•Âä†Ê†áÁ≠æÂ∞±ÂèØ‰ª•‰∫Ü„ÄÇ</p>
<p>Ë¶ÅÂà∂Á∫¶ÁöÑÂè™Êúâ‰∏Ä‰∫õ HTML Âå∫ÂùóÂÖÉÁ¥†‚Äï‚ÄïÊØîÂ¶Ç <code>&lt;div&gt;</code>„ÄÅ<code>&lt;table&gt;</code>„ÄÅ<code>&lt;pre&gt;</code>„ÄÅ<code>&lt;p&gt;</code> Á≠âÊ†áÁ≠æÔºåÂøÖÈ°ªÂú®ÂâçÂêéÂä†‰∏äÁ©∫Ë°å‰∏éÂÖ∂ÂÆÉÂÜÖÂÆπÂå∫ÈöîÂºÄÔºåËøòË¶ÅÊ±ÇÂÆÉ‰ª¨ÁöÑÂºÄÂßãÊ†áÁ≠æ‰∏éÁªìÂ∞æÊ†áÁ≠æ‰∏çËÉΩÁî®Âà∂Ë°®Á¨¶ÊàñÁ©∫Ê†ºÊù•Áº©Ëøõ„ÄÇMarkdown ÁöÑÁîüÊàêÂô®ÊúâË∂≥Â§üÊô∫ËÉΩÔºå‰∏ç‰ºöÂú® HTML Âå∫ÂùóÊ†áÁ≠æÂ§ñÂä†‰∏ä‰∏çÂøÖË¶ÅÁöÑ <code>&lt;p&gt;</code> Ê†áÁ≠æ„ÄÇ</p>
<p>‰æãÂ≠êÂ¶Ç‰∏ãÔºåÂú® Markdown Êñá‰ª∂ÈáåÂä†‰∏ä‰∏ÄÊÆµ HTML Ë°®Ê†ºÔºö</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">ËøôÊòØ‰∏Ä‰∏™ÊôÆÈÄöÊÆµËêΩ„ÄÇ</span><br><span class="line"></span><br><span class="line">&lt;table&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;Foo&lt;<span class="regexp">/td&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>tr&gt;</span><br><span class="line">&lt;<span class="regexp">/table&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">ËøôÊòØÂè¶‰∏Ä‰∏™ÊôÆÈÄöÊÆµËêΩ„ÄÇ</span></span><br></pre></td></tr></table></figure>
<p>ËØ∑Ê≥®ÊÑèÔºåÂú® HTML Âå∫ÂùóÊ†áÁ≠æÈó¥ÁöÑ Markdown Ê†ºÂºèËØ≠Ê≥ïÂ∞Ü‰∏ç‰ºöË¢´Â§ÑÁêÜ„ÄÇÊØîÂ¶ÇÔºå‰Ω†Âú® HTML Âå∫ÂùóÂÜÖ‰ΩøÁî® Markdown Ê†∑ÂºèÁöÑ<code>*Âº∫Ë∞É*</code>‰ºöÊ≤°ÊúâÊïàÊûú„ÄÇ</p>
<p>HTML ÁöÑÂå∫ÊÆµÔºàË°åÂÜÖÔºâÊ†áÁ≠æÂ¶Ç <code>&lt;span&gt;</code>„ÄÅ<code>&lt;cite&gt;</code>„ÄÅ<code>&lt;del&gt;</code> ÂèØ‰ª•Âú® Markdown ÁöÑÊÆµËêΩ„ÄÅÂàóË°®ÊàñÊòØÊ†áÈ¢òÈáåÈöèÊÑè‰ΩøÁî®„ÄÇ‰æùÁÖß‰∏™‰∫∫‰π†ÊÉØÔºåÁîöËá≥ÂèØ‰ª•‰∏çÁî® Markdown Ê†ºÂºèÔºåËÄåÁõ¥Êé•ÈááÁî® HTML Ê†áÁ≠æÊù•Ê†ºÂºèÂåñ„ÄÇ‰∏æ‰æãËØ¥ÊòéÔºöÂ¶ÇÊûúÊØîËæÉÂñúÊ¨¢ HTML ÁöÑ <code>&lt;a&gt;</code> Êàñ <code>&lt;img&gt;</code> Ê†áÁ≠æÔºåÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®Ëøô‰∫õÊ†áÁ≠æÔºåËÄå‰∏çÁî® Markdown Êèê‰æõÁöÑÈìæÊé•ÊàñÊòØÂõæÂÉèÊ†áÁ≠æËØ≠Ê≥ï„ÄÇ</p>
<p>ÂíåÂ§ÑÂú® HTML Âå∫ÂùóÊ†áÁ≠æÈó¥‰∏çÂêåÔºåMarkdown ËØ≠Ê≥ïÂú® HTML Âå∫ÊÆµÊ†áÁ≠æÈó¥ÊòØÊúâÊïàÁöÑ„ÄÇ</p>
<h2 id="ÁâπÊÆäÂ≠óÁ¨¶Ëá™Âä®ËΩ¨Êç¢"><a href="#ÁâπÊÆäÂ≠óÁ¨¶Ëá™Âä®ËΩ¨Êç¢" class="headerlink" title="ÁâπÊÆäÂ≠óÁ¨¶Ëá™Âä®ËΩ¨Êç¢"></a>ÁâπÊÆäÂ≠óÁ¨¶Ëá™Âä®ËΩ¨Êç¢</h2><p>Âú® HTML Êñá‰ª∂‰∏≠ÔºåÊúâ‰∏§‰∏™Â≠óÁ¨¶ÈúÄË¶ÅÁâπÊÆäÂ§ÑÁêÜÔºö <code>&lt;</code> Âíå <code>&amp;</code> „ÄÇ <code>&lt;</code> Á¨¶Âè∑Áî®‰∫éËµ∑ÂßãÊ†áÁ≠æÔºå<code>&amp;</code> Á¨¶Âè∑ÂàôÁî®‰∫éÊ†áËÆ∞ HTML ÂÆû‰ΩìÔºåÂ¶ÇÊûú‰Ω†Âè™ÊòØÊÉ≥Ë¶ÅÊòæÁ§∫Ëøô‰∫õÂ≠óÁ¨¶ÁöÑÂéüÂûãÔºå‰Ω†ÂøÖÈ°ªË¶Å‰ΩøÁî®ÂÆû‰ΩìÁöÑÂΩ¢ÂºèÔºåÂÉèÊòØ <code>&amp;lt;</code> Âíå <code>&amp;amp;</code>„ÄÇ</p>
<p><code>&amp;</code> Â≠óÁ¨¶Â∞§ÂÖ∂ËÆ©ÁΩëÁªúÊñáÊ°£ÁºñÂÜôËÄÖÂèóÊäòÁ£®ÔºåÂ¶ÇÊûú‰Ω†Ë¶ÅÊâì„Äå<code>AT&amp;T</code>„Äç Ôºå‰Ω†ÂøÖÈ°ªË¶ÅÂÜôÊàê„Äå<code>AT&amp;amp;T</code>„Äç„ÄÇËÄåÁΩëÂùÄ‰∏≠ÁöÑ <code>&amp;</code> Â≠óÁ¨¶‰πüË¶ÅËΩ¨Êç¢„ÄÇÊØîÂ¶Ç‰Ω†Ë¶ÅÈìæÊé•Âà∞Ôºö</p>
<p>  <a href="http://images.google.com/images?num=30" target="_blank" rel="noopener">http://images.google.com/images?num=30</a> <code>&amp;</code>q=larry+bird</p>
<p>‰Ω†ÂøÖÈ°ªË¶ÅÊääÁΩëÂùÄËΩ¨Êç¢ÂÜô‰∏∫Ôºö</p>
<p>  <a href="http://images.google.com/images?num=30" target="_blank" rel="noopener">http://images.google.com/images?num=30</a> <code>&amp;amp;</code>q=larry+bird</p>
<p>ÊâçËÉΩÊîæÂà∞ÈìæÊé•Ê†áÁ≠æÁöÑ <code>href</code> Â±ûÊÄßÈáå„ÄÇ‰∏çÁî®ËØ¥‰πüÁü•ÈÅìËøôÂæàÂÆπÊòìÂøΩÁï•ÔºåËøô‰πüÂèØËÉΩÊòØ HTML Ê†áÂáÜÊ£ÄÈ™åÊâÄÊ£ÄÊü•Âà∞ÁöÑÈîôËØØ‰∏≠ÔºåÊï∞ÈáèÊúÄÂ§öÁöÑ„ÄÇ</p>
<p>Markdown ËÆ©‰Ω†ÂèØ‰ª•Ëá™ÁÑ∂Âú∞‰π¶ÂÜôÂ≠óÁ¨¶ÔºåÈúÄË¶ÅËΩ¨Êç¢ÁöÑÁî±ÂÆÉÊù•Â§ÑÁêÜÂ•Ω‰∫Ü„ÄÇÂ¶ÇÊûú‰Ω†‰ΩøÁî®ÁöÑ <code>&amp;</code> Â≠óÁ¨¶ÊòØ HTML Â≠óÁ¨¶ÂÆû‰ΩìÁöÑ‰∏ÄÈÉ®ÂàÜÔºåÂÆÉ‰ºö‰øùÁïôÂéüÁä∂ÔºåÂê¶ÂàôÂÆÉ‰ºöË¢´ËΩ¨Êç¢Êàê <code>&amp;amp</code>;„ÄÇ</p>
<p>ÊâÄ‰ª•‰Ω†Â¶ÇÊûúË¶ÅÂú®ÊñáÊ°£‰∏≠ÊèíÂÖ•‰∏Ä‰∏™ÁâàÊùÉÁ¨¶Âè∑ <code>¬©</code>Ôºå‰Ω†ÂèØ‰ª•ËøôÊ†∑ÂÜôÔºö</p>
<pre><code>&amp;copy;</code></pre><p>Markdown ‰ºö‰øùÁïôÂÆÉ‰∏çÂä®„ÄÇËÄåËã•‰Ω†ÂÜôÔºö</p>
<pre><code>AT&amp;T</code></pre><p>Markdown Â∞±‰ºöÂ∞ÜÂÆÉËΩ¨‰∏∫Ôºö</p>
<pre><code>AT&amp;amp;T</code></pre><p>Á±ª‰ººÁöÑÁä∂ÂÜµ‰πü‰ºöÂèëÁîüÂú® <code>&lt;</code> Á¨¶Âè∑‰∏äÔºåÂõ†‰∏∫ Markdown ÂÖÅËÆ∏ <a href="#html">ÂÖºÂÆπ HTML</a> ÔºåÂ¶ÇÊûú‰Ω†ÊòØÊää <code>&lt;</code> Á¨¶Âè∑‰Ωú‰∏∫ HTML Ê†áÁ≠æÁöÑÂÆöÁïåÁ¨¶‰ΩøÁî®ÔºåÈÇ£ Markdown ‰πü‰∏ç‰ºöÂØπÂÆÉÂÅö‰ªª‰ΩïËΩ¨Êç¢Ôºå‰ΩÜÊòØÂ¶ÇÊûú‰Ω†ÂÜôÔºö</p>
<pre><code>4 &lt; 5</code></pre><p>Markdown Â∞Ü‰ºöÊääÂÆÉËΩ¨Êç¢‰∏∫Ôºö</p>
<pre><code>4 &amp;lt; 5</code></pre><p>‰∏çËøáÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåcode ËåÉÂõ¥ÂÜÖÔºå‰∏çËÆ∫ÊòØË°åÂÜÖËøòÊòØÂå∫ÂùóÔºå <code>&lt;</code> Âíå <code>&amp;</code> ‰∏§‰∏™Á¨¶Âè∑ÈÉΩ<em>‰∏ÄÂÆö</em>‰ºöË¢´ËΩ¨Êç¢Êàê HTML ÂÆû‰ΩìÔºåËøôÈ°πÁâπÊÄßËÆ©‰Ω†ÂèØ‰ª•ÂæàÂÆπÊòìÂú∞Áî® Markdown ÂÜô HTML code ÔºàÂíå HTML Áõ∏ÂØπËÄåË®ÄÔºå HTML ËØ≠Ê≥ï‰∏≠Ôºå‰Ω†Ë¶ÅÊääÊâÄÊúâÁöÑ <code>&lt;</code> Âíå <code>&amp;</code> ÈÉΩËΩ¨Êç¢‰∏∫ HTML ÂÆû‰ΩìÔºåÊâçËÉΩÂú® HTML Êñá‰ª∂ÈáåÈù¢ÂÜôÂá∫ HTML code„ÄÇÔºâ</p>
<hr>
<h1 id="Âå∫ÂùóÂÖÉÁ¥†"><a href="#Âå∫ÂùóÂÖÉÁ¥†" class="headerlink" title="Âå∫ÂùóÂÖÉÁ¥†"></a>Âå∫ÂùóÂÖÉÁ¥†</h1><h2 id="ÊÆµËêΩÂíåÊç¢Ë°å"><a href="#ÊÆµËêΩÂíåÊç¢Ë°å" class="headerlink" title="ÊÆµËêΩÂíåÊç¢Ë°å"></a>ÊÆµËêΩÂíåÊç¢Ë°å</h2><p>‰∏Ä‰∏™ Markdown ÊÆµËêΩÊòØÁî±‰∏Ä‰∏™ÊàñÂ§ö‰∏™ËøûÁª≠ÁöÑÊñáÊú¨Ë°åÁªÑÊàêÔºåÂÆÉÁöÑÂâçÂêéË¶ÅÊúâ‰∏Ä‰∏™‰ª•‰∏äÁöÑÁ©∫Ë°åÔºàÁ©∫Ë°åÁöÑÂÆö‰πâÊòØÊòæÁ§∫‰∏äÁúãËµ∑Êù•ÂÉèÊòØÁ©∫ÁöÑÔºå‰æø‰ºöË¢´ËßÜ‰∏∫Á©∫Ë°å„ÄÇÊØîÊñπËØ¥ÔºåËã•Êüê‰∏ÄË°åÂè™ÂåÖÂê´Á©∫Ê†ºÂíåÂà∂Ë°®Á¨¶ÔºåÂàôËØ•Ë°å‰πü‰ºöË¢´ËßÜ‰∏∫Á©∫Ë°åÔºâ„ÄÇÊôÆÈÄöÊÆµËêΩ‰∏çËØ•Áî®Á©∫Ê†ºÊàñÂà∂Ë°®Á¨¶Êù•Áº©Ëøõ„ÄÇ</p>
<p>„ÄåÁî±‰∏Ä‰∏™ÊàñÂ§ö‰∏™ËøûÁª≠ÁöÑÊñáÊú¨Ë°åÁªÑÊàê„ÄçËøôÂè•ËØùÂÖ∂ÂÆûÊöóÁ§∫‰∫Ü Markdown ÂÖÅËÆ∏ÊÆµËêΩÂÜÖÁöÑÂº∫Ëø´Êç¢Ë°åÔºàÊèíÂÖ•Êç¢Ë°åÁ¨¶ÔºâÔºåËøô‰∏™ÁâπÊÄßÂíåÂÖ∂‰ªñÂ§ßÈÉ®ÂàÜÁöÑ text-to-HTML Ê†ºÂºè‰∏ç‰∏ÄÊ†∑ÔºàÂåÖÊã¨ Movable Type ÁöÑ„ÄåConvert Line Breaks„ÄçÈÄâÈ°πÔºâÔºåÂÖ∂ÂÆÉÁöÑÊ†ºÂºè‰ºöÊääÊØè‰∏™Êç¢Ë°åÁ¨¶ÈÉΩËΩ¨Êàê <code>&lt;br /&gt;</code> Ê†áÁ≠æ„ÄÇ</p>
<p>Â¶ÇÊûú‰Ω†<em>Á°ÆÂÆû</em>ÊÉ≥Ë¶Å‰æùËµñ Markdown Êù•ÊèíÂÖ• <code>&lt;br /&gt;</code> Ê†áÁ≠æÁöÑËØùÔºåÂú®ÊèíÂÖ•Â§ÑÂÖàÊåâÂÖ•‰∏§‰∏™‰ª•‰∏äÁöÑÁ©∫Ê†ºÁÑ∂ÂêéÂõûËΩ¶„ÄÇ</p>
<p>ÁöÑÁ°ÆÔºåÈúÄË¶ÅÂ§öË¥πÁÇπ‰∫ãÔºàÂ§öÂä†Á©∫Ê†ºÔºâÊù•‰∫ßÁîü <code>&lt;br /&gt;</code> Ôºå‰ΩÜÊòØÁÆÄÂçïÂú∞„ÄåÊØè‰∏™Êç¢Ë°åÈÉΩËΩ¨Êç¢‰∏∫ <code>&lt;br /&gt;</code>„ÄçÁöÑÊñπÊ≥ïÂú® Markdown ‰∏≠Âπ∂‰∏çÈÄÇÂêàÔºå Markdown ‰∏≠ email ÂºèÁöÑ <a href="#blockquote">Âå∫ÂùóÂºïÁî®</a> ÂíåÂ§öÊÆµËêΩÁöÑ <a href="#list">ÂàóË°®</a> Âú®‰ΩøÁî®Êç¢Ë°åÊù•ÊéíÁâàÁöÑÊó∂ÂÄôÔºå‰∏ç‰ΩÜÊõ¥Â•ΩÁî®ÔºåËøòÊõ¥Êñπ‰æøÈòÖËØª„ÄÇ</p>
<h2 id="Ê†áÈ¢ò"><a href="#Ê†áÈ¢ò" class="headerlink" title="Ê†áÈ¢ò"></a>Ê†áÈ¢ò</h2><p>Markdown ÊîØÊåÅ‰∏§ÁßçÊ†áÈ¢òÁöÑËØ≠Ê≥ïÔºåÁ±ª [Setext] <a href="http://docutils.sourceforge.net/mirror/setext.html" target="_blank" rel="noopener">1</a> ÂíåÁ±ª [atx] <a href="http://www.aaronsw.com/2002/atx/" target="_blank" rel="noopener">2</a> ÂΩ¢Âºè„ÄÇ</p>
<p>Á±ª Setext ÂΩ¢ÂºèÊòØÁî®Â∫ïÁ∫øÁöÑÂΩ¢ÂºèÔºåÂà©Áî® <code>=</code> ÔºàÊúÄÈ´òÈò∂Ê†áÈ¢òÔºâÂíå <code>-</code> ÔºàÁ¨¨‰∫åÈò∂Ê†áÈ¢òÔºâÔºå‰æãÂ¶ÇÔºö</p>
<pre><code>This is an H1
=============

This is an H2
-------------</code></pre><p>‰ªª‰ΩïÊï∞ÈáèÁöÑ <code>=</code> Âíå <code>-</code> ÈÉΩÂèØ‰ª•ÊúâÊïàÊûú„ÄÇ</p>
<p>Á±ª Atx ÂΩ¢ÂºèÂàôÊòØÂú®Ë°åÈ¶ñÊèíÂÖ• 1 Âà∞ 6 ‰∏™ <code>#</code> ÔºåÂØπÂ∫îÂà∞Ê†áÈ¢ò 1 Âà∞ 6 Èò∂Ôºå‰æãÂ¶ÇÔºö</p>
<pre><code># ËøôÊòØ H1

## ËøôÊòØ H2

###### ËøôÊòØ H6</code></pre><p>‰Ω†ÂèØ‰ª•ÈÄâÊã©ÊÄßÂú∞„ÄåÈó≠Âêà„ÄçÁ±ª atx Ê†∑ÂºèÁöÑÊ†áÈ¢òÔºåËøôÁ∫ØÁ≤πÂè™ÊòØÁæéËßÇÁî®ÁöÑÔºåËã•ÊòØËßâÂæóËøôÊ†∑ÁúãËµ∑Êù•ÊØîËæÉËàíÈÄÇÔºå‰Ω†Â∞±ÂèØ‰ª•Âú®Ë°åÂ∞æÂä†‰∏ä <code>#</code>ÔºåËÄåË°åÂ∞æÁöÑ <code>#</code> Êï∞Èáè‰πü‰∏çÁî®ÂíåÂºÄÂ§¥‰∏ÄÊ†∑ÔºàË°åÈ¶ñÁöÑ‰∫ïÂ≠óÁ¨¶Êï∞ÈáèÂÜ≥ÂÆöÊ†áÈ¢òÁöÑÈò∂Êï∞ÔºâÔºö</p>
<pre><code># ËøôÊòØ H1 #

## ËøôÊòØ H2 ##

### ËøôÊòØ H3 ######</code></pre><h2 id="Âå∫ÂùóÂºïÁî®"><a href="#Âå∫ÂùóÂºïÁî®" class="headerlink" title="Âå∫ÂùóÂºïÁî®"></a>Âå∫ÂùóÂºïÁî®</h2><p>Markdown Ê†áËÆ∞Âå∫ÂùóÂºïÁî®ÊòØ‰ΩøÁî®Á±ª‰ºº email ‰∏≠Áî® <code>&gt;</code> ÁöÑÂºïÁî®ÊñπÂºè„ÄÇÂ¶ÇÊûú‰Ω†ËøòÁÜüÊÇâÂú® email ‰ø°‰ª∂‰∏≠ÁöÑÂºïË®ÄÈÉ®ÂàÜÔºå‰Ω†Â∞±Áü•ÈÅìÊÄé‰πàÂú® Markdown Êñá‰ª∂‰∏≠Âª∫Á´ã‰∏Ä‰∏™Âå∫ÂùóÂºïÁî®ÔºåÈÇ£‰ºöÁúãËµ∑Êù•ÂÉèÊòØ‰Ω†Ëá™Â∑±ÂÖàÊñ≠Â•ΩË°åÔºåÁÑ∂ÂêéÂú®ÊØèË°åÁöÑÊúÄÂâçÈù¢Âä†‰∏ä <code>&gt;</code> Ôºö</p>
<pre><code>&gt; This is a blockquote with two paragraphs. Lorem ipsum dolor sit amet,
&gt; consectetuer adipiscing elit. Aliquam hendrerit mi posuere lectus.
&gt; Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.
&gt;
&gt; Donec sit amet nisl. Aliquam semper ipsum sit amet velit. Suspendisse
&gt; id sem consectetuer libero luctus adipiscing.</code></pre><p>Markdown ‰πüÂÖÅËÆ∏‰Ω†ÂÅ∑ÊáíÂè™Âú®Êï¥‰∏™ÊÆµËêΩÁöÑÁ¨¨‰∏ÄË°åÊúÄÂâçÈù¢Âä†‰∏ä <code>&gt;</code> Ôºö</p>
<pre><code>&gt; This is a blockquote with two paragraphs. Lorem ipsum dolor sit amet,
consectetuer adipiscing elit. Aliquam hendrerit mi posuere lectus.
Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.

&gt; Donec sit amet nisl. Aliquam semper ipsum sit amet velit. Suspendisse
id sem consectetuer libero luctus adipiscing.</code></pre><p>Âå∫ÂùóÂºïÁî®ÂèØ‰ª•ÂµåÂ•óÔºà‰æãÂ¶ÇÔºöÂºïÁî®ÂÜÖÁöÑÂºïÁî®ÔºâÔºåÂè™Ë¶ÅÊ†πÊçÆÂ±ÇÊ¨°Âä†‰∏ä‰∏çÂêåÊï∞ÈáèÁöÑ <code>&gt;</code> Ôºö</p>
<pre><code>&gt; This is the first level of quoting.
&gt;
&gt; &gt; This is nested blockquote.
&gt;
&gt; Back to the first level.</code></pre><p>ÂºïÁî®ÁöÑÂå∫ÂùóÂÜÖ‰πüÂèØ‰ª•‰ΩøÁî®ÂÖ∂‰ªñÁöÑ Markdown ËØ≠Ê≥ïÔºåÂåÖÊã¨Ê†áÈ¢ò„ÄÅÂàóË°®„ÄÅ‰ª£Á†ÅÂå∫ÂùóÁ≠âÔºö</p>
<pre><code>&gt; ## ËøôÊòØ‰∏Ä‰∏™Ê†áÈ¢ò„ÄÇ
&gt;
&gt; 1.   ËøôÊòØÁ¨¨‰∏ÄË°åÂàóË°®È°π„ÄÇ
&gt; 2.   ËøôÊòØÁ¨¨‰∫åË°åÂàóË°®È°π„ÄÇ
&gt;
&gt; ÁªôÂá∫‰∏Ä‰∫õ‰æãÂ≠ê‰ª£Á†ÅÔºö
&gt;
&gt;     return shell_exec(&quot;echo $input | $markdown_script&quot;);</code></pre><p>‰ªª‰ΩïÂÉèÊ†∑ÁöÑÊñáÊú¨ÁºñËæëÂô®ÈÉΩËÉΩËΩªÊùæÂú∞Âª∫Á´ã email ÂûãÁöÑÂºïÁî®„ÄÇ‰æãÂ¶ÇÂú® BBEdit ‰∏≠Ôºå‰Ω†ÂèØ‰ª•ÈÄâÂèñÊñáÂ≠óÂêéÁÑ∂Âêé‰ªéÈÄâÂçï‰∏≠ÈÄâÊã©<em>Â¢ûÂä†ÂºïÁî®Èò∂Â±Ç</em>„ÄÇ</p>
<h2 id="ÂàóË°®"><a href="#ÂàóË°®" class="headerlink" title="ÂàóË°®"></a>ÂàóË°®</h2><p>Markdown ÊîØÊåÅÊúâÂ∫èÂàóË°®ÂíåÊó†Â∫èÂàóË°®„ÄÇ</p>
<p>Êó†Â∫èÂàóË°®‰ΩøÁî®ÊòüÂè∑„ÄÅÂä†Âè∑ÊàñÊòØÂáèÂè∑‰Ωú‰∏∫ÂàóË°®Ê†áËÆ∞Ôºö</p>
<pre><code>*   Red
*   Green
*   Blue</code></pre><p>Á≠âÂêå‰∫éÔºö</p>
<pre><code>+   Red
+   Green
+   Blue</code></pre><p>‰πüÁ≠âÂêå‰∫éÔºö</p>
<pre><code>-   Red
-   Green
-   Blue</code></pre><p>ÊúâÂ∫èÂàóË°®Âàô‰ΩøÁî®Êï∞Â≠óÊé•ÁùÄ‰∏Ä‰∏™Ëã±ÊñáÂè•ÁÇπÔºö</p>
<pre><code>1.  Bird
2.  McHale
3.  Parish</code></pre><p>ÂæàÈáçË¶ÅÁöÑ‰∏ÄÁÇπÊòØÔºå‰Ω†Âú®ÂàóË°®Ê†áËÆ∞‰∏ä‰ΩøÁî®ÁöÑÊï∞Â≠óÂπ∂‰∏ç‰ºöÂΩ±ÂìçËæìÂá∫ÁöÑ HTML ÁªìÊûúÔºå‰∏äÈù¢ÁöÑÂàóË°®ÊâÄ‰∫ßÁîüÁöÑ HTML Ê†áËÆ∞‰∏∫Ôºö</p>
<pre><code>&lt;ol&gt;
&lt;li&gt;Bird&lt;/li&gt;
&lt;li&gt;McHale&lt;/li&gt;
&lt;li&gt;Parish&lt;/li&gt;
&lt;/ol&gt;</code></pre><p>Â¶ÇÊûú‰Ω†ÁöÑÂàóË°®Ê†áËÆ∞ÂÜôÊàêÔºö</p>
<pre><code>1.  Bird
1.  McHale
1.  Parish</code></pre><p>ÊàñÁîöËá≥ÊòØÔºö</p>
<pre><code>3. Bird
1. McHale
8. Parish</code></pre><p>‰Ω†ÈÉΩ‰ºöÂæóÂà∞ÂÆåÂÖ®Áõ∏ÂêåÁöÑ HTML ËæìÂá∫„ÄÇÈáçÁÇπÂú®‰∫éÔºå‰Ω†ÂèØ‰ª•ËÆ© Markdown Êñá‰ª∂ÁöÑÂàóË°®Êï∞Â≠óÂíåËæìÂá∫ÁöÑÁªìÊûúÁõ∏ÂêåÔºåÊàñÊòØ‰Ω†Êáí‰∏ÄÁÇπÔºå‰Ω†ÂèØ‰ª•ÂÆåÂÖ®‰∏çÁî®Âú®ÊÑèÊï∞Â≠óÁöÑÊ≠£Á°ÆÊÄß„ÄÇ</p>
<p>Â¶ÇÊûú‰Ω†‰ΩøÁî®ÊáíÊÉ∞ÁöÑÂÜôÊ≥ïÔºåÂª∫ËÆÆÁ¨¨‰∏Ä‰∏™È°πÁõÆÊúÄÂ•ΩËøòÊòØ‰ªé 1. ÂºÄÂßãÔºåÂõ†‰∏∫ Markdown Êú™Êù•ÂèØËÉΩ‰ºöÊîØÊåÅÊúâÂ∫èÂàóË°®ÁöÑ start Â±ûÊÄß„ÄÇ</p>
<p>ÂàóË°®È°πÁõÆÊ†áËÆ∞ÈÄöÂ∏∏ÊòØÊîæÂú®ÊúÄÂ∑¶ËæπÔºå‰ΩÜÊòØÂÖ∂ÂÆû‰πüÂèØ‰ª•Áº©ËøõÔºåÊúÄÂ§ö 3 ‰∏™Á©∫Ê†ºÔºåÈ°πÁõÆÊ†áËÆ∞ÂêéÈù¢Âàô‰∏ÄÂÆöË¶ÅÊé•ÁùÄËá≥Â∞ë‰∏Ä‰∏™Á©∫Ê†ºÊàñÂà∂Ë°®Á¨¶„ÄÇ</p>
<p>Ë¶ÅËÆ©ÂàóË°®ÁúãËµ∑Êù•Êõ¥ÊºÇ‰∫ÆÔºå‰Ω†ÂèØ‰ª•ÊääÂÜÖÂÆπÁî®Âõ∫ÂÆöÁöÑÁº©ËøõÊï¥ÁêÜÂ•ΩÔºö</p>
<pre><code>*   Lorem ipsum dolor sit amet, consectetuer adipiscing elit.
    Aliquam hendrerit mi posuere lectus. Vestibulum enim wisi,
    viverra nec, fringilla in, laoreet vitae, risus.
*   Donec sit amet nisl. Aliquam semper ipsum sit amet velit.
    Suspendisse id sem consectetuer libero luctus adipiscing.</code></pre><p>‰ΩÜÊòØÂ¶ÇÊûú‰Ω†ÊáíÔºåÈÇ£‰πüË°åÔºö</p>
<pre><code>*   Lorem ipsum dolor sit amet, consectetuer adipiscing elit.
Aliquam hendrerit mi posuere lectus. Vestibulum enim wisi,
viverra nec, fringilla in, laoreet vitae, risus.
*   Donec sit amet nisl. Aliquam semper ipsum sit amet velit.
Suspendisse id sem consectetuer libero luctus adipiscing.</code></pre><p>Â¶ÇÊûúÂàóË°®È°πÁõÆÈó¥Áî®Á©∫Ë°åÂàÜÂºÄÔºåÂú®ËæìÂá∫ HTML Êó∂ Markdown Â∞±‰ºöÂ∞ÜÈ°πÁõÆÂÜÖÂÆπÁî® <code>&lt;p&gt;</code><br>Ê†áÁ≠æÂåÖËµ∑Êù•Ôºå‰∏æ‰æãÊù•ËØ¥Ôºö</p>
<pre><code>*   Bird
*   Magic</code></pre><p>‰ºöË¢´ËΩ¨Êç¢‰∏∫Ôºö</p>
<pre><code>&lt;ul&gt;
&lt;li&gt;Bird&lt;/li&gt;
&lt;li&gt;Magic&lt;/li&gt;
&lt;/ul&gt;</code></pre><p>‰ΩÜÊòØËøô‰∏™Ôºö</p>
<pre><code>*   Bird

*   Magic</code></pre><p>‰ºöË¢´ËΩ¨Êç¢‰∏∫Ôºö</p>
<pre><code>&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Bird&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Magic&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;</code></pre><p>ÂàóË°®È°πÁõÆÂèØ‰ª•ÂåÖÂê´Â§ö‰∏™ÊÆµËêΩÔºåÊØè‰∏™È°πÁõÆ‰∏ãÁöÑÊÆµËêΩÈÉΩÂøÖÈ°ªÁº©Ëøõ 4 ‰∏™Á©∫Ê†ºÊàñÊòØ 1 ‰∏™Âà∂Ë°®Á¨¶Ôºö</p>
<pre><code>1.  This is a list item with two paragraphs. Lorem ipsum dolor
    sit amet, consectetuer adipiscing elit. Aliquam hendrerit
    mi posuere lectus.

    Vestibulum enim wisi, viverra nec, fringilla in, laoreet
    vitae, risus. Donec sit amet nisl. Aliquam semper ipsum
    sit amet velit.

2.  Suspendisse id sem consectetuer libero luctus adipiscing.</code></pre><p>Â¶ÇÊûú‰Ω†ÊØèË°åÈÉΩÊúâÁº©ËøõÔºåÁúãËµ∑Êù•‰ºöÁúãÂ•ΩÂæàÂ§öÔºåÂΩìÁÑ∂ÔºåÂÜçÊ¨°Âú∞ÔºåÂ¶ÇÊûú‰Ω†ÂæàÊáíÊÉ∞ÔºåMarkdown ‰πüÂÖÅËÆ∏Ôºö</p>
<pre><code>*   This is a list item with two paragraphs.

    This is the second paragraph in the list item. You&apos;re
only required to indent the first line. Lorem ipsum dolor
sit amet, consectetuer adipiscing elit.

*   Another item in the same list.</code></pre><p>Â¶ÇÊûúË¶ÅÂú®ÂàóË°®È°πÁõÆÂÜÖÊîæËøõÂºïÁî®ÔºåÈÇ£ <code>&gt;</code> Â∞±ÈúÄË¶ÅÁº©ËøõÔºö</p>
<pre><code>*   A list item with a blockquote:

    &gt; This is a blockquote
    &gt; inside a list item.</code></pre><p>Â¶ÇÊûúË¶ÅÊîæ‰ª£Á†ÅÂå∫ÂùóÁöÑËØùÔºåËØ•Âå∫ÂùóÂ∞±ÈúÄË¶ÅÁº©Ëøõ<em>‰∏§Ê¨°</em>Ôºå‰πüÂ∞±ÊòØ 8 ‰∏™Á©∫Ê†ºÊàñÊòØ 2 ‰∏™Âà∂Ë°®Á¨¶Ôºö</p>
<pre><code>*   ‰∏ÄÂàóË°®È°πÂåÖÂê´‰∏Ä‰∏™ÂàóË°®Âå∫ÂùóÔºö

        &lt;‰ª£Á†ÅÂÜôÂú®Ëøô&gt;</code></pre><p>ÂΩìÁÑ∂ÔºåÈ°πÁõÆÂàóË°®ÂæàÂèØËÉΩ‰ºö‰∏çÂ∞èÂøÉ‰∫ßÁîüÔºåÂÉèÊòØ‰∏ãÈù¢ËøôÊ†∑ÁöÑÂÜôÊ≥ïÔºö</p>
<pre><code>1986. What a great season.</code></pre><p>Êç¢Âè•ËØùËØ¥Ôºå‰πüÂ∞±ÊòØÂú®Ë°åÈ¶ñÂá∫Áé∞<em>Êï∞Â≠ó-Âè•ÁÇπ-Á©∫ÁôΩ</em>ÔºåË¶ÅÈÅøÂÖçËøôÊ†∑ÁöÑÁä∂ÂÜµÔºå‰Ω†ÂèØ‰ª•Âú®Âè•ÁÇπÂâçÈù¢Âä†‰∏äÂèçÊñúÊù†„ÄÇ</p>
<pre><code>1986\. What a great season.</code></pre><h2 id="‰ª£Á†ÅÂå∫Âùó"><a href="#‰ª£Á†ÅÂå∫Âùó" class="headerlink" title="‰ª£Á†ÅÂå∫Âùó"></a>‰ª£Á†ÅÂå∫Âùó</h2><p>ÂíåÁ®ãÂ∫èÁõ∏ÂÖ≥ÁöÑÂÜô‰ΩúÊàñÊòØÊ†áÁ≠æËØ≠Ë®ÄÂéüÂßãÁ†ÅÈÄöÂ∏∏‰ºöÊúâÂ∑≤ÁªèÊéíÁâàÂ•ΩÁöÑ‰ª£Á†ÅÂå∫ÂùóÔºåÈÄöÂ∏∏Ëøô‰∫õÂå∫ÂùóÊàë‰ª¨Âπ∂‰∏çÂ∏åÊúõÂÆÉ‰ª•‰∏ÄËà¨ÊÆµËêΩÊñá‰ª∂ÁöÑÊñπÂºèÂéªÊéíÁâàÔºåËÄåÊòØÁÖßÂéüÊù•ÁöÑÊ†∑Â≠êÊòæÁ§∫ÔºåMarkdown ‰ºöÁî® <code>&lt;pre&gt;</code> Âíå <code>&lt;code&gt;</code> Ê†áÁ≠æÊù•Êää‰ª£Á†ÅÂå∫ÂùóÂåÖËµ∑Êù•„ÄÇ</p>
<p>Ë¶ÅÂú® Markdown ‰∏≠Âª∫Á´ã‰ª£Á†ÅÂå∫ÂùóÂæàÁÆÄÂçïÔºåÂè™Ë¶ÅÁÆÄÂçïÂú∞Áº©Ëøõ 4 ‰∏™Á©∫Ê†ºÊàñÊòØ 1 ‰∏™Âà∂Ë°®Á¨¶Â∞±ÂèØ‰ª•Ôºå‰æãÂ¶ÇÔºå‰∏ãÈù¢ÁöÑËæìÂÖ•Ôºö</p>
<pre><code>ËøôÊòØ‰∏Ä‰∏™ÊôÆÈÄöÊÆµËêΩÔºö

    ËøôÊòØ‰∏Ä‰∏™‰ª£Á†ÅÂå∫Âùó„ÄÇ</code></pre><p>Markdown ‰ºöËΩ¨Êç¢ÊàêÔºö</p>
<pre><code>&lt;p&gt;ËøôÊòØ‰∏Ä‰∏™ÊôÆÈÄöÊÆµËêΩÔºö&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ËøôÊòØ‰∏Ä‰∏™‰ª£Á†ÅÂå∫Âùó„ÄÇ
&lt;/code&gt;&lt;/pre&gt;</code></pre><p>Ëøô‰∏™ÊØèË°å‰∏ÄÈò∂ÁöÑÁº©ËøõÔºà4 ‰∏™Á©∫Ê†ºÊàñÊòØ 1 ‰∏™Âà∂Ë°®Á¨¶ÔºâÔºåÈÉΩ‰ºöË¢´ÁßªÈô§Ôºå‰æãÂ¶ÇÔºö</p>
<pre><code>Here is an example of AppleScript:

    tell application &quot;Foo&quot;
        beep
    end tell</code></pre><p>‰ºöË¢´ËΩ¨Êç¢‰∏∫Ôºö</p>
<pre><code>&lt;p&gt;Here is an example of AppleScript:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tell application &quot;Foo&quot;
    beep
end tell
&lt;/code&gt;&lt;/pre&gt;</code></pre><p>‰∏Ä‰∏™‰ª£Á†ÅÂå∫Âùó‰ºö‰∏ÄÁõ¥ÊåÅÁª≠Âà∞Ê≤°ÊúâÁº©ËøõÁöÑÈÇ£‰∏ÄË°åÔºàÊàñÊòØÊñá‰ª∂ÁªìÂ∞æÔºâ„ÄÇ</p>
<p>Âú®‰ª£Á†ÅÂå∫ÂùóÈáåÈù¢Ôºå <code>&amp;</code> „ÄÅ <code>&lt;</code> Âíå <code>&gt;</code> ‰ºöËá™Âä®ËΩ¨Êàê HTML ÂÆû‰ΩìÔºåËøôÊ†∑ÁöÑÊñπÂºèËÆ©‰Ω†ÈùûÂ∏∏ÂÆπÊòì‰ΩøÁî® Markdown ÊèíÂÖ•ËåÉ‰æãÁî®ÁöÑ HTML ÂéüÂßãÁ†ÅÔºåÂè™ÈúÄË¶ÅÂ§çÂà∂Ë¥¥‰∏äÔºåÂÜçÂä†‰∏äÁº©ËøõÂ∞±ÂèØ‰ª•‰∫ÜÔºåÂâ©‰∏ãÁöÑ Markdown ÈÉΩ‰ºöÂ∏Æ‰Ω†Â§ÑÁêÜÔºå‰æãÂ¶ÇÔºö</p>
<pre><code>&lt;div class=&quot;footer&quot;&gt;
    &amp;copy; 2004 Foo Corporation
&lt;/div&gt;</code></pre><p>‰ºöË¢´ËΩ¨Êç¢‰∏∫Ôºö</p>
<pre><code>&lt;pre&gt;&lt;code&gt;&amp;lt;div class=&quot;footer&quot;&amp;gt;
    &amp;amp;copy; 2004 Foo Corporation
&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;</code></pre><p>‰ª£Á†ÅÂå∫Âùó‰∏≠Ôºå‰∏ÄËà¨ÁöÑ Markdown ËØ≠Ê≥ï‰∏ç‰ºöË¢´ËΩ¨Êç¢ÔºåÂÉèÊòØÊòüÂè∑‰æøÂè™ÊòØÊòüÂè∑ÔºåËøôË°®Á§∫‰Ω†ÂèØ‰ª•ÂæàÂÆπÊòìÂú∞‰ª• Markdown ËØ≠Ê≥ïÊí∞ÂÜô Markdown ËØ≠Ê≥ïÁõ∏ÂÖ≥ÁöÑÊñá‰ª∂„ÄÇ</p>
<h2 id="ÂàÜÈöîÁ∫ø"><a href="#ÂàÜÈöîÁ∫ø" class="headerlink" title="ÂàÜÈöîÁ∫ø"></a>ÂàÜÈöîÁ∫ø</h2><p>‰Ω†ÂèØ‰ª•Âú®‰∏ÄË°å‰∏≠Áî®‰∏â‰∏™‰ª•‰∏äÁöÑÊòüÂè∑„ÄÅÂáèÂè∑„ÄÅÂ∫ïÁ∫øÊù•Âª∫Á´ã‰∏Ä‰∏™ÂàÜÈöîÁ∫øÔºåË°åÂÜÖ‰∏çËÉΩÊúâÂÖ∂‰ªñ‰∏úË•ø„ÄÇ‰Ω†‰πüÂèØ‰ª•Âú®ÊòüÂè∑ÊàñÊòØÂáèÂè∑‰∏≠Èó¥ÊèíÂÖ•Á©∫Ê†º„ÄÇ‰∏ãÈù¢ÊØèÁßçÂÜôÊ≥ïÈÉΩÂèØ‰ª•Âª∫Á´ãÂàÜÈöîÁ∫øÔºö</p>
<pre><code>* * *

***

*****

- - -

---------------------------------------</code></pre><hr>
<h1 id="Âå∫ÊÆµÂÖÉÁ¥†"><a href="#Âå∫ÊÆµÂÖÉÁ¥†" class="headerlink" title="Âå∫ÊÆµÂÖÉÁ¥†"></a>Âå∫ÊÆµÂÖÉÁ¥†</h1><h2 id="ÈìæÊé•"><a href="#ÈìæÊé•" class="headerlink" title="ÈìæÊé•"></a>ÈìæÊé•</h2><p>Markdown ÊîØÊåÅ‰∏§ÁßçÂΩ¢ÂºèÁöÑÈìæÊé•ËØ≠Ê≥ïÔºö <em>Ë°åÂÜÖÂºè</em>Âíå<em>ÂèÇËÄÉÂºè</em>‰∏§ÁßçÂΩ¢Âºè„ÄÇ</p>
<p>‰∏çÁÆ°ÊòØÂì™‰∏ÄÁßçÔºåÈìæÊé•ÊñáÂ≠óÈÉΩÊòØÁî® [ÊñπÊã¨Âè∑] Êù•Ê†áËÆ∞„ÄÇ</p>
<p>Ë¶ÅÂª∫Á´ã‰∏Ä‰∏™<em>Ë°åÂÜÖÂºè</em>ÁöÑÈìæÊé•ÔºåÂè™Ë¶ÅÂú®ÊñπÂùóÊã¨Âè∑ÂêéÈù¢Á¥ßÊé•ÁùÄÂúÜÊã¨Âè∑Âπ∂ÊèíÂÖ•ÁΩëÂùÄÈìæÊé•Âç≥ÂèØÔºåÂ¶ÇÊûú‰Ω†ËøòÊÉ≥Ë¶ÅÂä†‰∏äÈìæÊé•ÁöÑ title ÊñáÂ≠óÔºåÂè™Ë¶ÅÂú®ÁΩëÂùÄÂêéÈù¢ÔºåÁî®ÂèåÂºïÂè∑Êää title ÊñáÂ≠óÂåÖËµ∑Êù•Âç≥ÂèØÔºå‰æãÂ¶ÇÔºö</p>
<pre><code>This is [an example](http://example.com/ &quot;Title&quot;) inline link.

[This link](http://example.net/) has no title attribute.</code></pre><p>‰ºö‰∫ßÁîüÔºö</p>
<pre><code>&lt;p&gt;This is &lt;a href=&quot;http://example.com/&quot; title=&quot;Title&quot;&gt;
an example&lt;/a&gt; inline link.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://example.net/&quot;&gt;This link&lt;/a&gt; has no
title attribute.&lt;/p&gt;</code></pre><p>Â¶ÇÊûú‰Ω†ÊòØË¶ÅÈìæÊé•Âà∞ÂêåÊ†∑‰∏ªÊú∫ÁöÑËµÑÊ∫êÔºå‰Ω†ÂèØ‰ª•‰ΩøÁî®Áõ∏ÂØπË∑ØÂæÑÔºö</p>
<pre><code>See my [About](/about/) page for details.   </code></pre><p><em>ÂèÇËÄÉÂºè</em>ÁöÑÈìæÊé•ÊòØÂú®ÈìæÊé•ÊñáÂ≠óÁöÑÊã¨Âè∑ÂêéÈù¢ÂÜçÊé•‰∏äÂè¶‰∏Ä‰∏™ÊñπÊã¨Âè∑ÔºåËÄåÂú®Á¨¨‰∫å‰∏™ÊñπÊã¨Âè∑ÈáåÈù¢Ë¶ÅÂ°´ÂÖ•Áî®‰ª•Ëæ®ËØÜÈìæÊé•ÁöÑÊ†áËÆ∞Ôºö</p>
<pre><code>This is [an example][id] reference-style link.</code></pre><p>‰Ω†‰πüÂèØ‰ª•ÈÄâÊã©ÊÄßÂú∞Âú®‰∏§‰∏™ÊñπÊã¨Âè∑‰∏≠Èó¥Âä†‰∏ä‰∏Ä‰∏™Á©∫Ê†ºÔºö</p>
<pre><code>This is [an example] [id] reference-style link.</code></pre><p>Êé•ÁùÄÔºåÂú®Êñá‰ª∂ÁöÑ‰ªªÊÑèÂ§ÑÔºå‰Ω†ÂèØ‰ª•ÊääËøô‰∏™Ê†áËÆ∞ÁöÑÈìæÊé•ÂÜÖÂÆπÂÆö‰πâÂá∫Êù•Ôºö</p>
<pre><code>[id]: http://example.com/  &quot;Optional Title Here&quot;</code></pre><p>ÈìæÊé•ÂÜÖÂÆπÂÆö‰πâÁöÑÂΩ¢Âºè‰∏∫Ôºö</p>
<ul>
<li>ÊñπÊã¨Âè∑ÔºàÂâçÈù¢ÂèØ‰ª•ÈÄâÊã©ÊÄßÂú∞Âä†‰∏äËá≥Â§ö‰∏â‰∏™Á©∫Ê†ºÊù•Áº©ËøõÔºâÔºåÈáåÈù¢ËæìÂÖ•ÈìæÊé•ÊñáÂ≠ó</li>
<li>Êé•ÁùÄ‰∏Ä‰∏™ÂÜíÂè∑</li>
<li>Êé•ÁùÄ‰∏Ä‰∏™‰ª•‰∏äÁöÑÁ©∫Ê†ºÊàñÂà∂Ë°®Á¨¶</li>
<li>Êé•ÁùÄÈìæÊé•ÁöÑÁΩëÂùÄ</li>
<li>ÈÄâÊã©ÊÄßÂú∞Êé•ÁùÄ title ÂÜÖÂÆπÔºåÂèØ‰ª•Áî®ÂçïÂºïÂè∑„ÄÅÂèåÂºïÂè∑ÊàñÊòØÊã¨ÂºßÂåÖÁùÄ</li>
</ul>
<p>‰∏ãÈù¢Ëøô‰∏âÁßçÈìæÊé•ÁöÑÂÆö‰πâÈÉΩÊòØÁõ∏ÂêåÔºö</p>
<pre><code>[foo]: http://example.com/  &quot;Optional Title Here&quot;
[foo]: http://example.com/  &apos;Optional Title Here&apos;
[foo]: http://example.com/  (Optional Title Here)</code></pre><p><strong>ËØ∑Ê≥®ÊÑèÔºö</strong>Êúâ‰∏Ä‰∏™Â∑≤Áü•ÁöÑÈóÆÈ¢òÊòØ Markdown.pl 1.0.1 ‰ºöÂøΩÁï•ÂçïÂºïÂè∑ÂåÖËµ∑Êù•ÁöÑÈìæÊé• title„ÄÇ</p>
<p>ÈìæÊé•ÁΩëÂùÄ‰πüÂèØ‰ª•Áî®Â∞ñÊã¨Âè∑ÂåÖËµ∑Êù•Ôºö</p>
<pre><code>[id]: &lt;http://example.com/&gt;  &quot;Optional Title Here&quot;</code></pre><p>‰Ω†‰πüÂèØ‰ª•Êää title Â±ûÊÄßÊîæÂà∞‰∏ã‰∏ÄË°åÔºå‰πüÂèØ‰ª•Âä†‰∏Ä‰∫õÁº©ËøõÔºåËã•ÁΩëÂùÄÂ§™ÈïøÁöÑËØùÔºåËøôÊ†∑‰ºöÊØîËæÉÂ•ΩÁúãÔºö</p>
<pre><code>[id]: http://example.com/longish/path/to/resource/here
    &quot;Optional Title Here&quot;</code></pre><p>ÁΩëÂùÄÂÆö‰πâÂè™ÊúâÂú®‰∫ßÁîüÈìæÊé•ÁöÑÊó∂ÂÄôÁî®Âà∞ÔºåÂπ∂‰∏ç‰ºöÁõ¥Êé•Âá∫Áé∞Âú®Êñá‰ª∂‰πã‰∏≠„ÄÇ</p>
<p>ÈìæÊé•Ëæ®Âà´Ê†áÁ≠æÂèØ‰ª•ÊúâÂ≠óÊØç„ÄÅÊï∞Â≠ó„ÄÅÁ©∫ÁôΩÂíåÊ†áÁÇπÁ¨¶Âè∑Ôºå‰ΩÜÊòØÂπ∂<em>‰∏ç</em>Âå∫ÂàÜÂ§ßÂ∞èÂÜôÔºåÂõ†Ê≠§‰∏ãÈù¢‰∏§‰∏™ÈìæÊé•ÊòØ‰∏ÄÊ†∑ÁöÑÔºö</p>
<pre><code>[link text][a]
[link text][A]</code></pre><p><em>ÈöêÂºèÈìæÊé•Ê†áËÆ∞</em>ÂäüËÉΩËÆ©‰Ω†ÂèØ‰ª•ÁúÅÁï•ÊåáÂÆöÈìæÊé•Ê†áËÆ∞ÔºåËøôÁßçÊÉÖÂΩ¢‰∏ãÔºåÈìæÊé•Ê†áËÆ∞‰ºöËßÜ‰∏∫Á≠âÂêå‰∫éÈìæÊé•ÊñáÂ≠óÔºåË¶ÅÁî®ÈöêÂºèÈìæÊé•Ê†áËÆ∞Âè™Ë¶ÅÂú®ÈìæÊé•ÊñáÂ≠óÂêéÈù¢Âä†‰∏ä‰∏Ä‰∏™Á©∫ÁöÑÊñπÊã¨Âè∑ÔºåÂ¶ÇÊûú‰Ω†Ë¶ÅËÆ© ‚ÄúGoogle‚Äù ÈìæÊé•Âà∞ google.comÔºå‰Ω†ÂèØ‰ª•ÁÆÄÂåñÊàêÔºö</p>
<pre><code>[Google][]</code></pre><p>ÁÑ∂ÂêéÂÆö‰πâÈìæÊé•ÂÜÖÂÆπÔºö</p>
<pre><code>[Google]: http://google.com/</code></pre><p>Áî±‰∫éÈìæÊé•ÊñáÂ≠óÂèØËÉΩÂåÖÂê´Á©∫ÁôΩÔºåÊâÄ‰ª•ËøôÁßçÁÆÄÂåñÂûãÁöÑÊ†áËÆ∞ÂÜÖ‰πüËÆ∏ÂåÖÂê´Â§ö‰∏™ÂçïËØçÔºö</p>
<pre><code>Visit [Daring Fireball][] for more information.</code></pre><p>ÁÑ∂ÂêéÊé•ÁùÄÂÆö‰πâÈìæÊé•Ôºö</p>
<pre><code>[Daring Fireball]: http://daringfireball.net/</code></pre><p>ÈìæÊé•ÁöÑÂÆö‰πâÂèØ‰ª•ÊîæÂú®Êñá‰ª∂‰∏≠ÁöÑ‰ªª‰Ωï‰∏Ä‰∏™Âú∞ÊñπÔºåÊàëÊØîËæÉÂÅèÂ•ΩÁõ¥Êé•ÊîæÂú®ÈìæÊé•Âá∫Áé∞ÊÆµËêΩÁöÑÂêéÈù¢Ôºå‰Ω†‰πüÂèØ‰ª•ÊääÂÆÉÊîæÂú®Êñá‰ª∂ÊúÄÂêéÈù¢ÔºåÂ∞±ÂÉèÊòØÊ≥®Ëß£‰∏ÄÊ†∑„ÄÇ</p>
<p>‰∏ãÈù¢ÊòØ‰∏Ä‰∏™ÂèÇËÄÉÂºèÈìæÊé•ÁöÑËåÉ‰æãÔºö</p>
<pre><code>I get 10 times more traffic from [Google] [1] than from
[Yahoo] [2] or [MSN] [3].

  [1]: http://google.com/        &quot;Google&quot;
  [2]: http://search.yahoo.com/  &quot;Yahoo Search&quot;
  [3]: http://search.msn.com/    &quot;MSN Search&quot;</code></pre><p>Â¶ÇÊûúÊîπÊàêÁî®ÈìæÊé•ÂêçÁß∞ÁöÑÊñπÂºèÂÜôÔºö</p>
<pre><code>I get 10 times more traffic from [Google][] than from
[Yahoo][] or [MSN][].

  [google]: http://google.com/        &quot;Google&quot;
  [yahoo]:  http://search.yahoo.com/  &quot;Yahoo Search&quot;
  [msn]:    http://search.msn.com/    &quot;MSN Search&quot;</code></pre><p>‰∏äÈù¢‰∏§ÁßçÂÜôÊ≥ïÈÉΩ‰ºö‰∫ßÁîü‰∏ãÈù¢ÁöÑ HTML„ÄÇ</p>
<pre><code>&lt;p&gt;I get 10 times more traffic from &lt;a href=&quot;http://google.com/&quot;
title=&quot;Google&quot;&gt;Google&lt;/a&gt; than from
&lt;a href=&quot;http://search.yahoo.com/&quot; title=&quot;Yahoo Search&quot;&gt;Yahoo&lt;/a&gt;
or &lt;a href=&quot;http://search.msn.com/&quot; title=&quot;MSN Search&quot;&gt;MSN&lt;/a&gt;.&lt;/p&gt;</code></pre><p>‰∏ãÈù¢ÊòØÁî®Ë°åÂÜÖÂºèÂÜôÁöÑÂêåÊ†∑‰∏ÄÊÆµÂÜÖÂÆπÁöÑ Markdown Êñá‰ª∂ÔºåÊèê‰æõ‰Ωú‰∏∫ÊØîËæÉ‰πãÁî®Ôºö</p>
<pre><code>I get 10 times more traffic from [Google](http://google.com/ &quot;Google&quot;)
than from [Yahoo](http://search.yahoo.com/ &quot;Yahoo Search&quot;) or
[MSN](http://search.msn.com/ &quot;MSN Search&quot;).</code></pre><p>ÂèÇËÄÉÂºèÁöÑÈìæÊé•ÂÖ∂ÂÆûÈáçÁÇπ‰∏çÂú®‰∫éÂÆÉÊØîËæÉÂ•ΩÂÜôÔºåËÄåÊòØÂÆÉÊØîËæÉÂ•ΩËØªÔºåÊØîËæÉ‰∏Ä‰∏ã‰∏äÈù¢ÁöÑËåÉ‰æãÔºå‰ΩøÁî®ÂèÇËÄÉÂºèÁöÑÊñáÁ´†Êú¨Ë∫´Âè™Êúâ 81 ‰∏™Â≠óÁ¨¶Ôºå‰ΩÜÊòØÁî®Ë°åÂÜÖÂΩ¢ÂºèÁöÑÂç¥‰ºöÂ¢ûÂä†Âà∞ 176 ‰∏™Â≠óÂÖÉÔºåÂ¶ÇÊûúÊòØÁî®Á∫Ø HTML Ê†ºÂºèÊù•ÂÜôÔºå‰ºöÊúâ 234 ‰∏™Â≠óÂÖÉÔºåÂú® HTML Ê†ºÂºè‰∏≠ÔºåÊ†áÁ≠æÊØîÊñáÊú¨ËøòË¶ÅÂ§ö„ÄÇ</p>
<p>‰ΩøÁî® Markdown ÁöÑÂèÇËÄÉÂºèÈìæÊé•ÔºåÂèØ‰ª•ËÆ©Êñá‰ª∂Êõ¥ÂÉèÊòØÊµèËßàÂô®ÊúÄÂêé‰∫ßÁîüÁöÑÁªìÊûúÔºåËÆ©‰Ω†ÂèØ‰ª•Êää‰∏Ä‰∫õÊ†áËÆ∞Áõ∏ÂÖ≥ÁöÑÂÖÉÊï∞ÊçÆÁßªÂà∞ÊÆµËêΩÊñáÂ≠ó‰πãÂ§ñÔºå‰Ω†Â∞±ÂèØ‰ª•Â¢ûÂä†ÈìæÊé•ËÄå‰∏çËÆ©ÊñáÁ´†ÁöÑÈòÖËØªÊÑüËßâË¢´ÊâìÊñ≠„ÄÇ</p>
<h2 id="Âº∫Ë∞É"><a href="#Âº∫Ë∞É" class="headerlink" title="Âº∫Ë∞É"></a>Âº∫Ë∞É</h2><p>Markdown ‰ΩøÁî®ÊòüÂè∑Ôºà<code>*</code>ÔºâÂíåÂ∫ïÁ∫øÔºà<code>_</code>Ôºâ‰Ωú‰∏∫Ê†áËÆ∞Âº∫Ë∞ÉÂ≠óËØçÁöÑÁ¨¶Âè∑ÔºåË¢´ <code>*</code> Êàñ <code>_</code> ÂåÖÂõ¥ÁöÑÂ≠óËØç‰ºöË¢´ËΩ¨ÊàêÁî® <code>&lt;em&gt;</code> Ê†áÁ≠æÂåÖÂõ¥ÔºåÁî®‰∏§‰∏™ <code>*</code> Êàñ <code>_</code> ÂåÖËµ∑Êù•ÁöÑËØùÔºåÂàô‰ºöË¢´ËΩ¨Êàê <code>&lt;strong&gt;</code>Ôºå‰æãÂ¶ÇÔºö</p>
<pre><code>*single asterisks*

_single underscores_

**double asterisks**

__double underscores__</code></pre><p>‰ºöËΩ¨ÊàêÔºö</p>
<pre><code>&lt;em&gt;single asterisks&lt;/em&gt;

&lt;em&gt;single underscores&lt;/em&gt;

&lt;strong&gt;double asterisks&lt;/strong&gt;

&lt;strong&gt;double underscores&lt;/strong&gt;</code></pre><p>‰Ω†ÂèØ‰ª•Èöè‰æøÁî®‰Ω†ÂñúÊ¨¢ÁöÑÊ†∑ÂºèÔºåÂîØ‰∏ÄÁöÑÈôêÂà∂ÊòØÔºå‰Ω†Áî®‰ªÄ‰πàÁ¨¶Âè∑ÂºÄÂêØÊ†áÁ≠æÔºåÂ∞±Ë¶ÅÁî®‰ªÄ‰πàÁ¨¶Âè∑ÁªìÊùü„ÄÇ</p>
<p>Âº∫Ë∞É‰πüÂèØ‰ª•Áõ¥Êé•ÊèíÂú®ÊñáÂ≠ó‰∏≠Èó¥Ôºö</p>
<pre><code>un*frigging*believable</code></pre><p>‰ΩÜÊòØ<strong>Â¶ÇÊûú‰Ω†ÁöÑ <code>*</code> Âíå <code>_</code> ‰∏§ËæπÈÉΩÊúâÁ©∫ÁôΩÁöÑËØùÔºåÂÆÉ‰ª¨Â∞±Âè™‰ºöË¢´ÂΩìÊàêÊôÆÈÄöÁöÑÁ¨¶Âè∑</strong>„ÄÇ</p>
<p>Â¶ÇÊûúË¶ÅÂú®ÊñáÂ≠óÂâçÂêéÁõ¥Êé•ÊèíÂÖ•ÊôÆÈÄöÁöÑÊòüÂè∑ÊàñÂ∫ïÁ∫øÔºå‰Ω†ÂèØ‰ª•Áî®ÂèçÊñúÁ∫øÔºö</p>
<pre><code>\*this text is surrounded by literal asterisks\*</code></pre><h2 id="‰ª£Á†Å"><a href="#‰ª£Á†Å" class="headerlink" title="‰ª£Á†Å"></a>‰ª£Á†Å</h2><p>Â¶ÇÊûúË¶ÅÊ†áËÆ∞‰∏ÄÂ∞èÊÆµË°åÂÜÖ‰ª£Á†ÅÔºå‰Ω†ÂèØ‰ª•Áî®ÂèçÂºïÂè∑ÊääÂÆÉÂåÖËµ∑Êù•Ôºà<code>`</code>ÔºâÔºå‰æãÂ¶ÇÔºö</p>
<pre><code>Use the `printf()` function.</code></pre><p>‰ºö‰∫ßÁîüÔºö</p>
<pre><code>&lt;p&gt;Use the &lt;code&gt;printf()&lt;/code&gt; function.&lt;/p&gt;</code></pre><p>Â¶ÇÊûúË¶ÅÂú®‰ª£Á†ÅÂå∫ÊÆµÂÜÖÊèíÂÖ•ÂèçÂºïÂè∑Ôºå‰Ω†ÂèØ‰ª•Áî®Â§ö‰∏™ÂèçÂºïÂè∑Êù•ÂºÄÂêØÂíåÁªìÊùü‰ª£Á†ÅÂå∫ÊÆµÔºö</p>
<pre><code>``There is a literal backtick (`) here.``</code></pre><p>ËøôÊÆµËØ≠Ê≥ï‰ºö‰∫ßÁîüÔºö</p>
<pre><code>&lt;p&gt;&lt;code&gt;There is a literal backtick (`) here.&lt;/code&gt;&lt;/p&gt;</code></pre><p>‰ª£Á†ÅÂå∫ÊÆµÁöÑËµ∑ÂßãÂíåÁªìÊùüÁ´ØÈÉΩÂèØ‰ª•ÊîæÂÖ•‰∏Ä‰∏™Á©∫ÁôΩÔºåËµ∑ÂßãÁ´ØÂêéÈù¢‰∏Ä‰∏™ÔºåÁªìÊùüÁ´ØÂâçÈù¢‰∏Ä‰∏™ÔºåËøôÊ†∑‰Ω†Â∞±ÂèØ‰ª•Âú®Âå∫ÊÆµÁöÑ‰∏ÄÂºÄÂßãÂ∞±ÊèíÂÖ•ÂèçÂºïÂè∑Ôºö</p>
<pre><code>A single backtick in a code span: `` ` ``

A backtick-delimited string in a code span: `` `foo` ``</code></pre><p>‰ºö‰∫ßÁîüÔºö</p>
<pre><code>&lt;p&gt;A single backtick in a code span: &lt;code&gt;`&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;A backtick-delimited string in a code span: &lt;code&gt;`foo`&lt;/code&gt;&lt;/p&gt;</code></pre><p>Âú®‰ª£Á†ÅÂå∫ÊÆµÂÜÖÔºå<code>&amp;</code> ÂíåÂ∞ñÊã¨Âè∑<strong>ÈÉΩ</strong>‰ºöË¢´Ëá™Âä®Âú∞ËΩ¨Êàê HTML ÂÆû‰ΩìÔºåËøô‰ΩøÂæóÊèíÂÖ• HTML ÂéüÂßãÁ†ÅÂèòÂæóÂæàÂÆπÊòìÔºåMarkdown ‰ºöÊää‰∏ãÈù¢ËøôÊÆµÔºö</p>
<pre><code>Please don&apos;t use any `&lt;blink&gt;` tags.</code></pre><p>ËΩ¨‰∏∫Ôºö</p>
<pre><code>&lt;p&gt;Please don&apos;t use any &lt;code&gt;&amp;lt;blink&amp;gt;&lt;/code&gt; tags.&lt;/p&gt;</code></pre><p>‰Ω†‰πüÂèØ‰ª•ËøôÊ†∑ÂÜôÔºö</p>
<pre><code>`&amp;#8212;` is the decimal-encoded equivalent of `&amp;mdash;`.</code></pre><p>‰ª•‰∫ßÁîüÔºö</p>
<pre><code>&lt;p&gt;&lt;code&gt;&amp;amp;#8212;&lt;/code&gt; is the decimal-encoded
equivalent of &lt;code&gt;&amp;amp;mdash;&lt;/code&gt;.&lt;/p&gt;</code></pre><h2 id="ÂõæÁâá"><a href="#ÂõæÁâá" class="headerlink" title="ÂõæÁâá"></a>ÂõæÁâá</h2><p>ÂæàÊòéÊòæÂú∞ÔºåË¶ÅÂú®Á∫ØÊñáÂ≠óÂ∫îÁî®‰∏≠ËÆæËÆ°‰∏Ä‰∏™„ÄåËá™ÁÑ∂„ÄçÁöÑËØ≠Ê≥ïÊù•ÊèíÂÖ•ÂõæÁâáÊòØÊúâ‰∏ÄÂÆöÈöæÂ∫¶ÁöÑ„ÄÇ</p>
<p>Markdown ‰ΩøÁî®‰∏ÄÁßçÂíåÈìæÊé•ÂæàÁõ∏‰ººÁöÑËØ≠Ê≥ïÊù•Ê†áËÆ∞ÂõæÁâáÔºåÂêåÊ†∑‰πüÂÖÅËÆ∏‰∏§ÁßçÊ†∑ÂºèÔºö <em>Ë°åÂÜÖÂºè</em>Âíå<em>ÂèÇËÄÉÂºè</em>„ÄÇ</p>
<p>Ë°åÂÜÖÂºèÁöÑÂõæÁâáËØ≠Ê≥ïÁúãËµ∑Êù•ÂÉèÊòØÔºö</p>
<pre><code>![Alt text](/path/to/img.jpg)

![Alt text](/path/to/img.jpg &quot;Optional title&quot;)</code></pre><p>ËØ¶ÁªÜÂèôËø∞Â¶Ç‰∏ãÔºö</p>
<ul>
<li>‰∏Ä‰∏™ÊÉäÂèπÂè∑ <code>!</code></li>
<li>Êé•ÁùÄ‰∏Ä‰∏™ÊñπÊã¨Âè∑ÔºåÈáåÈù¢Êîæ‰∏äÂõæÁâáÁöÑÊõø‰ª£ÊñáÂ≠ó</li>
<li>Êé•ÁùÄ‰∏Ä‰∏™ÊôÆÈÄöÊã¨Âè∑ÔºåÈáåÈù¢Êîæ‰∏äÂõæÁâáÁöÑÁΩëÂùÄÔºåÊúÄÂêéËøòÂèØ‰ª•Áî®ÂºïÂè∑ÂåÖ‰ΩèÂπ∂Âä†‰∏ä<br>ÈÄâÊã©ÊÄßÁöÑ ‚Äòtitle‚Äô ÊñáÂ≠ó„ÄÇ</li>
</ul>
<p>ÂèÇËÄÉÂºèÁöÑÂõæÁâáËØ≠Ê≥ïÂàôÈïøÂæóÂÉèËøôÊ†∑Ôºö</p>
<pre><code>![Alt text][id]</code></pre><p>„Äåid„ÄçÊòØÂõæÁâáÂèÇËÄÉÁöÑÂêçÁß∞ÔºåÂõæÁâáÂèÇËÄÉÁöÑÂÆö‰πâÊñπÂºèÂàôÂíåËøûÁªìÂèÇËÄÉ‰∏ÄÊ†∑Ôºö</p>
<pre><code>[id]: url/to/image  &quot;Optional title attribute&quot;</code></pre><p>Âà∞ÁõÆÂâç‰∏∫Ê≠¢Ôºå Markdown ËøòÊ≤°ÊúâÂäûÊ≥ïÊåáÂÆöÂõæÁâáÁöÑÂÆΩÈ´òÔºåÂ¶ÇÊûú‰Ω†ÈúÄË¶ÅÁöÑËØùÔºå‰Ω†ÂèØ‰ª•‰ΩøÁî®ÊôÆÈÄöÁöÑ <code>&lt;img&gt;</code> Ê†áÁ≠æ„ÄÇ</p>
<hr>
<h1 id="ÂÖ∂ÂÆÉ"><a href="#ÂÖ∂ÂÆÉ" class="headerlink" title="ÂÖ∂ÂÆÉ"></a>ÂÖ∂ÂÆÉ</h1><h2 id="Ëá™Âä®ÈìæÊé•"><a href="#Ëá™Âä®ÈìæÊé•" class="headerlink" title="Ëá™Âä®ÈìæÊé•"></a>Ëá™Âä®ÈìæÊé•</h2><p>Markdown ÊîØÊåÅ‰ª•ÊØîËæÉÁÆÄÁü≠ÁöÑËá™Âä®ÈìæÊé•ÂΩ¢ÂºèÊù•Â§ÑÁêÜÁΩëÂùÄÂíåÁîµÂ≠êÈÇÆ‰ª∂‰ø°ÁÆ±ÔºåÂè™Ë¶ÅÊòØÁî®Â∞ñÊã¨Âè∑ÂåÖËµ∑Êù•Ôºå Markdown Â∞±‰ºöËá™Âä®ÊääÂÆÉËΩ¨ÊàêÈìæÊé•„ÄÇ‰∏ÄËà¨ÁΩëÂùÄÁöÑÈìæÊé•ÊñáÂ≠óÂ∞±ÂíåÈìæÊé•Âú∞ÂùÄ‰∏ÄÊ†∑Ôºå‰æãÂ¶ÇÔºö</p>
<pre><code>&lt;http://example.com/&gt;</code></pre><p>Markdown ‰ºöËΩ¨‰∏∫Ôºö</p>
<pre><code>&lt;a href=&quot;http://example.com/&quot;&gt;http://example.com/&lt;/a&gt;</code></pre><p>ÈÇÆÂùÄÁöÑËá™Âä®ÈìæÊé•‰πüÂæàÁ±ª‰ººÔºåÂè™ÊòØ Markdown ‰ºöÂÖàÂÅö‰∏Ä‰∏™ÁºñÁ†ÅËΩ¨Êç¢ÁöÑËøáÁ®ãÔºåÊääÊñáÂ≠óÂ≠óÁ¨¶ËΩ¨Êàê 16 Ëøõ‰ΩçÁ†ÅÁöÑ HTML ÂÆû‰ΩìÔºåËøôÊ†∑ÁöÑÊ†ºÂºèÂèØ‰ª•Á≥äÂºÑ‰∏Ä‰∫õ‰∏çÂ•ΩÁöÑÈÇÆÂùÄÊî∂ÈõÜÊú∫Âô®‰∫∫Ôºå‰æãÂ¶ÇÔºö</p>
<pre><code>&lt;address@example.com&gt;</code></pre><p>Markdown ‰ºöËΩ¨ÊàêÔºö</p>
<pre><code>&lt;a href=&quot;&amp;#x6D;&amp;#x61;i&amp;#x6C;&amp;#x74;&amp;#x6F;:&amp;#x61;&amp;#x64;&amp;#x64;&amp;#x72;&amp;#x65;
&amp;#115;&amp;#115;&amp;#64;&amp;#101;&amp;#120;&amp;#x61;&amp;#109;&amp;#x70;&amp;#x6C;e&amp;#x2E;&amp;#99;&amp;#111;
&amp;#109;&quot;&gt;&amp;#x61;&amp;#x64;&amp;#x64;&amp;#x72;&amp;#x65;&amp;#115;&amp;#115;&amp;#64;&amp;#101;&amp;#120;&amp;#x61;
&amp;#109;&amp;#x70;&amp;#x6C;e&amp;#x2E;&amp;#99;&amp;#111;&amp;#109;&lt;/a&gt;</code></pre><p>Âú®ÊµèËßàÂô®ÈáåÈù¢ÔºåËøôÊÆµÂ≠ó‰∏≤ÔºàÂÖ∂ÂÆûÊòØ <code>&lt;a href=&quot;mailto:address@example.com&quot;&gt;address@example.com&lt;/a&gt;</code>Ôºâ‰ºöÂèòÊàê‰∏Ä‰∏™ÂèØ‰ª•ÁÇπÂáªÁöÑ„Äå<a href="mailto:address@example.com" target="_blank" rel="noopener">address@example.com</a>„ÄçÈìæÊé•„ÄÇ</p>
<p>ÔºàËøôÁßç‰ΩúÊ≥ïËôΩÁÑ∂ÂèØ‰ª•Á≥äÂºÑ‰∏çÂ∞ëÁöÑÊú∫Âô®‰∫∫Ôºå‰ΩÜÂπ∂‰∏çËÉΩÂÖ®ÈÉ®Êå°‰∏ãÊù•Ôºå‰∏çËøáÊÄªÊØî‰ªÄ‰πàÈÉΩ‰∏çÂÅöÂ•Ω‰∫õ„ÄÇ‰∏çÁÆ°ÊÄéÊ†∑ÔºåÂÖ¨ÂºÄ‰Ω†ÁöÑ‰ø°ÁÆ±ÁªàÁ©∂‰ºöÂºïÊù•ÂπøÂëä‰ø°‰ª∂ÁöÑ„ÄÇÔºâ</p>
<h2 id="ÂèçÊñúÊù†"><a href="#ÂèçÊñúÊù†" class="headerlink" title="ÂèçÊñúÊù†"></a>ÂèçÊñúÊù†</h2><p>Markdown ÂèØ‰ª•Âà©Áî®ÂèçÊñúÊù†Êù•ÊèíÂÖ•‰∏Ä‰∫õÂú®ËØ≠Ê≥ï‰∏≠ÊúâÂÖ∂ÂÆÉÊÑè‰πâÁöÑÁ¨¶Âè∑Ôºå‰æãÂ¶ÇÔºöÂ¶ÇÊûú‰Ω†ÊÉ≥Ë¶ÅÁî®ÊòüÂè∑Âä†Âú®ÊñáÂ≠óÊóÅËæπÁöÑÊñπÂºèÊù•ÂÅöÂá∫Âº∫Ë∞ÉÊïàÊûúÔºà‰ΩÜ‰∏çÁî® <code>&lt;em&gt;</code> Ê†áÁ≠æÔºâÔºå‰Ω†ÂèØ‰ª•Âú®ÊòüÂè∑ÁöÑÂâçÈù¢Âä†‰∏äÂèçÊñúÊù†Ôºö</p>
<pre><code>\*literal asterisks\*</code></pre><p>Markdown ÊîØÊåÅ‰ª•‰∏ãËøô‰∫õÁ¨¶Âè∑ÂâçÈù¢Âä†‰∏äÂèçÊñúÊù†Êù•Â∏ÆÂä©ÊèíÂÖ•ÊôÆÈÄöÁöÑÁ¨¶Âè∑Ôºö</p>
<pre><code>\   ÂèçÊñúÁ∫ø
`   ÂèçÂºïÂè∑
*   ÊòüÂè∑
_   Â∫ïÁ∫ø
{}  Ëä±Êã¨Âè∑
[]  ÊñπÊã¨Âè∑
()  Êã¨Âºß
#   ‰∫ïÂ≠óÂè∑
+   Âä†Âè∑
-   ÂáèÂè∑
.   Ëã±ÊñáÂè•ÁÇπ
!   ÊÉäÂèπÂè∑</code></pre>]]></content>
      <categories>
        <category>Technology</category>
      </categories>
      <tags>
        <tag>Êü•ÈòÖ</tag>
        <tag>MarkDown</tag>
      </tags>
  </entry>
  <entry>
    <title>10ÂàÜÈíüÂÖ•Èó®requireJs</title>
    <url>/blog/how-to-use-requirejs/</url>
    <content><![CDATA[<h1 id="ÂºïÂÖ•"><a href="#ÂºïÂÖ•" class="headerlink" title="ÂºïÂÖ•"></a>ÂºïÂÖ•</h1><hr>
<p>‰∏ãËΩΩ <code>requireJs</code>ÔºåÁÑ∂ÂêéÂú® <code>head</code> ‰∏≠</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script src=<span class="string">"js/require.js"</span> data-main=<span class="string">"js/main"</span> defer <span class="keyword">async</span>=<span class="string">"true"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p><code>async</code> Â±ûÊÄßË°®ÊòéËøô‰∏™Êñá‰ª∂ÈúÄË¶ÅÂºÇÊ≠•Âä†ËΩΩÔºåÈÅøÂÖçÁΩëÈ°µÂ§±ÂéªÂìçÂ∫î„ÄÇIE‰∏çÊîØÊåÅËøô‰∏™Â±ûÊÄßÔºåÂè™ÊîØÊåÅ <code>defer</code>ÔºåÊâÄ‰ª•Êää <code>defer</code> ‰πüÂÜô‰∏ä„ÄÇ</p>
<p><code>data-main</code> Â±ûÊÄßÁöÑ‰ΩúÁî®ÊòØÔºåÊåáÂÆöÁΩëÈ°µÁ®ãÂ∫èÁöÑ‰∏ªÊ®°Âùó„ÄÇÂú®‰∏ä‰æã‰∏≠ÔºåÂ∞±ÊòØjsÁõÆÂΩï‰∏ãÈù¢ÁöÑ <code>main.js</code>ÔºåËøô‰∏™Êñá‰ª∂‰ºöÁ¨¨‰∏Ä‰∏™Ë¢´ <code>require.js</code> Âä†ËΩΩ„ÄÇÁî±‰∫é<code>require.js</code> ÈªòËÆ§ÁöÑÊñá‰ª∂ÂêéÁºÄÂêçÊòØjsÔºåÊâÄ‰ª•ÂèØ‰ª•Êää <code>main.js</code> ÁÆÄÂÜôÊàê <code>main</code>„ÄÇ</p>
<h1 id="Âü∫Êú¨API"><a href="#Âü∫Êú¨API" class="headerlink" title="Âü∫Êú¨API"></a>Âü∫Êú¨API</h1><hr>
<p><code>require</code> ‰ºöÂÆö‰πâ‰∏â‰∏™ÂèòÈáèÔºö<strong>define</strong>, <strong>require</strong>, <strong>requirejs</strong>ÔºåÂÖ∂‰∏≠ <code>require</code> === <code>requirejs</code>Ôºå‰∏ÄËà¨‰ΩøÁî® <code>require</code> Êõ¥ÁÆÄÁü≠</p>
<a id="more"></a>
<ul>
<li>define ‰ªéÂêçÂ≠óÂ∞±ÂèØ‰ª•ÁúãÂá∫Ëøô‰∏™apiÊòØÁî®Êù•ÂÆö‰πâ‰∏Ä‰∏™<strong>Ê®°Âùó</strong></li>
<li>require Âä†ËΩΩ‰æùËµñÊ®°ÂùóÔºåÂπ∂ÊâßË°åÂä†ËΩΩÂÆåÂêéÁöÑÂõûË∞ÉÂáΩÊï∞</li>
</ul>
<p>ÊØîÂ¶ÇÊàë‰ª¨ÊÉ≥ÂÜô‰∏Ä‰∏™ a.js ÁöÑÊ®°ÂùóÔºåÂÆûÁé∞‰∏Ä‰∏™ÂäüËÉΩÔºö</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">fun1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(<span class="string">"it works"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fun1();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ËøôÈáåÈÄöËøá <code>define</code> ÂáΩÊï∞ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™Ê®°ÂùóÔºåËøôÊòØ <code>requirejs</code> ÁöÑÊ†áÂáÜÂÜôÊ≥ï„ÄÇÂ¶ÇÊûúÊÉ≥Âú®È°µÈù¢‰∏≠‰ΩøÁî®ËØ• js ÔºåÂèØ‰ª•Áõ¥Êé•Âú® <code>html</code> Êñá‰ª∂‰∏≠Ë∞ÉÁî®Ôºö</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>([<span class="string">"js/a"</span>]);</span><br></pre></td></tr></table></figure>

<p>Â¶ÇÊûúÊàë‰ª¨ÁöÑÁΩëÈ°µÁõÆÂΩïÂ¶Ç‰∏ãÔºö</p>
<p><img src="/img/post/20170325/f9a21c59-60fe-4757-ba4d-5ce2db23756f.png" alt="Alt text"></p>
<p>Âπ∂‰∏î <code>index.html</code> ÂÜÖÂÆπÂ¶Ç‰∏ãÔºåÈÄöËøá‰∏ªÂä® <code>require</code> ÁöÑÊñπÂºèË∞ÉÁî® a.jsÔºö</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"js/lib/require.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">        &lt;!-- ËøôÈáåÂè™ÊòØ‰∏ªÂä®Âä†ËΩΩ‰∫Üa.jsÔºåÂπ∂Ê≤°ÊúâÂÆö‰πâÂä†ËΩΩÁªìÊùüÂêéÁöÑÂõûË∞ÉÂáΩÊï∞ÔºåÂÖ∂ÂäüËÉΩÂç≥‰∏∫Âè™ÊâßË°åa.js‰∏≠‰ª£Á†Å --&gt;</span><br><span class="line">        &lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">            <span class="built_in">require</span>([<span class="string">"js/a"</span>]);</span><br><span class="line">        &lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">      &lt;span&gt;body&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>body&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure>

<p>ËøôÊó∂ÂÄôÁΩëÈ°µÂ∞±‰ºöÂºπÂá∫‰∏Ä‰∏™alert ÂØπËØùÊ°ÜÔºö<br><img src="/img/post/20170325/4cb5a7d9-a6f5-46fe-91be-88b60ac7a2eb.png" alt="Alt text"></p>
<p>Â¶ÇÊûúÂ∞Ü <code>index.html</code> ÂÜôÊàêÂ¶Ç‰∏ãÔºö</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"js/lib/require.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">        &lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">            <span class="built_in">require</span>([<span class="string">"js/a"</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                alert(<span class="string">"call back!"</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">      &lt;span&gt;body&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>body&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure>

<p>ÈÇ£‰πà‰ºöÂú® ‚ÄòIt works‚Äô ÂêéÔºåÂÜçÂºπÂá∫‰∏Ä‰∏™ÂØπËØùÊ°ÜÔºö<br><img src="/img/post/20170325/ab9e13af-eb74-4469-a451-533c1ab52760.png" alt="Alt text"></p>
<h1 id="Âä†ËΩΩÊñá‰ª∂ÂíåÂÖ®Â±ÄÈÖçÁΩÆ"><a href="#Âä†ËΩΩÊñá‰ª∂ÂíåÂÖ®Â±ÄÈÖçÁΩÆ" class="headerlink" title="Âä†ËΩΩÊñá‰ª∂ÂíåÂÖ®Â±ÄÈÖçÁΩÆ"></a>Âä†ËΩΩÊñá‰ª∂ÂíåÂÖ®Â±ÄÈÖçÁΩÆ</h1><p>‰πüËÆ∏‰Ω†‰ºöËØ¥ÔºåËøôÊ†∑Ë∞ÉÁî®ÁöÑÊñπÂºèÔºåÂ¶ÇÊûúÊàëÊúâ a,b,c,d‚Ä¶ Á≠â js ‰ª£Á†ÅÔºå‰∏çËøòÊòØÂæó‰∏Ä‰∏™‰∏™ÂÜôÂà∞ <code>head</code> ÈáåÁöÑ <code>&lt;script&gt;</code> Ê†áÁ≠æÂÜÖË∞ÉÁî®‰πà„ÄÇ‰∏çÊÄ•Ôºå‰∏ãÈù¢ÊâçÊòØÈáçÁÇπ„ÄÇ</p>
<p>È¶ñÂÖàÊàë‰ª¨Âú® js ÁõÆÂΩï‰∏ãÊñ∞Âª∫‰∏Ä‰∏™ <code>main.js</code>Ôºö</p>
<p><img src="/img/post/20170325/dc5e5da3-fbce-4713-a010-dacae5bbd7f6.png" alt="Alt text"></p>
<p>ÁÑ∂ÂêéÂú® <code>main.js</code> ‰∏≠ÂÜôÂ¶Ç‰∏ã‰ª£Á†ÅÔºö</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>.config(&#123;</span><br><span class="line">    paths : &#123;</span><br><span class="line">        <span class="string">"a"</span> : <span class="string">"js/a"</span>   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>([<span class="string">'a'</span>],<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">alert(<span class="string">'finish load'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ÁÑ∂ÂêéÂú® <code>index.html</code> ‰∏≠ËøôÊ†∑ÂÜôÔºö</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"js/lib/require.js"</span> &gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">       &lt;script&gt;</span><br><span class="line">           <span class="built_in">require</span>([<span class="string">'js/main'</span>]);</span><br><span class="line">       &lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">      &lt;span&gt;body&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>body&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure>

<p>ËøôÈáåÁî®Âà∞‰∫Ü <code>require.config</code>„ÄÇ<code>require.config</code> ÊòØÁî®Êù•ÈÖçÁΩÆÊ®°ÂùóÂä†ËΩΩ‰ΩçÁΩÆÁöÑ„ÄÇÂç≥ÁªôÊàë‰ª¨ÁöÑ js Ê®°ÂùóÔºåÂèñ‰∏Ä‰∏™ Âà´ÂêçÔºå‰πãÂêéËøõË°å <code>require</code> ÁöÑÊó∂ÂÄôÔºåÂ∞±‰∏çÁî®‰ª•ËæìÂÖ•Ë∑ØÂæÑÁöÑÊñπÂºèÊù•Ë∞ÉÁî®ÔºåÁõ¥Êé•ÂÜôËøô‰∏™ Âà´Âêç Â∞±Ë°å„ÄÇ</p>
<p>ÂèØ‰ª•ÁúãÂà∞‰∏äÈù¢‰ª£Á†ÅÂÜô <code>require</code> ÁöÑÊó∂ÂÄôÔºåÁõ¥Êé•ÊòØ‰ΩøÁî® <code>require([&#39;a&#39;]</code> ËÄå‰∏çÊòØ‰πãÂâçÁöÑ <code>require([&quot;js/a&quot;]</code>„ÄÇ</p>
<p>ËøôÊ†∑Â¶ÇÊûúÊàë‰ª¨ÊúâÂæàÂ§öÁöÑ‰ª£Á†ÅÔºåÂ∞±ÂèØ‰ª•Âú® <code>main.js</code> ‰∏≠ÔºåÂÖàÈÖçÁΩÆÂêÑ‰∏™Ê®°ÂùóÁöÑË∑ØÂæÑÔºåÂπ∂Ëµ∑Âà´ÂêçÔºåÁÑ∂ÂêéÊå®‰∏™ <code>require</code> Ë∞ÉÁî®Â∞±ÊòØ‰∫Ü„ÄÇÂ∞±‰∏çÁî®ÂØπ <code>head</code> Ê†áÁ≠æËøõË°å‰øÆÊîπ„ÄÇ</p>
<p>ÂêåÊó∂Â¶ÇÊûúÊàë‰ª¨Âú® <code>index.html</code> ‰∏≠ËøôÊ†∑ÂÜôÔºö</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"js/lib/require.js"</span> data-main=<span class="string">"js/main"</span> defer <span class="keyword">async</span>=<span class="string">"true"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>ËøôÈáå <code>data-main</code> Â±ûÊÄßÁöÑ‰ΩúÁî®ÊòØÔºåÊåáÂÆöÁΩëÈ°µÁ®ãÂ∫èÁöÑ‰∏ªÊ®°Âùó„ÄÇÂú®‰∏ä‰æã‰∏≠ÔºåÂ∞±ÊòØjsÁõÆÂΩï‰∏ãÈù¢ÁöÑ <code>main.js</code>ÔºåËøô‰∏™Êñá‰ª∂‰ºöËá™Âä®Ë¢´ <code>require.js</code> Âä†ËΩΩ„ÄÇËøôÊ†∑Êàë‰ª¨Â∞±Âè™Áî®ÂÜô‰∏Ä‰∏™ <code>&lt;script&gt;</code> Ê†áÁ≠æÔºåÂ∞±ÂÆûÁé∞‰∫ÜÂØπÊâÄÊúâÁöÑ js Ê®°ÂùóÁöÑË∞ÉÁî®„ÄÇ</p>
<p><code>data-main</code> ËøòÊúâ‰∏Ä‰∏™ÈáçË¶ÅÁöÑÂäüËÉΩÔºö<br>ÂΩì <code>script</code> Ê†áÁ≠æÊåáÂÆö <code>data-main</code> Â±ûÊÄßÊó∂Ôºå<code>require</code> ‰ºöÈªòËÆ§ÁöÑÂ∞Ü <code>data-main</code> ÊåáÂÆöÁöÑ js ‰∏∫Ê†πË∑ØÂæÑ„ÄÇÂç≥‰πãÂêéÂ¶ÇÊûúÂÜô <code>require</code> Êù•Ë∞ÉÁî® js Ê®°ÂùóÔºå‰∏çÈúÄË¶ÅÂÜçÊ∑ªÂä† ‚Äòjs‚Äô ÁõÆÂΩïÂâçÁºÄ„ÄÇ</p>
<p><code>async</code> Â±ûÊÄßË°®ÊòéËøô‰∏™Êñá‰ª∂ÈúÄË¶ÅÂºÇÊ≠•Âä†ËΩΩÔºåÈÅøÂÖçÁΩëÈ°µÂ§±ÂéªÂìçÂ∫î„ÄÇIE‰∏çÊîØÊåÅËøô‰∏™Â±ûÊÄßÔºåÂè™ÊîØÊåÅ <code>defer</code>ÔºåÊâÄ‰ª•Êää <code>defer</code> ‰πüÂÜô‰∏ä„ÄÇ</p>
<p>‰∏ãÈù¢ÊòØ‰ΩøÁî® <code>data-main</code> Â±ûÊÄßÊó∂ÂÄôÁöÑ html Âíå js Êñá‰ª∂ÂÜôÊ≥ïÔºö</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">   &lt;head&gt;</span><br><span class="line">       &lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"js/lib/require.js"</span> data-main=<span class="string">"js/main"</span> defer <span class="keyword">async</span>=<span class="string">"true"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">    &lt;<span class="regexp">/head&gt;</span></span><br><span class="line"><span class="regexp">    &lt;body&gt;</span></span><br><span class="line"><span class="regexp">       &lt;span&gt;body&lt;/</span>span&gt;</span><br><span class="line">    &lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>.config(&#123;</span><br><span class="line">    <span class="comment">//ËøôÈáåÁúãÂà∞ÊåáÂÆö a.js Ê®°ÂùóË∑ØÂæÑÁöÑÊó∂ÂÄôÔºåÂπ∂Ê≤°ÊúâÂÜô‰∏äÂÖ∂Ë∑ØÂæÑÂâçÁºÄ 'js/'ÔºåËøôÂ∞±ÊòØ data-main Â±ûÊÄßÁöÑ‰ΩúÁî®</span></span><br><span class="line">    paths : &#123;</span><br><span class="line">        <span class="string">"a_alias"</span> : <span class="string">"a"</span>   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>([<span class="string">'a_alias'</span>],<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">alert(<span class="string">'finish load'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="Âä†ËΩΩ‰∏çÁ¨¶ÂêàAMDËßÑËåÉÊ®°Âùó"><a href="#Âä†ËΩΩ‰∏çÁ¨¶ÂêàAMDËßÑËåÉÊ®°Âùó" class="headerlink" title="Âä†ËΩΩ‰∏çÁ¨¶ÂêàAMDËßÑËåÉÊ®°Âùó"></a>Âä†ËΩΩ‰∏çÁ¨¶ÂêàAMDËßÑËåÉÊ®°Âùó</h1><hr>
<p>Ê†áÂáÜÁöÑÂÜôÊ≥ïÊòØÈúÄË¶Å‰ΩøÁî®‰∏Ä‰∏™Ôºö</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// your code here</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Â∞Ü‰Ω†ÁöÑ‰ª£Á†ÅÂÜôÂú®Ëøô‰∏™ <code>define</code> ÂÜÖÈÉ®„ÄÇ‰ΩÜÊòØÊàë‰ª¨Â¶ÇÊûúÊÉ≥Ë¶Å‰ΩøÁî®‰∏Ä‰∏™‰∏çÊòØËøôÁßçÊ†áÂáÜÁöÑ js Ê®°ÂùóÊÄé‰πàÁ†¥Ôºü</p>
<p>ËøôÈáåÂ∞±Ë¶Å‰ΩøÁî®Âà∞ <code>shim</code>„ÄÇÊàë‰ª¨Áúã‰∏ãÈù¢ÁöÑÂÆåÊï¥ÈÖçÁΩÆ <code>main.js</code> Ôºö</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">requirejs.config(&#123;</span><br><span class="line">        paths: &#123;</span><br><span class="line">            jquery: [               </span><br><span class="line">                <span class="string">'lib/jquery.min'</span></span><br><span class="line">            ],</span><br><span class="line">            bootstrap: [</span><br><span class="line">                <span class="string">'//cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min'</span>, <span class="comment">// ËøôÈáåÊîØÊåÅËæìÂÖ•Â§ö‰∏™Â§áÈÄâË∑ØÂæÑÔºåÂâç‰∏Ä‰∏™Â§±Ë¥•Â∞±ÊòØÈÄâÊã©‰∏ã‰∏Ä‰∏™</span></span><br><span class="line">                <span class="string">'lib/bootstrap.min'</span></span><br><span class="line">            ],</span><br><span class="line">            my:<span class="string">'my'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        shim:&#123;</span><br><span class="line">            <span class="string">'bootstrap'</span>:&#123;</span><br><span class="line">                deps:[<span class="string">'jquery'</span>] <span class="comment">// ËøôÈáåÊåáÂÆö‰æùËµñÂÖ≥Á≥ªÔºåbootstrap Ë¶ÅÂú® jquery Âä†ËΩΩÂÆåÊàê‰πãÂêéÂÜçÂä†ËΩΩ</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">'my'</span>:&#123;</span><br><span class="line">                deps:[<span class="string">'jquery'</span>,<span class="string">'bootstrap'</span>],</span><br><span class="line">                exports:<span class="string">'my_alis'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">require</span>([</span><br><span class="line">        <span class="string">'jquery'</span>,<span class="string">'bootstrap'</span>,<span class="string">'my'</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">$, my_alis</span>)</span>&#123;</span><br><span class="line">            <span class="comment">// my ‰∏≠ÁöÑÂèòÈáèÂíåÂáΩÊï∞ÔºåÂè™Âú®ËøôÈáåÊúâÊïà„ÄÇ</span></span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>ËøôÈáåÂÅáËÆæÊàë‰ΩøÁî®‰∫Ü <code>jquery</code> Âíå <code>bootstrap</code> Ê®°ÂùóÔºåËøòÊúâ‰∏Ä‰∏™Ëá™Â∑±ÂÜôÁöÑ‰∏öÂä°ËÑöÊú¨ <code>my.js</code>„ÄÇ <code>my.js</code> Âõ†‰∏∫Ë¶Å‰æùËµñ‰∫é <code>jquery</code> Âíå <code>bootstrap</code> ÊâÄ‰ª•Âú®‰æùËµñÂÖ≥Á≥ª‰∏≠ÂÜô‰∫Ü‰∏äÈù¢ÁöÑÈÖçÁΩÆ„ÄÇ</p>
<p>ÂÖ≥ÈîÆÂú®‰∫é <code>export</code> ÂÖ≥ÈîÆÂ≠óÁöÑÂ£∞Êòé„ÄÇËøôÊ†∑Êàë‰ª¨Â∞±ÂèØ‰ª•Âä†ËΩΩ‰∏Ä‰∏™Ê≤°Êúâ‰ΩøÁî® <code>AMD</code> ËßÑËåÉÁºñÁ®ãÁöÑ js Ê®°Âùó‰∫Ü„ÄÇÂπ∂‰∏îÊ®°ÂùóÁöÑÊâÄÊúâÂèòÈáèÔºåÂíåÂáΩÊï∞ÔºåÈÉΩ‰∏çÊòØÂú®ÂÖ®Â±ÄÂüüÁöÑÔºåÂè™Âú® ÂõûË∞ÉÂáΩÊï∞‰∏≠ÊúâÊïà„ÄÇ‰ªéËÄåÈÅøÂÖç‰∫ÜÂÖ®Â±ÄÂèòÈáèÁöÑÊ±°ÊüìÈóÆÈ¢ò„ÄÇ</p>
<h1 id="ÂèÇËÄÉÔºö"><a href="#ÂèÇËÄÉÔºö" class="headerlink" title="ÂèÇËÄÉÔºö"></a>ÂèÇËÄÉÔºö</h1><hr>
<ul>
<li><a href="http://www.runoob.com/w3cnote/requirejs-tutorial-2.html" target="_blank" rel="noopener">JSÊ®°ÂùóÂåñÂ∑•ÂÖ∑requirejsÊïôÁ®ã(‰∫å)ÔºöÂü∫Êú¨Áü•ËØÜ</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2012/11/require_js.html" target="_blank" rel="noopener">JavascriptÊ®°ÂùóÂåñÁºñÁ®ãÔºà‰∏âÔºâÔºörequire.jsÁöÑÁî®Ê≥ï</a></li>
</ul>
]]></content>
      <categories>
        <category>Technology</category>
      </categories>
      <tags>
        <tag>ÂâçÁ´ØÂºÄÂèë</tag>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>A monitoring software for evaporator</title>
    <url>/blog/A-monitoring-software-for-evaporator/</url>
    <content><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Accompanied by the development of automation technology, configuration technology, DCS PLC and other industrial control technology advance with each passing day, monitoring configuration software is becoming more and more widespread in the field of industrial control. To improve the productive efficiency of evaporators, and to ensure the safety of the production, this project has designed a control system.</p>
<p>This project uses the Siemens WinCC configuration software to develop a monitoring system, configuring the communication between the upper and the lower computer. Siemens WinCC configuration software is a user-friendly interface software, by which users can edit interface of the operation screen, monitor screen, the alarm screen, real-time trend curves, history trend curve, and print as required.</p>
<p>The system has real-time dynamic display and operation functions. It can monitor the production process of the falling film evaporator system, can achieve remote operation of the on-site equipment, and can show the operation status of the device. It can also draw the pressure-time curve, record the time when operators login, and export alarm records, data records and other records from the database.</p>
<p>This system lowers the operator‚Äôs labor strength and improves productive efficiency via setting user permissions and alarm through a user-friendly interface.</p>
<h1 id="Software"><a href="#Software" class="headerlink" title="Software"></a>Software</h1><p>This project was finished in Perth, Australia, and was used to produce condensed carrot juice.</p>
<p><img src="index.png" alt=""></p>
<p>This project uses PID-controller to control the pressure, flow rate and temperature.</p>
<p><img src="facility.png" alt=""></p>
<p><img src="alarm.png" alt=""></p>
<p><img src="evaporaters.png" alt=""></p>
<p><img src="evaporater.jpg" alt=""></p>
]]></content>
      <categories>
        <category>project</category>
      </categories>
  </entry>
  <entry>
    <title>LCR meter</title>
    <url>/blog/LCR-meter/</url>
    <content><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>This project is about the ARM, CPLD, and DDS technology. Based on the LCR meter theory, the whole system consists of a signal source module, voltage &amp; current detection module, the digital process module, etc. </p>
<p>The signal source module provides DC to 500K Hz sine wave, range from 10mV to 2V along with 10mA to 1A circuit source, based on DDS technology using CPLD controller. </p>
<p>Phase detection circuit calculates the phase difference of two sine wave using multi-slope analog-to-digital technology. Digital processing uses S3C6410 chip to achieve digital filter, vector decomposition. </p>
<p>I am in charge of the circuit design and CLPD program design, C++ interface design.</p>
<h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><p><img src="overview.jpg" alt=""></p>
<ul>
<li><code>CPLD Part</code>Ôºö1. Communication Interface; 2. Multi-Slope ADC controler; 3. SPI interface; 4.DDS(Direct Digital Systhesizer) module;</li>
<li><code>Analog Circuit</code>: 1. Measuring circuit design; 2. Amplifier stability analyse; 3. SI analyse;</li>
<li><code>Coding</code>: designed Measure class, using virtual class and virtual function.</li>
</ul>
<h1 id="FPGA-architechture"><a href="#FPGA-architechture" class="headerlink" title="FPGA architechture"></a>FPGA architechture</h1><p><img src="CPLD.png" alt=""></p>
<h1 id="Prototype"><a href="#Prototype" class="headerlink" title="Prototype"></a>Prototype</h1><p><img src="LCR.jpg" alt=""></p>
]]></content>
      <categories>
        <category>project</category>
      </categories>
  </entry>
  <entry>
    <title>Freescale Smart Car Race</title>
    <url>/blog/Freescale-smart-car/</url>
    <content><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>The Freescale Cup, formerly known as the Smart Car Race, began in 2003 when Korea‚Äôs Hanyang University hosted 80 teams of students. Since that modest origin, the annual event has expanded throughout North America, Europe, China, India, Malaysia and Latin America, impacting more than 15,000 students at more than 500 schools.</p>
<p>The competition requires student teams to build, program and race a model car around a track for speed, with victory going to the fastest car that completes the course without derailing. The creation of each autonomous car requires embedded software programming and basic circuit creation, using Freescale parts included in the entry kit; student-developed motor control hardware and software, to propel and steer the intelligent vehicle; and a student-developed camera interface, to navigate the vehicle through the race.</p>
<p>In 2010, I became a member of the team of Southeast University, China. And in 2011, I became the team leader and won the <code>1st prize</code> of 7th Freescale Cup National University Students Car Race of Camera group.</p>
<h1 id="Car-model"><a href="#Car-model" class="headerlink" title="Car model"></a>Car model</h1><p>I am in charge of the circuit board design and the software programming. I designed the base algorithm to detect the roads and my team members helped me to debug the PID-control variables.</p>
<p><img src="model.png" alt="car"></p>
<p><img src="smart_car.gif" alt="video"></p>
]]></content>
      <categories>
        <category>project</category>
      </categories>
  </entry>
</search>
